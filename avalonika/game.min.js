/*! For license information please see game.min.js.LICENSE.txt */
(()=>{var t={720:(t,e,i)=>{"use strict";i.d(e,{Mx:()=>h,wU:()=>d,mL:()=>c});var s=i(302),o=i(301),n=(i(266),i(919)),r=i(73),a=i(584),l=i(750);class h extends o.p{constructor(){super(),console.log("üéÆ Application start."),this.stage=new n.H,this.lastUpdate=performance.now(),onmessage=this.onRenderMessage.bind(this),this.paused=!1,this.inputEnabled=!0,this.physicsReady=!1,this.physicsWorker=new Worker("physics.js"),this.physicsWorker.onmessage=this.onPhysicsMessage.bind(this),this.physicsWorker.postMessage({msg:"setStageBound",args:[640,480,!0,!0,!0,!0]}),this.logicalViewport=new r.UL(0,0,0,0),this.logicalViewportOffset=new r.E9(self._deviceInfo.logicalViewportOffset),this.logicalViewportScale=new r.E9(self._deviceInfo.logicalViewportScale),this.deviceViewport=new r.UL(self._deviceInfo.deviceViewport),this.init(640,480,60,h.ScaleModes.LETTERBOX)}init(t,e,i=60,s=h.ScaleModes.LETTERBOX){this.logicalViewport=new r.UL(0,0,t,e),this.setUpdateFPS(i),this.postMessageToRender({msg:"addCommand",class:"Application",method:"setLogicalViewport",args:[this.logicalViewport.xywh,s]})}onPhysicsMessage(t){"ready"==t.data.msg&&(console.log("üëç Physics ready."),this.physicsReady=!0)}onRenderMessage(t){const e=t.data;"render"==e.msg?this.renderTick():"deviceInfo"==e.msg?(this.deviceViewport=new r.UL(e.info.deviceViewport),this.logicalViewportOffset=new r.E9(e.info.logicalViewportOffset),this.logicalViewportScale=new r.E9(e.info.logicalViewportScale),this.dispatchEvent(l.j.RESIZE)):"Asset_loadCompleted"==e.msg?s.x.dispatchLoadedEvent(e.id):"input"==e.msg&&this.enableInput?this.onInputMessage(e.inputType,e.secondlyInputType,e.inputData):console.log("onRenderMessage",t)}get logicalRenderBounds(){return new r.UL(-this.logicalViewportOffset.x,-this.logicalViewportOffset.y,this.logicalViewport.width+2*this.logicalViewportOffset.x,this.logicalViewport.height+2*this.logicalViewportOffset.y)}onInputMessage(t,e,i){const s=new l.j(t);Object.assign(s,i),this.stage.dispatchEventWithChildren(s),!s.stopped&&e&&(s.name=e,this.stage.dispatchEventWithChildren(s))}renderTick(){const t=(performance.now()-this.lastUpdate)/(1e3/this.updateFPS),e=Math.round(t);if(!this.paused)for(let t=0;t<Math.min(5,e);t++)this.update();this.lastUpdate+=1e3/this.updateFPS*e}update(){this.dispatchEvent(l.j.BEFORE_UPDATE),o.p.doEnterFrame();let[t,e]=this.stage.encodeRenderingInfoWithChildren();this.physicsReady&&this.physicsWorker.postMessage({msg:"update"}),this.postMessageToRender({msg:"update",renderingInfo:t},e),this.dispatchEvent(l.j.AFTER_UPDATE)}setUpdateFPS(t){this.updateFPS=t,this.postMessageToRender({msg:"addCommand",class:"Application",method:"setUpdateFPS",args:[this.updateFPS]})}setPaused(t){this.paused=t,this.enableInput(!t)}enableInput(t){this.inputEnabled=t}setBackgroundColor(t){this.postMessageToRender({msg:"addCommand",class:"Application",method:"setBackgroundColor",args:[a.c.hex2rgba(t)]})}postMessageToRender(t,e){postMessage(t,e)}preload(t,e){return s.x.preload(t,e)}}h.ScaleModes={NO_SCALE:"NO_SCALE",CENTER:"CENTER",CROP:"CROP",LETTERBOX:"LETTERBOX",STRETCH:"STRETCH",FIT_WIDTH:"FIT_WIDTH",FIT_HEIGHT:"FIT_HEIGHT"},null==self.application&&(self.application=new h);const d=self.application,c=self.application.stage;console.assert(a.c.isWebWorker(),"ApplicationÏùÑ Î©îÏù∏Ïì∞Î†àÎìúÏóê ÎßåÎì§Î†§Í≥† ÌïòÍ≥† ÏûàÏùå")},302:(t,e,i)=>{"use strict";i.d(e,{x:()=>l});var s=i(720),o=i(301),n=i(750),r=i(584);const a={};class l extends o.p{constructor(t,e){super(),this.id=l.lastId++,null!=t&&t.indexOf("*")>=0?this.name=t.replace("*",this.id.toString()):this.name=null==t?"":t,this.type=null==e?l.guessType(this.name):e,l.finalizationRegistry.register(this,{thisObjId:this.id,thisType:this.type}),this.loaded=void 0,this.onLoadedHandler=this.onLoaded.bind(this,[this.id]),this.type!=l.AssetTypes.TrueTypeFont&&this.type!=l.AssetTypes.BitmapFont&&this.type!=l.AssetTypes.Sound&&this.type!=l.AssetTypes.Texture||l.loadedEventDispatcher.addEventListener(n.j.LOADED,this.onLoadedHandler),this.loadFontInfo(t)}loadFontInfo(t){if(this.type==l.AssetTypes.TrueTypeFont)a[t]?(this.fontInfo=a[t],console.log(`Ìè∞Ìä∏ ${this.name} Î°úÎìú ÏôÑÎ£å.(Ï∫êÏãú)`),this.loaded=!0,this.dispatchEvent(n.j.LOADED)):fetch(`asset/${t}.json`).then((e=>(console.assert(e.ok,`asset/${t}.json Î°úÎìúÌïòÏßÄ Î™ªÌñàÏùå.`),e.json()))).then((t=>{this.fontInfo=t,this.fontLoaded&&(a[this.name]=this.fontInfo,console.log(`Ìè∞Ìä∏ ${this.name} Î°úÎìú ÏôÑÎ£å.(jsonÏùÑ Îä¶Í≤å Î°úÎî©)`),this.loaded=!0,this.dispatchEvent(n.j.LOADED))}));else if(this.type==l.AssetTypes.BitmapFont||this.type==l.AssetTypes.MsdfFont){const e=r.c.getEmbeddedFile(t+".json");this.fontInfo=JSON.parse(e),this.loaded=!0}}addEventListener(t,e,i=null,s=!1){return super.addEventListener(t,e,i,s)}release(){s.wU.postMessageToRender({msg:"addCommand",class:"Asset",method:"release",args:[this.id]})}load(t){s.wU.postMessageToRender({msg:"executeCommand",class:"Asset",method:"load",args:[{id:this.id,type:this.type,name:this.name,extraData:t}]})}update(t){s.wU.postMessageToRender({msg:"addCommand",class:"Asset",method:"load",args:[{id:this.id,type:this.type,name:this.name,extraData:t}]})}onLoaded(t,e){t==e.id&&(l.loadedEventDispatcher.removeEventListener(n.j.LOADED,this.onLoadedHandler),this.type==l.AssetTypes.TrueTypeFont?(this.fontLoaded=!0,this.fontInfo&&(a[this.name]=this.fontInfo,console.log(`Ìè∞Ìä∏ ${this.name} Î°úÎìú ÏôÑÎ£å.(ttfÎä¶Í≤å Î°úÎî©)`),this.loaded=!0,this.dispatchEvent(n.j.LOADED))):(this.loaded=!0,this.dispatchEvent(n.j.LOADED)))}static finalizeHandler(t){s.wU.postMessageToRender({msg:"addCommand",class:"Asset",method:"release",args:[t.thisObjId]})}static dispatchLoadedEvent(t){l.loadedEventDispatcher.dispatchEvent(n.j.LOADED,{id:t})}static guessType(t){const e=/\.[^.]+$/.exec(t),i=null!=e?e[0].toLowerCase():"";return".png"==i||".jpg"==i?l.AssetTypes.Texture:".wav"==i||".mp3"==i?l.AssetTypes.Sound:".ttf"==i?l.AssetTypes.TrueTypeFont:null}static findPreloadedAsset(t){for(let e of l.preloadAssets)if(e.name==t)return e;return null}static preload(t,e){return new Promise(((e,i)=>{for(let e of t){const t=new l(e);t.load(),l.preloadAssets.push(t),l.preloadAssetPromises.push(t.eventToPromise(n.j.LOADED))}Promise.all(l.preloadAssetPromises).then(e)}))}}l.AssetTypes={Texture:"Texture",RenderTarget:"RenderTarget",Sound:"Sound",Shader:"Shader",TrueTypeFont:"TrueTypeFont",MsdfFont:"MsdfFont",BitmapFont:"BitmapFont",PostProcessFilter:"PostProcessFilter"},l.lastId=1,l.finalizationRegistry=new FinalizationRegistry(l.finalizeHandler),l.loadedEventDispatcher=new o.p,l.preloadAssets=[],l.preloadAssetPromises=[]},873:(t,e,i)=>{"use strict";i.d(e,{F:()=>n});var s=i(301);i(584);const o=new WeakMap;class n extends s.p{constructor(){super(),this.__components={}}addComponent(t){const e=t.getName();null!=t.holder&&t.removeFromHolder(),null!=this.__components[e]&&this.__components[e].removeFromHolder(),this.__components[e]=t;const i=o.get(t.constructor)||[];return i.includes(t)||(i.push(t),o.set(t.constructor,i)),t.holder=new Proxy(this,{get:(e,i)=>"addEventListener"==i?function(i,s,o,n){t.__savedHandlers=t.__savedHandlers||{},t.__savedHandlers[i]=t.__savedHandlers[i]||[],t.__savedHandlers[i].push([s,o]),e.addEventListener(...arguments)}:e[i]}),t.onAdded?t.onAdded.call(t,t.holder):Object.getPrototypeOf(t).onAdded&&Object.getPrototypeOf(t).onAdded.call(t,t.holder),t}createComponent(t,e){const i=new t;return this.addComponent(Object.assign(i,e)),i}removeComponent(t){if("function"==typeof t&&null!=t.prototype){for(const e in this.__components)t.getName()==e&&this.removeComponent(this.__components[e]);return}const e=t.getName();if(t.onRemoved?t.onRemoved.call(t,t.holder):Object.getPrototypeOf(t).onRemoved&&Object.getPrototypeOf(t).onRemoved.call(t,t.holder),delete this.__components[e],t.__savedHandlers){console.log(`${e}Ïùò Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨Î•º Ï†ïÎ¶¨ÌïúÎã§`);for(const e in t.__savedHandlers)for(const[i,s]of t.__savedHandlers[e])console.log(`${e} Ïù¥Î≤§Ìä∏ Ìï∏Îì§Îü¨ ÏÇ≠Ï†ú`),this.removeEventListener(e,i,s)}const i=o.get(t.constructor);console.assert(Array.isArray(i));const s=i.indexOf(t);s>=0&&(i.splice(s,1),i.length>0?o.set(t.constructor,i):o.delete(t.constructor))}hasComponent(t){return null!=this.__components[t.name]}get components(){return this.__components}getComponent(t){return this.__components["string"==typeof t?t:t.name]}getCompatibleComponents(t){const e=[];for(const i in this.__components){const s=this.__components[i];s instanceof t&&e.push(s)}return e}static getAllComponents(t){return o.get(t)}static getAllComponentHolders(...t){let e;e=this.getAllComponents(t[0]);for(let i=1;i<t.length;i++){const s=this.getAllComponents(t[i]);e=s.filter(((t,i,s)=>e.includes(t)))}const i=[];for(const t of e)i.push(t.holder);return i}hasAllComponents(...t){for(const e of t)if(!this.hasComponent(e))return!1;return!0}}n.registeredHolders={}},750:(t,e,i)=>{"use strict";i.d(e,{j:()=>s});class s{constructor(t="@EVENT"+ ++s.nextId,e,i){this.name=t,this.stopped=!1,this.target=void 0,this.component=void 0,this.owner=i,this.forwarded=!1,e&&Object.assign(this,e)}on(t,e){return null==this.owner&&(this.owner=new s.EventDispatcher),this.owner.on(this.name,t,e),this}once(t,e){return null==this.owner&&(this.owner=new s.EventDispatcher),this.owner.once(this.name,t,e),this}onStage(t,e,i){return console.assert(this.owner&&this.owner.addChild,"SpriteÍ∞Ä ÏïÑÎãàÎ©¥ onStageÎ•º Ìï† Ïàò ÏóÜÏäµÎãàÎã§."),this.owner.onStage(this.name,t,e,i),this}remove(t,e){return null==this.owner&&(this.owner=new s.EventDispatcher),this.owner.removeEventListener(this.name,t,e),this}dispatch(t){return null==this.owner&&(this.owner=new s.EventDispatcher),Object.assign(this,t),this.owner.dispatchEvent(this),this}stopPropagation(){this.stopped=!0}getTarget(){return this.target}static isInputEvent(t){const e=s.eventAttribs[t];if(null!=e)return 1==e.isInput}}s.STAGE_VISIBLE="stageVisible",s.STAGE_FOCUS="stageFocus",s.ENTER_FRAME="enterFrame",s.RENDER="render",s.ADDED_TO_STAGE="addedToStage",s.REMOVED_FROM_STAGE="removedFromStage",s.POINTER_DOWN="pointerDown",s.POINTER_UP="pointerUp",s.POINTER_MOVE="pointerMove",s.MOUSE_DOWN="mouseDown",s.MOUSE_UP="mouseUp",s.MOUSE_MOVE="mouseMove",s.MOUSE_WHEEL="mouseWheel",s.MOUSE_DOWN="touchesBegin",s.MOUSE_UP="touchesEnd",s.TOUCHES_MOVE="touchesMove",s.MOUSE_UP="touchesCancel",s.KEY_UP="keyUp",s.KEY_DOWN="keyDown",s.TIMER="timer",s.TEXTURE_UPDATE="textureUpdate",s.RESIZE="resize",s.READY="ready",s.COMPLETE="complete",s.ERROR="error",s.BEFORE_UPDATE="beforeUpdate",s.AFTER_UPDATE="afterUpdate",s.LOADED="loaded",s.ALL="*",s.APPLICATION_INIT="APPLICATION_INIT",s.APPLICATION_START="APPLICATION_START",s.eventAttribs={[s.POINTER_DOWN]:{isInput:!0},[s.POINTER_UP]:{isInput:!0},[s.POINTER_MOVE]:{isInput:!0},[s.MOUSE_DOWN]:{isInput:!0,device:"mouse"},[s.MOUSE_UP]:{isInput:!0,device:"mouse"},[s.MOUSE_MOVE]:{isInput:!0,device:"mouse"},[s.MOUSE_WHEEL]:{isInput:!0,device:"mouse"},[s.MOUSE_DOWN]:{isInput:!0,device:"touch"},[s.MOUSE_UP]:{isInput:!0,device:"touch"},[s.TOUCHES_MOVE]:{isInput:!0,device:"touch"},[s.MOUSE_UP]:{isInput:!0,device:"touch"},[s.KEY_UP]:{isInput:!0,device:"keyboard"},[s.KEY_DOWN]:{isInput:!0,device:"keyboard"}},s.EventDispatcher=void 0,s.nextId=0},301:(t,e,i)=>{"use strict";i.d(e,{p:()=>r});var s=i(729),o=i.n(s),n=i(750);class r{constructor(){this.eventEmitter=new(o())}triggerable(){return this.__triggers={},new Proxy(this,{set(t,e,i,s){const o=Reflect.set(t,e,i,s),n=t.__triggers[e];if(n)for(const[i,s]of n)(null==s||s(t,e))&&t.dispatchEvent(i,{key:e});return o}})}newEvent(t,e){return new n.j(e,t,this)}newTrigger(t,e,i){console.assert(null!=this.__triggers,"Ïù¥ Í∞úÏ≤¥Îäî triggerableÏù¥ ÏïÑÎãôÎãàÎã§.");const s=new n.j(i);for(const i in t)t[i]?(this.__triggers[i]=null!=this.__triggers[i]?this.__triggers[i]:[],this.__triggers[i].push([s.name,e])):delete this.__triggers[i];return s}hasEventListener(t){return this.eventEmitter.listeners(t).length>0}addEventListener(t,e,i=null,s=!1){return s?this.eventEmitter.once(t,e,i||this):this.eventEmitter.on(t,e,i||this),t==n.j.ENTER_FRAME||t==n.j.RENDER?(this.addEventListener(n.j.ADDED_TO_STAGE,(()=>{r.enterFrameList.set(this,null!=this.eventEmitter._events[t]?this.eventEmitter._events[t].length:1)})),this.addEventListener(n.j.REMOVED_FROM_STAGE,(()=>{r.enterFrameList.delete(this)})),this.isOnStage()&&r.enterFrameList.set(this,null!=this.eventEmitter._events[t]?this.eventEmitter._events[t].length:1)):n.j.isInputEvent(t)&&(this.hasInputEvents=!0),this}addUniqueEventListener(t,e,i,s=!1){return this.removeEventListener(t,e,i),this.addEventListener(t,e,i,s),this}dispatchEvent(t,e){let i;return i="string"==typeof t?new n.j(t):t,i.target=this,Object.assign(i,e),i.forwarded||this.eventEmitter.emit("*",i),this.eventEmitter.emit(i.name,i)}removeEventListener(t,e,i){if(this.eventEmitter.removeListener(t,e,i||this),t!=n.j.ENTER_FRAME&&t!=n.j.RENDER||null!=this.eventEmitter._events[t]&&0!=this.eventEmitter._events[t].length||r.enterFrameList.delete(this),n.j.isInputEvent(t))for(const t in this.eventEmitter._events)if(n.j.isInputEvent(t)){this.hasInputEvents=!0;break}}removeAllEventListeners(t){if(this.eventEmitter.removeAllListeners(t),t!=n.j.ENTER_FRAME&&t!=n.j.RENDER||!(t&&null==this.eventEmitter._events[t]||0==this.eventEmitter._events[t].length)||r.enterFrameList.delete(this),t&&n.j.isInputEvent(t))for(const t in this.eventEmitter._events)if(n.j.isInputEvent(t)){this.hasInputEvents=!0;break}}addEventListenerOnStage(t,e,i,s=this,o=!1){const r=this;return s.addEventListener(n.j.ADDED_TO_STAGE,(()=>{r.addEventListener(t,e,i,o)}),this),s.addEventListener(n.j.REMOVED_FROM_STAGE,(()=>{r.removeEventListener(t,e,i)}),this),this}on(t,e,i){return this.addEventListener(t,e,i)}once(t,e,i){return this.addEventListener(t,e,i,!0)}onStage(t,e,i,s=this){return this.addEventListenerOnStage(t,e,i,s)}beforeRender(t,e,i=!0){i&&this.removeEventListener(n.j.RENDER,t,e),this.addEventListener(n.j.RENDER,t,e,!0)}startForwardEvents(t,e){for(let i=0;i<t.length;i++){const s=t[i];this.addEventListener(s,e.dispatchEvent.bind(e,[s]))}}stopForwardEvents(t,e){for(let i=0;i<t.length;i++){const s=t[i];this.removeEventListener(s,e.dispatchEvent.bind(e,[s]))}}waitEvents(t,e,i){const s=[];let o;const n=()=>{let e=0;for(const i in t){let s,n=this;Array.isArray(t[i])?[s,n]=t[i]:s=t[i],n.removeEventListener(s,o,e),e++}};o=function(){s[this-1]++;for(let t=0;t<s.length;t++)if(0==s[t])return;n(),e.call(i)};for(const e in t){let i,n=this;Array.isArray(t[e])?[i,n]=t[e]:i=t[e];const r=s.length+1;n.addEventListener(i,o,r),s.push(0)}}addCombinedEvents(t,e){return this.waitEvents(e,(()=>{this.dispatchEvent(t)})),this}eventToPromise(t){return new Promise(((e,i)=>{this.addEventListener(t,e)}))}static doEnterFrame(){if(r.enterFramePaused)return 0;let t=0;for(const[e,i]of r.enterFrameList.entries())e.dispatchEvent(n.j.ENTER_FRAME),e.dispatchEvent(n.j.RENDER),t+=i;return t}}r.prototype.tween=void 0,r.prototype.move=void 0,r.prototype.wait=void 0,r.prototype.getTweens=void 0,r.prototype.stopAllTweens=void 0,r.enterFramePaused=!1,n.j.EventDispatcher=r,r.enterFrameList=new Map},718:(t,e,i)=>{"use strict";i.d(e,{K:()=>r});var s=i(266),o=(i(550),i(73)),n=i(584);class r extends s.j{constructor(){super(),this._$$spriteType=s.j.SpriteTypes.MESH,this._$$updateCode=s.j.UpdateCodes.UPDATE_NOTHING,this.dirty={positionOffset:0,positionLength:0,texCoordOffset:0,texCoordLength:0,colorOffset:0,colorLength:0,indexOffset:0,indexLength:0,textureReset:!1,positionReset:!1,texCoordReset:!1,colorReset:!1,indexReset:!1},this.a_position=void 0,this.a_texCoord=void 0,this.a_color=void 0,this.indices=void 0,this.a_genericArray=void 0}setTexture(t){this.texture=t,this._$$updateCode|=s.j.UpdateCodes.UPDATE_EXTRA,this.dirty.textureReset=!0}setTextureCoordinateArray(t){this.dirty.texCoordReset=!(this.a_texCoord&&this.a_texCoord.length>=t.length),this.a_texCoord=new Float32Array(t),this._$$updateCode|=s.j.UpdateCodes.UPDATE_EXTRA,this.dirty.texCoordOffset=0,this.dirty.texCoordLength=this.a_texCoord.length}setTextureCoordinates(...t){let e=1/0,i=-1/0;for(let s=0;s<t.length;s+=3){const o=t[s],n=t[s+1],r=t[s+2];this.a_texCoord[2*o]=n,this.a_texCoord[2*o+1]=r,e=Math.min(e,o),i=Math.max(i,o)}this._$$updateCode|=s.j.UpdateCodes.UPDATE_EXTRA,this.dirty.texCoordOffset=2*Math.min(this.dirty.texCoordOffset/2,e),this.dirty.texCoordLength=2*Math.max((this.dirty.texCoordOffset+this.dirty.texCoordLength)/2,i)}setTextureCoordinate(t,e,i){this.a_texCoord[2*t]=e,this.a_texCoord[2*t+1]=i}getTextureCoordinate(t){return new o.E9(this.a_texCoord[2*t],this.a_texCoord[2*t+1])}_calculateLocalBounds(t=0,e=this.a_position.length/2){let i=1/0,s=-1/0,o=1/0,n=-1/0;for(let r=t;r<2*e;r+=2){const t=this.a_position[r],e=this.a_position[r+1];i=Math.min(t,i),s=Math.max(t,s),o=Math.min(e,o),n=Math.max(e,n)}this._$$localBounds.x=i,this._$$localBounds.y=o,this._$$localBounds.width=s-i,this._$$localBounds.height=n-o}setVertexArray(t){this.dirty.positionReset=!(this.a_position&&this.a_position.length>=t.length),this.a_position=new Float32Array(t),this._$$updateCode|=s.j.UpdateCodes.UPDATE_EXTRA,this.useCustomLocalBounds||this._calculateLocalBounds(),this.dirty.positionOffset=0,this.dirty.positionLength=this.a_position.length}setVertices(...t){let e=1/0,i=-1/0,o=this._$$localBounds.left,n=this._$$localBounds.right,r=this._$$localBounds.top,a=this._$$localBounds.bottom;for(let s=0;s<t.length;s+=3){const l=t[s],h=t[s+1],d=t[s+2];this.a_position[2*l]=h,this.a_position[2*l+1]=d,o=Math.min(h,o),n=Math.max(h,n),r=Math.min(d,r),a=Math.min(d,a),e=Math.min(e,l),i=Math.max(i,l)}this._$$updateCode|=s.j.UpdateCodes.UPDATE_EXTRA,this.useCustomLocalBounds||(this._$$localBounds.x=o,this._$$localBounds.y=r,this._$$localBounds.width=n-o,this._$$localBounds.height=a-r),this.dirty.positionOffset=2*Math.min(this.dirty.positionOffset/2,e),this.dirty.positionLength=2*Math.max((this.dirty.positionOffset+this.dirty.positionLength)/2,i)}setVertex(t,e,i){this.a_position[2*t]=e,this.a_position[2*t+1]=i}getVertex(t){return new o.E9(this.a_position[2*t],this.a_position[2*t+1])}setColorArray(t){this.dirty.colorReset=!(this.a_color&&this.a_color.length>=2*t.length),this.a_color=new Uint8Array(2*t.length);for(let e=0;e<t.length;e+=2)this.a_color[2*e+0]=t[e]>>16&255,this.a_color[2*e+1]=t[e]>>8&255,this.a_color[2*e+2]=255&t[e],this.a_color[2*e+3]=255*t[e+1];this._$$updateCode|=s.j.UpdateCodes.UPDATE_EXTRA,this.dirty.colorOffset=0,this.dirty.colorLength=this.a_color.length}setColors(...t){let e=1/0,i=-1/0;for(let s=0;s<t.length;s+=3){const o=t[s],n=t[s+1],r=t[s+2];this.a_color[4*o]=n>>16&255,this.a_color[4*o+1]=n>>8&255,this.a_color[4*o+2]=255&n,this.a_color[4*o+3]=255*r,e=Math.min(e,o),i=Math.max(i,o)}this._$$updateCode|=s.j.UpdateCodes.UPDATE_EXTRA,this.dirty.colorOffset=4*Math.min(this.dirty.colorOffset/4,e),this.dirty.colorLength=4*Math.max((this.dirty.colorOffset+this.dirty.colorLength)/4,i)}getColorArraySize(){return this.a_color.length/4}setRgbaColorArray(t){this.dirty.colorReset=!(this.a_color&&this.a_color.length>=t.length),this.a_color=new Uint8Array(t.map((t=>255*t))),this._$$updateCode|=s.j.UpdateCodes.UPDATE_EXTRA,this.dirty.colorOffset=0,this.dirty.colorLength=this.a_color.length}setColor(t,e,i){const s=n.c.hex2rgba(e,i);this.a_color[4*t]=s[0],this.a_color[4*t+1]=s[1],this.a_color[4*t+2]=s[2],this.a_color[4*t+3]=s[3]}getColor(t){return{color:16777215&n.c.rgba2hex(this.a_color,4*t),alpha:this.a_color[4*t+3]}}setIndexArray(t){this.dirty.indexReset=!0,this.indices=new Uint16Array(2*Math.ceil(t.length/2)),this.indices.set(t),this._$$updateCode|=s.j.UpdateCodes.UPDATE_EXTRA,this.dirty.indexOffset=0,this.dirty.indexLength=this.indices.length}setIndices(...t){let e=1/0,i=-1/0;for(let s=0;s<t.length;s+=2){const o=t[s],n=t[s+1];this.indices[o]=n,e=Math.min(e,o),i=Math.max(i,o)}this._$$updateCode|=s.j.UpdateCodes.UPDATE_EXTRA,this.dirty.indexOffset=Math.min(this.dirty.indexOffset,e),this.dirty.indexLength=Math.max(this.dirty.indexOffset+this.dirty.indexLength,i)}getIndex(t){return this.indices[t]}setIndex(t,e){this.indices[t]=e}setGenericArray(t,e,i=r.ArrayTypes.FLOAT32,o=1,n=!1){this.a_genericArray=this.a_genericArray||{},this.a_genericArray[t]={data:new i(e),numComponents:o,normalize:n},this._$$updateCode|=s.j.UpdateCodes.UPDATE_EXTRA}static createBox(t,e,i,s,o=16777215,n=1){const a=new r;return a.setVertexArray([t,e,t+i,e,t,e+s,t+i,e+s]),a.setColorArray([o,n,o,n,o,n,o,n]),a.setIndexArray([0,1,2,1,3,2]),a}encodeExtraRenderingInfo(){const t=new Float32Array(14+this.dirty.positionLength+this.dirty.texCoordLength+Math.ceil(this.dirty.colorLength/4)+Math.ceil(this.dirty.indexLength/2));t.set([null!=this.texture?this.texture.asset.id:0,this.dirty.positionOffset,this.dirty.positionLength,this.dirty.texCoordOffset,this.dirty.texCoordLength,this.dirty.colorOffset,this.dirty.colorLength,this.dirty.indexOffset,this.dirty.indexLength,+this.dirty.textureReset,+this.dirty.positionReset,+this.dirty.texCoordReset,+this.dirty.colorReset,+this.dirty.indexReset]);let e,i,s=14;if(this.dirty.positionLength>0&&(t.set(o.Th.subarray(this.a_position,this.dirty.positionOffset,this.dirty.positionLength),s),s+=this.dirty.positionLength),this.dirty.texCoordLength>0&&(t.set(o.Th.subarray(this.a_texCoord,this.dirty.texCoordOffset,this.dirty.texCoordLength),s),s+=this.dirty.texCoordLength),this.dirty.colorLength>0&&(t.set(o.Th.Uint8ToFloat32(this.a_color,this.dirty.colorOffset,this.dirty.colorLength),s),s+=this.dirty.colorLength/4),this.dirty.indexLength>0&&t.set(o.Th.Uint16ToFloat32(this.indices,this.dirty.indexOffset,this.dirty.indexLength),s),this.dirty.textureReset=!1,this.dirty.positionReset=!1,this.dirty.texCoordReset=!1,this.dirty.colorReset=!1,this.dirty.indexReset=!1,this.a_genericArray){e=this.a_genericArray,i=[];for(let t in this.a_genericArray)i.push(this.a_genericArray[t].data.buffer)}return[t,null,e,i]}}r.ArrayTypes={UINT32:Uint32Array,UINT16:Uint16Array,UINT8:Uint8Array,FLOAT32:Float32Array}},244:(t,e,i)=>{"use strict";i.d(e,{A:()=>l});var s=i(720),o=i(699),n=(i(266),i(750),i(584)),r=i(73),a=i(302);class l extends o.W{constructor(t,e,i=!1){super(),this.asset=new a.x("<RT:*>",a.x.AssetTypes.RenderTarget),this.width=t,this.height=e,this.uvRect=new r.UL(0,0,this.width,this.height),this.asset.load({width:this.width,height:this.height,filter:i})}clear(t=0,e=0){s.wU.postMessageToRender({msg:"addCommand",class:"RenderTarget",method:"clear",args:[this.asset.id,n.c.hex2rgba(t,e)]})}draw(t){let[e,i]=t.encodeRenderingInfoWithChildren();s.wU.postMessageToRender({msg:"addCommand",class:"RenderTarget",method:"draw",args:[this.asset.id,e]},i)}}},65:(t,e,i)=>{"use strict";i.d(e,{i:()=>c});var s=i(266),o=i(750),n=(i(584),i(611)),r=i(718),a=i(244);function l(t){return t*Math.PI/180}let h;function d(t){return t}class c extends s.j{constructor(t,e,i,o,n,r,a){super(),this.application=t,this.stage=t.stage,this.x1=e,this.y1=i,this.x2=e+o,this.y2=i+n,this.lw=r,this.lh=a,this.tweening=!1,this.transitionEventCatcher=new s.j,this._blackMesh=null,this._RT=null}static accordionLeft(t,e,i,s,o){const n=t.lw,r=1-s,a=s;e.setScaleX(r),i.setX(n*r),i.setScaleX(a)}static accordionRight(t,e,i,s,o){const n=t.lw,r=1-s,a=s;e.setX(n*a),e.setScaleX(r),i.setScaleX(a)}static zoomOut(t,e,i,s,o){const n=t.lw,r=t.lh,a=s+1,l=s,h=1-1.2*s;e.setAlpha(h),h<=0&&e.setVisible(!1),e.setScale(a),e.setPosition(-(n*a-n)/2,-(r*a-r)/2),i.setAlpha(s),i.setScale(l),i.setPosition(-(n*l-n)/2,-(r*l-r)/2)}static zoomIn(t,e,i,s,o){const n=t.lw,r=t.lh,a=s+1,l=s;e.setAlpha(1-s),e.setScale(a),e.setPosition(-(n*a-n)/2,-(r*a-r)/2),i.setAlpha(s),i.setScale(l),i.setPosition(-(n*l-n)/2,-(r*l-r)/2)}static zoomOutCross(t,e,i,s,o){const n=t.lw,r=t.lh,a=s+1,l=1-s+1,h=1-1.2*s;e.setAlpha(h),h<=0&&e.setVisible(!1),e.setScale(a),e.setPosition(-(n*a-n)/2,-(r*a-r)/2),i.setAlpha(s),i.setScale(l),i.setPosition(-(n*l-n)/2,-(r*l-r)/2)}static zoomInCross(t,e,i,s,o){const n=t.lw,r=t.lh,a=1-s,l=s;e.setAlpha(1-s),e.setScale(a),e.setPosition(-(n*a-n)/2,-(r*a-r)/2),i.setAlpha(s),i.setScale(l),i.setPosition(-(n*l-n)/2,-(r*l-r)/2)}static spinCW(t,e,i,s,o){const n=t.lw,r=t.lh,a=180*s,h=180+180*s,[d,c]=[Math.cos(l(a))*n/2-Math.sin(l(a))*r/2-n/2,Math.sin(l(a))*n/2+Math.cos(l(a))*r/2-r/2],[u,p]=[Math.cos(l(h))*n/2-Math.sin(l(h))*r/2-n/2,Math.sin(l(h))*n/2+Math.cos(l(h))*r/2-r/2];e.setAlpha(1-s),i.setAlpha(s),e.setRotation(a),i.setRotation(h),e.setPosition(-d,-c),i.setPosition(-u,-p)}static spinCCW(t,e,i,s,o){const n=t.lw,r=t.lh,a=180+180*(1-s),h=180*(1-s),[d,c]=[Math.cos(l(a))*n/2-Math.sin(l(a))*r/2-n/2,Math.sin(l(a))*n/2+Math.cos(l(a))*r/2-r/2],[u,p]=[Math.cos(l(h))*n/2-Math.sin(l(h))*r/2-n/2,Math.sin(l(h))*n/2+Math.cos(l(h))*r/2-r/2];e.setAlpha(1-s),i.setAlpha(s),e.setRotation(a),i.setRotation(h),e.setPosition(-d,-c),i.setPosition(-u,-p)}static spinCrossCW(t,e,i,s,o){const n=t.lw,r=t.lh,a=180*-s,h=180+180*s,[d,c]=[Math.cos(l(a))*n/2-Math.sin(l(a))*r/2-n/2,Math.sin(l(a))*n/2+Math.cos(l(a))*r/2-r/2],[u,p]=[Math.cos(l(h))*n/2-Math.sin(l(h))*r/2-n/2,Math.sin(l(h))*n/2+Math.cos(l(h))*r/2-r/2];e.setAlpha(1-s),i.setAlpha(s),e.setRotation(a),i.setRotation(h),e.setPosition(-d,-c),i.setPosition(-u,-p)}static spinCrossCCW(t,e,i,s,o){const n=t.lw,r=t.lh,a=180*s,h=180+180*-s,[d,c]=[Math.cos(l(a))*n/2-Math.sin(l(a))*r/2-n/2,Math.sin(l(a))*n/2+Math.cos(l(a))*r/2-r/2],[u,p]=[Math.cos(l(h))*n/2-Math.sin(l(h))*r/2-n/2,Math.sin(l(h))*n/2+Math.cos(l(h))*r/2-r/2];e.setAlpha(1-s),i.setAlpha(s),e.setRotation(a),i.setRotation(h),e.setPosition(-d,-c),i.setPosition(-u,-p)}static balloon(t,e,i,s,o){const n=t.lw,r=t.lh,a=s+1,l=1-s+1,h=1-s,d=s;e.setAlpha(1-s),e.setScale(a,h),e.setPosition(-(n*a-n)/2,-(r*h-r)/2),i.setAlpha(s),i.setScale(l,d),i.setPosition(-(n*l-n)/2,-(r*d-r)/2)}static tv(t,e,i,s,o){const n=t.lw,r=t.lh,a=3*s+1,l=.2*s+.8,h=1-s,d=s;e.setAlpha(1-s),e.setScale(a,h),e.setPosition(-(n*a-n)/2,-(r*h-r)/2),i.setAlpha(s),i.setScale(l,d),i.setPosition(-(n*l-n)/2,-(r*d-r)/2)}static getWiperV2(t,e,i){const s=new r.K;return s.setVertexArray([0,0,e,0,0,1.2*i,e,i,0,1.4*i,e,1.2*i]),s.setColorArray([0,1,0,1,0,1,0,1,0,0,0,0]),s.setIndexArray([0,1,2,1,3,2,2,3,4,3,4,5]),s.setColorMultiplier(0,0,0),s}static getWiperV(t,e,i){const s=new r.K;return s.setVertexArray([0,0,e,0,0,i,e,i,0,1.2*i,e,1.2*i]),s.setColorArray([0,1,0,1,0,1,0,1,0,0,0,0]),s.setIndexArray([0,1,2,1,3,2,2,3,4,3,4,5]),s.setColorMultiplier(0,0,0),s}static getWiperH(t,e,i){const s=new r.K;return s.setVertexArray([0,0,e,0,0,i,e,i,1.2*e,0,1.2*e,i]),s.setColorArray([0,1,0,1,0,1,0,1,0,0,0,0]),s.setIndexArray([0,1,2,1,3,2,1,4,3,4,5,3]),s.setColorMultiplier(0,0,0),s}static wipeUp2(t,e,i,s,o){const n=-t.x1,r=-t.y1,a=t.x2-t.x1,l=t.y2-t.y1;if(t._blackMesh&&t._blackMesh.removeFromParent(),s<.5){e.setVisible(!0),i.setVisible(!1);const o=c.getWiperV2(t,a,l);t._blackMesh=o,t.addChild(o),o.setScaleY(-1),o.setX(-n),o.setY(l*(1+1.4*(1-2*s))-r)}else{const o=2*(s-.5);e.setVisible(!1),i.setVisible(!0);const h=c.getWiperV2(t,a,l);t._blackMesh=h,h.setScaleX(-1),t.addChild(h),h.setX(a-n),h.setY(l*(1.4*-o)-r)}}static wipeDown(t,e,i,s,o){const n=-t.x1,r=-t.y1,a=t.x2-t.x1,l=t.y2-t.y1;if(t._blackMesh&&t._blackMesh.removeFromParent(),s<.5){const o=2*s;e.setVisible(!0),i.setVisible(!1);const h=c.getWiperV(t,a,l);t._blackMesh=h,t.addChild(h),h.setX(-n),h.setY(-l*(1-o)*1.2-r)}else{const o=2*(s-.5);e.setVisible(!1),i.setVisible(!0);const h=c.getWiperV(t,a,l);t._blackMesh=h,t.addChild(h),h.setScaleY(-1),h.setX(-n),h.setY(l*(1+1.2*o)-r)}}static wipeUp(t,e,i,s,o){const n=-t.x1,r=-t.y1,a=t.x2-t.x1,l=t.y2-t.y1;if(t._blackMesh&&t._blackMesh.removeFromParent(),s<.5){e.setVisible(!0),i.setVisible(!1);const o=c.getWiperV(t,a,l);t._blackMesh=o,t.addChild(o),o.setScaleY(-1),o.setX(-n),o.setY(l*(1+1.2*(1-2*s))-r)}else{const o=2*(s-.5);e.setVisible(!1),i.setVisible(!0);const h=c.getWiperV(t,a,l);t._blackMesh=h,t.addChild(h),h.setX(-n),h.setY(l*(1.2*-o)-r)}}static wipeRight(t,e,i,s,o){const n=-t.x1,r=-t.y1,a=t.x2-t.x1,l=t.y2-t.y1;if(t._blackMesh&&t._blackMesh.removeFromParent(),s<.5){const o=2*s;e.setVisible(!0),i.setVisible(!1);const h=c.getWiperH(t,a,l);t._blackMesh=h,t.addChild(h),h.setX(-a*(1-o)*1.2-n),h.setY(-r)}else{const o=2*(s-.5);e.setVisible(!1),i.setVisible(!0);const h=c.getWiperH(t,a,l);t._blackMesh=h,t.addChild(h),h.setScaleX(-1),h.setX(a*(1+1.2*o)-n),h.setY(-r)}}static wipeLeft(t,e,i,s,o){const n=-t.x1,r=-t.y1,a=t.x2-t.x1,l=t.y2-t.y1;if(t._blackMesh&&t._blackMesh.removeFromParent(),s<.5){e.setVisible(!0),i.setVisible(!1);const o=c.getWiperH(t,a,l);t._blackMesh=o,t.addChild(o),o.setScaleX(-1),o.setX(a*(1+1.2*(1-2*s))-n),o.setY(-r)}else{const o=2*(s-.5);e.setVisible(!1),i.setVisible(!0);const h=c.getWiperH(t,a,l);t._blackMesh=h,t.addChild(h),h.setX(a*(1.2*-o)-n),h.setY(-r)}}static getClockMesh(t,e,i,s){s<0&&(s=0),s>1&&(s=1);const o=360*s,n=Math.floor(8*s)+1,a=o%45,h=Math.sin(l(a));let d=[],c=[];1==s?(d=[0*e,0*i,1*e,0*i,1*e,1*i,0*e,1*i],c=[0,1,2,2,3,0]):1==n?(d=[.5*e,0*i,(.5+h)*e,0*i,.5*e,.5*i],c=[0,1,2]):2==n?(d=[1*e,0*i,1*e,h*i,.5*e,.5*i,.5*e,0*i],c=[0,1,2,3,0,2]):3==n?(d=[1*e,.5*i,1*e,(.5+h)*i,.5*e,.5*i,.5*e,0*i,1*e,0*i],c=[0,1,2,3,4,2,4,0,2]):4==n?(d=[1*e,1*i,(1-h)*e,1*i,.5*e,.5*i,.5*e,0*i,1*e,0*i],c=[0,1,2,3,4,2,4,0,2]):5==n?(d=[.5*e,1*i,(.5-h)*e,1*i,.5*e,.5*i,.5*e,0*i,1*e,0*i,1*e,1*i],c=[0,1,2,3,4,0,4,5,0]):6==n?(d=[0*e,1*i,0*e,(1-h)*i,.5*e,.5*i,.5*e,0*i,1*e,0*i,1*e,1*i],c=[0,1,2,3,4,2,4,5,0]):7==n?(d=[0*e,.5*i,0*e,(.5-h)*i,.5*e,.5*i,.5*e,0*i,1*e,0*i,1*e,1*i,0*e,1*i],c=[0,1,2,3,4,2,4,5,6,0,2,6]):(d=[0*e,0*i,h*e,0*i,.5*e,.5*i,.5*e,0*i,1*e,0*i,1*e,1*i,0*e,1*i],c=[0,1,2,3,4,2,4,5,6,0,2,6]);const u=new r.K;return u.setVertexArray(d),u.setIndexArray(c),u.setColorMultiplier(0,0,0),u}static getCircleMesh(t,e){const i=[0,0],s=[],o=[0,1];for(let t=0;t<64;t++){const n=t/64*2*Math.PI;i[2+4*t]=Math.cos(n)*e,i[2+4*t+1]=Math.sin(n)*e,i[2+4*t+2]=Math.cos(n)*e*1.2,i[2+4*t+3]=Math.sin(n)*e*1.2,o[2+4*t]=0,o[2+4*t+1]=1,o[2+4*t+2]=0,o[2+4*t+3]=0,s[9*t]=0,s[9*t+1]=2*t+1,s[9*t+2]=2*t+3,s[9*t+3]=2*t+1,s[9*t+4]=2*t+2,s[9*t+5]=2*t+4,s[9*t+6]=2*t+1,s[9*t+7]=2*t+4,s[9*t+8]=2*t+3,63==t&&(s[9*t+2]=1,s[9*t+5]=2,s[9*t+7]=2,s[9*t+8]=1)}const n=new r.K;return n.setVertexArray(i),n.setIndexArray(s),n.setColorArray(o),n}static getCircleHoleMesh(t,e,i){const s=[],o=[],n=[];for(let t=0;t<32;t++){const r=t/32*2*Math.PI;s[6*t]=Math.cos(r)*e/1.2,s[6*t+1]=Math.sin(r)*e/1.2,s[6*t+2]=Math.cos(r)*e,s[6*t+3]=Math.sin(r)*e,s[6*t+4]=Math.cos(r)*i,s[6*t+5]=Math.sin(r)*i,n[6*t]=0,n[6*t+1]=0,n[6*t+2]=0,n[6*t+3]=1,n[6*t+4]=0,n[6*t+5]=1,o[12*t]=3*t+0,o[12*t+1]=3*t+4,o[12*t+2]=3*t+3,o[12*t+3]=3*t+0,o[12*t+4]=3*t+1,o[12*t+5]=3*t+4,o[12*t+6]=3*t+1,o[12*t+7]=3*t+2,o[12*t+8]=3*t+5,o[12*t+9]=3*t+1,o[12*t+10]=3*t+5,o[12*t+11]=3*t+4,31==t&&(o[12*t+1]=1,o[12*t+2]=0,o[12*t+5]=1,o[12*t+8]=2,o[12*t+10]=2,o[12*t+11]=1)}const a=new r.K;return a.setVertexArray(s),a.setIndexArray(o),a.setColorArray(n),a}static circleInOut(t,e,i,s,o){const n=t.x2-t.x1,r=t.y2-t.y1,a=Math.sqrt((n/2)**2+(r/2)**2);if(t._blackMesh&&t._blackMesh.removeFromParent(),s<.5){const o=2*s;e.setVisible(!0),i.setVisible(!1);const n=c.getCircleHoleMesh(t,a*(1-o)*1.2,1.2*a);t._blackMesh=n,t.addChild(n),n.setX(t.lw/2),n.setY(t.lh/2)}else{const o=2*(s-.5);e.setVisible(!1),i.setVisible(!0);const n=c.getCircleHoleMesh(t,a*o*1.2,1.2*a);t._blackMesh=n,t.addChild(n),n.setX(t.lw/2),n.setY(t.lh/2)}}static circleOut(t,e,i,s,o){const n=t.x2-t.x1,r=t.y2-t.y1,a=Math.sqrt((n/2)**2+(r/2)**2);if(t._blackMesh&&t._blackMesh.removeFromParent(),s<.5){const o=2*s;e.setVisible(!0),i.setVisible(!1);const n=c.getCircleMesh(t,1.2*a);t._blackMesh=n,t.addChild(n),n.setScale(o),n.setX(t.lw/2),n.setY(t.lh/2)}else{const o=2*(s-.5);e.setVisible(!1),i.setVisible(!0);const n=c.getCircleHoleMesh(t,a*o*1.2,1.2*a);t._blackMesh=n,t.addChild(n),n.setX(t.lw/2),n.setY(t.lh/2)}}static circleIn(t,e,i,s,o){const n=t.x2-t.x1,r=t.y2-t.y1,a=Math.sqrt((n/2)**2+(r/2)**2);if(t._blackMesh&&t._blackMesh.removeFromParent(),s<.5){const o=2*s;e.setVisible(!0),i.setVisible(!1);const n=c.getCircleHoleMesh(t,a*(1-o)*1.2,1.2*a);t._blackMesh=n,t.addChild(n),n.setX(t.lw/2),n.setY(t.lh/2)}else{const o=2*(s-.5);e.setVisible(!1),i.setVisible(!0);const n=c.getCircleMesh(t,1.2*a);t._blackMesh=n,t.addChild(n),n.setScale(1-o),n.setX(t.lw/2),n.setY(t.lh/2)}}static clock(t,e,i,s,o){const n=-t.x1,r=-t.y1,a=t.x2-t.x1,l=t.y2-t.y1;if(t._blackMesh&&t._blackMesh.removeFromParent(),s<.5){e.setVisible(!0),i.setVisible(!1);const o=c.getClockMesh(t,a,l,2*s);o.setX(-n),o.setY(-r),t._blackMesh=o,t.addChild(o)}else{e.setVisible(!1),i.setVisible(!0);const o=c.getClockMesh(t,a,l,1-2*(s-.5));o.setScaleX(-1),o.setX(a-n),o.setY(-r),t._blackMesh=o,t.addChild(o)}}static getCircleMeshRT(t,e){const i=[0,0],s=[(t.x2-t.x1)/2,(t.y2-t.y1)/2],o=[],n=[16777215,1];for(let t=0;t<64;t++){const r=t/64*2*Math.PI;i[2+4*t]=Math.cos(r)*e,i[2+4*t+1]=Math.sin(r)*e,i[2+4*t+2]=Math.cos(r)*e*1.2,i[2+4*t+3]=Math.sin(r)*e*1.2,s[2+4*t]=s[1]+i[2+4*t],s[2+4*t+1]=s[2]+i[2+4*t+1],s[2+4*t+2]=s[1]+i[2+4*t+2],s[2+4*t+3]=s[2]+i[2+4*t+3],n[2+4*t]=16777215,n[2+4*t+1]=1,n[2+4*t+2]=16777215,n[2+4*t+3]=0,o[9*t]=0,o[9*t+1]=2*t+1,o[9*t+2]=2*t+3,o[9*t+3]=2*t+1,o[9*t+4]=2*t+2,o[9*t+5]=2*t+4,o[9*t+6]=2*t+1,o[9*t+7]=2*t+4,o[9*t+8]=2*t+3,63==t&&(o[9*t+2]=1,o[9*t+5]=2,o[9*t+7]=2,o[9*t+8]=1)}const a=new r.K;return a.setVertexArray(i),a.setIndexArray(o),a.setColorArray(n),a.setTextureCoordinateArray(s),a.setTexture(t._RT),a}static getCircleHoleMeshRT(t,e,i){const[s,o]=[(t.x2-t.x1)/2,(t.y2-t.y1)/2],n=[],a=[],l=[],h=[];for(let t=0;t<32;t++){const r=t/32*2*Math.PI;n.push(Math.cos(r)*e/1.2,Math.sin(r)*e/1.2,Math.cos(r)*e,Math.sin(r)*e,Math.cos(r)*i,Math.sin(r)*i),a.push(s+n[6*t],o+n[6*t+1],s+n[6*t+2],o+n[6*t+3],s+n[6*t+4],o+n[6*t+5]),h.push(16777215,0,16777215,1,16777215,1),l.push(3*t+0,3*t+4,3*t+3,3*t+0,3*t+1,3*t+4,3*t+1,3*t+2,3*t+5,3*t+1,3*t+5,3*t+4),31==t&&(l[12*t+1]=1,l[12*t+2]=0,l[12*t+5]=1,l[12*t+8]=2,l[12*t+10]=2,l[12*t+11]=1)}const d=new r.K;return d.setVertexArray(n),d.setIndexArray(l),d.setColorArray(h),d.setTextureCoordinateArray(a),d.setTexture(t._RT),d}static circleOutRT(t,e,i,s,o){const n=t.x2-t.x1,r=t.y2-t.y1;null!=t._blackMesh&&t._blackMesh.removeFromParent();const a=Math.sqrt((n/2)**2+(r/2)**2);e.setVisible(!1),i.setVisible(!0);const l=c.getCircleHoleMeshRT(t,a*s*1.2,1.2*a);t._blackMesh=l,t.addChild(l),l.setX(t.lw/2),l.setY(t.lh/2)}static circleInRT(t,e,i,s,o){const n=t.x2-t.x1,r=t.y2-t.y1;t._blackMesh&&t._blackMesh.removeFromParent();const a=Math.sqrt((n/2)**2+(r/2)**2);e.setVisible(!1),i.setVisible(!0);const l=c.getCircleMeshRT(t,a*(1-s)*1.2);t._blackMesh=l,t.addChild(l),l.setX(t.lw/2),l.setY(t.lh/2)}static getPaperMeshRT(t,e,i){const s=[t.x1,t.y1,t.x2-e-i,t.y1,t.x1,t.y2,t.x2-e-i,t.y2],o=[0+e,0,t.x2-t.x1-i,0,0+e,t.y2-t.y1,t.x2-t.x1-i,t.y2-t.y1],n=new r.K;return n.setVertexArray(s),n.setIndexArray([0,1,2,1,3,2]),n.setTextureCoordinateArray(o),n.setTexture(t._RT),n}static paperDownRT(t,e,i,s,o){t._blackMesh&&t._blackMesh.removeFromParent(),e.setVisible(!1),i.setVisible(!0);const n=Math.sin(l(180*s))*(t.x2-t.x1)/2,r=s<.5?0:(1-Math.cos(l(180*(s-.5))))*(t.x2-t.x1),a=c.getPaperMeshRT(t,n,r);i.setX(Math.sin(l(180*s))*(t.x2-t.x1)/2),a.setX(0);const h=1-.5*s,d=Math.max(0,2*s-1);i.setColorMultiplier(d,d,d),a.setColorMultiplier(h,h,h),t._blackMesh=a,t.addChild(a)}static paperUpRT(t,e,i,s,o){t._blackMesh&&t._blackMesh.removeFromParent(),e.setVisible(!1),i.setVisible(!0),i.setX(-Math.sin(l(180*s))*(t.x2-t.x1)/2);const n=s<.5?Math.sin(l(180*s))*(t.x2-t.x1)/2:i.getX()+(t.x2-t.x1),r=s<.5?0:n-(t.x2-t.x1)/2-Math.cos(l(180*(s-90)))*(t.x2-t.x1)/2,a=n-r,h=c.getPaperMeshRT(t,r,a);h.setX(n);const d=1-.5*s,u=Math.max(0,2*s-1);i.setColorMultiplier(u,u,u),h.setColorMultiplier(d,d,d),t._blackMesh=h,t.addChild(h)}static moveFromRight(t,e,i,s,o){const n=t.lw+2*-t.x1;e.setX(-s*n),i.setX((1-s)*n)}static moveFromLeft(t,e,i,s,o){const n=t.lw+2*-t.x1;e.setX(s*n),i.setX((s-1)*n)}static overFromRight(t,e,i,s,o){const n=t.lw+2*-t.x1;i.setX((1-s)*n)}static overFromLeft(t,e,i,s,o){const n=t.lw+2*-t.x1;i.setX((s-1)*n)}static moveFromRightWithFade(t,e,i,s,o){const n=t.lw+2*-t.x1;e.setAlpha(1-s),e.setX(-s*n),i.setX((1-s)*n)}static moveFromLeftWithFade(t,e,i,s,o){const n=t.lw+2*-t.x1;e.setAlpha(1-s),e.setX(s*n),i.setX((s-1)*n)}static overFromRightWithFade(t,e,i,s,o){const n=t.lw+2*-t.x1;e.setAlpha(1-s),i.setX((1-s)*n)}static overFromLeftWithFade(t,e,i,s,o){const n=t.lw+2*-t.x1;e.setAlpha(1-s),i.setX((s-1)*n)}static moveFromBottom(t,e,i,s,o){const n=t.lh;e.setY(-s*n),i.setY((1-s)*n)}static moveFromTop(t,e,i,s,o){const n=t.lh;e.setY(s*n),i.setY((s-1)*n)}static overFromBottom(t,e,i,s,o){const n=t.lh;i.setY((1-s)*n)}static overFromTop(t,e,i,s,o){const n=t.lh;i.setY((s-1)*n)}static moveFromBottomWithFade(t,e,i,s,o){const n=t.lh;e.setAlpha(1-s),e.setY(-s*n),i.setY((1-s)*n)}static moveFromTopWithFade(t,e,i,s,o){const n=t.lh;e.setAlpha(1-s),e.setY(s*n),i.setY((s-1)*n)}static overFromBottomWithFade(t,e,i,s,o){const n=t.lh;e.setAlpha(1-s),i.setY((1-s)*n)}static overFromTopWithFade(t,e,i,s,o){const n=t.lh;e.setAlpha(1-s),i.setY((s-1)*n)}static fade(t,e,i,s,o){s<.5?e.setAlpha(2*(.5-s)):e.setAlpha(0),s<.5?i.setAlpha(0):i.setAlpha(2*(s-.5))}static crossfade(t,e,i,s,o){e.setAlpha(1-s),i.setAlpha(s)}static flip(t,e,i,s,o){const n=t.lw;if(s<.5){const t=2*(.5-s);e.setScaleX(t),e.setX((1-t)*n*.5)}else e.setScaleX(0),e.setX(.5*n);if(s<.5)i.setScaleX(0),i.setX(.5*n);else{const t=2*(s-.5);i.setScaleX(t),i.setX((1-t)*n*.5)}}static flipWithFade(t,e,i,s,o){const n=t.lw;if(s<.5){const t=2*(.5-s);e.setScaleX(t),e.setX((1-t)*n*.5),e.setAlpha(t)}else e.setScaleX(0),e.setX(.5*n),e.setAlpha(0);if(s<.5)i.setScaleX(0),i.setX(.5*n),i.setAlpha(0);else{const t=2*(s-.5);i.setScaleX(t),i.setX((1-t)*n*.5),i.setAlpha(t)}}static flipWithShade(t,e,i,s,o){const n=t.lw;if(s<.5){const t=2*(.5-s);e.setScaleX(t),e.setX((1-t)*n*.5),e.setColorMultiplier(1-s,1-s,1-s,1)}else e.setScaleX(0),e.setX(.5*n),e.setColorMultiplier(.5,.5,.5,1);if(s<.5)i.setScaleX(0),i.setX(.5*n),i.setColorMultiplier(.5,.5,.5,1);else{const t=2*(s-.5);i.setScaleX(t),i.setX((1-t)*n*.5),i.setColorMultiplier(s,s,s,1)}}getCurrentSceneName(){return this.currentScene}getCurrentScene(){return this.scene2?this.scene2:this.scene1}isChanging(){return this.changingScene}changeScene(t,e,i,r,l){let c;if(c="function"==typeof t?t():t,this.active||(this.addEventListener(o.j.ENTER_FRAME,this.onEnterFrame,this),this.active=!0),this.changingScene=!0,this.eventFilter=null!=l?l.eventFilter:null,this.currentScene=c,this.tweening&&(0!=this.time?(this.dispatchEvent("transitionEnd"),this.scene1.dispatchEvent("exitEnd"),this.scene2.dispatchEvent("enterEnd"),this.onTransitionEnd(),this.scene1.removeFromParent(),this.scene1=this.scene2,this.scene2=null,this.tweening=!1,this.changingScene=!1):this.scene2&&(this.scene2.removeFromParent(),this.scene2=null)),null==this.scene1&&(this.scene1=new s.j),this.duration=e,this.transition=i,this.ease=r||d,this.scene2=c,this.scene2.setVisible(!1),this.addChild(this.scene2),this.time=0,this.currentTimer=n.B.now(),this.tweening=!0,h.get(i)){const t=this.stage.getScale(),e=this.x2-this.x1,i=this.y2-this.y1,s=this.stage.getX();this.stage.setScale(1);const o=new a.A(e,i,!0);o.clear(0,1),this.stage.setPosition(-this.x1,-this.y1),o.draw(this.stage),this.stage.setX(s),this.stage.setScale(t.x,t.y),this._RT=o}return this.scene2}resetCurrentScene(t){this.scene1=t,this.addChild(this.scene1)}filterTransitionEvents(t){t.stopPropagation()}onTransitionBegin(){if(this.eventFilter){this.stage.addChild(this.transitionEventCatcher);for(const t in this.eventFilter){const e=this.eventFilter[t];this.transitionEventCatcher.addEventListener(e,this.filterTransitionEvents,this)}}}onTransitionEnd(){if(this.eventFilter){for(const t in this.eventFilter){const e=this.eventFilter[t];this.transitionEventCatcher.removeEventListener(e,this.filterTransitionEvents,this)}this.transitionEventCatcher.removeFromParent()}}onEnterFrame(t){if(this.stage.addChild(this.transitionEventCatcher),!this.tweening)return this.removeEventListener(o.j.ENTER_FRAME,this.onEnterFrame,this),this.scene1.removeFromParent(),this.scene1=this.scene2,this.scene2=null,this.active=null,this.changingScene=!1,this._blackMesh&&(this._blackMesh.removeFromParent(),this._blackMesh=null),void(this._RT&&(this._RT=null));0==this.time&&(this.onTransitionBegin(),this.scene2.setVisible(!0),this.dispatchEvent("transitionBegin"),this.scene1.dispatchEvent("exitBegin"),this.scene2.dispatchEvent("enterBegin"));const e=n.B.now();this.currentTimer=e;const i=0==this.duration?1:this.time/this.duration;this.transition(this,this.scene1,this.scene2,this.ease(i),i),this.time==this.duration&&(this.dispatchEvent("transitionEnd"),this.scene1.dispatchEvent("exitEnd"),this.scene2.dispatchEvent("enterEnd"),this.onTransitionEnd(),this.tweening=!1),this.time=this.time+1e3/60,this.duration<this.time&&(this.time=this.duration)}}h=new Map([[c.circleInRT,!0],[c.circleOutRT,!0],[c.paperDownRT,!0],[c.paperUpRT,!0]])},636:(t,e,i)=>{"use strict";i.d(e,{e:()=>o}),i(720);var s=i(302);i(699),i(584);class o{constructor(t,e,i,o){this.asset=new s.x("<Shader:*>",s.x.AssetTypes.Shader),this.textures=null!=i?i:{},this.constants=null!=o?o:{},this.dirty=!1,this.asset.load({vertexSrc:t,fragmentSrc:e,textures:this._getTextureIds(),constants:this.constants})}_getTextureIds(){const t={};for(let e in this.textures)t[e]=this.textures[e].asset.id;return t}_update(){this.dirty=!0}forceUpdate(){this.dirty&&(this.asset.update({textures:this._getTextureIds(),constants:this.constants}),this.dirty=!1)}release(){this.asset.release()}setConstant(t,e){return this.constants[t]=e,this._update(),this}setConstants(t){return Object.assign(this.constants,t),this._update(),this}setTexture(t,e){return this.textures[t]=e,this._update(),this}clone(){const t={textures:{},constants:{}};return t.asset=new s.x("<Shader:*>",s.x.AssetTypes.Shader),Object.assign(t.textures,this.textures),Object.assign(t.constants,this.constants),Object.setPrototypeOf(t,o.prototype),t.asset.load({copyFrom:this.asset.id,textures:t._getTextureIds(),constants:t.constants}),t}}o.lastId=0},266:(t,e,i)=>{"use strict";i.d(e,{j:()=>p});var s=i(141),o=i(301),n=i(750),r=i(873),a=i(73),l=i(584),h=i(302),d=i(720),c=i(106);class u{constructor(){this._x=0,this._y=0,this._anchorX=0,this._anchorY=0,this._scaleX=1,this._scaleY=1,this._rotation=0,this._matrixDirty=!1,this._matrix=s.m4.identity(),this.invalidateCallback=null}get x(){return this._x}get y(){return this._y}get anchorX(){return this._anchorX}get anchorY(){return this._anchorY}get scaleX(){return this._scaleX}get scaleY(){return this._scaleY}get rotation(){return this._rotation}set x(t){this.setDirty(this._x!=t),this._x=t}set y(t){this.setDirty(this._y!=t),this._y=t}set anchorX(t){this.setDirty(this._anchorX!=t),this._anchorX=t}set anchorY(t){this.setDirty(this._anchorY!=t),this._anchorY=t}set scaleX(t){this.setDirty(this._scaleX!=t),this._scaleX=t}set scaleY(t){this.setDirty(this._scaleY!=t),this._scaleY=t}set rotation(t){this.setDirty(this._rotation!=t),this._rotation=t}get matrix(){if(this._matrixDirty){const t=s.m4.translation([this._x,this._y,0]);s.m4.scale(t,[this._scaleX,this._scaleY,1],t),s.m4.rotateZ(t,this._rotation*Math.PI/180,t),this._matrix=t,this._matrixDirty=!1}return this._matrix}setDirty(t){this.invalidateCallback&&t&&this.invalidateCallback(),this._matrixDirty=this._matrixDirty||t}clone(){const t={};return Object.assign(t,this),Object.setPrototypeOf(t,this.constructor.prototype),t}}i(636);class p extends r.F{constructor(){super(),this._$$id=p.lastId++,p.finalizationRegistry.register(this,{thisObjId:this._$$id}),this._$$spriteType=p.SpriteTypes.SPRITE,this._$$updateCode=p.UpdateCodes.UPDATE_NOTHING,this.transform=new u,this.transform.invalidateCallback=this.onInvalidateTransform.bind(this),this._$$localBounds=new a.UL(0,0,0,0),this._$$boundsDirty=!0,this._$$bounds=new a.UL(0,0,0,0),this.customBounds=void 0,this.useCustomLocalBounds=!1,this.worldMatrix=void 0,this.colorOverride=[1,1,1,1],this.colorAdd=[0,0,0,0],this.clipRegion=null,this.children=[],this.parent=null,this._$$visible=!0,this.customPrev,this.asset,this.cacheBitmapMode=p.CacheBitmapModes.NO_CACHE,this.cacheBitmapDstId=0,this.cacheBitmapAsset,this.blendMode=p.BlendModes.NORMAL,this.motionBlur=!0,this.shader}static finalizeHandler(t){d.wU.postMessageToRender({msg:"addCommand",class:"Sprite",method:"release",args:[t.thisObjId]})}release(){null!=this.asset&&this.asset.release();for(let t in this)delete this[t];d.wU.postMessageToRender({msg:"addCommand",executionTiming:2,class:"Sprite",method:"release",args:[this._$$id]})}clone(){const t={};return Object.assign(t,this),Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t._$$id=p.lastId++,t.transform=t.transform.clone(),t.transform.invalidateCallback=t.onInvalidateTransform.bind(t),t._$$localBounds=t._$$localBounds.clone(),t._$$bounds=t._$$bounds.clone(),t.worldMatrix=null!=t.worldMatrix?s.m4.copy(t.worldMatrix):null,t.colorOverride=[...t.colorOverride],t.colorAdd=[...t.colorAdd],t.clipRegion=null!=t.clipRegion?t.clipRegion.clone():null,t.children=[...t.children],t.customPrev=null!=t.customPrev?Object.assign({},t.customPrev):null,t._$$updateCode|=p.UpdateCodes.UPDATE_EXTRA,t}onInvalidateTransform(){let t=this;do{t._$$boundsDirty=!0,t=t.parent}while(null!=t);return t}getPath(t){const e=[];let i=this;for(;null!=i.parent;)t?e.unshift(i.parent.children.indexOf(i)+":"+i.constructor.name):e.unshift(i.parent.children.indexOf(i)),i=i.parent;return i.isStage?"//"+e.join("/"):"?/"+e.join("/")}get position(){return new a.E9(this.transform.x,this.transform.y)}set position(t){this.transform.x=t.x,this.transform.y=t.y}setPosition(t,e){this.transform.x=t,this.transform.y=e}getPosition(){return this.position}get x(){return this.transform.x}set x(t){this.transform.x=t}getX(){return this.transform.x}setX(t){this.transform.x=t}get y(){return this.transform.y}set y(t){this.transform.y=t}getY(){return this.transform.y}setY(t){this.transform.y=t}get xy(){return[this.x,this.y]}set xy(t){Array.isArray(t)?(this.x=t[0],this.y=t[1]):(this.x=t.x,this.y=t.y)}getRotation(){return this.transform.rotation}setRotation(t){this.transform.rotation=t}get anchorX(){return this.transform.anchorX/(this.bounds.width||1)}get anchorPosition(){return new a.E9(this.transform.anchorX,this.transform.anchorY)}set anchorPosition(t){this.transform.anchorX=t.x,this.transform.anchorY=t.y}get anchorPositionX(){return this.transform.anchorX}set anchorPositionX(t){this.transform.anchorX=t}get anchorPositionY(){return this.transform.anchorY}set anchorPositionY(t){this.transform.anchorY=t}set anchorX(t){this.transform.anchorX=t*this.bounds.width}get anchorY(){return this.transform.anchorY/(this.bounds.height||1)}set anchorY(t){this.transform.anchorY=t*this.bounds.height}getAnchorPoint(){return new a.E9(this.anchorX,this.anchorY)}setAnchorPoint(t,e){this.anchorX=t,this.anchorY=e}get scaleX(){return this.transform.scaleX}set scaleX(t){this.transform.scaleX=t}getScaleX(){return this.transform.scaleX}setScaleX(t){this.transform.scaleX=t}get scaleY(){return this.transform.scaleY}set scaleY(t){this.transform.scaleY=t}getScaleY(){return this.transform.scaleY}setScaleY(t){this.transform.scaleY=t}get scale(){return new a.E9(this.transform.scaleX,this.transform.scaleY)}set scale(t){if("number"==typeof t)this.transform.scaleX=t,this.transform.scaleY=t;else{const e=new a.E9(t);this.transform.scaleX=e.x,this.transform.scaleY=e.y}}getScale(){return this.scale}setScale(t,e){this.scaleX=t,this.scaleY=null==e?t:e}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get localBounds(){const t=new a.UL(this._$$localBounds);return t.x-=this.transform.anchorX,t.y-=this.transform.anchorY,t}get bounds(){if(this.customBounds)return this.customBounds;if(!this._$$boundsDirty)return this._$$bounds;let t=s.m4.identity(),e=new a.UL,i=[];const o=(t,e)=>{if(t._$$boundsDirty){if(0!=t.spriteType){const[o,n,r,a,l,h,d,c]=t.localBounds.getCornerPoints();let u,p;[u,p]=s.m4.transformPoint(e,[o,n,0]),i.push(u,p),[u,p]=s.m4.transformPoint(e,[r,a,0]),i.push(u,p),[u,p]=s.m4.transformPoint(e,[l,h,0]),i.push(u,p),[u,p]=s.m4.transformPoint(e,[d,c,0]),i.push(u,p)}for(let i of t.children)i.visible&&o(i,s.m4.multiply(e,i.transform.matrix))}else i.push(...t._$$boundsPoints)};o(this,t);for(let t=0;t<i.length;t+=2)e.extendPoint(i[t],i[t+1]);return this._$$bounds=e,this._$$boundsDirty=!1,this._$$boundsPoints=i,e}getBounds(){return this.bounds}updateLocalBounds(){}get visible(){return this._$$visible}set visible(t){!this._$$visible&&t&&this._updateChildren(p.UpdateCodes.UPDATE_CLEAR_PREV),this._$$visible=t}isVisible(){return this.visible}setVisible(t){this.visible=t}isVisibleDeeply(){let t;for(t=this;null!=t&&!t.isStage;t=t.parent)if(!t.visible)return!1;return null!=t}get redMultiplier(){return this.colorOverride[0]}set redMultiplier(t){this.colorOverride[0]=t}get greenMultiplier(){return this.colorOverride[1]}set greenMultiplier(t){this.colorOverride[1]=t}get blueMultiplier(){return this.colorOverride[2]}set blueMultiplier(t){this.colorOverride[2]=t}get alpha(){return this.colorOverride[3]}set alpha(t){this.colorOverride[3]=t}setAlpha(t){this.colorOverride[3]=t}getAlpha(t){return this.colorOverride[3]}setColorMultiplier(t,e,i,s){this.colorOverride[0]=t,this.colorOverride[1]=e,this.colorOverride[2]=i,null!=s&&(this.colorOverride[3]=s)}setOverrideColor(t,e){const i=l.c.hex2rgba(t,e);this.colorOverride[0]=i[0],this.colorOverride[1]=i[1],this.colorOverride[2]=i[2],null!=e&&(this.colorOverride[3]=i[3])}get width(){return this.bounds.width}set width(t){this.customBounds=this.customBounds||this.bounds,this.customBounds.width=t}get height(){return this.bounds.height}set height(t){this.customBounds=this.customBounds||this.bounds,this.customBounds.height=t}setCustomBounds(t,e,i,s){this.customBounds.x=t,this.customBounds.y=e,this.customBounds.width=i,this.customBounds.height=s}getWidth(){return this.width}getHeight(){return this.height}localToGlobal(t,e){let i=[];for(let t=this;i.unshift(t.transform.matrix),null!=t.parent;t=t.parent);let o=s.m4.identity();i.forEach((t=>{s.m4.multiply(o,t,o)}));let n=s.m4.transformPoint(o,[t,e,0]);return new a.E9(n[0],n[1])}globalToLocal(t,e){if(null==this.parent||this.isStage)return new a.E9(t,e);let i=[];for(let t=this;i.push(s.m4.inverse(t.transform.matrix)),null!=t.parent;t=t.parent);let o=s.m4.identity();i.forEach((t=>{s.m4.multiply(o,t,o)}));let n=s.m4.transformPoint(o,[t,e,0]);return new a.E9(n[0],n[1])}setBlendMode(t){this.blendMode=t}_updateChildren(t){for(const e of this.searchChildren())e.updateCode|=t}addChildAt(t,e){null==e&&(e=this.children.length);const i=this.children.indexOf(t);this.children.splice(e,0,t),i>=0&&(i>e?this.children.splice(i+1,1):i<e&&this.children.splice(i,1)),t.parent=this,this.isOnStage()&&(t._updateChildren(p.UpdateCodes.UPDATE_CLEAR_PREV),t.dispatchEventWithChildren(new n.j(n.j.ADDED_TO_STAGE))),this.onInvalidateTransform()}addChild(...t){for(const e of t)this.addChildAt(e)}removeChildAt(t){const e=this.children[t];e.parent=null,this.children.splice(t,1),this.isOnStage()&&e.dispatchEventWithChildren(new n.j(n.j.REMOVED_FROM_STAGE)),this.onInvalidateTransform()}removeChild(t){let e=this.children.indexOf(t);-1!=e&&this.removeChildAt(e)}removeFromParent(){this.parent&&this.parent.removeChild(this)}clearChildren(){for(let t=this.children.length-1;t>=0;t--)this.removeChildAt(t)}getChildIndex(t){return this.children.indexOf(t)}getChildAt(t){return this.children[t]}getStage(){let t;for(t=this;null!=t&&!t.isStage;t=t.parent);return t}isOnStage(){return null!=this.getStage()}dispatchEventWithChildren(t,e){let i;i="string"==typeof t?new n.j(t):t,Object.assign(i,e);for(const t of this.searchChildren(!0)){if(i.stopped)return;t.dispatchEvent(i)}}*searchChildren(t){yield*p.searchChildren(this,t)}static*searchChildren(t,e=!1){const i=function*(t){if(e){if(t.children.length>0)for(let e=t.children.length-1;e>=0;e--){const s=t.children[e];s&&(yield*i(s))}yield t}else if(yield t,t.children.length>0)for(let e=0;e<t.children.length;e++){const s=t.children[e];s&&(yield*i(s))}};yield*i(t)}findChildById(t){for(let e of this.searchChildren())if(e.id==t)return e}getNumChildren(){return this.children.length}getParent(){return this.parent}contains(t){return this.children.includes(t)}hitTestPoint(t,e){const i=this.globalToLocal(t,e);return this.bounds.contains(i.x,i.y)}setClip(t,e,i,s){this.clipRegion=new a.UL(t,e,i,s)}setShader(t){this.shader=t}getShader(){return this.shader}setInteractive(t=null){this.__interactive=this.__interactive||{};const e=this.__interactive,i=t&&null!=t.clickRadius?t.clickRadius:10,s=i=>{this.hitTestPoint(i.x,i.y)&&(e.downPointerPosition=new a.E9(i.x,i.y),e.downThisPosition=this.getPosition().clone(),e.downOffset=new a.E9(i.x-this.x,i.y-this.y),e.downButton=i.button,e.pushed=!0,e.clickCanceled=!1,e.state="down",t.disableBasicAnimation?t.pressAnimation&&(e.tween&&e.tween.stop(),e.tween=t.pressAnimation.call(this,i,e),i.stopPropagation()):(e.tween&&e.tween.stop(),e.tween=this.move(e.downThisPosition.x,e.downThisPosition.y+(null!=t.pressOffsetY?t.pressOffsetY:3),300,c.U.outBack),i.stopPropagation()),null!=t.down&&t.down.call(this,i,e))},o=s=>{"down"!=e.state&&"move"!=e.state||(e.state="move",e.moveDeltaPosition=new a.E9(s.x-e.downPointerPosition.x,s.y-e.downPointerPosition.y),e.moveThisPosition=new a.E9(t.dragX?e.downThisPosition.x+e.moveDeltaPosition.x:e.downThisPosition.x,t.dragY?e.downThisPosition.y+e.moveDeltaPosition.y:e.downThisPosition.y),t.allowDragOutside||(e.moveThisPosition.x=l.c.clamp(e.moveThisPosition.x,d.wU.logicalRenderBounds.left-e.downOffset.x,d.wU.logicalRenderBounds.right-e.downOffset.x),e.moveThisPosition.y=l.c.clamp(e.moveThisPosition.y,d.wU.logicalRenderBounds.top-e.downOffset.y,d.wU.logicalRenderBounds.bottom-e.downOffset.y)),(t.dragX||t.dragY)&&e.tween&&e.tween.cancel(),t.dragX&&(this.x=e.moveThisPosition.x),t.dragY&&(this.y=e.moveThisPosition.y),0==e.clickCanceled&&Math.sqrt(e.moveDeltaPosition.x**2+e.moveDeltaPosition.y**2)>i&&(e.clickCanceled=!0),s.stopPropagation(),null!=t.move&&t.move.call(this,s,e),e.pushed&&!this.hitTestPoint(s.x,s.y)?(e.pushed=!1,t.disableBasicAnimation?t.releaseAnimation&&(e.tween&&e.tween.stop(),e.tween=t.releaseAnimation.call(this,s,e),s.stopPropagation()):(e.tween&&e.tween.stop(),e.tween=this.move(e.moveThisPosition.x,e.moveThisPosition.y,200,c.U.outCubic),s.stopPropagation())):!e.pushed&&this.hitTestPoint(s.x,s.y)&&(e.pushed=!0,t.disableBasicAnimation?t.pressAnimation&&(e.tween&&e.tween.stop(),e.tween=t.pressAnimation.call(this,s,e),s.stopPropagation()):(e.tween&&e.tween.stop(),e.tween=this.move(e.moveThisPosition.x,e.moveThisPosition.y+(null!=t.pressOffsetY?t.pressOffsetY:3),100,c.U.outCubic),s.stopPropagation())))},r=s=>{"down"!=e.state&&"move"!=e.state||(e.state="up",e.moveDeltaPosition=new a.E9(s.x-e.downPointerPosition.x,s.y-e.downPointerPosition.y),e.moveThisPosition=new a.E9(t.dragX?e.downThisPosition.x+e.moveDeltaPosition.x:e.downThisPosition.x,t.dragY?e.downThisPosition.y+e.moveDeltaPosition.y:e.downThisPosition.y),t.dragX&&(this.x=e.moveThisPosition.x),t.dragY&&(this.y=e.moveThisPosition.y),t.allowDragOutside||(e.moveThisPosition.x=l.c.clamp(e.moveThisPosition.x,d.wU.logicalRenderBounds.left-e.downOffset.x,d.wU.logicalRenderBounds.right-e.downOffset.x),e.moveThisPosition.y=l.c.clamp(e.moveThisPosition.y,d.wU.logicalRenderBounds.top-e.downOffset.y,d.wU.logicalRenderBounds.bottom-e.downOffset.y)),0==e.clickCanceled&&Math.sqrt(e.moveDeltaPosition.x**2+e.moveDeltaPosition.y**2)<i&&null!=t.click&&t.click.call(this,s,e),this.hitTestPoint(s.x,s.y)&&(e.pushed=!0,null!=t.press&&t.press.call(this,s,e)),t.preventRelease||(t.disableBasicAnimation?t.releaseAnimation&&(e.tween&&e.tween.stop(),e.tween=t.releaseAnimation.call(this,s,e),s.stopPropagation()):(e.tween&&e.tween.stop(),e.tween=this.move(e.moveThisPosition.x,e.moveThisPosition.y,300,c.U.outBounce),s.stopPropagation())),null!=t.up&&t.up.call(this,s,e))};null!=t?(this.on(n.j.POINTER_DOWN,s),this.on(n.j.POINTER_MOVE,o),this.on(n.j.POINTER_UP,r)):(this.removeEventListener(n.j.POINTER_DOWN,s),this.removeEventListener(n.j.POINTER_MOVE,o),this.removeEventListener(n.j.POINTER_UP,r),delete this.__interactive)}encodeRenderingInfo(){const t=new Float32Array(38);return t.set([this._$$id,this._$$spriteType,this._$$updateCode,this.colorOverride[0],this.colorOverride[1],this.colorOverride[2],this.colorOverride[3],this.colorAdd[0],this.colorAdd[1],this.colorAdd[2],this.colorAdd[3],this.transform.anchorX,this.transform.anchorY]),null!=this.shader?(this.shader.forceUpdate(),t[13]=this.shader.asset.id):t[13]=0,a.Th.memcpy(t,14,this.transform.matrix,0,16),t.set(null!=this.clipRegion?this.clipRegion.xywh:[NaN,NaN,NaN,NaN],30),t[34]=null!=this.cacheBitmapAsset?this.cacheBitmapAsset.id:0,t[35]=this.cacheBitmapDstId,t[36]=this.blendMode,t[37]=+this.motionBlur,t}encodeCustomPrev(){const t=new Float32Array(22);return t.set([this.customPrev.colorOverride[0],this.customPrev.colorOverride[1],this.customPrev.colorOverride[2],this.customPrev.colorOverride[3],this.customPrev.anchorPositionX,this.customPrev.anchorPositionY]),a.Th.memcpy(t,6,this.customPrev.worldMatrix,0,16),t}sortChildren(t="y"){this.children.sort(((e,i)=>e[t]-i[t]))}setCustomPrev(t,e,i,s){this.customPrev={worldMatrix:t,colorOverride:e,anchorPositionX:i,anchorPositionY:s},this._$$updateCode|=p.UpdateCodes.UPDATE_CUSTOM_PREV}setCacheMode(t){if(this.cacheBitmapMode==p.CacheBitmapModes.SNAPSHOT&&this._updateChildren(p.UpdateCodes.UPDATE_CLEAR_PREV),this.cacheBitmapAsset){this.cacheBitmapAsset.release();const t=e=>{if(e.cacheBitmapMode==p.CacheBitmapModes.NO_CACHE){this.cacheBitmapAsset=null,e.cacheBitmapDstId=0;for(let i of e.children)t(i)}};this.cacheBitmapMode=p.CacheBitmapModes.NO_CACHE,t(this)}this.cacheBitmapMode=t}encodeRenderingInfoWithChildren(){const t=[],e=[];if(this.visible){!function i(o,n,r,a,l){const d=o.encodeRenderingInfo(),c=d.subarray(14,30),u=d.subarray(3,7),g=d.subarray(30,34);let m,f,w,y,E=0,C=!1;if(!Number.isNaN(g[0])){let t=s.m4.transformPoint(n,[g[0],g[1],0]);g[0]=t[0]+o.x,g[1]=t[1]+o.y}if(s.m4.multiply(n,c,c),o.worldMatrix=s.m4.copy(c),o.cacheBitmapMode!=p.CacheBitmapModes.NO_CACHE&&(null==o.cacheBitmapAsset?C=!0:o.cacheBitmapMode==p.CacheBitmapModes.FILTER&&(o.cacheBitmapAsset.release(),C=!0)),C){const t=o.bounds,e=new h.x("<RT:*>",h.x.AssetTypes.RenderTarget);e.load({x:t.x,y:t.y,width:Math.min(2048,t.width),height:Math.min(2048,t.height),worldMatrix:o.worldMatrix}),o.cacheBitmapAsset=e,E=e.id,o.cacheBitmapDstId=E,l=E}else o.cacheBitmapDstId=l||o.cacheBitmapDstId;if(d[35]=o.cacheBitmapDstId,u[0]=u[0]*r[0],u[1]=u[1]*r[1],u[2]=u[2]*r[2],u[3]=u[3]*r[3],Number.isNaN(g[0])&&!Number.isNaN(a[0])&&g.set(a),0!=o._$$spriteType){if(o._$$updateCode&p.UpdateCodes.UPDATE_EXTRA&&null!=o.encodeExtraRenderingInfo){let t;[m,f,w,t]=o.encodeExtraRenderingInfo(),t&&e.push(...t)}o._$$updateCode&p.UpdateCodes.UPDATE_CUSTOM_PREV&&(y=o.encodeCustomPrev()),d[34]=0,t.push([d,m,f,y,w])}if(o.cacheBitmapMode==p.CacheBitmapModes.SNAPSHOT&&0==o.cacheBitmapDstId||(o.children.forEach((t=>{t.visible&&(i(t,c,u,g,l),o.cacheBitmapMode==p.CacheBitmapModes.SNAPSHOT&&(t.cacheBitmapDstId=0))})),o.cacheBitmapMode==p.CacheBitmapModes.SNAPSHOT&&(o.cacheBitmapDstId=0)),o.cacheBitmapAsset){const e=new Float32Array(d);e[34]=E,e[35]=0,t.push([e,null,null,y,null])}o._$$updateCode=p.UpdateCodes.UPDATE_NOTHING}(this,s.m4.identity(),[1,1,1,1],[NaN,NaN,NaN,NaN],0);for(let i=0;i<t.length;i++)e.push(t[i][0].buffer),t[i][1]&&e.push(t[i][1].buffer),t[i][3]&&e.push(t[i][3].buffer);return[t,e]}return[null,null]}}p.lastId=1,p.finalizationRegistry=new FinalizationRegistry(p.finalizeHandler),p.loadedEventDispatcher=new o.p,p.SpriteTypes={SPRITE:0,BITMAP:1,MESH:2,TEXTFIELD:3,PIXEL:4,SHAPE:5},p.UpdateCodes={UPDATE_NOTHING:0,UPDATE_EXTRA:1,UPDATE_CLEAR_PREV:2,UPDATE_CUSTOM_PREV:4},p.CacheBitmapModes={NO_CACHE:0,SNAPSHOT:1,FILTER:2},p.BlendModes={NORMAL:0,MULTIPLY:1,ADD:2,SCREEN:3,NORMAL_NPM:4,ADD_NPM:5,SCREEN_NPM:6}},919:(t,e,i)=>{"use strict";i.d(e,{H:()=>o});var s=i(266);i(141);class o extends s.j{constructor(){super(),this.isStage=!0}}},550:(t,e,i)=>{"use strict";i.d(e,{x:()=>l});var s=i(302),o=i(699),n=i(73),r=i(584),a=i(750);class l extends o.W{constructor(t,e=!1,i={}){super(),this.asset=new s.x(t,s.x.AssetTypes.Texture);const o=r.c.getImageSize(t);this.uvRect=i.rect||new n.UL(0,0,o.width,o.height),this.width=this.uvRect.width,this.height=this.uvRect.height,this.asset.load({width:o.width,height:o.height,uvRect:this.uvRect,filter:e})}addEventListener(t,e,i=null,s=!1){return t==a.j.LOADED&&this.asset.addEventListener(t,this.dispatchEvent.bind(this,a.j.LOADED),null,s),super.addEventListener(t,e,i,s)}}},699:(t,e,i)=>{"use strict";i.d(e,{W:()=>o}),i(302);var s=i(301);class o extends s.p{constructor(){super(),this.width=0,this.height=0,this.asset=void 0,this.uvRect=void 0}get size(){return[this.width,this.height]}}},611:(t,e,i)=>{"use strict";i.d(e,{B:()=>n});var s=i(301),o=i(750);class n extends s.p{constructor(t,e=0){super(),this.delay=t,this.repeatCount=e,this.count=0}start(){this.stop(),this.__timer=setInterval((()=>{this.count++;const t=new o.j(o.j.TIMER);t.timer=this,this.dispatchEvent(t),0!=this.repeatCount&&this.count>=this.repeatCount&&this.stop()}),this.delay)}stop(){this.__timer&&(clearInterval(this.__timer),this.__timer=null)}getCurrentCount(){return this.count}getDelay(){return this.delay}static delayedCall(t,e,i){console.assert(null!=e);const s=new n(t,1);return s.addEventListener(o.j.TIMER,e,i),s.start(),s}static now(){return+new Date}static getPerformaceTimer(){return performance.now()}static getShortDate(t=new Date){return t.toISOString()}static wait(t){return new Promise(((e,i)=>{this.delayedCall(t,e)}))}static waitFrame(t){return new Promise(((e,i)=>{this.delayedCall(1e3/60*t,e)}))}}},73:(t,e,i)=>{"use strict";function s(t){return Array.isArray(t)||t instanceof Float32Array?{x:t[0],y:t[1]}:t}i.d(e,{UL:()=>o,E9:()=>n,Th:()=>r});class o{constructor(t,e,i,s){Array.isArray(t)||t instanceof Float32Array?(this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]):"object"==typeof t?(this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height):(this.x=t||0,this.y=e||0,this.width=i||0,this.height=s||0)}clone(){return new o(this)}getCornerPoints(){const{x:t,y:e,width:i,height:s}=this;return[t,e,t+i,e,t,e+s,t+i,e+s]}getArray(){return[this.x,this.y,this.width,this.height]}extendPoint(t,e){null==this.x?(this.x=t,this.y=e,this.width=0,this.height=0):(t<this.x&&(this.width+=this.x-t,this.x=t),e<this.y&&(this.height+=this.y-e,this.y=e),this.width=Math.max(this.right,t)-this.x,this.height=Math.max(this.bottom,e)-this.y)}extendRect(t){this.extendPoint(t.x,t.y),this.extendPoint(t.right,t.y),this.extendPoint(t.x,t.bottom),this.extendPoint(t.right,t.bottom)}get xywh(){return[this.x,this.y,this.width,this.height]}set xywh(t){const e=function(t){return Array.isArray(t)||t instanceof Float32Array?{x:t[0],y:t[1],width:t[2],height:t[3]}:t}(t);this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}contains(t,e){return t>=this.left&&t<this.right&&e>=this.top&&e<this.bottom}}class n{constructor(t,e){Array.isArray(t)||t instanceof Float32Array?(this.x=t[0],this.y=t[1]):"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=e||0)}clone(){return new n(this)}getArray(){return[this.x,this.y]}get xy(){return[this.x,this.y]}set xy(t){const e=s(t);this.x=e.x,this.y=e.y}add(t){const e=s(t);return this.x+=e.x,this.y+=e.y,new n(this)}subtract(t){const e=s(t);return this.x-=e.x,this.y-=e.y,new n(this)}mul(t){const e=s(t);return this.x*=e.x,this.y*=e.y,new n(this)}}class r{static Uint8ToFloat32(t,e=0,i=null){return new Float32Array(t.buffer,t.byteOffset+e,null!=i?Math.ceil(i/4):null)}static Uint16ToFloat32(t,e=0,i=null){return new Float32Array(t.buffer,t.byteOffset+2*e,null!=i?Math.ceil(i/2):null)}static Float32ToUint8(t,e=0,i=null){return new Uint8Array(t.buffer,t.byteOffset+4*e,null!=i?4*i:null)}static Float32ToUint16(t,e=0,i=null){return new Uint16Array(t.buffer,t.byteOffset+4*e,null!=i?2*i:null)}static subarray(t,e=0,i=null){return t.subarray(e,null!=i?e+i:null)}static resize(t,e){const i=new t.constructor(e);return i.set(t,0,Math.min(e,t.length)),i}static memcpy(t,e,i,s,o){if(o<100){const n=t.subarray(e),r=i.subarray(s);for(let t=0;t<o;t++)n[t]=r[t]}else{const n=o*i.BYTES_PER_ELEMENT,r=new Uint8Array(t.buffer,t.byteOffset+e*t.BYTES_PER_ELEMENT),a=new Uint8Array(i.buffer,i.byteOffset+s*i.BYTES_PER_ELEMENT,n);r.set(a)}}}},584:(t,e,i)=>{"use strict";i.d(e,{c:()=>s});const s={AsyncValue:class{constructor(){this.value=void 0,this.promise=new Promise(((t,e)=>{this._resolve=t,this._reject=e}))}resolve(t){this.value=t,this._resolve(t),delete this.promise,delete this._resolve,delete this._reject}reject(t){this._reject(t),delete this.promise,delete this._resolve,delete this._reject}},nullReplace:(t,e)=>null!=t?t:e,random:(t,e)=>(console.assert(null==t&&null==e||null!=t&&null!=e,`random(${t},${e}) Íµ¨Î¨∏ÏùÄ ÌóàÏö©ÎêòÏßÄ ÏïäÏùå. random(1,a) ÌòπÏùÄ random(0,a)Î•º Î™ÖÌôïÌûà Ïì∏ Í≤É`),null==e?Math.floor(Math.random()*t+1):null==t?Math.random():Math.floor(Math.random()*(e-t+1)+t)),precision:(t,e)=>parseFloat(t).toPrecision(e),idiv:(t,e)=>t/e>>0,lerp:(t,e,i)=>t+(e-t)*i,clamp:(t,e,i)=>Math.min(Math.max(t,e),i),distance:(t,e,i,s)=>Math.sqrt((i-t)*(i-t)+(s-e)*(s-e)),frac:t=>t%1,legacy(t=""){},notImplements(t=""){},getEmbeddedFile:t=>(console.assert(null!=self._embeddedFiles[t.toLowerCase()]),self._embeddedFiles[t]),getEmbeddedBinaryFile(t){console.assert(null!=self._embeddedFiles[t.toLowerCase()]);const e=self._embeddedFiles[t.toLowerCase()],i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s=[];for(let t=0;t<e.length;){const o=i.indexOf(e.charAt(t++)),n=i.indexOf(e.charAt(t++)),r=i.indexOf(e.charAt(t++)),a=i.indexOf(e.charAt(t++)),l=o<<2|n>>4,h=(15&n)<<4|r>>2,d=(3&r)<<6|a;s.push(l),64!=r&&s.push(h),64!=a&&s.push(d)}return new Uint8Array(s)},embeddedFileExist:t=>null!=self._embeddedFiles[t],getEmbeddedXmlFile:t=>(new window.DOMParser).parseFromString(s.getEmbeddedFile(t),"text/xml"),getImageSize:t=>self._imageSizes[t.toLowerCase()]||{width:0,height:0},splitStringWithTag(t){const e=/<([^>]+)>/g,i=["default"],s=[];let o=0;for(;;){const n=e.exec(t),r=i[i.length-1];if(null==n)return o<t.length&&s.push([r,t.substring(o)]),s;{const a=n[1],l=n.index;"/"!=a[0]?i.push(a):r==a.substring(1)&&i.length--,o!=l&&s.push([r,t.substring(o,l)]),o=e.lastIndex}}},hex2rgba(t,e){const i=[];return i[0]=((16711680&t)>>16)/255,i[1]=((65280&t)>>8)/255,i[2]=(255&t)/255,i[3]=null!=e?e:((4278190080&t)>>24)/255,i},rgba2hex(t,e){const i=e||0;return 255*t[i]<<16|255*t[i+1]<<8|255*t[i+2]|255*t[i+3]<<24},angleToDir(t){let e;return e=-135<t&&t<=-45?1:-45<t&&t<=45?2:45<t&&t<=135?3:4,e},dirToOffset(t){let e,i;return 1==t?[e,i]=[0,-1]:2==t?[e,i]=[1,0]:3==t?[e,i]=[0,1]:4==t&&([e,i]=[-1,0]),[e,i]},filterAttrib(t,e,i){const s=null!=e?Array.isArray(e)?","+e.join(",")+",":","+e+",":",*,",o=null!=i?Array.isArray(i)?","+i.join(",")+",":","+i+",":"",n=null!=t?Array.isArray(t)?t:t.split(","):[];let r;if(o.indexOf(",*,")>=0)return!1;if(s.indexOf(",*,")>=0)r=!0;else{if(!(n.length>0))return!1;for(const t of n)if(s.indexOf(","+t+",")>=0){r=!0;break}}if(r){for(const t of n)if(o.indexOf(","+t+",")>=0)return!1;return!0}return!1},format(t,...e){let i;if(e.length>0){let s=0;i=t.replace(/%[s|d]/g,(function(t){return"%"+s++}));for(let t=0;t<e.length;t++)i=i.replace(`%${t}`,e[t])}else i=t;return i},isNode:()=>"object"==typeof{env:{}}&&"object"==typeof{env:{}}.versions&&void 0!=={env:{}}.versions.node,isWebWorker(){return!this.isNode()&&"undefined"!=typeof WorkerGlobalScope&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator},clearObject(t){const e=Object.keys(t);for(let i=0,s=e.length;i<s;i++)delete t[e[i]]}}},106:(t,e,i)=>{"use strict";i.d(e,{U:()=>s});const s={},o=1.70158;s.inBack=function(t){return t*t*(2.70158*t-o)},s.outBack=function(t){return(t-=1)*t*(2.70158*t+o)+1},s.inOutBack=function(t){return(t*=2)<1?t*t*(3.5949095*t-2.5949095)*.5:.5*((t-=2)*t*(3.5949095*t+2.5949095)+2)},s.inBounce=function(t){return 1-s.outBounce(1-t)},s.outBounce=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},s.inOutBounce=function(t){return(t*=2)<1?.5*s.inBounce(t):.5*s.outBounce(t-1)+.5},s.inCircular=function(t){return-(Math.sqrt(1-t*t)-1)},s.outCircular=function(t){return Math.sqrt(1-(t-1)*(t-1))},s.inOutCircular=function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):(t-=2,.5*(Math.sqrt(1-t*t)+1))},s.inCubic=function(t){return t*t*t},s.outCubic=function(t){return(t-=1)*t*t+1},s.inOutCubic=function(t){return t<.5?4*t*t*t:4*(t-=1)*t*t+1};var n=.3,r=.075;s.inElastic=function(t){return 0==t||1==t?t:(t-=1,-1*Math.pow(2,10*t)*Math.sin((t-r)*(2*Math.PI)/n))},s.outElastic=function(t){return 0==t||1==t?t:1*Math.pow(2,-10*t)*Math.sin((t-r)*(2*Math.PI)/n)+1},s.inOutElastic=function(t){return 0==t||1==t?t:(t=2*t-1)<0?1*Math.pow(2,10*t)*Math.sin((t-1.5*r)*(2*Math.PI)/(1.5*n))*-.5:.5*Math.pow(2,-10*t)*Math.sin((t-1.5*r)*(2*Math.PI)/(1.5*n))+1},s.inExponential=function(t){return 0==t?0:Math.pow(2,10*(t-1))},s.outExponential=function(t){return 1==t?1:1-Math.pow(2,-10*t)},s.inOutExponential=function(t){return 0==t||1==t?t:(t=2*t-1)<0?.5*Math.pow(2,10*t):1-.5*Math.pow(2,-10*t)},s.linear=function(t){return t},s.inQuadratic=function(t){return t*t},s.outQuadratic=function(t){return-t*(t-2)},s.inOutQuadratic=function(t){return t<.5?2*t*t:-2*t*(t-2)-1},s.inQuartic=function(t){return t*t*t*t},s.outQuartic=function(t){return 1-(t-=1)*t*t*t},s.inOutQuartic=function(t){return t<.5?8*t*t*t*t:-8*(t-=1)*t*t*t+1},s.inQuintic=function(t){return t*t*t*t*t},s.outQuintic=function(t){return 1+(t-=1)*t*t*t*t},s.inOutQuintic=function(t){return t<.5?16*t*t*t*t*t:16*(t-=1)*t*t*t*t+1},s.inSine=function(t){return 1-Math.cos(t*(Math.PI/2))},s.outSine=function(t){return Math.sin(t*(Math.PI/2))},s.inOutSine=function(t){return-.5*(Math.cos(t*Math.PI)-1)},s.outElasticSmooth=function(t){return 0==t||1==t?t:1*Math.pow(2.5,-10*t)*Math.sin((t-.095)*(2*Math.PI)/.38)+1},s.inElasticSmooth2=function(t){return 0==t||1==t?t:(t-=1,-1*Math.pow(2.6,10*t)*Math.sin((t-.1425)*(2*Math.PI)/.57))},s.outElasticSmooth2=function(t){return 0==t||1==t?t:1*Math.pow(2.6,-10*t)*Math.sin((t-.1425)*(2*Math.PI)/.57)+1},s.outElasticWave=function(t){if(0==t||1==t)return t;var e=Math.pow(t,4);return(Math.pow(220,-.7*Math.pow(t,.4))*Math.sin((Math.pow(t,.95)-.0475)*(2*Math.PI)/.19)+1)*(1-e)+e}},420:(t,e,i)=>{"use strict";i.d(e,{Mx:()=>s.Mx,eY:()=>r,UP:()=>m,wA:()=>h,ju:()=>a.j,pB:()=>l.p,VD:()=>w,Ar:()=>E,Kj:()=>C.K,KG:()=>B,OD:()=>f,DK:()=>T,JV:()=>b,E9:()=>y.E9,UL:()=>y.UL,AC:()=>M.A,i$:()=>P.i,ei:()=>it,bn:()=>F,$u:()=>S,jy:()=>o.j,Ke:()=>L,nv:()=>D,xE:()=>u.x,Wc:()=>n.W,Kw:()=>k,B7:()=>G.B,kX:()=>W,cQ:()=>c.c,wU:()=>s.wU,Ui:()=>_.U,BJ:()=>z,mL:()=>s.mL});var s=i(720),o=i(266),n=i(699);class r extends o.j{constructor(t){super(),this._$$spriteType=o.j.SpriteTypes.BITMAP,this._$$updateCode=o.j.UpdateCodes.UPDATE_EXTRA,this.texture=t,this._$$localBounds.x=0,this._$$localBounds.y=0,this._$$localBounds.width=t.width,this._$$localBounds.height=t.height}encodeExtraRenderingInfo(){let t=new Float32Array(9);return t[0]=this.texture.asset.id,t.set(this.texture.uvRect.getCornerPoints(),1),[t]}setTexture(t){this.texture=t,this._$$updateCode|=o.j.UpdateCodes.UPDATE_EXTRA}}var a=i(750),l=i(301);i(873);class h{constructor(){this.holder=void 0,this.__savedHandlers=void 0,this.__name=this.constructor.name}triggerable(){return l.p.prototype.triggerable.call(this)}newEvent(t,e){return l.p.prototype.newEvent.call(this.holder,t,e)}newTrigger(t,e,i){return l.p.prototype.newTrigger.call(this,t,e,i)}getName(){return this.__name}setName(t){this.__name=t}dispatchEvent(t,e){let i;return console.assert(this.holder,"Ïª¥Ìè¨ÎÑåÌä∏ ÌôÄÎçîÍ∞Ä ÏóÜÎäîÎç∞ Ïù¥Î≤§Ìä∏Î•º Î∞úÏÉùÏãúÌÇ§Î†§Í≥† ÌïúÎã§"),i="string"==typeof t?new a.j(t):t,i.target=this.holder,i.component=this,Object.assign(i,e),this.holder.dispatchEvent(i)}isAdded(){return null!=this.holder}removeFromHolder(){console.assert(this.holder,"Ïª¥Ìè¨ÎÑåÌä∏ ÌôÄÎçîÍ∞Ä ÏóÜÎäîÎç∞ Ï†úÍ±∞ÌïòÎ†§Í≥† ÌïúÎã§"),this.holder.removeComponent(this)}}var d=i(302),c=i(584),u=i(550);class p extends l.p{constructor(t,e,i){super(),this.name=t,this.referenceSize=e||1,this.styles=i,this.asset}addEventListener(t,e,i=null,s=!1){return t==a.j.LOADED&&this.asset.addEventListener(t,this.dispatchEvent.bind(this,a.j.LOADED),null,s),super.addEventListener(t,e,i,s)}getAscender(t){if(!this.asset.loaded)return console.log(`Î°úÎî©Ïù¥ ÏïàÎêú ÏÉÅÌÉúÎ°ú ÏÇ¨Ïù¥Ï¶àÎ•º Íµ¨ÌïòÎ†§Í≥† ÌïúÎã§. ${this.asset.name}`),0;const e=this.asset.fontInfo;return e.ascender/e.unitsPerEm*(t||this.referenceSize)}measureTextWidth(t,e){if(!this.asset.loaded)return console.log(`Î°úÎî©Ïù¥ ÏïàÎêú ÏÉÅÌÉúÎ°ú ÏÇ¨Ïù¥Ï¶àÎ•º Íµ¨ÌïòÎ†§Í≥† ÌïúÎã§. ${this.asset.name}`),0}}class g extends p{constructor(t,e,i){super(t,e,i),this.asset=new d.x(t,d.x.AssetTypes.TrueTypeFont),this.asset.load({referenceSize:this.referenceSize,styles:this.styles}),this.fontLoaded=!1}measureTextWidth(t,e){super.measureTextWidth(t,e);const i=this.asset.fontInfo;let s=0;for(let e=0;e<t.length;e++){const o=t.charCodeAt(e),n=i.chars[o];if(Array.isArray(n)?s+=n[0]:null!=n&&(s+=n),e<t.length-1&&i.kerningPairs){const n=t.charCodeAt(e+1),r=i.kerningPairs[o+","+n];r&&(s+=r)}}return s/i.unitsPerEm*(e||this.referenceSize)}}class m extends p{constructor(t,e,i,s){super(t,e,i),this.asset=new d.x(t,d.x.AssetTypes.BitmapFont);const o=this.asset.fontInfo.pages[0],n=c.c.getImageSize(o.file);this.asset.load({bitmap:o.file,width:n.width,height:n.height,referenceSize:this.referenceSize,styles:this.styles,fontInfo:this.asset.fontInfo,filter:s}),this.fontLoaded=!1}measureTextWidth(t,e){super.measureTextWidth(t,e);const i=this.asset.fontInfo,s=e?e/i.info.size:1;let o=0;for(let e=0;e<t.length;e++){const n=t.charCodeAt(e);o+=i.chars[n].xadvance*s}return o}}class f extends p{constructor(t,e,i){super(t,e,i),this.asset=new d.x(t,d.x.AssetTypes.MsdfFont);const s=this.asset.fontInfo.pages[0],o=c.c.getImageSize(s.file);this.asset.load({bitmap:s.file,width:o.width,height:o.height,referenceSize:this.referenceSize,styles:this.styles,fontInfo:this.asset.fontInfo}),this.fontLoaded=!1}measureTextWidth(t,e){super.measureTextWidth(t,e);const i=this.asset.fontInfo,s=e?e/i.info.size:1;let o=0;for(let e=0;e<t.length;e++){const n=t.charCodeAt(e);o+=i.chars[n].xadvance*s}return o}}const w={ESC:"Escape",ENTER:"Enter",SPACE:"Space",LEFT:"ArrowLeft",RIGHT:"ArrowRight",UP:"ArrowUp",DOWN:"ArrowDown",CTRL:"ControlLeft",A:"KeyA",B:"KeyB",C:"KeyC",D:"KeyD",E:"KeyE",F:"KeyF",G:"KeyG",H:"KeyH",I:"KeyI",J:"KeyJ",K:"KeyK",L:"KeyL",M:"KeyM",N:"KeyN",O:"KeyO",P:"KeyP",Q:"KeyQ",R:"KeyR",S:"KeyS",T:"KeyT",U:"KeyU",V:"KeyV",W:"KeyW",X:"KeyX",Y:"KeyY",Z:"KeyZ",Digit0:"Digit0",Digit1:"Digit1",Digit2:"Digit2",Digit3:"Digit3",Digit4:"Digit4",Digit5:"Digit5",Digit6:"Digit6",Digit7:"Digit7",Digit8:"Digit8",Digit9:"Digit9"};var y=i(73);class E extends o.j{constructor(t=0,e=0,i=0,s=0){super(),this.__locations={},this.__width=i,this.__height=s,this.x=t,this.y=e}resize(t,e){this.__width=t,this.__height=e,this._onResizeEvent()}setRect(t,e,i,s){this.x=t,this.y=e,this.resize(i,s)}_onResizeEvent(){for(const t in this.__locations){const e=this.__locations[t];if("origin"==t)e.x=-this.x,e.y=-this.y;else{const[i,s]=t.split(",");e.x=this.__width*parseFloat(i),e.y=this.__height*parseFloat(s)}}this.dispatchEvent(new a.j(a.j.RESIZE,{width:this.__width,height:this.__height}))}get origin(){return this.location("origin")}get topLeft(){return this.location(0,0)}get topMiddle(){return this.location(.5,0)}get topRight(){return this.location(1,0)}get bottomLeft(){return this.location(0,1)}get bottomMiddle(){return this.location(.5,1)}get bottomRight(){return this.location(1,1)}get leftMiddle(){return this.location(0,.5)}get rightMiddle(){return this.location(1,.5)}get center(){return this.location(.5,.5)}location(t,e=null){const i=null!=e?t+","+e:t;let s=this.__locations[i];return null!=s||(s=this.__locations[i]=new E,null==e?"origin"==i&&(s.x=-this.x,s.y=-this.y):(s.x=this.__width*t,s.y=this.__height*e),this.addChild(s)),s}get width(){return this.__width}set width(t){this.__width=t,this._onResizeEvent()}get height(){return this.__height}set height(t){this.__height=t,this._onResizeEvent()}get size(){return new y.E9(this.__width,this.__height)}set size(t){this.__width=t.x,this.__height=t.y,this._onResizeEvent()}static fromRenderViewport(){const t=new E(s.wU.logicalRenderBounds.x,s.wU.logicalRenderBounds.y,s.wU.logicalRenderBounds.width,s.wU.logicalRenderBounds.height);return s.wU.addEventListener(a.j.RESIZE,(()=>{t.x=s.wU.logicalRenderBounds.x,t.y=s.wU.logicalRenderBounds.y,t.resize(s.wU.logicalRenderBounds.width,s.wU.logicalRenderBounds.height)})),t}static fromLogicalViewpoer(){const t=new E(0,0,s.wU.logicalViewport.width,s.wU.logicalViewport.height);return s.wU.addEventListener(a.j.RESIZE,(()=>{t.resize(s.wU.logicalViewport.width,s.wU.logicalViewport.height)})),t}}var C=i(718),_=i(106);const A={autoPlay:!0};function x(t){const e=this.__mc.animations[this.__mc.currentAnimation];if(null==e)return;for(let[t,i]of e.timeline.entries()){let e=!0;"string"==typeof t&&(t=this.__mc.targets[t],console.assert(null!=t,"MovieClipÏùò ÌÉÄÍ≤üÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§."));for(const s in i){const o=i[s][this.__mc.currentFrame];"$"==s?e=!1:null!=o&&(t[s]=o,e=!1)}t instanceof o.j&&(e?this.contains(t)&&this.removeChild(t):this.contains(t)||this.addChild(t))}const i=e.action[this.__mc.currentFrame];if(null!=i)if(-1==i)this.stop();else if("string"==typeof i){const[t,e,s]=i.split(":");"ani"==t&&this.gotoAndPlay(null!=s?e+":"+s:e)}else this.__mc.currentFrame=parseInt(i);else 0==this.__mc.playing||this.__mc.currentFrame>=e.lastFrame?this.stop():this.__mc.currentFrame++}function v(t){const e=new Map,i={};let s,o=0;for(const n in t){const r=t[n];if("string"==typeof r[1]){const[t,e,s]=r;"stop"==e?i[t]=-1:"goto"==e?i[t]="number"==typeof s?s:"ani:"+s:"event"==e?i[t]="event:"+s:"sound"==e&&(i[t]="sound:"+s)}else{const[t,i,n,a]=r;if(s=e.get(n)||{},null==a){s.$=s.$||{};for(let e=t;e<=i;e++)s.$[e]=1}else for(const e in a)if(s[e]=s[e]||{},Array.isArray(a[e])){const[o,n,r]=a[e],l=("function"==typeof r?r:_.U[r])||_.U.linear;for(let r=t;r<=i;r++)s[e][r]=l((r-t)/(i-t))*(n-o)+o}else{const o=a[e];for(let n=t;n<=i;n++)s[e][n]=o}e.set(n,s),o=Math.max(o,i)}}return{action:i,timeline:e,lastFrame:o}}class B extends o.j{constructor(t,e){super(),this.__mc={},this.__mc.currentFrame=0,this.__mc.currentAnimation=void 0,this.__mc.playing=!1,this.__mc.targets={},this.__mc.animations={},this.__mc.options=Object.assign(A,e),t&&this.addAnimations(t),this.__mc.options.autoPlay&&this.play()}addAnimations(t){if(null!=t)if(Array.isArray(t))this.__mc.animations.default=v.call(this,t),this.__mc.currentAnimation="default";else for(const e in t)null==this.__mc.currentAnimation&&(this.__mc.currentAnimation=e),this.__mc.animations[e]=v.call(this,t[e])}merge(t,e){for(const i in t.__mc.animations){const s=t.__mc.animations[i];(e||null==this.__mc.animations[i])&&(this.__mc.animations[i]=s)}}setTarget(t,e){this.__mc.targets[t]=e}gotoAndPlay(t){if("string"==typeof t){const[e,i]=t.split(":");this.__mc.currentAnimation=e,this.__mc.currentFrame=null!=i?parseInt(i):0}else console.assert("number"==typeof t),this.__mc.currentFrame=parseInt(t);this.play()}gotoAndStop(t){if("string"==typeof t){const[e,i]=t.split(":");this.__mc.currentAnimation=e,this.__mc.currentFrame=null!=i?parseInt(i):0}else console.assert("number"==typeof t),this.__mc.currentFrame=parseInt(t);this.stop()}play(t){null!=t&&this.gotoAndPlay(t),this.__mc.playing||(this.addEventListener(a.j.ENTER_FRAME,x,this),this.__mc.playing=!0)}stop(){this.__mc.playing&&(this.removeEventListener(a.j.ENTER_FRAME,x,this),this.__mc.playing=!1)}setGotoAction(t,e){parseInt(e)==e&&(e=parseInt(e)),this.__mc.animations[this.__mc.currentAnimation].action[t]=e}setStopAction(t){this.__mc.animations[this.__mc.currentAnimation].action[t]=-1}instance(){const t=new B(null);return t.__mc.animations=this.__mc.animations,t.__mc.currentAnimation=Object.keys(this.__mc.animations)[0],Object.assign(t.__mc.targets,this.__mc.targets),t.play(),t}}class T extends o.j{constructor(){super()}addParticles(...t){}setTexture(...t){}}class b extends o.j{constructor(t=16777215,e=1,i=1,s=1){super(),this._$$spriteType=o.j.SpriteTypes.PIXEL,this._$$updateCode=o.j.UpdateCodes.UPDATE_EXTRA,this.pixelColor=c.c.hex2rgba(t,e),this.pixelWidth=i,this.pixelHeight=s,this._$$localBounds.x=0,this._$$localBounds.y=0,this._$$localBounds.width=i,this._$$localBounds.height=s}setColor(t=16777215,e=1){this.pixelColor=c.c.hex2rgba(t,e),this._$$updateCode=o.j.UpdateCodes.UPDATE_EXTRA}encodeExtraRenderingInfo(){let t=new Float32Array(6);return t[0]=this.pixelWidth,t[1]=this.pixelHeight,t.set(this.pixelColor,2),[t]}}var M=i(244),P=i(65);i(636);class F extends o.j{constructor(t){super(),this._$$spriteType=o.j.SpriteTypes.SHAPE,this._$$updateCode=o.j.UpdateCodes.UPDATE_EXTRA,this.beginPath(),this.setLineStyle(0,0,0),this.setFillStyle(F.SOLID,0,0)}get currentSubPathPoints(){return this.subPaths[this.subPaths.length-1]}setLineStyle(t,e,i){this.lineWidth=t,this.lineColor=c.c.hex2rgba(e,i)}setFillStyle(t,...e){if(t==F.SOLID){const[t,i]=e;this.fillColor=c.c.hex2rgba(t,i)}}beginPath(t){this.startX=0,this.startY=0,this.lastX=0,this.lastY=0,this.subPaths=[[]]}clear(){this.subPaths=[]}moveTo(t,e){this.endPath(),0==this.currentSubPathPoints.length&&(this.startX=t,this.startY=e),this.currentSubPathPoints.push(t,e),this.lastX=t,this.lastY=e,this._$$localBounds.extendPoint(t,e)}lineTo(t,e){if(0==this.currentSubPathPoints.length)return this.moveTo(t,e);this.currentSubPathPoints.push(t,e),this.lastX=t,this.lastY=e,this._$$localBounds.extendPoint(t,e)}endPath(){}closePath(){this.currentSubPathPoints.length>0&&(this.currentSubPathPoints.push(this.startX,this.startY),this.subPaths.push([])),this._$$updateCode|=o.j.UpdateCodes.UPDATE_EXTRA}makeBox(t,e,i,s,o,n){this.beginPath(),this.setFillStyle(F.SOLID,o,n),this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+s),this.lineTo(t,e+s),this.closePath()}static makeBox(t,e,i,s,o,n){const r=new F;return r.makeBox(t,e,i,s,o,n),r}encodeExtraRenderingInfo(){let t=(()=>{const t=[];return t.push(this.subPaths.length-(0==this.currentSubPathPoints.length?1:0)),this.subPaths.forEach((e=>{t.push(e.length),t.push(...e)})),t})(),e=new Float32Array(9+t.length);return e[0]=this.lineWidth,e.set(this.lineColor,1),e.set(this.fillColor,5),e.set(t,9),[e]}}F.NONE="none",F.SOLID="solid",F.TEXTURE="texture",F.LINEAR_GRADIENT="linearGradient",F.RADIAL_GRADIENT="radialGradient",F.NON_ZERO="noneZero";class S extends l.p{constructor(t){super(),this.asset=new d.x(t,d.x.AssetTypes.Sound),this.asset.load(),this.playing=!1}addEventListener(t,e,i=null,s=!1){return t==a.j.LOADED&&this.asset.addEventListener(t,this.dispatchEvent.bind(this,a.j.LOADED),null,s),super.addEventListener(t,e,i,s)}play(t,e,i){s.wU.postMessageToRender({msg:"addCommand",class:"Sound",method:"play",args:[this.asset.id,t,e,i]}),this.playing=!0}setVolume(t){s.wU.postMessageToRender({msg:"addCommand",class:"Sound",method:"setVolume",args:[this.asset.id,t]})}setPitch(t){s.wU.postMessageToRender({msg:"addCommand",class:"Sound",method:"setPitch",args:[this.asset.id,t]})}isPlaying(){return this.playing}setPaused(t){t?s.wU.postMessageToRender({msg:"addCommand",class:"Sound",method:"setPaused",args:[this.asset.id,t]}):this.play(),this.playing=!t}setPosition(t){s.wU.postMessageToRender({msg:"addCommand",class:"Sound",method:"setPosition",args:[this.asset.id,t]})}stop(){s.wU.postMessageToRender({msg:"addCommand",class:"Sound",method:"stop",args:[this.asset.id]}),this.playing=!1}getLength(){throw new Error("Not implemented")}static playSound(t){return new S(t).play()}static playSingleSound(t,e,i,o=t){s.wU.postMessageToRender({msg:"addCommand",class:"Sound",method:"playSingleSound",args:[t,e,i,o]})}static stopAllSingleSound(){s.wU.postMessageToRender({msg:"addCommand",class:"Sound",method:"stopAllSingleSound",args:[]})}}class D extends o.j{constructor(t,e,i){super(),this.font=t,this.styles=i,this.useBaseline=!1,this._$$spriteType=o.j.SpriteTypes.TEXTFIELD,this._$$updateCode=o.j.UpdateCodes.UPDATE_EXTRA,this.colorAdd=t instanceof g?[1,1,1,0]:[0,0,0,0],this.customBounds=new y.UL,this.text=e}get text(){return this._text}set text(t){t!=this._text&&(this.customBounds.width=this.font.measureTextWidth(t,this.fontSize),this.customBounds.height=this.fontSize),this._text=t}get fontSize(){return this.font.referenceSize}getTextWidth(){return this.width}setTextColor(t,e){this.setOverrideColor(t,e)}static fromTextWrap(t,e,i,s,o,n,r){const a=new D(o,t,{align:null!=n?n:"left",lineHeight:s,wordWrap:null!=e&&!r,whiteSpate:"normal",trim:!0,breakWord:null!=e&&!r,wordWrapWidth:e});return a.anchorX="center"==n?.5:"right"==n?1:0,null!=e&&(a.x+=e*a.anchorPosition.x),a}encodeExtraRenderingInfo(){let t=new Float32Array(2);return t[0]=this.font.asset.id,t[1]=+this.useBaseline,[t,[this.text]]}}var G=i(611);class L extends l.p{constructor(t){super(),console.assert(self.indexedDB,"indexedDBÍ∞Ä ÏßÄÏõêÎêòÏßÄ ÏïäÎäî Î∏åÎùºÏö∞Ï†Ä");const e=self.indexedDB.open(t,1);e.onerror=t=>{throw new Error("indexedDB Ïó¥Í∏∞ Ïã§Ìå®")},e.onupgradeneeded=t=>{t.target.result.createObjectStore("files",{keyPath:"path"})},e.onsuccess=t=>{const i=e.result;this.db=i,this.dispatchEvent("ready")}}read(t){return new Promise(((e,i)=>{const s=()=>{this.db.transaction("files","readonly").objectStore("files").get(t).onsuccess=t=>{this.dispatchEvent(new a.j(a.j.COMPLETE,{content:t.target.result.content})),e(t.target.result.content)}};this.db?s():this.once("ready",s)}))}write(t,e){return new Promise(((i,s)=>{const o=()=>{this.db.transaction("files","readwrite").objectStore("files").put({path:t,content:e}).onsuccess=t=>{this.dispatchEvent(new a.j(a.j.COMPLETE)),i()}};this.db?o():this.once("ready",o)}))}static loadFile(t){}}class I extends o.j{constructor(t){super(),this.loader=new SpinePixi.AssetManager,this.loader.loadText(t+".json"),this.loader.loadText("Spines/Spine_Player_3.atlas"),this.loader.loadTexture("Spines/Spine_Player_3.png"),this.spineFilename=t,requestAnimationFrame((()=>this.load()))}load(){if(this.loader.isLoadingComplete()){console.log("ÏôÑÎ£å");let t=this.loadSkeleton(this.spineFilename);this.skeleton=t.skeleton,this.state=t.state,this.bounds=t.bounds,this.skeletonData=t,this.renderer=new SpinePixi.SkeletonRenderer(this.__pixi),this.onStage(a.j.ENTER_FRAME,(()=>{this.state.update(1/60),this.state.apply(this.skeleton),this.renderer.draw(this.skeleton)})),this.__pixi.emit(a.j.READY)}else requestAnimationFrame((()=>this.load()))}loadSkeleton(t){let e=t.substr(0,t.lastIndexOf("/")),i=new SpinePixi.core.TextureAtlas(this.loader.get("Spines/Spine_Player_3.atlas"),(t=>this.loader.get(e+"/"+t))),s=new SpinePixi.core.AtlasAttachmentLoader(i),o=new SpinePixi.core.SkeletonJson(s).readSkeletonData(this.loader.get(t+".json")),n=new SpinePixi.core.Skeleton(o);n.flipY=!0;let r=this.calculateBounds(n);n.setSkinByName("runner");var a=new SpinePixi.core.AnimationState(new SpinePixi.core.AnimationStateData(n.data));return a.setAnimation(0,"standing",!0),a.addListener({event:function(t,e){},complete:function(t,e){},start:function(t){},end:function(t){}}),{skeleton:n,state:a,bounds:r}}calculateBounds(t){t.data,t.setToSetupPose(),t.updateWorldTransform();var e=new SpinePixi.core.Vector2,i=new SpinePixi.core.Vector2;return t.getBounds(e,i,[]),{offset:e,size:i}}}function R(t,e){const i=t*(this.__tileWidth+this.__spacingX)+this.__marginX,s=e*(this.__tileHeight+this.__spacingY)+this.__marginY;return[i,s,i+this.__tileWidth,s+this.__tileHeight]}I.prototype.getChildAt=D.prototype.getChildAt,I.prototype.getNumChildren=D.prototype.getNumChildren,I.prototype.sortChildren=D.prototype.sortChildren,I.prototype.refreshColor=D.prototype.refreshColor,i(919);class k extends o.j{constructor(t,e,i,s,o,n=0,r=0,a=0,l=0,h=s,d=o){super(),this.__mapWidth=t,this.__mapHeight=e,this.__texture=i,this.__tileWidth=s,this.__tileHeight=o,this.__spacingX=n,this.__spacingY=r,this.__marginX=a,this.__marginY=l,this.__displayWidth=h||s,this.__displayHeight=d||o;const c=new C.K;c.setTexture(i),this.__mesh=c,this.useCustomLocalBounds=!0,this._$$localBounds.width=t*s,this._$$localBounds.height=e*o,this.clearAllTiles(),this.addChild(c)}clearAllTiles(){const[t,e,i,s]=[[],[],[],[]];for(let o=0;o<this.__mapHeight;o++)for(let n=0;n<this.__mapWidth;n++){const[r,a,l,h]=[n*this.__displayWidth,o*this.__displayHeight,(n+1)*this.__displayWidth,(o+1)*this.__displayHeight];t.push(r,a,l,a,r,h,l,h),i.push(0,0,0,0,0,0,0,0),s.push(0,0,0,0,0,0,0,0),e.push(0,0,0,0,0,0)}let o=this.__mesh;o.setVertexArray(t),o.setIndexArray(e),o.setTextureCoordinateArray(i),o.setColorArray(s),this.__map=[]}setTile(t,e,i,s,o=!1,n=16777215,r=1,a=n,l=r,h=n,d=r,c=n,u=r){null!=i&&null!=s||this.clearTile(t,e),this.__mapWidth;const[p,g,m,f]=[t*this.__displayWidth,e*this.__displayHeight,(t+1)*this.__displayWidth,(e+1)*this.__displayHeight],w=this.__mesh,[y,E,C,_]=R.call(this,i,s);let A=this.__map[e*this.__mapWidth+t];!function(t,e,i,s,o,n,r,a,l,h,d,c,u,p,g,m,f,w){const[y,E,C,_]=[4*e,4*e,4*e,6*e];t.setVertices(y+0,i,s,y+1,o,s,y+2,i,n,y+3,o,n),t.setTextureCoordinates(E+0,r,a,E+1,l,a,E+2,r,h,E+3,l,h),t.setColors(C+0,d,c,C+1,u,p,C+2,g,m,C+3,f,w),t.setIndices(_+0,y+0,_+1,y+1,_+2,y+2,_+3,y+1,_+4,y+3,_+5,y+2)}(w,t+e*this.__mapWidth,p,g,m,f,y,E,C,_,n,l,a,l,h,d,c,u),A=[i,s,o,n,r,a,l,h,d,c,u,t+e*this.__mapWidth],this.__map[e*this.__mapWidth+t]=A}getTile(t,e){const i=this.__map[e*this.__mapWidth+t];if(null!=i)return i}getArray(t,e){const i=this.__map[e*this.__mapWidth+t];if(null==i)return;const s=i[11],[o,n]=[4*s,6*s],r=this.__mesh,a=[],l=[],h=[],d=[];for(let t=0;t<4;t++){const{x:e,y:i}=r.getVertex(o+t);a.push(e,i);const{x:s,y:n}=r.getTextureCoordinate(o+t);l.push(s,n);const{color:d,alpha:c}=r.getColor(o+t);h.push(d,c)}for(let t=0;t<6;t++){const e=r.getIndex(n+t);d.push(e)}return[a,l,h,d]}clearTile(t,e){const i=this.__map[e*this.__mapWidth+t];if(null!=i){const t=6*i[11];this.__mesh.setIndices(t+0,0,t+1,0,t+2,0,t+3,0,t+4,0,t+5,0)}this.__map[e*this.__mapWidth+t]=null}setTexture(t){this.__mesh.setTexture(t)}setShader(t){this.__mesh.setShader(t)}setTileColor(t,e,i,s,o){if(this.__mapWidth,o){const o=this.__map[e*this.__mapWidth+t],n=e>0&&t>0?this.__map[(e-1)*this.__mapWidth+t-1]:null,r=e>0?this.__map[(e-1)*this.__mapWidth+t]:null,a=t>0?this.__map[e*this.__mapWidth+t-1]:null;o&&this.__mesh.setColor(4*o[11]+0,i,s),n&&this.__mesh.setColor(4*n[11]+3,i,s),r&&this.__mesh.setColor(4*r[11]+2,i,s),a&&this.__mesh.setColor(4*a[11]+1,i,s)}else{const o=this.__map[e*this.__mapWidth+t];if(o){const t=4*o[11];this.__mesh.setColors(t+0,i,s,t+1,i,s,t+2,i,s,t+3,i,s)}}}}function O(t){return[(t>>16)/255,(t>>8&255)/255,(255&t)/255]}k.FLIP_DIAGONAL="flipDiagonal",k.FLIP_HORIZONTAL="flipHorizontal",k.FLIP_VERTICAL="flipVertical";const X=[];class W extends l.p{constructor(t,e,i,o){super(),this._delay=0,this._paused=!0,this._position=Number.NaN,this._isEnd=!1,this.autoPlay=!0,this.repeatCount=1,this.timeScale=1,this.ease=W.defaultEase,this.dispatchEvents=W.defaultDispatchEvents,this.target=t,this.duration=e,this.reflect=void 0,this.nextTween=void 0;let n=null;"function"!=typeof o&&"string"!=typeof o||(o={ease:o}),null!=o&&(n=o.swapValues,o.swapValues=null,Object.assign(this,o)),"string"==typeof this.ease&&(this.ease=_.U[this.ease]),console.assert(null!=this.ease),this.resetValues(i),n&&this.swapValues(),0==this.duration&&0==this.getDelay()&&this.autoPlay&&(this.calculatedPosition=null,this.setPosition(0)),W.active||(s.wU.stage.addEventListener(a.j.ENTER_FRAME,W.onTick),W.active=!0)}isPaused(){return this._paused}isEnd(){return this._isEnd}stop(){this.setPaused(!0)}setPaused(t){t!=this._paused&&(this._paused=t,this._paused?W.activeTweenList.delete(this):((Number.isNaN(this._position)||0!=this.repeatCount&&this._position>=this.repeatCount*this.duration)&&(this._inited=!1,this.calculatedPosition=0,this.calculatedPositionOld=0,this.ratio=0,this.ratioOld=0,this.positionOld=0,this._position=-this.getDelay()),W.activeTweenList.set(this,!0)))}stopAll(){for(const[t]of W.activeTweenList)t.stop()}getPosition(){return this._position}setPosition(t){this.positionOld=this._position,this.ratioOld=this.ratio,this.calculatedPositionOld=this.calculatedPosition;const e=this.repeatCount*this.duration,i=t>=e&&this.repeatCount>0;if(i){if(this.calculatedPositionOld==e)return;this._position=e,this.calculatedPosition=(this.reflect&&this.repeatCount,this.duration)}else this._position=t,this.calculatedPosition=this._position<0?0:this._position%this.duration,this.reflect&&Math.floor(this.getPosition()/this.duration)%2!=0&&(this.calculatedPosition=this.duration-this.calculatedPosition);if(this.ratio=0==this.duration&&this._position>=0?1:this.ease(this.calculatedPosition/this.duration,0,1,1),this.target&&(this._position>=0||this.positionOld>=0)&&this.calculatedPosition!=this.calculatedPositionOld){this._inited||this.init();for(const t in this._endValues){let e,i,s;if("color"==t){e=this._initValues[t],i=this._rangeValues[t];const s=e[0]+i[0]*this.ratio,o=e[1]+i[1]*this.ratio,n=e[2]+i[2]*this.ratio;this.target.setColorMultiplier(s,o,n)}else e=this._initValues[t],i=this._rangeValues[t],s=e+i*this.ratio,console.assert(null!=this.target[t]),this.target[t]=s}}return this.dispatchEvents&&this.dispatchEvent("change"),i&&(this._isEnd=!0,this.setPaused(!0),this.nextTween&&this.nextTween.setPaused(!1),this.dispatchEvents&&this.dispatchEvent("complete")),this}getDelay(){return this._delay}setDelay(t){return this._position<=0&&(this._position=-t),this._delay=t,this}setValue(t,e){return this._endValues[t]=e,this.invalidate(),this}getValue(t){return this._endValues[t]}deleteValue(t){this._rangeValues[t]=null,this._initValues[t]=null;const e=null!=this._endValues[t];return this._endValues[t]=null,e}setValues(t){return Object.assign(this._endValues,t),this.invalidate(),this}resetValues(t){return this._endValues={},this.setValues(t),this}getValues(){return Object.assign({},this._endValues)}getInitValue(t){return this._initValues[t]}swapValues(){this._inited||this.init();const t=this._endValues;this._endValues=this._initValues,this._initValues=t;for(const t in this._rangeValues){const e=this._rangeValues[t];this._rangeValues[t]=-e}if(this.calculatedPosition=null,this._position<0){const t=this.positionOld;this.setPosition(0),this._position=this.positionOld,this.positionOld=t}else this.setPosition(this._position)}init(){this._inited=!0,this._initValues={},this._rangeValues={};for(const t in this._endValues)if("color"==t){let e;this._initValues[t]=O(this.target.colorMultiplier),e=O(this._endValues[t]),this._rangeValues[t]=[e[0]-parseFloat(this._initValues[t][0]),e[1]-parseFloat(this._initValues[t][1]),e[2]-parseFloat(this._initValues[t][2])]}else console.assert(null!=this.target[t],"Ìä∏ÏúàÏúºÎ°ú Ï°∞ÏûëÌïòÎ†§Îäî Í∞íÏù¥ nullÏù¥Îã§."),this._initValues[t]=this.target[t],this._rangeValues[t]=this._endValues[t]-this._initValues[t];this.dispatchEvents&&this.dispatchEvent("init")}toStart(){this.setPosition(0)}cancel(){this.setPosition(0),this.stop()}toEnd(){this.setPosition(this.repeatCount>0&&this.repeatCount*this.duration||this.duration)}invalidate(){this._inited=!1,this._position>0&&(this._position=0),this.autoPlay&&this.setPaused(!1)}onCompleteRemoveFromParent(){return this.addEventListener("complete",(()=>{this.target.removeFromParent(),this.target=null}),this),this}onComplete(t,e){return this.addEventListener("complete",t,e),this}onChange(t,e){return this.addEventListener("change",t,e),this}setNextTween(t){return this.nextTween=t,this}tween(t,e,i){const s=new W(this.target,t,e,i);return this.isEnd()||(s.setPaused(!0),this.setNextTween(s)),s}move(t,e,i=0,s){const o=new W(this.target,i,{x:t,y:e},s);return this.isEnd()||(o.setPaused(!0),this.setNextTween(o)),o}wait(t=0,e,i){const s=new W(this.target,t);return e&&this.onComplete(e,i),this.isEnd()||(s.setPaused(!0),this.setNextTween(s)),s}stopTweenChain(){W.stopTarget(this.target)}static linearEase(t,e,i,s){return t}static onTick(){if(W.pauseAll)return;const t=1/60*W.timeScaleAll*1e3;for(const[t]of W.activeTweenList)X.push(t);for(let e=0;e<X.length;e++){const i=X[e];i.setPosition(i._position+(i.useFrames&&W.timeScaleAll||t)*i.timeScale)}0==X.length&&(s.wU.stage.removeEventListener(a.j.ENTER_FRAME,W.onTick),W.active=null),X.length=0}static stopTarget(t){for(const[e]of W.activeTweenList)e.target==t&&e.stop()}}l.p.prototype.tween=function(t,e,i){return new W(this,t,e,i)},l.p.prototype.move=function(t,e,i=0,s){return new W(this,i,{x:t,y:e},s)},l.p.prototype.wait=function(t=0,e,i){return new W(this,t).onComplete(e,i)},l.p.prototype.getTweens=function(t){const e=[];for(const[i]of W.activeTweenList)i.target==this&&(t&&!i.paused||e.push(i));return e.length>0?e:null},l.p.prototype.stopAllTweens=function(){W.stopTarget(this)},W.active=!1,W.defaultDispatchEvents=!0,W.defaultEase=W.linearEase,W.pauseAll=!1,W.timeScaleAll=1,W.activeTweenList=new Map;const Y=["„Ñ±","„Ñ≤","„Ñ¥","„Ñ∑","„Ñ∏","„Ñπ","„ÖÅ","„ÖÇ","„ÖÉ","„ÖÖ","„ÖÜ","„Öá","„Öà","„Öâ","„Öä","„Öã","„Öå","„Öç","„Öé"],N=["„Öè","„Öê","„Öë","„Öí","„Öì","„Öî","„Öï","„Öñ","„Öó","„Öò","„Öô","„Öö","„Öõ","„Öú","„Öù","„Öû","„Öü","„Ö†","„Ö°","„Ö¢","„Ö£"],U=[" ","„Ñ±","„Ñ≤","„Ñ≥","„Ñ¥","„Ñµ","„Ñ∂","„Ñ∑","„Ñπ","„Ñ∫","„Ñª","„Ñº","„ÑΩ","„Ñæ","„Ñø","„ÖÄ","„ÖÅ","„ÖÇ","„ÖÑ","„ÖÖ","„ÖÜ","„Öá","„Öà","„Öä","„Öã","„Öå","„Öç","„Öé"],V={},j={„Öè„Ö£:1,„Ö£„Öè:2,„Öë„Ö£:3,„Öì„Ö£:5,„Ö£„Öì:6,„Öï„Ö£:7,„Öó„Öè:9,„Öó„Öê:10,„Öó„Öè„Ö£:10,„Öó„Ö£:11,„Ö£„Öó:12,„Öú„Öì:14,„Öú„Öî:15,„Öú„Öì„Ö£:15,„Öú„Ö£:16,„Ö°„Öú:17,„Ö°„Ö£:19},$={};for(let t=0;t<Y.length;t++)V[Y[t]]=t;for(let t=0;t<N.length;t++)j[N[t]]=t;for(let t=0;t<U.length;t++)$[U[t]]=t;const H=44032,z={};function K(t){return t.charCodeAt(0)}const Q=[K("Í∞Ä"),K("Ìû£")];z.isValidUnicode=function(t){const e=K(t);return e>=Q[0]&&e<=Q[1]};const q=[K("„Ñ±"),K("„Öé")],J=[K("„Öè"),K("„Ö£")];z.isJamo=function(t){const e=K(t);return e>=q[0]&&e<=q[1]||e>=J[0]&&e<=J[1]},z.isJongSung=function(t){const e=t.substr(t.length-1),i=e.charCodeAt(0);if(i<H||i>55199)return!!V[e]||"bcdfghjklmnpqrstvwxz136780".indexOf(e)>=0;let s=i-H;return s%=588,s%=28,s>0},z.replaceJoSa=function(t){if(null==t||""==t)return t;const e=/}?([^}]*){([^/}]*)}/g;let i=e.exec(t),s=0,o="";for(;null!=i;){s=e.lastIndex;const[n,r,a]=[RegExp.$1,RegExp.$2,RegExp.$1.match(/.['"`^()[\]]?$/)[0].substr(0,1)],l=z.isJongSung(a),h=l?z.divideJaSo(a)[2]:null;let d;"ÏùÑ"==r||"Î•º"==r?d=l?"ÏùÑ":"Î•º":"Ïù¥"==r||"Í∞Ä"==r?d=l?"Ïù¥":"Í∞Ä":"Í≥º"==r||"ÏôÄ"==r?d=l?"Í≥º":"ÏôÄ":"ÏùÄ"==r||"Îäî"==r?d=l?"ÏùÄ":"Îäî":"Ïù¥Îäî"==r?d=l?"Ïù¥Îäî":"Îäî":"Ïù¥ÏôÄ"==r?d=l?"Ïù¥ÏôÄ":"ÏôÄ":"Ïó¨"==r||"Ïù¥Ïó¨"==r?d=l?"Ïù¥Ïó¨":"Ïó¨":"ÏúºÎ°ú"==r||"Î°ú"==r?d=l&&"„Ñπ"!=h?"ÏúºÎ°ú":"Î°ú":"Ïù¥ÎÑ§"==r||"ÎÑ§"==r?d=l?"Ïù¥ÎÑ§":"ÎÑ§":"Ïù¥Îûë"==r||"Îûë"==r?d=l?"Ïù¥Îûë":"Îûë":"Îùº"==r&&(d=l?"Ïù¥Îùº":"Îùº"),o=o+n+d,i=e.exec(t)}return o+t.substr(s)},z.format=function(t,...e){let i;if(e.length>0){let s=0;i=t.replace(/%[s|d]/g,(function(t){return"%"+s++}));for(let t=0;t<e.length;t++)i=i.replace(`%${t}`,e[t])}else i=t;return z.replaceJoSa(i)},z.mergeJaSo=function(t,e,i){const s=V[t],o=j[e],n=i?$[i]:0,r=H+28*(21*s+o)+n;return String.fromCharCode(r)},z.divideJaSo=function(t){const e=t.charCodeAt(0);if(e<H||e>55199){const e=V[t];if(e)return[Y[e]];const i=j[t];return i?[null,N[i]]:[]}let i=e-H;const s=Math.floor(i/588);i%=588;const o=Math.floor(i/28);return i%=28,[Y[s],N[o],i>0&&U[i]||null]},z.getTypeOfJaSo=function(t){let[e,i,s]=[!1,!1,!1];return V[t]&&(e=!0),j[t]&&(i=!0),$[t]&&(s=!0),[e,i,s]};const Z={undefined:"$$UDF",function:"$$FNC",unknown:"$$UKN",NaN:"$$NAN",Infinity:"$$INF",MinusInfinity:"$$MIF",Date:"$$DAT",RegExp:"$$RGX",Reference:"$$REF"},tt={ignorePrefix:"__",ignoreList:["__pixi"],skipUndefined:!0,skipUnknownClass:!0};function et(t,e,i){if(null==i)Object.assign(t,e);else for(const s in e)"object"==typeof e[s]&&t[s]&&i.includes(s)?Object.assign(t[s],e[s]):t[s]=e[s]}class it{constructor(t,e=tt){this.classList={},this.options=e;for(const e of t)Array.isArray(e)?this.classList[e[0].name]=[e,e[1]]:this.classList[e.name]=[e,null];this.__objectToId=void 0,this.__idToObject=void 0,this.__refCount=void 0}_getSerializableObject(t){if(this.__objectToId.has(t))return this.__refCount[this.__objectToId.get(t)]=(this.__refCount[this.__objectToId.get(t)]||0)+1,Z.Reference+":"+this.__objectToId.get(t);if(void 0===t)return Z.undefined;if(null===t)return null;if(t instanceof RegExp)return Z.RegExp+":"+t.toString();if(t instanceof Date)return Z.Date+":"+t.getTime();if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return Number.isNaN(t)?Z.NaN:t===Number.POSITIVE_INFINITY?Z.Infinity:t===Number.NEGATIVE_INFINITY?Z.MinusInfinity:t;if("function"==typeof t)return Z.function;if("object"==typeof t){if(this.options.skipUnknownClass&&t.constructor!==Object&&t.constructor!==Array&&null==this.classList[t.constructor.name])return Z.unknown;const e=this.__objectToId.size;let i;if(this.__objectToId.set(t,e),Array.isArray(t)){i=[];for(let e=0;e<t.length;e++){const s=this._getSerializableObject(t[e]);this.options.skipUndefined&&s==Z.undefined||s!=Z.function&&s!=Z.unknown&&(i[e]=s)}}else{const e=t.constructor!==Object?this.classList[t.constructor.name][1]:null;i=e&&e.dataOnly||t.constructor===Object?{}:{__class:t.constructor.name};const s=Object.keys(t).sort();for(const o of s)if(!this.options.ignoreList.includes(o)&&!o.startsWith(this.options.ignorePrefix)){if(e&&e.black&&e.black.includes(o))continue;if(e&&e.white&&!e.white.includes(o))continue;const s=this._getSerializableObject(t[o]);if(this.options.skipUndefined&&s==Z.undefined)continue;s!=Z.function&&s!=Z.unknown&&(i[o]=s)}}return this.__idToObject[e]=i,i.__refId=e,i}throw new Error(`Ïïå Ïàò ÏóÜÎäî ÌÉÄÏûÖ Î∞úÍ≤¨ ${t}`)}getSerializableObject(t){this.__objectToId=new Map,this.__idToObject={},this.__refCount={};const e=this._getSerializableObject(t);for(const t in this.__idToObject)null==this.__refCount[t]&&delete this.__idToObject[t].__refId;return delete this.__objectToId,delete this.__idToObject,delete this.__refCount,e}stringify(t){return JSON.stringify(this.getSerializableObject(t))}parse(t,e){const i=this,s=function(t,s){if(null==s)return s;if("object"==typeof s){if(Array.isArray(s)||null==s._$$class)return s;{let t;console.assert(!i.__objectToId.has(s)),console.assert(i.classList[s._$$class]);const[o,n]=i.classList[s._$$class];null==n?(console.assert(0==o.length,`${s._$$class}Ïùò ÏÉùÏÑ±ÏûêÏùò Ïù∏ÏàòÎäî ${o.length}Ïù∏Îç∞ Ïù∏Ïàò ÏóÜÏù¥ ÏÉùÏÑ±ÏùÑ ÏãúÎèÑÌïòÍ≥† ÏûàÎã§. construct ÏòµÏÖòÏù¥ ÌïÑÏöîÌï®`),t=new o,Object.assign(t,s)):n.construct?(t=n.construct.call(i,s,e),!1!==n.fill&&et(t,s,n.keep)):et(t,s,n.keep);const r=s.__refId;return null!=r&&(i.__objectToId.set(s,r),i.__idToObject[r]=t,delete t.__refId),delete t._$$class,t}}if("string"==typeof s){if(Object.values(Z).includes(s.substr(0,5))){const t=s.substr(0,5);if(t==Z.NaN)return Number.NaN;if(t==Z.Infinity)return Number.POSITIVE_INFINITY;if(t==Z.MinusInfinity)return Number.NEGATIVE_INFINITY;if(t==Z.RegExp)return new RegExp(s.substr(6));if(t==Z.Date)return new Date(s.substr(6));if(t==Z.Reference){const t=s.substr(6);if(i.__idToObject[t])return i.__idToObject[t];throw new Error("Î¶¨ÌçºÎü∞Ïä§ Í∞úÏ≤¥Í∞Ä ÎßåÎì§Ïñ¥ÏßÄÍ∏∞ Ï†ÑÏóê Î¶¨ÌçºÎü∞Ïä§Î•º Ïó∞Í≤∞ÌïòÎ†§Í≥† Ìï®")}throw new Error(`parse Ìï† Ïàò ÏóÜÎäî Í∞úÏ≤¥ ${s}`)}return s}return s};let o;if(this.__objectToId=new Map,this.__idToObject={},console.log(t),"object"==typeof t){const e=function(t){if(null==t)return t;if("object"==typeof t){const i=Array.isArray(t)?[]:{};for(const o in t)i[o]=s.call(i,o,e(t[o]));return i}return t};o=e(t)}else"string"==typeof t&&(o=JSON.parse(t,s));return delete this.__idToObject,delete this.__objectToId,console.log(o),o}}},110:t=>{let e=Number.POSITIVE_INFINITY,i=null;t.exports=class{static dist(t,e,i,s){return Math.sqrt(Math.pow(i-t,2)+Math.pow(s-e,2))}static dist_between(t,e){return this.dist(t.x,t.y,e.x,e.y)}static heuristic_cost_estimate(t,e){return this.dist(t.x,t.y,e.x,e.y)}static is_valid_node(t,e){return!0}static lowest_f_score(t,i){let[s,o]=[e,null];for(let e in t){let n=t[e],r=i[n];r<s&&([s,o]=[r,n])}return o}static neighbor_nodes(t,e){let i=[];for(let s in e){let o=e[s];t!=o&&this.is_valid_node(t,o)&&i.push(o)}return i}static not_in(t,e){for(let i in t)if(t[i]==e)return!1;return!0}static remove_node(t,e){for(let i in t)if(t[i]==e){t[i]=t[t.length-1],t[t.length-1]=null;break}}static unwind_path(t,e,i){return e[i]?(t.unshift(e[i]),this.unwind_path(t,e,e[i])):t}static a_star(t,e,i,s){let o=[],n=[t],r=[];s&&(this.is_valid_node=s);let[a,l]=[[],[]];for(a[t]=0,l[t]=a[t]+this.heuristic_cost_estimate(t,e);n.length>0;){let t=this.lowest_f_score(n,l);if(t==e){let t=this.unwind_path([],r,e);return t.push(e),t}this.remove_node(n,t),o.push(t);let s=this.neighbor_nodes(t,i);for(let i in s){let h=s[i];if(this.not_in(o,h)){let i=a[t]+this.dist_between(t,h);(this.not_in(n,h)||i<a[h])&&(r[h]=t,a[h]=i,l[h]=a[h]+this.heuristic_cost_estimate(h,e),this.not_in(n,h)&&n.push(h))}}}return null}static clear_cached_paths(){i=null}static distance(t,e,i,s){return this.dist(t,e,i,s)}static path(t,e,s,o,n){if(i||(i={}),i[t]){if(i[t][e]&&!o)return i[t][e]}else i[t]={};return this.a_star(t,e,s,n)}}},886:t=>{const e={startIndex:new Uint16Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,0,0,30,31,33,35,37,39,41,43,45,47,49,51,53,55,57,59,61,63,65,67,69,71,73,75,77,79,81,83,85,0,0,86,87,89,92,95,98,101,104,107,110,113,116,119,122,125,128,131,134,137,140,143,146,149,152,155,158,161,164,166,0,0,167,168,170,173,177,181,185,189,193,197,201,205,209,213,217,221,225,229,233,237,241,245,249,253,257,261,265,268,270,0,0,271,272,274,277,281,286,291,296,301,306,311,316,321,326,331,336,341,346,351,356,361,366,371,376,381,386,390,393,395,0,0,396,397,398,400,403,408,414,420,426,432,438,444,450,456,462,468,474,480,486,492,498,504,510,516,522,527,530,532,533,0,0,534,535,536,538,541,545,551,558,565,572,579,586,593,600,607,614,621,628,635,642,649,656,663,670,676,680,683,685,686,0,0,687,689,690,692,695,699,704,711,719,727,735,743,751,759,767,775,783,791,799,807,815,823,831,838,843,847,850,852,853,0,0,855,856,858,861,863,866,870,876,883,892,901,910,919,928,937,946,955,964,973,982,991,1e3,1007,1013,1017,1020,1022,1025,1027,0,0,1028,1029,1031,1033,1036,1040,1044,1049,1055,1063,1073,1083,1093,1103,1113,1123,1133,1143,1153,1163,1173,1181,1187,1192,1196,1200,1203,1205,1207,0,0,1208,1209,1211,1213,1216,1219,1223,1228,1233,1240,1249,1260,1271,1282,1293,1304,1315,1326,1337,1348,1357,1364,1369,1374,1378,1381,1384,1386,1388,0,0,1389,1390,1392,1394,1396,1399,1402,1406,1411,1417,1424,1434,1446,1458,1470,1482,1494,1506,1518,1528,1535,1541,1546,1550,1553,1556,1558,1560,1562,0,0,1563,1564,1565,1567,1569,1571,1574,1577,1581,1586,1592,1600,1610,1623,1636,1649,1662,1675,1685,1693,1699,1704,1708,1711,1714,1716,1718,1720,1721,0,0,1722,1723,1724,1725,1727,1729,1731,1733,1736,1739,1743,1748,1755,1766,1780,1794,1808,1819,1826,1831,1835,1838,1841,1843,1845,1847,1849,1850,1851,0,0,1852,1853,1854,1855,1856,1857,1858,1859,1862,1865,1868,1871,1876,1883,0,1898,1913,1920,1925,1928,1931,1934,1937,1938,1939,1940,1941,1942,1943,0,0,1944,1945,1946,1947,1949,1951,1953,1955,1958,1961,1965,1970,1977,1988,2002,2016,2030,2041,2048,2053,2057,2060,2063,2065,2067,2069,2071,2072,2073,0,0,2074,2075,2076,2078,2080,2082,2085,2088,2092,2097,2103,2111,2121,2134,2147,2160,2173,2186,2196,2204,2210,2215,2219,2222,2225,2227,2229,2231,2232,0,0,2233,2234,2236,2238,2240,2243,2246,2250,2255,2261,2268,2278,2290,2302,2314,2326,2338,2350,2362,2372,2379,2385,2390,2394,2397,2400,2402,2404,2406,0,0,2407,2408,2410,2412,2415,2418,2422,2427,2432,2439,2448,2459,2470,2481,2492,2503,2514,2525,2536,2547,2556,2563,2568,2573,2577,2580,2583,2585,2587,0,0,2588,2589,2591,2593,2596,2600,2604,2609,2615,2623,2633,2643,2653,2663,2673,2683,2693,2703,2713,2723,2733,2741,2747,2752,2756,2760,2763,2765,2767,0,0,2768,2769,2771,2774,2776,2779,2783,2789,2796,2805,2814,2823,2832,2841,2850,2859,2868,2877,2886,2895,2904,2913,2920,2926,2930,2933,2935,2938,2940,0,0,2941,2943,2944,2946,2949,2953,2958,2965,2973,2981,2989,2997,3005,3013,3021,3029,3037,3045,3053,3061,3069,3077,3085,3092,3097,3101,3104,3106,3107,0,0,3109,3110,3111,3113,3116,3120,3126,3133,3140,3147,3154,3161,3168,3175,3182,3189,3196,3203,3210,3217,3224,3231,3238,3245,3251,3255,3258,3260,3261,0,0,3262,3263,3264,3266,3269,3274,3280,3286,3292,3298,3304,3310,3316,3322,3328,3334,3340,3346,3352,3358,3364,3370,3376,3382,3388,3393,3396,3398,3399,0,0,3400,3401,3403,3406,3410,3415,3420,3425,3430,3435,3440,3445,3450,3455,3460,3465,3470,3475,3480,3485,3490,3495,3500,3505,3510,3515,3519,3522,3524,0,0,3525,3526,3528,3531,3535,3539,3543,3547,3551,3555,3559,3563,3567,3571,3575,3579,3583,3587,3591,3595,3599,3603,3607,3611,3615,3619,3623,3626,3628,0,0,3629,3630,3632,3635,3638,3641,3644,3647,3650,3653,3656,3659,3662,3665,3668,3671,3674,3677,3680,3683,3686,3689,3692,3695,3698,3701,3704,3707,3709,0,0,3710,3711,3713,3715,3717,3719,3721,3723,3725,3727,3729,3731,3733,3735,3737,3739,3741,3743,3745,3747,3749,3751,3753,3755,3757,3759,3761,3763,3765,0,0,3766,3767,3768,3769,3770,3771,3772,3773,3774,3775,3776,3777,3778,3779,3780,3781,3782,3783,3784,3785,3786,3787,3788,3789,3790,3791,3792,3793,3794,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),skip:new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,0,0,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,0,0,4,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,0,0,5,5,4,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,4,5,5,0,0,6,6,5,4,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,4,5,6,6,0,0,7,7,6,5,4,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,4,5,6,7,7,0,0,9,8,7,7,6,5,3,2,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,5,6,7,7,8,9,0,0,10,9,9,8,7,6,5,4,2,0,0,0,0,0,0,0,0,0,0,0,2,4,5,6,7,8,9,9,10,0,0,11,10,10,9,9,8,7,6,4,2,0,0,0,0,0,0,0,0,0,2,4,6,7,8,9,9,10,10,11,0,0,12,11,11,11,10,10,9,8,7,5,2,0,0,0,0,0,0,0,2,5,7,8,9,10,10,11,11,11,12,0,0,13,13,12,12,12,11,11,10,9,8,6,3,0,0,0,0,0,3,6,8,9,10,11,11,12,12,12,13,13,0,0,14,14,14,13,13,13,13,12,12,11,10,8,4,0,0,0,4,8,10,11,12,12,13,13,13,13,14,14,14,0,0,15,15,15,15,15,15,15,14,14,14,14,13,12,8,0,8,12,13,14,14,14,14,15,15,15,15,15,15,15,0,0,16,16,16,16,16,16,16,16,16,16,16,16,16,17,17,17,16,16,16,16,16,16,16,16,16,16,16,16,16,0,0,17,17,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,17,17,17,17,17,17,17,17,17,17,17,0,0,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,18,18,18,18,18,18,18,18,18,0,0,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,19,19,19,19,19,19,19,0,0,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,20,20,20,20,20,0,0,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,21,21,21,0,0,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,22,0,0,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,0,0,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,0,0,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,0,0,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,0,0,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,0,0,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,0,0,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),count:new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,0,0,1,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,1,0,0,1,2,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,2,1,0,0,1,2,3,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,3,2,1,0,0,1,1,2,3,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,5,3,2,1,1,0,0,1,1,2,3,4,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,4,3,2,1,1,0,0,2,1,2,3,4,5,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,5,4,3,2,1,2,0,0,1,2,3,2,3,4,6,7,9,9,9,9,9,9,9,9,9,9,9,9,9,7,6,4,3,2,3,2,1,0,0,1,2,2,3,4,4,5,6,8,10,10,10,10,10,10,10,10,10,10,10,8,6,5,4,4,3,2,2,1,0,0,1,2,2,3,3,4,5,5,7,9,11,11,11,11,11,11,11,11,11,9,7,5,5,4,3,3,2,2,1,0,0,1,2,2,2,3,3,4,5,6,7,10,12,12,12,12,12,12,12,10,7,6,5,4,3,3,2,2,2,1,0,0,1,1,2,2,2,3,3,4,5,6,8,10,13,13,13,13,13,10,8,6,5,4,3,3,2,2,2,1,1,0,0,1,1,1,2,2,2,2,3,3,4,5,7,11,14,14,14,11,7,5,4,3,3,2,2,2,2,1,1,1,0,0,1,1,1,1,1,1,1,3,3,3,3,5,7,15,0,15,7,5,3,3,3,3,1,1,1,1,1,1,1,0,0,1,1,1,2,2,2,2,3,3,4,5,7,11,14,14,14,11,7,5,4,3,3,2,2,2,2,1,1,1,0,0,1,1,2,2,2,3,3,4,5,6,8,10,13,13,13,13,13,10,8,6,5,4,3,3,2,2,2,1,1,0,0,1,2,2,2,3,3,4,5,6,7,10,12,12,12,12,12,12,12,10,7,6,5,4,3,3,2,2,2,1,0,0,1,2,2,3,3,4,5,5,7,9,11,11,11,11,11,11,11,11,11,9,7,5,5,4,3,3,2,2,1,0,0,1,2,2,3,4,4,5,6,8,10,10,10,10,10,10,10,10,10,10,10,8,6,5,4,4,3,2,2,1,0,0,1,2,3,2,3,4,6,7,9,9,9,9,9,9,9,9,9,9,9,9,9,7,6,4,3,2,3,2,1,0,0,2,1,2,3,4,5,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,7,5,4,3,2,1,2,0,0,1,1,2,3,4,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,6,4,3,2,1,1,0,0,1,1,2,3,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,5,3,2,1,1,0,0,1,2,3,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,4,3,2,1,0,0,1,2,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,2,1,0,0,1,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,1,0,0,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),data:new Uint32Array([1,2,4,8,16,32,64,384,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,12582912,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,1,1,2,2,4,4,8,24,16,32,32,64,64,128,128,256,768,512,1024,1024,2048,6144,4096,8192,8192,16384,16384,32768,32768,65536,65536,131072,131072,786432,262144,1048576,524288,2097152,1048576,4194304,6291456,8388608,8388608,16777216,16777216,33554432,33554432,201326592,67108864,268435456,134217728,536870912,268435456,1073741824,536870912,1073741824,1,1,2,1,2,4,2,4,8,12,8,16,16,48,32,32,64,64,64,128,128,384,256,768,512,512,1024,1024,1024,2048,2048,6144,4096,12288,8192,8192,16384,16384,16384,32768,32768,32768,65536,65536,65536,393216,131072,131072,524288,786432,262144,1048576,1048576,524288,2097152,2097152,1048576,12582912,4194304,6291456,16777216,8388608,8388608,33554432,16777216,16777216,67108864,100663296,33554432,402653184,134217728,67108864,536870912,268435456,134217728,1073741824,536870912,268435456,1073741824,536870912,1073741824,1,1,2,1,2,4,1,2,4,8,6,4,8,16,8,24,16,32,16,32,96,64,96,64,128,128,128,128,256,256,256,768,512,1536,1536,1024,1024,2048,2048,2048,6144,4096,4096,12288,8192,8192,24576,16384,16384,16384,32768,32768,32768,32768,196608,65536,65536,65536,262144,393216,131072,131072,524288,524288,786432,262144,3145728,1048576,1048576,524288,4194304,6291456,2097152,3145728,8388608,8388608,4194304,4194304,50331648,16777216,8388608,8388608,67108864,33554432,50331648,16777216,134217728,201326592,67108864,33554432,805306368,268435456,134217728,67108864,1073741824,536870912,268435456,134217728,1073741824,536870912,268435456,1073741824,536870912,1073741824,1,1,3,1,3,4,1,3,4,8,1,2,4,8,16,6,12,8,16,32,8,16,48,32,64,48,32,64,192,128,64,192,128,256,256,384,256,768,512,1536,512,1536,1024,1024,2048,3072,2048,2048,2048,4096,4096,4096,12288,12288,8192,24576,24576,16384,16384,16384,32768,32768,32768,32768,32768,196608,196608,65536,65536,65536,262144,262144,393216,393216,131072,1572864,524288,524288,524288,262144,2097152,3145728,1048576,1048576,524288,12582912,4194304,6291456,2097152,3145728,16777216,25165824,8388608,4194304,4194304,100663296,33554432,16777216,25165824,8388608,134217728,67108864,100663296,33554432,16777216,805306368,402653184,134217728,67108864,33554432,1073741824,536870912,268435456,134217728,67108864,1073741824,1610612736,268435456,134217728,1073741824,1610612736,268435456,1073741824,1610612736,1073741824,1,3,3,6,3,6,8,1,3,6,8,16,1,2,4,8,16,32,6,12,24,16,32,64,24,16,32,96,192,128,32,96,192,128,256,256,192,128,256,256,512,512,768,768,512,1536,1024,3072,1024,3072,3072,2048,2048,4096,6144,4096,4096,4096,12288,8192,24576,24576,24576,24576,16384,16384,32768,32768,32768,32768,32768,32768,196608,196608,196608,196608,65536,65536,786432,262144,262144,262144,393216,131072,1048576,1572864,1572864,524288,524288,262144,6291456,6291456,2097152,3145728,1048576,1572864,25165824,8388608,4194304,4194304,2097152,2097152,33554432,50331648,25165824,8388608,4194304,4194304,201326592,67108864,33554432,50331648,25165824,8388608,805306368,402653184,201326592,67108864,33554432,16777216,1073741824,536870912,268435456,134217728,67108864,33554432,1073741824,1610612736,805306368,134217728,67108864,1610612736,805306368,134217728,1610612736,805306368,1610612736,1073741824,1,3,1,6,1,6,12,1,6,12,16,1,3,6,12,16,32,1,2,4,8,16,32,64,6,12,24,48,96,64,128,24,48,96,64,128,384,256,96,192,128,384,256,512,512,384,256,768,512,1536,1024,3072,1536,1536,1024,3072,2048,2048,4096,6144,6144,6144,4096,4096,12288,8192,24576,24576,24576,24576,24576,16384,16384,32768,32768,32768,32768,32768,32768,32768,196608,196608,196608,196608,196608,65536,65536,786432,786432,786432,262144,262144,393216,131072,3145728,3145728,1048576,1572864,524288,524288,262144,12582912,4194304,6291456,2097152,3145728,1048576,1572864,50331648,25165824,8388608,12582912,4194304,2097152,2097152,201326592,100663296,50331648,16777216,8388608,12582912,4194304,805306368,402653184,201326592,100663296,50331648,16777216,8388608,1073741824,536870912,268435456,134217728,67108864,33554432,16777216,1073741824,1610612736,805306368,402653184,67108864,33554432,1073741824,805306368,402653184,67108864,1073741824,805306368,402653184,1073741824,805306368,1610612736,1073741824,1,1,3,1,6,1,3,12,1,3,12,24,1,3,12,24,48,1,3,6,12,24,48,64,3,3,4,8,16,32,64,128,12,12,24,48,96,192,128,256,48,48,96,192,128,256,768,512,192,192,384,256,768,512,1024,1024,768,768,1536,1536,3072,3072,2048,6144,3072,3072,6144,6144,4096,4096,12288,8192,12288,12288,24576,24576,24576,24576,16384,16384,114688,114688,32768,32768,32768,32768,32768,32768,393216,393216,196608,196608,196608,196608,65536,65536,1572864,1572864,786432,786432,262144,262144,393216,131072,6291456,6291456,3145728,3145728,1572864,1572864,524288,786432,25165824,25165824,12582912,4194304,6291456,2097152,1048576,1048576,100663296,100663296,50331648,25165824,8388608,4194304,6291456,2097152,402653184,402653184,201326592,100663296,50331648,25165824,8388608,4194304,1610612736,1610612736,268435456,134217728,67108864,33554432,16777216,8388608,1073741824,1610612736,805306368,402653184,201326592,100663296,16777216,1073741824,1610612736,402653184,201326592,100663296,1073741824,1610612736,402653184,201326592,1073741824,1610612736,402653184,1073741824,805306368,1610612736,1073741824,1073741824,1,3,2,1,7,4,3,12,3,6,24,3,6,12,48,1,3,6,12,48,96,3,7,12,24,48,96,128,3,7,14,12,16,32,64,128,256,12,24,48,48,96,192,384,256,512,112,96,192,192,384,768,512,1536,1024,384,896,768,768,1536,1024,3072,2048,6144,3584,3072,3072,3072,6144,6144,4096,4096,8192,12288,12288,12288,12288,24576,24576,24576,24576,16384,114688,114688,114688,114688,32768,32768,32768,32768,32768,393216,393216,393216,393216,196608,196608,196608,196608,65536,3670016,1572864,1572864,1572864,786432,786432,262144,262144,131072,12582912,14680064,6291456,6291456,3145728,1048576,1572864,524288,786432,117440512,50331648,25165824,25165824,12582912,6291456,2097152,3145728,1048576,402653184,201326592,100663296,100663296,50331648,25165824,12582912,4194304,2097152,1610612736,1879048192,939524096,402653184,67108864,33554432,16777216,8388608,4194304,1610612736,1879048192,402653184,201326592,100663296,50331648,8388608,1073741824,1610612736,805306368,402653184,100663296,50331648,1610612736,805306368,402653184,100663296,1610612736,805306368,201326592,1610612736,402653184,1073741824,1879048192,268435456,1610612736,536870912,1073741824,1,1,2,3,4,3,14,8,1,7,28,16,1,3,12,48,1,3,14,24,96,3,7,12,24,96,192,1,3,14,28,48,96,192,256,3,7,14,28,56,48,64,128,256,512,28,56,48,96,192,192,384,768,1536,1024,224,192,448,384,768,768,1536,1024,2048,2048,1792,1792,3584,3584,3072,3072,6144,6144,4096,12288,14336,14336,12288,12288,12288,12288,24576,24576,24576,16384,114688,114688,114688,114688,114688,114688,32768,32768,32768,32768,917504,917504,393216,393216,393216,393216,196608,196608,196608,65536,7340032,7340032,3670016,3670016,1572864,1572864,786432,786432,262144,393216,58720256,25165824,29360128,12582912,6291456,6291456,3145728,1048576,524288,524288,469762048,234881024,100663296,50331648,25165824,25165824,12582912,6291456,3145728,1048576,1610612736,1879048192,939524096,469762048,234881024,100663296,16777216,8388608,4194304,2097152,1073741824,1610612736,939524096,469762048,100663296,50331648,25165824,4194304,1610612736,1879048192,402653184,201326592,50331648,25165824,1073741824,1610612736,939524096,201326592,50331648,1073741824,1610612736,402653184,100663296,1073741824,1879048192,469762048,67108864,1610612736,939524096,134217728,1610612736,268435456,1073741824,536870912,1073741824,1,1,2,3,4,1,7,8,3,14,16,3,15,56,32,1,7,28,112,64,3,7,28,48,192,1,3,15,28,48,224,384,1,3,7,14,56,112,192,384,768,3,7,14,28,56,112,224,192,256,512,1024,60,120,112,224,448,384,768,768,1536,3072,2048,960,896,1920,1792,1536,3584,3072,3072,6144,4096,12288,15360,15360,14336,14336,14336,12288,12288,12288,24576,24576,16384,114688,114688,114688,114688,114688,114688,114688,114688,32768,32768,32768,1966080,1966080,917504,917504,917504,393216,393216,393216,196608,196608,65536,31457280,14680064,15728640,7340032,3145728,3670016,1572864,1572864,786432,262144,393216,503316480,251658240,117440512,58720256,29360128,12582912,6291456,6291456,3145728,1572864,524288,1610612736,1879048192,939524096,469762048,234881024,117440512,58720256,25165824,4194304,2097152,1048576,1073741824,1610612736,1879048192,939524096,234881024,117440512,25165824,12582912,6291456,1073741824,1610612736,2013265920,469762048,100663296,58720256,12582912,1610612736,1879048192,469762048,100663296,25165824,1073741824,1879048192,469762048,117440512,16777216,1610612736,2013265920,234881024,33554432,1610612736,939524096,67108864,1073741824,1879048192,134217728,1610612736,268435456,1073741824,536870912,1073741824,1,1,3,3,6,7,12,1,15,16,7,30,32,3,15,56,64,3,15,60,240,128,3,15,30,112,448,256,1,7,15,60,112,192,768,1,3,7,15,30,56,240,448,768,1536,7,15,31,30,60,112,224,448,896,768,1024,2048,248,240,480,480,960,896,1792,1536,3072,3072,6144,4096,7936,7936,7680,7680,15360,15360,14336,14336,12288,12288,24576,24576,253952,253952,253952,253952,114688,114688,114688,114688,114688,114688,32768,32768,8126464,8126464,3932160,3932160,1966080,1966080,917504,917504,393216,393216,196608,196608,260046848,125829120,62914560,62914560,31457280,14680064,7340032,3145728,1572864,1572864,786432,262144,1879048192,2013265920,2080374784,1006632960,503316480,117440512,58720256,29360128,14680064,6291456,1048576,524288,1073741824,1610612736,1879048192,2013265920,1006632960,234881024,125829120,29360128,6291456,3145728,1073741824,1879048192,2013265920,503316480,117440512,25165824,6291456,1610612736,2013265920,1006632960,117440512,29360128,4194304,1610612736,2013265920,503316480,125829120,8388608,1610612736,2013265920,234881024,16777216,1879048192,1006632960,33554432,1073741824,2013265920,67108864,1879048192,402653184,1610612736,805306368,1073741824,1610612736,1073741824,1,3,1,7,3,14,15,28,1,31,48,7,63,96,3,15,124,192,1,15,63,240,256,3,15,63,252,960,512,1,7,15,63,252,480,1792,1024,1,3,15,31,63,124,240,960,1792,3072,15,31,63,63,126,252,496,480,960,1792,3584,3072,4096,4080,4064,4032,4032,8064,7936,7680,7680,15360,14336,12288,12288,24576,520192,520192,520192,520192,253952,253952,253952,253952,114688,114688,114688,114688,32768,133693440,66584576,33030144,33030144,16515072,8126464,3932160,3932160,1966080,917504,393216,393216,196608,2013265920,2080374784,2113929216,2113929216,1056964608,528482304,130023424,62914560,31457280,7340032,3670016,1572864,262144,1073741824,1610612736,2013265920,2080374784,2113929216,520093696,125829120,31457280,7340032,1572864,1073741824,1879048192,2013265920,2113929216,528482304,62914560,7340032,1048576,1610612736,2013265920,2113929216,528482304,31457280,2097152,1073741824,2013265920,2113929216,125829120,4194304,1610612736,2013265920,520093696,25165824,1879048192,2113929216,50331648,1073741824,2080374784,100663296,2013265920,469762048,1610612736,939524096,1073741824,1879048192,1610612736,1073741824,1,3,7,1,15,3,31,15,63,31,127,3,63,252,15,255,496,3,63,511,960,3,31,255,1023,1792,3,15,63,255,1023,4080,3072,1,3,15,31,63,255,511,1023,4080,7936,4096,255,255,511,511,1023,1023,2047,2047,4092,4080,8128,7936,15360,12288,8388352,8388352,4193792,4193792,2096128,2096128,1046528,1046528,520192,520192,253952,253952,114688,114688,2139095040,2139095040,2143289344,2143289344,2145386496,2145386496,2146435072,2146435072,536346624,133693440,33292288,8126464,1966080,393216,1073741824,1610612736,2013265920,2080374784,2113929216,2139095040,2143289344,2145386496,133693440,8126464,262144,1610612736,2013265920,2113929216,2139095040,2145386496,133693440,1572864,1610612736,2080374784,2139095040,2145386496,7340032,1610612736,2113929216,2143289344,31457280,2013265920,2139095040,130023424,1610612736,2113929216,528482304,2080374784,2130706432,2013265920,2113929216,1610612736,2080374784,1073741824,2013265920,1879048192,1610612736,1073741824,1,3,7,15,31,63,127,3,255,3,15,511,15,63,1023,63,255,2047,255,15,1023,4095,1023,15,15,255,4095,8191,4095,255,15,3,15,63,255,1023,4095,16383,16383,16383,4095,1023,255,63,15,3,1610612736,2013265920,2113929216,2139095040,2145386496,2146959360,2147352576,2147352576,2147352576,2146959360,2145386496,2139095040,2113929216,2013265920,1610612736,2013265920,2139095040,2146959360,2147221504,2146959360,2139095040,2013265920,2013265920,2145386496,2146959360,2145386496,2013265920,2139095040,2146435072,2139095040,2113929216,2145386496,2113929216,2013265920,2143289344,2013265920,1610612736,2139095040,1610612736,2130706432,2113929216,2080374784,2013265920,1879048192,1610612736,1073741824,1,3,7,15,1,31,3,63,15,127,31,252,63,3,496,255,15,960,511,63,3,1792,1023,255,31,3,3072,4080,1023,255,63,15,3,4096,7936,4080,1023,511,255,63,31,15,3,1,12288,15360,7936,8128,4080,4092,2047,2047,1023,1023,511,511,255,255,114688,114688,253952,253952,520192,520192,1046528,1046528,2096128,2096128,4193792,4193792,8388352,8388352,393216,1966080,8126464,33292288,133693440,536346624,2146435072,2146435072,2145386496,2145386496,2143289344,2143289344,2139095040,2139095040,262144,8126464,133693440,2145386496,2143289344,2139095040,2113929216,2080374784,2013265920,1610612736,1073741824,1572864,133693440,2145386496,2139095040,2113929216,2013265920,1610612736,7340032,2145386496,2139095040,2080374784,1610612736,31457280,2143289344,2113929216,1610612736,130023424,2139095040,2013265920,528482304,2113929216,1610612736,2130706432,2080374784,2113929216,2013265920,2080374784,1610612736,2013265920,1073741824,1879048192,1610612736,1073741824,1,3,7,1,14,3,28,15,48,31,1,96,63,7,192,124,15,3,256,240,63,15,1,512,960,252,63,15,3,1024,1792,480,252,63,15,7,1,3072,1792,960,240,124,63,31,15,3,1,4096,3072,3584,1792,960,480,496,252,126,63,63,31,15,24576,12288,12288,14336,15360,7680,7680,7936,8064,4032,4032,4064,4080,32768,114688,114688,114688,114688,253952,253952,253952,253952,520192,520192,520192,520192,196608,393216,393216,917504,1966080,3932160,3932160,8126464,16515072,33030144,33030144,66584576,133693440,262144,1572864,3670016,7340032,31457280,62914560,130023424,528482304,1056964608,2113929216,2113929216,2080374784,2013265920,1572864,7340032,31457280,125829120,520093696,2113929216,2080374784,2013265920,1610612736,1073741824,1048576,7340032,62914560,528482304,2113929216,2013265920,1879048192,1073741824,2097152,31457280,528482304,2113929216,2013265920,1610612736,4194304,125829120,2113929216,2013265920,1073741824,25165824,520093696,2013265920,1610612736,50331648,2113929216,1879048192,100663296,2080374784,1073741824,469762048,2013265920,939524096,1610612736,1879048192,1073741824,1610612736,1073741824,1,3,1,6,3,12,7,16,15,1,32,30,7,64,56,15,3,128,240,60,15,3,256,448,112,30,15,3,768,192,112,60,15,7,1,1536,768,448,240,56,30,15,7,3,1,2048,1024,768,896,448,224,112,60,30,31,15,7,4096,6144,3072,3072,1536,1792,896,960,480,480,240,248,24576,24576,12288,12288,14336,14336,15360,15360,7680,7680,7936,7936,32768,32768,114688,114688,114688,114688,114688,114688,253952,253952,253952,253952,196608,196608,393216,393216,917504,917504,1966080,1966080,3932160,3932160,8126464,8126464,262144,786432,1572864,1572864,3145728,7340032,14680064,31457280,62914560,62914560,125829120,260046848,524288,1048576,6291456,14680064,29360128,58720256,117440512,503316480,1006632960,2080374784,2013265920,1879048192,3145728,6291456,29360128,125829120,234881024,1006632960,2013265920,1879048192,1610612736,1073741824,6291456,25165824,117440512,503316480,2013265920,1879048192,1073741824,4194304,29360128,117440512,1006632960,2013265920,1610612736,8388608,125829120,503316480,2013265920,1610612736,16777216,234881024,2013265920,1610612736,33554432,1006632960,1879048192,67108864,2013265920,1073741824,402653184,1879048192,805306368,1610612736,1610612736,1073741824,1073741824,1,2,1,4,3,8,7,1,16,14,3,32,56,15,3,64,112,28,7,1,192,48,28,7,3,384,224,48,28,15,3,1,768,384,192,112,56,14,7,3,1,1024,512,256,192,224,112,56,28,14,7,3,2048,3072,1536,768,768,384,448,224,112,120,60,12288,4096,6144,3072,3072,3584,1536,1792,1920,896,960,16384,24576,24576,12288,12288,12288,14336,14336,14336,15360,15360,32768,32768,32768,114688,114688,114688,114688,114688,114688,114688,114688,65536,196608,196608,393216,393216,393216,917504,917504,917504,1966080,1966080,393216,262144,786432,1572864,1572864,3670016,3145728,7340032,15728640,14680064,31457280,524288,1572864,3145728,6291456,6291456,12582912,29360128,58720256,117440512,251658240,503316480,1048576,2097152,4194304,25165824,58720256,117440512,234881024,469762048,939524096,1879048192,1610612736,6291456,12582912,25165824,117440512,234881024,939524096,1879048192,1610612736,1073741824,12582912,58720256,100663296,469762048,2013265920,1610612736,1073741824,25165824,100663296,469762048,1879048192,1610612736,16777216,117440512,469762048,1879048192,1073741824,33554432,234881024,2013265920,1610612736,67108864,939524096,1610612736,134217728,1879048192,1073741824,268435456,1610612736,536870912,1073741824,1073741824,1,2,1,4,3,8,14,3,16,28,7,1,48,12,3,1,96,24,14,3,1,192,96,24,12,7,3,256,192,96,48,28,14,3,1,512,256,128,64,48,56,28,14,7,3,1024,1536,768,384,192,192,96,48,56,28,2048,2048,1024,1536,768,768,384,448,192,224,12288,4096,6144,6144,3072,3072,3584,3584,1792,1792,16384,24576,24576,24576,12288,12288,12288,12288,14336,14336,32768,32768,32768,32768,114688,114688,114688,114688,114688,114688,65536,196608,196608,196608,393216,393216,393216,393216,917504,917504,393216,262144,786432,786432,1572864,1572864,3670016,3670016,7340032,7340032,524288,524288,1048576,3145728,6291456,6291456,12582912,29360128,25165824,58720256,1048576,3145728,6291456,12582912,25165824,25165824,50331648,100663296,234881024,469762048,2097152,4194304,8388608,16777216,100663296,234881024,469762048,939524096,1879048192,1610612736,4194304,25165824,50331648,100663296,469762048,939524096,1610612736,1073741824,25165824,50331648,201326592,402653184,1879048192,1610612736,50331648,201326592,939524096,1610612736,1073741824,100663296,402653184,1610612736,1073741824,67108864,469762048,1879048192,1073741824,134217728,939524096,1610612736,268435456,1610612736,536870912,1073741824,1073741824,1,2,3,4,7,1,12,3,24,6,3,48,12,6,3,96,48,12,6,3,1,128,96,48,24,12,7,3,256,128,64,32,16,12,14,7,3,512,256,384,192,96,48,48,24,12,1024,1536,512,768,384,192,192,96,112,6144,2048,3072,1024,1536,768,768,896,384,8192,4096,4096,6144,6144,3072,3072,3072,3584,16384,24576,24576,24576,24576,12288,12288,12288,12288,32768,32768,32768,32768,32768,114688,114688,114688,114688,65536,196608,196608,196608,196608,393216,393216,393216,393216,131072,262144,262144,786432,786432,1572864,1572864,1572864,3670016,786432,524288,1572864,1048576,3145728,6291456,6291456,14680064,12582912,1048576,3145728,2097152,6291456,12582912,25165824,25165824,50331648,117440512,2097152,4194304,12582912,25165824,50331648,100663296,100663296,201326592,402653184,4194304,8388608,16777216,33554432,67108864,402653184,939524096,1879048192,1610612736,8388608,50331648,100663296,201326592,402653184,1879048192,1610612736,50331648,100663296,402653184,805306368,1610612736,1073741824,100663296,402653184,805306368,1610612736,201326592,805306368,1610612736,402653184,1610612736,268435456,1879048192,1073741824,536870912,1610612736,1073741824,1,1,3,6,1,12,3,1,24,12,3,1,48,24,12,3,1,64,48,24,12,6,3,1,128,64,32,16,8,4,3,3,256,128,192,96,48,24,12,12,512,768,256,128,192,96,48,48,1024,1024,512,768,256,384,192,192,6144,2048,3072,3072,1536,1536,768,768,8192,12288,4096,4096,6144,6144,3072,3072,16384,16384,24576,24576,24576,24576,12288,12288,32768,32768,32768,32768,32768,32768,114688,114688,65536,65536,196608,196608,196608,196608,393216,393216,131072,393216,262144,262144,786432,786432,1572864,1572864,786432,524288,1572864,1572864,3145728,3145728,6291456,6291456,1048576,1048576,2097152,6291456,4194304,12582912,25165824,25165824,2097152,6291456,4194304,8388608,25165824,50331648,100663296,100663296,4194304,8388608,25165824,50331648,100663296,201326592,402653184,402653184,8388608,16777216,33554432,67108864,134217728,268435456,1610612736,1610612736,16777216,100663296,201326592,402653184,805306368,1610612736,1073741824,100663296,201326592,402653184,1610612736,1073741824,201326592,402653184,1610612736,1073741824,402653184,1610612736,1073741824,805306368,1073741824,1610612736,1073741824,1073741824,1,3,6,1,12,6,1,16,12,6,1,32,16,12,6,3,1,64,32,16,8,4,2,1,128,64,96,48,24,12,6,256,384,128,64,96,48,24,512,512,256,384,128,192,96,3072,1024,1536,512,768,256,384,4096,2048,2048,3072,1024,1536,1536,8192,12288,4096,4096,6144,6144,6144,16384,16384,24576,24576,24576,24576,24576,32768,32768,32768,32768,32768,32768,32768,65536,65536,196608,196608,196608,196608,196608,131072,393216,262144,262144,786432,786432,786432,262144,524288,524288,1572864,1048576,3145728,3145728,1572864,1048576,3145728,2097152,6291456,4194304,12582912,2097152,2097152,4194304,12582912,8388608,25165824,50331648,4194304,12582912,8388608,16777216,50331648,100663296,201326592,8388608,16777216,50331648,100663296,201326592,402653184,805306368,16777216,33554432,67108864,134217728,268435456,536870912,1073741824,33554432,67108864,402653184,805306368,1610612736,1073741824,67108864,402653184,805306368,1073741824,402653184,805306368,1073741824,805306368,1073741824,1610612736,1073741824,1,3,6,3,8,6,3,16,8,6,3,1,32,16,8,4,2,1,64,32,16,24,12,6,128,192,96,32,16,24,256,256,128,192,96,32,512,512,256,256,128,192,3072,1024,1536,512,768,768,4096,2048,2048,3072,3072,1024,8192,12288,4096,4096,4096,6144,16384,16384,24576,24576,24576,24576,32768,32768,32768,32768,32768,32768,65536,65536,196608,196608,196608,196608,131072,393216,262144,262144,262144,786432,262144,524288,524288,1572864,1572864,1048576,1572864,1048576,3145728,2097152,6291456,6291456,2097152,2097152,4194304,4194304,8388608,25165824,4194304,4194304,8388608,25165824,50331648,33554432,8388608,25165824,50331648,33554432,67108864,201326592,16777216,33554432,67108864,201326592,402653184,805306368,33554432,67108864,134217728,268435456,536870912,1073741824,67108864,134217728,805306368,1610612736,1073741824,134217728,805306368,1610612736,805306368,1610612736,1610612736,1073741824,1,3,1,4,3,1,8,4,3,1,16,8,4,2,1,32,16,8,12,6,64,32,48,16,8,128,192,64,32,48,256,256,128,192,64,1536,512,768,256,384,2048,1024,1024,1536,512,4096,2048,2048,2048,3072,8192,12288,12288,4096,4096,16384,16384,16384,24576,24576,32768,32768,32768,32768,32768,65536,65536,65536,196608,196608,131072,393216,393216,262144,262144,262144,524288,524288,524288,1572864,524288,1048576,1048576,3145728,2097152,3145728,2097152,6291456,4194304,12582912,4194304,4194304,8388608,25165824,16777216,8388608,25165824,16777216,33554432,100663296,16777216,33554432,100663296,67108864,134217728,33554432,67108864,134217728,402653184,805306368,67108864,134217728,268435456,536870912,1073741824,134217728,268435456,1610612736,1073741824,268435456,1610612736,1073741824,1610612736,1073741824,1073741824,1,2,1,4,2,1,8,4,2,1,16,8,4,6,32,16,24,8,64,96,32,16,128,128,64,96,256,256,128,128,1536,512,768,256,2048,1024,1024,1536,4096,6144,2048,2048,8192,8192,12288,4096,16384,16384,16384,24576,32768,32768,32768,32768,65536,65536,65536,196608,131072,131072,393216,262144,262144,786432,524288,524288,524288,1048576,1048576,3145728,3145728,2097152,6291456,4194304,4194304,4194304,8388608,8388608,8388608,8388608,16777216,50331648,16777216,50331648,33554432,67108864,33554432,67108864,201326592,134217728,67108864,134217728,268435456,805306368,134217728,268435456,536870912,1073741824,268435456,536870912,1073741824,536870912,1073741824,1073741824,1,2,1,4,2,1,8,4,2,16,8,12,32,48,16,64,64,32,128,128,64,768,256,384,1024,512,512,2048,1024,1024,4096,6144,2048,8192,8192,12288,16384,16384,16384,32768,32768,32768,65536,65536,65536,131072,131072,393216,262144,786432,524288,524288,1048576,1048576,1048576,2097152,2097152,6291456,4194304,12582912,8388608,8388608,16777216,16777216,16777216,33554432,33554432,100663296,67108864,67108864,134217728,402653184,134217728,268435456,536870912,268435456,536870912,1073741824,536870912,1073741824,1073741824,1,2,1,4,2,8,4,16,24,32,32,64,64,128,128,768,256,1024,512,2048,1024,4096,6144,8192,8192,16384,16384,32768,32768,65536,65536,131072,131072,262144,786432,524288,1048576,1048576,2097152,6291456,4194304,8388608,8388608,16777216,16777216,33554432,33554432,67108864,201326592,134217728,268435456,268435456,536870912,536870912,1073741824,1073741824,1,2,4,8,16,32,64,384,512,1024,2048,4096,8192,16384,32768,65536,131072,262144,524288,1048576,2097152,12582912,16777216,33554432,67108864,134217728,268435456,536870912,1073741824])};t.exports=e},962:(t,e,i)=>{"use strict";i.r(e),i.d(e,{Props:()=>o,WorldEntity:()=>n});var s=i(420);class o extends s.wA{constructor(t,e){return super(),this.id=void 0,this.tileX=void 0,this.tileY=void 0,new Proxy(this,{get:(i,s)=>void 0!==i[s]?i[s]:t[e][s]})}}class n extends s.wA{constructor(t,e){super(),this.world=t,this.entityManager=t.getComponent("EntityManager"),this.props=e}setTileXy(t,e){}moveTo(t,e){}swapLocation(t){}}},990:()=>{},729:t=>{"use strict";var e=Object.prototype.hasOwnProperty,i="~";function s(){}function o(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function n(t,e,s,n,r){if("function"!=typeof s)throw new TypeError("The listener must be a function");var a=new o(s,n||t,r),l=i?i+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],a]:t._events[l].push(a):(t._events[l]=a,t._eventsCount++),t}function r(t,e){0==--t._eventsCount?t._events=new s:delete t._events[e]}function a(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(i=!1)),a.prototype.eventNames=function(){var t,s,o=[];if(0===this._eventsCount)return o;for(s in t=this._events)e.call(t,s)&&o.push(i?s.slice(1):s);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(t)):o},a.prototype.listeners=function(t){var e=i?i+t:t,s=this._events[e];if(!s)return[];if(s.fn)return[s.fn];for(var o=0,n=s.length,r=new Array(n);o<n;o++)r[o]=s[o].fn;return r},a.prototype.listenerCount=function(t){var e=i?i+t:t,s=this._events[e];return s?s.fn?1:s.length:0},a.prototype.emit=function(t,e,s,o,n,r){var a=i?i+t:t;if(!this._events[a])return!1;var l,h,d=this._events[a],c=arguments.length;if(d.fn){switch(d.once&&this.removeListener(t,d.fn,void 0,!0),c){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,e),!0;case 3:return d.fn.call(d.context,e,s),!0;case 4:return d.fn.call(d.context,e,s,o),!0;case 5:return d.fn.call(d.context,e,s,o,n),!0;case 6:return d.fn.call(d.context,e,s,o,n,r),!0}for(h=1,l=new Array(c-1);h<c;h++)l[h-1]=arguments[h];d.fn.apply(d.context,l)}else{var u,p=d.length;for(h=0;h<p;h++)switch(d[h].once&&this.removeListener(t,d[h].fn,void 0,!0),c){case 1:d[h].fn.call(d[h].context);break;case 2:d[h].fn.call(d[h].context,e);break;case 3:d[h].fn.call(d[h].context,e,s);break;case 4:d[h].fn.call(d[h].context,e,s,o);break;default:if(!l)for(u=1,l=new Array(c-1);u<c;u++)l[u-1]=arguments[u];d[h].fn.apply(d[h].context,l)}}return!0},a.prototype.on=function(t,e,i){return n(this,t,e,i,!1)},a.prototype.once=function(t,e,i){return n(this,t,e,i,!0)},a.prototype.removeListener=function(t,e,s,o){var n=i?i+t:t;if(!this._events[n])return this;if(!e)return r(this,n),this;var a=this._events[n];if(a.fn)a.fn!==e||o&&!a.once||s&&a.context!==s||r(this,n);else{for(var l=0,h=[],d=a.length;l<d;l++)(a[l].fn!==e||o&&!a[l].once||s&&a[l].context!==s)&&h.push(a[l]);h.length?this._events[n]=1===h.length?h[0]:h:r(this,n)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&r(this,e)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,t.exports=a},141:(t,e,i)=>{"use strict";i.d(e,{m4:()=>w});let s=Float32Array;function o(t,e,i){const o=new s(3);return t&&(o[0]=t),e&&(o[1]=e),i&&(o[2]=i),o}function n(t,e,i){return(i=i||new s(3))[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i}function r(t,e,i){i=i||new s(3);const o=t[2]*e[0]-t[0]*e[2],n=t[0]*e[1]-t[1]*e[0];return i[0]=t[1]*e[2]-t[2]*e[1],i[1]=o,i[2]=n,i}function a(t,e){e=e||new s(3);const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],o=Math.sqrt(i);return o>1e-5?(e[0]=t[0]/o,e[1]=t[1]/o,e[2]=t[2]/o):(e[0]=0,e[1]=0,e[2]=0),e}let l,h,d,c=Float32Array;function u(t,e){return(e=e||new c(16))[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function p(t){return(t=t||new c(16))[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function g(t,e){e=e||new c(16);const i=t[0],s=t[1],o=t[2],n=t[3],r=t[4],a=t[5],l=t[6],h=t[7],d=t[8],u=t[9],p=t[10],g=t[11],m=t[12],f=t[13],w=t[14],y=t[15],E=p*y,C=w*g,_=l*y,A=w*h,x=l*g,v=p*h,B=o*y,T=w*n,b=o*g,M=p*n,P=o*h,F=l*n,S=d*f,D=m*u,G=r*f,L=m*a,I=r*u,R=d*a,k=i*f,O=m*s,X=i*u,W=d*s,Y=i*a,N=r*s,U=E*a+A*u+x*f-(C*a+_*u+v*f),V=C*s+B*u+M*f-(E*s+T*u+b*f),j=_*s+T*a+P*f-(A*s+B*a+F*f),$=v*s+b*a+F*u-(x*s+M*a+P*u),H=1/(i*U+r*V+d*j+m*$);return e[0]=H*U,e[1]=H*V,e[2]=H*j,e[3]=H*$,e[4]=H*(C*r+_*d+v*m-(E*r+A*d+x*m)),e[5]=H*(E*i+T*d+b*m-(C*i+B*d+M*m)),e[6]=H*(A*i+B*r+F*m-(_*i+T*r+P*m)),e[7]=H*(x*i+M*r+P*d-(v*i+b*r+F*d)),e[8]=H*(S*h+L*g+I*y-(D*h+G*g+R*y)),e[9]=H*(D*n+k*g+W*y-(S*n+O*g+X*y)),e[10]=H*(G*n+O*h+Y*y-(L*n+k*h+N*y)),e[11]=H*(R*n+X*h+N*g-(I*n+W*h+Y*g)),e[12]=H*(G*p+R*w+D*l-(I*w+S*l+L*p)),e[13]=H*(X*w+S*o+O*p-(k*p+W*w+D*o)),e[14]=H*(k*l+N*w+L*o-(Y*w+G*o+O*l)),e[15]=H*(Y*p+I*o+W*l-(X*l+N*p+R*o)),e}function m(t,e,i){i=i||o();const s=e[0],n=e[1],r=e[2],a=s*t[3]+n*t[7]+r*t[11]+t[15];return i[0]=(s*t[0]+n*t[4]+r*t[8]+t[12])/a,i[1]=(s*t[1]+n*t[5]+r*t[9]+t[13])/a,i[2]=(s*t[2]+n*t[6]+r*t[10]+t[14])/a,i}function f(t,e,i){i=i||o();const s=e[0],n=e[1],r=e[2];return i[0]=s*t[0]+n*t[4]+r*t[8],i[1]=s*t[1]+n*t[5]+r*t[9],i[2]=s*t[2]+n*t[6]+r*t[10],i}var w=Object.freeze({__proto__:null,axisRotate:function(t,e,i,s){s=s||new c(16);let o=e[0],n=e[1],r=e[2];const a=Math.sqrt(o*o+n*n+r*r);o/=a,n/=a,r/=a;const l=o*o,h=n*n,d=r*r,u=Math.cos(i),p=Math.sin(i),g=1-u,m=l+(1-l)*u,f=o*n*g+r*p,w=o*r*g-n*p,y=o*n*g-r*p,E=h+(1-h)*u,C=n*r*g+o*p,_=o*r*g+n*p,A=n*r*g-o*p,x=d+(1-d)*u,v=t[0],B=t[1],T=t[2],b=t[3],M=t[4],P=t[5],F=t[6],S=t[7],D=t[8],G=t[9],L=t[10],I=t[11];return s[0]=m*v+f*M+w*D,s[1]=m*B+f*P+w*G,s[2]=m*T+f*F+w*L,s[3]=m*b+f*S+w*I,s[4]=y*v+E*M+C*D,s[5]=y*B+E*P+C*G,s[6]=y*T+E*F+C*L,s[7]=y*b+E*S+C*I,s[8]=_*v+A*M+x*D,s[9]=_*B+A*P+x*G,s[10]=_*T+A*F+x*L,s[11]=_*b+A*S+x*I,t!==s&&(s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s},axisRotation:function(t,e,i){i=i||new c(16);let s=t[0],o=t[1],n=t[2];const r=Math.sqrt(s*s+o*o+n*n);s/=r,o/=r,n/=r;const a=s*s,l=o*o,h=n*n,d=Math.cos(e),u=Math.sin(e),p=1-d;return i[0]=a+(1-a)*d,i[1]=s*o*p+n*u,i[2]=s*n*p-o*u,i[3]=0,i[4]=s*o*p-n*u,i[5]=l+(1-l)*d,i[6]=o*n*p+s*u,i[7]=0,i[8]=s*n*p+o*u,i[9]=o*n*p-s*u,i[10]=h+(1-h)*d,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},copy:u,frustum:function(t,e,i,s,o,n,r){const a=e-t,l=s-i,h=o-n;return(r=r||new c(16))[0]=2*o/a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2*o/l,r[6]=0,r[7]=0,r[8]=(t+e)/a,r[9]=(s+i)/l,r[10]=n/h,r[11]=-1,r[12]=0,r[13]=0,r[14]=o*n/h,r[15]=0,r},getAxis:function(t,e,i){const s=4*e;return(i=i||o())[0]=t[s+0],i[1]=t[s+1],i[2]=t[s+2],i},getTranslation:function(t,e){return(e=e||o())[0]=t[12],e[1]=t[13],e[2]=t[14],e},identity:p,inverse:g,lookAt:function(t,e,i,n){return n=n||new c(16),l=l||o(),h=h||o(),d=d||o(),a(function(t,e,i){return(i=i||new s(3))[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i}(t,e,d),d),a(r(i,d,l),l),a(r(d,l,h),h),n[0]=l[0],n[1]=l[1],n[2]=l[2],n[3]=0,n[4]=h[0],n[5]=h[1],n[6]=h[2],n[7]=0,n[8]=d[0],n[9]=d[1],n[10]=d[2],n[11]=0,n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n},multiply:function(t,e,i){i=i||new c(16);const s=t[0],o=t[1],n=t[2],r=t[3],a=t[4],l=t[5],h=t[6],d=t[7],u=t[8],p=t[9],g=t[10],m=t[11],f=t[12],w=t[13],y=t[14],E=t[15],C=e[0],_=e[1],A=e[2],x=e[3],v=e[4],B=e[5],T=e[6],b=e[7],M=e[8],P=e[9],F=e[10],S=e[11],D=e[12],G=e[13],L=e[14],I=e[15];return i[0]=s*C+a*_+u*A+f*x,i[1]=o*C+l*_+p*A+w*x,i[2]=n*C+h*_+g*A+y*x,i[3]=r*C+d*_+m*A+E*x,i[4]=s*v+a*B+u*T+f*b,i[5]=o*v+l*B+p*T+w*b,i[6]=n*v+h*B+g*T+y*b,i[7]=r*v+d*B+m*T+E*b,i[8]=s*M+a*P+u*F+f*S,i[9]=o*M+l*P+p*F+w*S,i[10]=n*M+h*P+g*F+y*S,i[11]=r*M+d*P+m*F+E*S,i[12]=s*D+a*G+u*L+f*I,i[13]=o*D+l*G+p*L+w*I,i[14]=n*D+h*G+g*L+y*I,i[15]=r*D+d*G+m*L+E*I,i},negate:function(t,e){return(e=e||new c(16))[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=-t[7],e[8]=-t[8],e[9]=-t[9],e[10]=-t[10],e[11]=-t[11],e[12]=-t[12],e[13]=-t[13],e[14]=-t[14],e[15]=-t[15],e},ortho:function(t,e,i,s,o,n,r){return(r=r||new c(16))[0]=2/(e-t),r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2/(s-i),r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2/(o-n),r[11]=0,r[12]=(e+t)/(t-e),r[13]=(s+i)/(i-s),r[14]=(n+o)/(o-n),r[15]=1,r},perspective:function(t,e,i,s,o){o=o||new c(16);const n=Math.tan(.5*Math.PI-.5*t),r=1/(i-s);return o[0]=n/e,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=n,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=(i+s)*r,o[11]=-1,o[12]=0,o[13]=0,o[14]=i*s*r*2,o[15]=0,o},rotateX:function(t,e,i){i=i||new c(16);const s=t[4],o=t[5],n=t[6],r=t[7],a=t[8],l=t[9],h=t[10],d=t[11],u=Math.cos(e),p=Math.sin(e);return i[4]=u*s+p*a,i[5]=u*o+p*l,i[6]=u*n+p*h,i[7]=u*r+p*d,i[8]=u*a-p*s,i[9]=u*l-p*o,i[10]=u*h-p*n,i[11]=u*d-p*r,t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i},rotateY:function(t,e,i){i=i||new c(16);const s=t[0],o=t[1],n=t[2],r=t[3],a=t[8],l=t[9],h=t[10],d=t[11],u=Math.cos(e),p=Math.sin(e);return i[0]=u*s-p*a,i[1]=u*o-p*l,i[2]=u*n-p*h,i[3]=u*r-p*d,i[8]=u*a+p*s,i[9]=u*l+p*o,i[10]=u*h+p*n,i[11]=u*d+p*r,t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i},rotateZ:function(t,e,i){i=i||new c(16);const s=t[0],o=t[1],n=t[2],r=t[3],a=t[4],l=t[5],h=t[6],d=t[7],u=Math.cos(e),p=Math.sin(e);return i[0]=u*s+p*a,i[1]=u*o+p*l,i[2]=u*n+p*h,i[3]=u*r+p*d,i[4]=u*a-p*s,i[5]=u*l-p*o,i[6]=u*h-p*n,i[7]=u*d-p*r,t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i},rotationX:function(t,e){e=e||new c(16);const i=Math.cos(t),s=Math.sin(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=s,e[7]=0,e[8]=0,e[9]=-s,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},rotationY:function(t,e){e=e||new c(16);const i=Math.cos(t),s=Math.sin(t);return e[0]=i,e[1]=0,e[2]=-s,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=s,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},rotationZ:function(t,e){e=e||new c(16);const i=Math.cos(t),s=Math.sin(t);return e[0]=i,e[1]=s,e[2]=0,e[3]=0,e[4]=-s,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},scale:function(t,e,i){i=i||new c(16);const s=e[0],o=e[1],n=e[2];return i[0]=s*t[0],i[1]=s*t[1],i[2]=s*t[2],i[3]=s*t[3],i[4]=o*t[4],i[5]=o*t[5],i[6]=o*t[6],i[7]=o*t[7],i[8]=n*t[8],i[9]=n*t[9],i[10]=n*t[10],i[11]=n*t[11],t!==i&&(i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i},scaling:function(t,e){return(e=e||new c(16))[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},setAxis:function(t,e,i,s){s!==t&&(s=u(t,s));const o=4*i;return s[o+0]=e[0],s[o+1]=e[1],s[o+2]=e[2],s},setDefaultType:function(t){const e=c;return c=t,e},setTranslation:function(t,e,i){return t!==(i=i||p())&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11]),i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i},transformDirection:f,transformNormal:function(t,e,i){i=i||o();const s=g(t),n=e[0],r=e[1],a=e[2];return i[0]=n*s[0]+r*s[1]+a*s[2],i[1]=n*s[4]+r*s[5]+a*s[6],i[2]=n*s[8]+r*s[9]+a*s[10],i},transformPoint:m,translate:function(t,e,i){i=i||new c(16);const s=e[0],o=e[1],n=e[2],r=t[0],a=t[1],l=t[2],h=t[3],d=t[4],u=t[5],p=t[6],g=t[7],m=t[8],f=t[9],w=t[10],y=t[11],E=t[12],C=t[13],_=t[14],A=t[15];return t!==i&&(i[0]=r,i[1]=a,i[2]=l,i[3]=h,i[4]=d,i[5]=u,i[6]=p,i[7]=g,i[8]=m,i[9]=f,i[10]=w,i[11]=y),i[12]=r*s+d*o+m*n+E,i[13]=a*s+u*o+f*n+C,i[14]=l*s+p*o+w*n+_,i[15]=h*s+g*o+y*n+A,i},translation:function(t,e){return(e=e||new c(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},transpose:function(t,e){if((e=e||new c(16))===t){let i;return i=t[1],t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,e}const i=t[0],s=t[1],o=t[2],n=t[3],r=t[4],a=t[5],l=t[6],h=t[7],d=t[8],u=t[9],p=t[10],g=t[11],m=t[12],f=t[13],w=t[14],y=t[15];return e[0]=i,e[1]=r,e[2]=d,e[3]=m,e[4]=s,e[5]=a,e[6]=u,e[7]=f,e[8]=o,e[9]=l,e[10]=p,e[11]=w,e[12]=n,e[13]=h,e[14]=g,e[15]=y,e}});const y=5120,E=5121,C=5124;{const t={};t[y]=Int8Array,t[5121]=Uint8Array,t[5122]=Int16Array,t[5123]=Uint16Array,t[C]=Int32Array,t[5125]=Uint32Array,t[5126]=Float32Array,t[32819]=Uint16Array,t[32820]=Uint16Array,t[33635]=Uint16Array,t[5131]=Uint16Array,t[33640]=Uint32Array,t[35899]=Uint32Array,t[35902]=Uint32Array,t[36269]=Uint32Array,t[34042]=Uint32Array}function _(t){if(t instanceof Int8Array)return y;if(t instanceof Uint8Array)return E;if(t instanceof Uint8ClampedArray)return E;if(t instanceof Int16Array)return 5122;if(t instanceof Uint16Array)return 5123;if(t instanceof Int32Array)return C;if(t instanceof Uint32Array)return 5125;if(t instanceof Float32Array)return 5126;throw new Error("unsupported typed array type")}const A="undefined"!=typeof SharedArrayBuffer?function(t){return t&&t.buffer&&(t.buffer instanceof ArrayBuffer||t.buffer instanceof SharedArrayBuffer)}:function(t){return t&&t.buffer&&t.buffer instanceof ArrayBuffer};function x(t,e){return"undefined"!=typeof WebGLTexture&&e instanceof WebGLTexture}const v=34962,B="";function T(t,e,i,s){if("undefined"!=typeof WebGLBuffer&&e instanceof WebGLBuffer)return e;i=i||v;const o=t.createBuffer();return function(t,e,i,s,o){t.bindBuffer(e,i),t.bufferData(e,s,o||35044)}(t,i,o,e,s),o}function b(t){return"indices"===t}function M(t){return t.length?t:t.data}const P=/coord|texture/i,F=/color|colour/i;function S(t,e){let i;if(i=P.test(t)?2:F.test(t)?4:3,e%i>0)throw new Error(`Can not guess numComponents for attribute '${t}'. Tried ${i} but ${e} values is not evenly divisible by ${i}. You should specify it.`);return i}function D(t,e){return t.numComponents||t.size||S(e,M(t).length)}function G(t,e){if(A(t))return t;if(A(t.data))return t.data;Array.isArray(t)&&(t={data:t});let i=t.type;return i||(i=b(e)?Uint16Array:Float32Array),new i(t.data)}function L(t,e){const i={};return Object.keys(e).forEach((function(s){if(!b(s)){const n=e[s],r=n.attrib||n.name||n.attribName||B+s;if(n.value){if(!Array.isArray(n.value)&&!A(n.value))throw new Error("array.value is not array or typedarray");i[r]={value:n.value}}else{let e,a,l,h;if(n.buffer&&n.buffer instanceof WebGLBuffer)e=n.buffer,h=n.numComponents||n.size,a=n.type,l=n.normalize;else if("number"==typeof n||"number"==typeof n.data){const i=n.data||n,r=n.type||Float32Array,d=i*r.BYTES_PER_ELEMENT;a=function(t){if(t===Int8Array)return y;if(t===Uint8Array)return E;if(t===Uint8ClampedArray)return E;if(t===Int16Array)return 5122;if(t===Uint16Array)return 5123;if(t===Int32Array)return C;if(t===Uint32Array)return 5125;if(t===Float32Array)return 5126;throw new Error("unsupported typed array type")}(r),l=void 0!==n.normalize?n.normalize:(o=r)===Int8Array||o===Uint8Array,h=n.numComponents||n.size||S(s,i),e=t.createBuffer(),t.bindBuffer(v,e),t.bufferData(v,d,n.drawType||35044)}else{const i=G(n,s);e=T(t,i,void 0,n.drawType),a=_(i),l=void 0!==n.normalize?n.normalize:function(t){return t instanceof Int8Array||t instanceof Uint8Array}(i),h=D(n,s)}i[r]={buffer:e,numComponents:h,type:a,normalize:l,stride:n.stride||0,offset:n.offset||0,divisor:void 0===n.divisor?void 0:n.divisor,drawType:n.drawType}}}var o})),t.bindBuffer(v,null),i}const I=["position","positions","a_position"];function R(t,e,i){const s=L(t,e),o=Object.assign({},i||{});o.attribs=Object.assign({},i?i.attribs:{},s);const n=e.indices;if(n){const e=G(n,"indices");o.indices=T(t,e,34963),o.numElements=e.length,o.elementType=_(e)}else o.numElements||(o.numElements=function(t,e){let i,s;for(s=0;s<I.length&&(i=I[s],!(i in e))&&(i=B+i,!(i in e));++s);s===I.length&&(i=Object.keys(e)[0]);const o=e[i];t.bindBuffer(v,o.buffer);const n=t.getBufferParameter(v,34660);var r;t.bindBuffer(v,null);const a=n/(5120===(r=o.type)||5121===r?1:5122===r||5123===r?2:5124===r||5125===r||5126===r?4:0),l=o.numComponents||o.size,h=a/l;if(h%1!=0)throw new Error(`numComponents ${l} not correct for length ${length}`);return h}(t,o.attribs));return o}function k(t,e){const i={};return Object.keys(e).forEach((function(s){i[s]=function(t,e,i){const s="indices"===i?34963:v;return T(t,G(e,i),s)}(t,e[s],s)})),e.indices?(i.numElements=e.indices.length,i.elementType=_(G(e.indices))):i.numElements=function(t){let e,i;for(i=0;i<I.length&&(e=I[i],!(e in t));++i);i===I.length&&(e=Object.keys(t)[0]);const s=t[e],o=M(s).length,n=D(s,e),r=o/n;if(o%n>0)throw new Error(`numComponents ${n} not correct for length ${o}`);return r}(e),i}function O(t,e,i){return function(t,e){let i=0;return t.push=function(){for(let e=0;e<arguments.length;++e){const s=arguments[e];if(s instanceof Array||A(s))for(let e=0;e<s.length;++e)t[i++]=s[e];else t[i++]=s}},t.reset=function(t){i=t||0},t.numComponents=e,Object.defineProperty(t,"numElements",{get:function(){return this.length/this.numComponents|0}}),t}(new(i||Float32Array)(t*e),t)}function X(t,e,i){const s=t.length,o=new Float32Array(3);for(let n=0;n<s;n+=3)i(e,[t[n],t[n+1],t[n+2]],o),t[n]=o[0],t[n+1]=o[1],t[n+2]=o[2]}function W(t,e,i){i=i||o();const s=e[0],n=e[1],r=e[2];return i[0]=s*t[0]+n*t[1]+r*t[2],i[1]=s*t[4]+n*t[5]+r*t[6],i[2]=s*t[8]+n*t[9]+r*t[10],i}function Y(t,e){return Object.keys(t).forEach((function(i){const s=t[i];i.indexOf("pos")>=0?function(t,e){X(t,e,m)}(s,e):i.indexOf("tan")>=0||i.indexOf("binorm")>=0?function(t,e){X(t,e,f)}(s,e):i.indexOf("norm")>=0&&function(t,e){X(t,g(e),W)}(s,e)})),t}function N(t,e,i){return t=t||2,{position:{numComponents:2,data:[(e=e||0)+-1*(t*=.5),(i=i||0)+-1*t,e+1*t,i+-1*t,e+-1*t,i+1*t,e+1*t,i+1*t]},normal:[0,0,1,0,0,1,0,0,1,0,0,1],texcoord:[0,0,1,0,0,1,1,1],indices:[0,1,2,2,1,3]}}function U(t,e,i,s,o){t=t||1,e=e||1,i=i||1,s=s||1,o=o||p();const n=(i+1)*(s+1),r=O(3,n),a=O(3,n),l=O(2,n);for(let o=0;o<=s;o++)for(let n=0;n<=i;n++){const h=n/i,d=o/s;r.push(t*h-.5*t,0,e*d-.5*e),a.push(0,1,0),l.push(h,d)}const h=i+1,d=O(3,i*s*2,Uint16Array);for(let t=0;t<s;t++)for(let e=0;e<i;e++)d.push((t+0)*h+e,(t+1)*h+e,(t+0)*h+e+1),d.push((t+1)*h+e,(t+1)*h+e+1,(t+0)*h+e+1);return Y({position:r,normal:a,texcoord:l,indices:d},o)}function V(t,e,i,s,o,n,r){if(e<=0||i<=0)throw new Error("subdivisionAxis and subdivisionHeight must be > 0");s=s||0,n=n||0;const a=(o=o||Math.PI)-s,l=(r=r||2*Math.PI)-n,h=(e+1)*(i+1),d=O(3,h),c=O(3,h),u=O(2,h);for(let o=0;o<=i;o++)for(let r=0;r<=e;r++){const h=r/e,p=o/i,g=l*h+n,m=a*p+s,f=Math.sin(g),w=Math.cos(g),y=Math.sin(m),E=w*y,C=Math.cos(m),_=f*y;d.push(t*E,t*C,t*_),c.push(E,C,_),u.push(1-h,p)}const p=e+1,g=O(3,e*i*2,Uint16Array);for(let t=0;t<e;t++)for(let e=0;e<i;e++)g.push((e+0)*p+t,(e+0)*p+t+1,(e+1)*p+t),g.push((e+1)*p+t,(e+0)*p+t+1,(e+1)*p+t+1);return{position:d,normal:c,texcoord:u,indices:g}}const j=[[3,7,5,1],[6,2,0,4],[6,7,3,2],[0,1,5,4],[7,6,4,5],[2,3,1,0]];function $(t){const e=(t=t||1)/2,i=[[-e,-e,-e],[+e,-e,-e],[-e,+e,-e],[+e,+e,-e],[-e,-e,+e],[+e,-e,+e],[-e,+e,+e],[+e,+e,+e]],s=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],o=[[1,0],[0,0],[0,1],[1,1]],n=O(3,24),r=O(3,24),a=O(2,24),l=O(3,12,Uint16Array);for(let t=0;t<6;++t){const e=j[t];for(let l=0;l<4;++l){const h=i[e[l]],d=s[t],c=o[l];n.push(h),r.push(d),a.push(c)}const h=4*t;l.push(h+0,h+1,h+2),l.push(h+0,h+2,h+3)}return{position:n,normal:r,texcoord:a,indices:l}}function H(t,e,i,s,o,n,r){if(s<3)throw new Error("radialSubdivisions must be 3 or greater");if(o<1)throw new Error("verticalSubdivisions must be 1 or greater");const a=void 0===n||n,l=void 0===r||r,h=(a?2:0)+(l?2:0),d=(s+1)*(o+1+h),c=O(3,d),u=O(3,d),p=O(2,d),g=O(3,s*(o+h/2)*2,Uint16Array),m=s+1,f=Math.atan2(t-e,i),w=Math.cos(f),y=Math.sin(f),E=o+(l?2:0);for(let n=a?-2:0;n<=E;++n){let r,a=n/o,l=i*a;n<0?(l=0,a=1,r=t):n>o?(l=i,a=1,r=e):r=t+n/o*(e-t),-2!==n&&n!==o+2||(r=0,a=0),l-=i/2;for(let t=0;t<m;++t){const e=Math.sin(t*Math.PI*2/s),i=Math.cos(t*Math.PI*2/s);c.push(e*r,l,i*r),n<0?u.push(0,-1,0):n>o?u.push(0,1,0):0===r?u.push(0,0,0):u.push(e*w,y,i*w),p.push(t/s,1-a)}}for(let t=0;t<o+h;++t)if(!(1===t&&a||t===o+h-2&&l))for(let e=0;e<s;++e)g.push(m*(t+0)+0+e,m*(t+0)+1+e,m*(t+1)+1+e),g.push(m*(t+0)+0+e,m*(t+1)+1+e,m*(t+1)+0+e);return{position:c,normal:u,texcoord:p,indices:g}}function z(t,e){e=e||[];const i=[];for(let s=0;s<t.length;s+=4){const o=t[s],n=t.slice(s+1,s+4);n.push.apply(n,e);for(let t=0;t<o;++t)i.push.apply(i,n)}return i}function K(){const t=[0,0,0,0,150,0,30,0,0,0,150,0,30,150,0,30,0,0,30,0,0,30,30,0,100,0,0,30,30,0,100,30,0,100,0,0,30,60,0,30,90,0,67,60,0,30,90,0,67,90,0,67,60,0,0,0,30,30,0,30,0,150,30,0,150,30,30,0,30,30,150,30,30,0,30,100,0,30,30,30,30,30,30,30,100,0,30,100,30,30,30,60,30,67,60,30,30,90,30,30,90,30,67,60,30,67,90,30,0,0,0,100,0,0,100,0,30,0,0,0,100,0,30,0,0,30,100,0,0,100,30,0,100,30,30,100,0,0,100,30,30,100,0,30,30,30,0,30,30,30,100,30,30,30,30,0,100,30,30,100,30,0,30,30,0,30,60,30,30,30,30,30,30,0,30,60,0,30,60,30,30,60,0,67,60,30,30,60,30,30,60,0,67,60,0,67,60,30,67,60,0,67,90,30,67,60,30,67,60,0,67,90,0,67,90,30,30,90,0,30,90,30,67,90,30,30,90,0,67,90,30,67,90,0,30,90,0,30,150,30,30,90,30,30,90,0,30,150,0,30,150,30,0,150,0,0,150,30,30,150,30,0,150,0,30,150,30,30,150,0,0,0,0,0,0,30,0,150,30,0,0,0,0,150,30,0,150,0],e=z([18,0,0,1,18,0,0,-1,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,-1,0,6,-1,0,0]),i=z([18,200,70,120,18,80,70,200,6,70,200,210,6,200,200,70,6,210,100,70,6,210,160,70,6,70,180,210,6,100,70,210,6,76,210,100,6,140,210,80,6,90,130,110,6,160,160,220],[255]),s=t.length/3,o={position:O(3,s),texcoord:O(2,s),normal:O(3,s),color:O(4,s,Uint8Array),indices:O(3,s/3,Uint16Array)};o.position.push(t),o.texcoord.push([.22,.19,.22,.79,.34,.19,.22,.79,.34,.79,.34,.19,.34,.19,.34,.31,.62,.19,.34,.31,.62,.31,.62,.19,.34,.43,.34,.55,.49,.43,.34,.55,.49,.55,.49,.43,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,1,1,1,0,0,1,1,1,0]),o.normal.push(e),o.color.push(i);for(let t=0;t<s;++t)o.indices.push(t);return o}function Q(t,e,i,o,r,a,l){if(r<=0)throw new Error("subdivisionDown must be > 0");const h=(l=l||1)-(a=a||0),d=2*(r+1)*4,c=O(3,d),u=O(3,d),p=O(2,d);function g(t,e,i){return t+(e-t)*i}function m(e,i,l,d,m,f){for(let C=0;C<=r;C++){const _=i/1,A=C/r,x=2*(_-.5),v=(a+A*h)*Math.PI,B=Math.sin(v),T=Math.cos(v),b=g(t,e,B),M=x*o,P=T*t,F=B*b;c.push(M,P,F);const S=n((w=[0,B,T],y=l,(E=(E=void 0)||new s(3))[0]=w[0]*y[0],E[1]=w[1]*y[1],E[2]=w[2]*y[2],E),d);u.push(S),p.push(_*m+f,A)}var w,y,E}for(let t=0;t<2;t++){const s=2*(t/1-.5);m(e,t,[1,1,1],[0,0,0],1,0),m(e,t,[0,0,0],[s,0,0],0,0),m(i,t,[1,1,1],[0,0,0],1,0),m(i,t,[0,0,0],[s,0,0],0,1)}const f=O(3,2*r*4,Uint16Array);function w(t,e){for(let i=0;i<r;++i)f.push(t+i+0,t+i+1,e+i+0),f.push(t+i+1,e+i+1,e+i+0)}const y=r+1;return w(0*y,4*y),w(5*y,7*y),w(6*y,2*y),w(3*y,1*y),{position:c,normal:u,texcoord:p,indices:f}}function q(t,e,i,s,o,n){return H(t,t,e,i,s,o,n)}function J(t,e,i,s,o,n){if(i<3)throw new Error("radialSubdivisions must be 3 or greater");if(s<3)throw new Error("verticalSubdivisions must be 3 or greater");o=o||0;const r=(n=n||2*Math.PI)-o,a=i+1,l=s+1,h=a*l,d=O(3,h),c=O(3,h),u=O(2,h),p=O(3,i*s*2,Uint16Array);for(let n=0;n<l;++n){const l=n/s,h=l*Math.PI*2,p=Math.sin(h),g=t+p*e,m=Math.cos(h),f=m*e;for(let t=0;t<a;++t){const e=t/i,s=o+e*r,n=Math.sin(s),a=Math.cos(s),h=n*g,w=a*g,y=n*p,E=a*p;d.push(h,f,w),c.push(y,m,E),u.push(e,1-l)}}for(let t=0;t<s;++t)for(let e=0;e<i;++e){const i=1+e,s=1+t;p.push(a*t+e,a*s+e,a*t+i),p.push(a*s+e,a*s+i,a*t+i)}return{position:d,normal:c,texcoord:u,indices:p}}function Z(t,e,i,s,o){if(e<3)throw new Error("divisions must be at least 3");o=o||1,s=s||0;const n=(e+1)*((i=i||1)+1),r=O(3,n),a=O(3,n),l=O(2,n),h=O(3,i*e*2,Uint16Array);let d=0;const c=t-s,u=e+1;for(let t=0;t<=i;++t){const n=s+c*Math.pow(t/i,o);for(let s=0;s<=e;++s){const o=2*Math.PI*s/e,c=n*Math.cos(o),p=n*Math.sin(o);if(r.push(c,0,p),a.push(0,1,0),l.push(1-s/e,t/i),t>0&&s!==e){const t=d+(s+1),e=d+s,i=d+s-u,o=d+(s+1)-u;h.push(t,e,i),h.push(t,i,o)}}d+=e+1}return{position:r,normal:a,texcoord:l,indices:h}}function tt(t){return function(e){const i=t.apply(this,Array.prototype.slice.call(arguments,1));return k(e,i)}}function et(t){return function(e){const i=t.apply(null,Array.prototype.slice.call(arguments,1));return R(e,i)}}function it(t){return!!t.texStorage2D}et(K),tt(K),et($),tt($),et(U),tt(U),et(V),tt(V),et(H),tt(H),et(N),tt(N),et(Q),tt(Q),et(q),tt(q),et(J),tt(J),et(Z),tt(Z),new Uint8Array([128,192,255,255]);{const t={};t[6406]={numColorComponents:1},t[6409]={numColorComponents:1},t[6410]={numColorComponents:2},t[6407]={numColorComponents:3},t[6408]={numColorComponents:4},t[6403]={numColorComponents:1},t[36244]={numColorComponents:1},t[33319]={numColorComponents:2},t[33320]={numColorComponents:2},t[6407]={numColorComponents:3},t[36248]={numColorComponents:3},t[6408]={numColorComponents:4},t[36249]={numColorComponents:4},t[6402]={numColorComponents:1},t[34041]={numColorComponents:2}}const st=33984,ot=34962,nt=3553,rt=34067,at=32879,lt=35866,ht={};function dt(t,e){return ht[e].bindPoint}function ct(t,e){return function(i){t.uniform1i(e,i)}}function ut(t,e){return function(i){t.uniform1iv(e,i)}}function pt(t,e){return function(i){t.uniform2iv(e,i)}}function gt(t,e){return function(i){t.uniform3iv(e,i)}}function mt(t,e){return function(i){t.uniform4iv(e,i)}}function ft(t,e,i,s){const o=dt(0,e);return it(t)?function(e){let n,r;x(0,e)?(n=e,r=null):(n=e.texture,r=e.sampler),t.uniform1i(s,i),t.activeTexture(st+i),t.bindTexture(o,n),t.bindSampler(i,r)}:function(e){t.uniform1i(s,i),t.activeTexture(st+i),t.bindTexture(o,e)}}function wt(t,e,i,s,o){const n=dt(0,e),r=new Int32Array(o);for(let t=0;t<o;++t)r[t]=i+t;return it(t)?function(e){t.uniform1iv(s,r),e.forEach((function(e,s){let o,a;t.activeTexture(st+r[s]),x(0,e)?(o=e,a=null):(o=e.texture,a=e.sampler),t.bindSampler(i,a),t.bindTexture(n,o)}))}:function(e){t.uniform1iv(s,r),e.forEach((function(e,i){t.activeTexture(st+r[i]),t.bindTexture(n,e)}))}}function yt(t,e){return function(i){if(i.value)switch(t.disableVertexAttribArray(e),i.value.length){case 4:t.vertexAttrib4fv(e,i.value);break;case 3:t.vertexAttrib3fv(e,i.value);break;case 2:t.vertexAttrib2fv(e,i.value);break;case 1:t.vertexAttrib1fv(e,i.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else t.bindBuffer(ot,i.buffer),t.enableVertexAttribArray(e),t.vertexAttribPointer(e,i.numComponents||i.size,i.type||5126,i.normalize||!1,i.stride||0,i.offset||0),void 0!==i.divisor&&t.vertexAttribDivisor(e,i.divisor)}}function Et(t,e){return function(i){if(i.value){if(t.disableVertexAttribArray(e),4!==i.value.length)throw new Error("The length of an integer constant value must be 4!");t.vertexAttrib4iv(e,i.value)}else t.bindBuffer(ot,i.buffer),t.enableVertexAttribArray(e),t.vertexAttribIPointer(e,i.numComponents||i.size,i.type||5124,i.stride||0,i.offset||0),void 0!==i.divisor&&t.vertexAttribDivisor(e,i.divisor)}}function Ct(t,e){return function(i){if(i.value){if(t.disableVertexAttribArray(e),4!==i.value.length)throw new Error("The length of an unsigned integer constant value must be 4!");t.vertexAttrib4uiv(e,i.value)}else t.bindBuffer(ot,i.buffer),t.enableVertexAttribArray(e),t.vertexAttribIPointer(e,i.numComponents||i.size,i.type||5125,i.stride||0,i.offset||0),void 0!==i.divisor&&t.vertexAttribDivisor(e,i.divisor)}}function _t(t,e,i){const s=i.size,o=i.count;return function(i){t.bindBuffer(ot,i.buffer);const n=i.size||i.numComponents||s,r=n/o,a=i.type||5126,l=ht[a].size*n,h=i.normalize||!1,d=i.offset||0,c=l/o;for(let s=0;s<o;++s)t.enableVertexAttribArray(e+s),t.vertexAttribPointer(e+s,r,a,h,l,d+c*s),void 0!==i.divisor&&t.vertexAttribDivisor(e+s,i.divisor)}}ht[5126]={Type:Float32Array,size:4,setter:function(t,e){return function(i){t.uniform1f(e,i)}},arraySetter:function(t,e){return function(i){t.uniform1fv(e,i)}}},ht[35664]={Type:Float32Array,size:8,setter:function(t,e){return function(i){t.uniform2fv(e,i)}},cols:2},ht[35665]={Type:Float32Array,size:12,setter:function(t,e){return function(i){t.uniform3fv(e,i)}},cols:3},ht[35666]={Type:Float32Array,size:16,setter:function(t,e){return function(i){t.uniform4fv(e,i)}},cols:4},ht[5124]={Type:Int32Array,size:4,setter:ct,arraySetter:ut},ht[35667]={Type:Int32Array,size:8,setter:pt,cols:2},ht[35668]={Type:Int32Array,size:12,setter:gt,cols:3},ht[35669]={Type:Int32Array,size:16,setter:mt,cols:4},ht[5125]={Type:Uint32Array,size:4,setter:function(t,e){return function(i){t.uniform1ui(e,i)}},arraySetter:function(t,e){return function(i){t.uniform1uiv(e,i)}}},ht[36294]={Type:Uint32Array,size:8,setter:function(t,e){return function(i){t.uniform2uiv(e,i)}},cols:2},ht[36295]={Type:Uint32Array,size:12,setter:function(t,e){return function(i){t.uniform3uiv(e,i)}},cols:3},ht[36296]={Type:Uint32Array,size:16,setter:function(t,e){return function(i){t.uniform4uiv(e,i)}},cols:4},ht[35670]={Type:Uint32Array,size:4,setter:ct,arraySetter:ut},ht[35671]={Type:Uint32Array,size:8,setter:pt,cols:2},ht[35672]={Type:Uint32Array,size:12,setter:gt,cols:3},ht[35673]={Type:Uint32Array,size:16,setter:mt,cols:4},ht[35674]={Type:Float32Array,size:32,setter:function(t,e){return function(i){t.uniformMatrix2fv(e,!1,i)}},rows:2,cols:2},ht[35675]={Type:Float32Array,size:48,setter:function(t,e){return function(i){t.uniformMatrix3fv(e,!1,i)}},rows:3,cols:3},ht[35676]={Type:Float32Array,size:64,setter:function(t,e){return function(i){t.uniformMatrix4fv(e,!1,i)}},rows:4,cols:4},ht[35685]={Type:Float32Array,size:32,setter:function(t,e){return function(i){t.uniformMatrix2x3fv(e,!1,i)}},rows:2,cols:3},ht[35686]={Type:Float32Array,size:32,setter:function(t,e){return function(i){t.uniformMatrix2x4fv(e,!1,i)}},rows:2,cols:4},ht[35687]={Type:Float32Array,size:48,setter:function(t,e){return function(i){t.uniformMatrix3x2fv(e,!1,i)}},rows:3,cols:2},ht[35688]={Type:Float32Array,size:48,setter:function(t,e){return function(i){t.uniformMatrix3x4fv(e,!1,i)}},rows:3,cols:4},ht[35689]={Type:Float32Array,size:64,setter:function(t,e){return function(i){t.uniformMatrix4x2fv(e,!1,i)}},rows:4,cols:2},ht[35690]={Type:Float32Array,size:64,setter:function(t,e){return function(i){t.uniformMatrix4x3fv(e,!1,i)}},rows:4,cols:3},ht[35678]={Type:null,size:0,setter:ft,arraySetter:wt,bindPoint:nt},ht[35680]={Type:null,size:0,setter:ft,arraySetter:wt,bindPoint:rt},ht[35679]={Type:null,size:0,setter:ft,arraySetter:wt,bindPoint:at},ht[35682]={Type:null,size:0,setter:ft,arraySetter:wt,bindPoint:nt},ht[36289]={Type:null,size:0,setter:ft,arraySetter:wt,bindPoint:lt},ht[36292]={Type:null,size:0,setter:ft,arraySetter:wt,bindPoint:lt},ht[36293]={Type:null,size:0,setter:ft,arraySetter:wt,bindPoint:rt},ht[36298]={Type:null,size:0,setter:ft,arraySetter:wt,bindPoint:nt},ht[36299]={Type:null,size:0,setter:ft,arraySetter:wt,bindPoint:at},ht[36300]={Type:null,size:0,setter:ft,arraySetter:wt,bindPoint:rt},ht[36303]={Type:null,size:0,setter:ft,arraySetter:wt,bindPoint:lt},ht[36306]={Type:null,size:0,setter:ft,arraySetter:wt,bindPoint:nt},ht[36307]={Type:null,size:0,setter:ft,arraySetter:wt,bindPoint:at},ht[36308]={Type:null,size:0,setter:ft,arraySetter:wt,bindPoint:rt},ht[36311]={Type:null,size:0,setter:ft,arraySetter:wt,bindPoint:lt};const At={};At[5126]={size:4,setter:yt},At[35664]={size:8,setter:yt},At[35665]={size:12,setter:yt},At[35666]={size:16,setter:yt},At[5124]={size:4,setter:Et},At[35667]={size:8,setter:Et},At[35668]={size:12,setter:Et},At[35669]={size:16,setter:Et},At[5125]={size:4,setter:Ct},At[36294]={size:8,setter:Ct},At[36295]={size:12,setter:Ct},At[36296]={size:16,setter:Ct},At[35670]={size:4,setter:Et},At[35671]={size:8,setter:Et},At[35672]={size:12,setter:Et},At[35673]={size:16,setter:Et},At[35674]={size:4,setter:_t,count:2},At[35675]={size:9,setter:_t,count:3},At[35676]={size:16,setter:_t,count:4};const xt=36096,vt=33306,Bt={};Bt[34041]=vt,Bt[6401]=36128,Bt[36168]=36128,Bt[6402]=xt,Bt[33189]=xt,Bt[33190]=xt,Bt[36012]=xt,Bt[35056]=vt,Bt[36013]=vt}},e={};function i(s){var o=e[s];if(void 0!==o)return o.exports;var n=e[s]={exports:{}};return t[s](n,n.exports,i),n.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";var t=i(420);class e extends t.Kj{constructor(t,e,i,s,o,n=16777215,r=1,a=0,l=0){super(),this.__isIconPack=!0,this.__spacing=a,this.__margin=l,this.__width=s,this.__height=o,this.__texture=t,this.__perRow=Math.floor((t.width/s-2*this.__margin)/(s+this.__spacing)),this.setTexture(t),this._$$color=n,this.__alpha=r,this.setColorArray([n,r,n,r,n,r,n,r]),this.setVertexArray([-s/2,-o/2,s/2,-o/2,-s/2,o/2,s/2,o/2]),this.setIndexArray([0,1,2,1,3,2]),this.setColRow(e,i)}setColRow(t,e){let i=this.__width,s=this.__height,o=(t-1)*(i+this.__spacing)+this.__margin,n=(e-1)*(s+this.__spacing)+this.__margin;this.setTextureCoordinateArray([o,n,o+i,n,o,n+s,o+i,n+s]),this._$$col=t,this.__row=e}setById(t){let e=(t-1)%this.__perRow+1,i=Math.floor(t/this.__perRow)+1;this.setColRow(e,i)}getId(){return this._$$col+(this.__row-1)*this.__perRow}getColRow(){return[this._$$col,this.__row]}clone(t,i){return new e(this.__texture,null!=t?t:this._$$col,null!=i?i:this.__row,this.__width,this.__height,this._$$color,this.__alpha,this.__spacing,this.__margin)}setFlip(t,e){let i=this.__width,s=this.__height,o=(this._$$col-1)*(i+this.__spacing)+this.__margin,n=(this.__row-1)*(s+this.__spacing)+this.__margin;t&&e?this.setTextureCoordinates(3,o,n,2,o+i,n,1,o,n+s,0,o+i,n+s):t?this.setTextureCoordinates(1,o,n,0,o+i,n,3,o,n+s,2,o+i,n+s):e?this.setTextureCoordinates(2,o,n,3,o+i,n,0,o,n+s,1,o+i,n+s):this.setTextureCoordinates(0,o,n,1,o+i,n,2,o,n+s,3,o+i,n+s)}sliceMesh(e){let i=this._$$col,s=this.__row,o=this.__width,n=this.__height,r=(i-1)*(o+this.__spacing)+this.__margin,a=(s-1)*(n+this.__spacing)+this.__margin,l=t.cQ.random(Math.floor(.45*o),Math.floor(.55*o))-1,h=t.cQ.random(Math.floor(.45*n),Math.floor(.55*n))-1,d=t.cQ.random(Math.floor(.3*o),Math.floor(.7*o))-1,c=t.cQ.random(Math.floor(.3*n),Math.floor(.7*n))-1,u=t.cQ.random(Math.floor(.3*o),Math.floor(.7*o))-1,p=t.cQ.random(Math.floor(.3*n),Math.floor(.7*n))-1,g=new t.Kj,m=[-o/2,-n/2,d-o/2,-n/2,l-o/2,h-n/2,-o/2,c-n/2];g.setVertexArray(m),g.setTextureCoordinateArray([r,a,r+d,a,r+l,a+h,r,a+c]),g.setIndexArray([0,1,2,0,2,3]),g.setTexture(this.__texture);let f=new t.Kj,w=[d-o/2,-n/2,o-o/2,-n/2,o-o/2,p-n/2,l-o/2,h-n/2];f.setVertexArray(w),f.setTextureCoordinateArray([r+d,a,r+o,a,r+o,a+p,r+l,a+h]),f.setIndexArray([0,1,2,0,2,3]),f.setTexture(this.__texture);let y=new t.Kj,E=[-o/2,c-n/2,l-o/2,h-n/2,u-o/2,n-n/2,-o/2,n-n/2];y.setVertexArray(E),y.setTextureCoordinateArray([r,a+c,r+l,a+h,r+u,a+n,r,a+n]),y.setIndexArray([0,1,2,0,2,3]),y.setTexture(this.__texture);let C=new t.Kj,_=[l-o/2,h-n/2,o-o/2,p-n/2,o-o/2,n-n/2,u-o/2,n-n/2];if(C.setVertexArray(_),C.setTextureCoordinateArray([r+l,a+h,r+o,a+p,r+o,a+n,r+u,a+n]),C.setIndexArray([0,1,2,0,2,3]),C.setTexture(this.__texture),this._$$color){let t=this._$$color,e=this.__alpha;g.setColorArray([t,e||1,t,e||1,t,e||1,t,e||1]),f.setColorArray([t,e||1,t,e||1,t,e||1,t,e||1]),y.setColorArray([t,e||1,t,e||1,t,e||1,t,e||1]),C.setColorArray([t,e||1,t,e||1,t,e||1,t,e||1])}return[g,f,y,C]}}const s=new class{constructor(){this._RANDOM=0,this.World={tileWidth:16,tileHeight:24,tilePerRow:16,shadowScale:2,shadowWidth:1024,shadowHeight:1024,textureToScreenMagicNumber:.9594726,zoomMin:1,zoomMax:1.8,turnPerDay:200,tileTextureName:"Tile1624.png",lightTextureName:"Light.png",shadowMaskTextureName:"shadowMask1624.png",timeTable:[{time:0,radius:3,c1:[.1,.3,1,.1],c2:[.25,.4,1,.7]},{time:3,radius:3,c1:[.1,.3,1,.12],c2:[.5,.75,1,1]},{time:5,radius:6,c1:[.5,.5,1,.15],c2:[.5,1,1,1]},{time:10,radius:14,c1:[.4,.7,.9,.16],c2:[1,1,1,1]},{time:11,radius:15,c1:[1,1,.8,.21],c2:[1,1,1,1]},{time:18,radius:15,c1:[1,.6,.5,.21],c2:[1,.7,.7,1]},{time:19,radius:14,c1:[1,0,.2,.16],c2:[1,1,.5,1]},{time:21,radius:6,c1:[1,0,1,.2],c2:[1,.6,.2,1]},{time:24,radius:3,c1:[.1,.3,1,.1],c2:[.25,.4,1,.7]}]},this.Entity={width:16,height:24,walkSpeed:220},this.Interface={margin:8}}get PARTICLE_SCALE(){return t.wU.deviceViewport.width/t.wU.deviceViewport.height}};var o=i(65);i(919);const n=new t.KG([[0,10,"@t",{redMultiplier:[1,1,"linear"],greenMultiplier:[1,.8,"linear"],blueMultiplier:[0,0,"linear"]}],[10,"goto",0]]),r=new t.KG({default:[[0,0,"@t"]],hide:[[0,0,"@t",{alpha:0}]],drop:[[0,30,"@t",{alpha:1,y:[0,-10,"outCubic"],rotation:[-720,0,"linear"]}],[31,60,"@t",{y:[-10,0,"outBounce"]}]]});function a(){const[t,e]=[this.tileWidth,this.tileHeight];this.__animationTick=(this.__animationTick+1)%2;const[i,o]=[this._textureX,this._textureY+this.__animationTick*e],[n,r]=[s.Entity.width,s.Entity.height];this.mesh.setTextureCoordinateArray([i,o,i+t,o,i,o+e,i+t,o+e]),this.shadowMesh&&this.shadowMesh.setTextureCoordinateArray([i,o+r,i+n,o+r,i,o,i+n,o])}function l(){const{x:t,y:e}=this.getPosition();this.shadowMesh.setPosition(t,e),this.shadowMesh.setAlpha(this.getAlpha()),this.shadowMesh.setVisible(this.isVisible())}class h extends t.jy{constructor(t,e,i,o){super(),"object"==typeof e&&null==i&&null==o&&(o=e,e=null),this.id=h.generateNewId(),this.isEntity=!0,this.walkSpeed=s.Entity.walkSpeed,this.options=null!=o?o:{},"number"==typeof e&&(this.position=He.world.tileCenterToWorld(e,i),this.tileX=e,this.tileY=i,this.lastTileX=e,this.lastTileY=i),this.name=t,this.property=void 0,this.mesh=void 0,this.movieClip=void 0,this.addedToWorld=void 0,this.tileWidth=void 0,this.tileHeight=void 0,this.isItem=void 0,this.isCreature=void 0,this.isProp=void 0,this.isSkill=void 0,this.isPlayer=void 0,this.texture=void 0,this.imageNum=void 0,this.imageCol=void 0,this.imageRow=void 0,this.colorNum=void 0}fillProperties(t,e){this.__key=e,console.assert(t[e],`Î≤†Ïù¥Ïä§ÌÖåÏù¥Î∏îÏóê ÌÇ§Í∞Ä ÏóÜÏùå ${t},${e}`),this.property=new Proxy({},{get:(i,s)=>s in i?i[s]:t[e][s]})}postInit(i){if(this.constructor!=i)return;const o=this.options,h=this.property,[d,c]=[this.tileX,this.tileY];let u,p;h.image?[u,p]=h.image:h.images&&([u,p]=h.images[this.imageNum]),[this.imageCol,this.imageRow]=[u,p],this.color=this.color||this.options.color||h.color,h.colors&&null==this.color?this.color=h.colors[this.colorNum]:this.color||(this.color=16777215),this.isCreature&&(p=2*p-1);const[g,m]=[s.Entity.width,s.Entity.height],[f,w]=[this.tileWidth,this.tileHeight],[y,E]=[(u-1)*f,(p-1)*w];let C=new e(this.texture,u,p,f,w,this.color,1);if(this.mesh=C,C.setFlip(o.flip),d&&c&&He.world.map.getVisibility(d,c)>0?this.setVisible(!1):this.setVisible(!0),this.isProp||this.isCreature||this.isSkill){this.addChild(C);const e=C.clone(),i=.8*m;e.setVertexArray([0-g/2,0-m/2+i,g-g/2,0-m/2+i,0-g/2,m-m/2+i,g-g/2,m-m/2+i]),e.setTextureCoordinateArray([y,E+m,y+g,E+m,y,E,y+g,E]),e.setColorArray([0,.5,0,.5,0,.5,0,.5]),this.shadowMesh=e,this.addEventListenerOnStage(t.ju.ENTER_FRAME,l,this)}if(this.isCreature&&(this._textureX=y,this._textureY=E,this.__animationTick=0,this.__animationTimer=new t.B7(500,0),this.__animationTimer.start(),this.__animationTimer.addEventListenerOnStage(t.ju.TIMER,a,this,this),this.buffs={},this.buffLayer=new t.jy,this.gaugeLayer=new t.jy,this.addChild(this.gaugeLayer),this.addChild(this.buffLayer)),this.isItem){if("gold"==this.property.effect){const t=n.instance();t.setTarget("@t",C),C=t}const e=r.instance();if(e.setTarget("@t",C),this.addChild(e),this.movieClip=e,d){const{x:t,y:e}=He.world.tileCenterToWorld(d,c);this.setPosition(t,e),[this.tileX,this.tileY]=[d,c]}if(1==o.drop){if(o.dropX){const{x:i,y:s}=He.world.tileCenterToWorld(o.dropX,o.dropY);e.setPosition(i-this.getX(),s-this.getY()),new t.kX(e,300,{x:0,y:0})}o.dropDelay?(e.gotoAndPlay("hide"),this.dropAnimationTimer=t.B7.delayedCall(o.dropDelay,(()=>{this.dropAnimationTimer=null,this.showDrop()}))):this.showDrop()}this.property.bundle&&(this.amount=o.amount||1,"gold"==this.property.bundle&&(this.amount<=5?this.changeImage(1,14):this.amount<=20?this.changeImage(2,14):this.amount<=100?this.changeImage(3,14):this.changeImage(4,14)))}}changeImage(t,e){const[i,o]=[s.Entity.width,s.Entity.height],[n,r]=[(t-1)*this.tileWidth,(e-1)*this.tileHeight];this.mesh.setTextureCoordinateArray([n,r,n+i,r,n,r+o,n+i,r+o])}setTileXy(t,e){if(this.lastTileX!=this.tileX&&this.lastTileY!=this.tileY&&([this.lastTileX,this.lastTileY]=[this.tileX,this.tileY]),this.addedToWorld){if(delete He.world.entityManager.entitiesByXy[this.tileX+","+this.tileY],[this.tileX,this.tileY]=[t,e],null!=He.world.entityManager.entitiesByXy[t+","+e])throw new Error("‚òû‚òû‚òû Ïò§Î∏åÏ†ùÌä∏Í∞Ä ÏûàÎäî ÏúÑÏπòÏóê Ïò§Î∏åÏ†ùÌä∏Î•º Ïù¥ÎèôÌïòÎ†§Ìï®");He.world.entityManager.entitiesByXy[t+","+e]=this}else[this.tileX,this.tileY]=[t,e]}enableDefaultAnimation(t){this.__animationTimer&&(t?(a.call(this),this.__animationTimer.start()):this.__animationTimer.stop())}stopPreviousAction(e){this.enableDefaultAnimation(!0),this.dispatchEvent(new t.ju("stopAction",{reason:e}))}moveTo(e,i){if(He.world.entityManager.getEntity(e,i))return null;{this.stopPreviousAction("move"),this.__walkTween&&this.__walkTween.stop();const{x:s,y:o}=He.world.tileCenterToWorld(e,i);this.setTileXy(e,i);const n=new t.kX(this,this.walkSpeed,{x:s,y:o},{ease:t.Ui.inOutCubic});return this.__walkTween=n,n}}moveToRel(t,e){this.moveTo(this.tileX+t,this.tileY+e)}swapLocation(e){console.assert(this.addedToWorld&&e.addedToWorld,"‚òû‚òû‚òû ÏõîÎìúÏóê ÏóÜÎäî Ïò§Î∏åÏ†ùÌä∏Ïùò ÏúÑÏπòÎ•º Î∞îÍæ∏Î†§Ìï®");{this.__walkTween&&this.__walkTween.stop();const{x:i,y:s}=He.world.tileCenterToWorld(e.tileX,e.tileY),o=new t.kX(this,this.walkSpeed,{x:i,y:s},{ease:t.Ui.inOutCubic});this.__walkTween=o}{e.__walkTween&&e.__walkTween.stop();const{x:i,y:s}=He.world.tileCenterToWorld(this.tileX,this.tileY),o=new t.kX(e,e.walkSpeed,{x:i,y:s},{ease:t.Ui.inOutCubic});e.__walkTween=o}He.world.entityManager.entitiesByXy[this.tileX+","+this.tileY]=e,He.world.entityManager.entitiesByXy[e.tileX+","+e.tileY]=this,[this.tileX,this.tileY,e.tileX,e.tileY]=[e.tileX,e.tileY,this.tileX,this.tileY]}getPropertyRel(t,e){return He.world.getProperty(this.tileX+t,this.tileY+e)}getEntityRel(t,e){return He.world.entityManager.getEntity(this.tileX+t,this.tileY+e)}getEntityPropertyRel(t,e){const i=He.world.entityManager.getEntity(this.tileX+t,this.tileY+e);return null!=i?i.property:null}removeFromWorld(){He.world.entityManager.removeEntity(this)}detachFromWorld(){He.world.entityManager.detachEntity(this)}canBeSeen(t){return He.world.sightManager.canBeSeen(this.tileX,this.tileY,t)}canSee(t,e,i){return"number"==typeof t?He.world.sightManager.canSee(this.tileX,this.tileY,t,e,i):He.world.sightManager.canSee(this.tileX,this.tileY,t.tileX,t.tileY,e)}resetPositionAndColor(){t.kX.stopTarget(this);const{x:e,y:i}=He.world.tileCenterToWorld(this.tileX,this.tileY);this.setPosition(e,i),this.setOverrideColor(16777215),this.setScale(1),this.setAlpha(1)}getNearEntities(t,e,i,s){const[o,n]=[this.tileX,this.tileY],r=He.world.entityManager.getEntitiesInRect(o-t,n-t,o+t,n+t),a=[];let l;l=null!=i&&null!=s?Math.atan2(s-this.y,i-this.x)/Math.PI*180+360:0;for(const i in r){const s=r[i],o=He.world.getDistanceBetweenEntities(this,s);if(this!=s&&o<=t){const t=Math.floor(Math.abs(Math.atan2(s.tileY-this.tileY,s.tileX-this.tileX)/Math.PI*180+360-l));(null==e||t<=e)&&a.push({dist:o,angle:t,entity:s})}}if(a.sort(((t,e)=>t.dist==e.dist?t.angle-e.angle:t.dist-e.dist)),r.length>0){const t=[];for(const e in a){const i=a[e];t.push(i.entity)}return t}return null}getName(){return this.name||"Ïù¥Î¶Ñ ÏóÜÎäî Î¨¥Ïñ∏Í∞Ä"}getDesc(){let t;return t=this.property.desc,t||"ÏÑ§Î™ÖÏù¥ ÏóÜÏäµÎãàÎã§"}static generateNewId(){return++this.nextId}}h.nextId=0;const d={random:function(t,e){return null==t?Math.random():null==e?Math.floor(Math.random()*t+1):Math.floor(Math.random()*(e-t)+1)+t}};function c(t){return 4294967295&t}function u(){return c(+new Date)}class p{constructor(t){this.mt=[],this.index=0,this.randomseed(t)}randomseed(t){null==t&&(t=u()),this.mt[0]=c(t);for(let t=1;t<=623;t++)this.mt[t]=c(1812433253*(this.mt[t-1]^(this.mt[t-1]/1073741824>>0)+t))}random(t,e){let i;if(0==this.index)for(let t=0;t<=623;t++)i=2147483647&this.mt[(t+1)%624],this.mt[t]=this.mt[(t+397)%624]^i>>1,0!=(1&i)&&(this.mt[t]=2567483615^this.mt[t]);return i=this.mt[this.index],i^=i/2048,i^=2636928640&c(i<<7),i^=4022730752&c(i<<15),i^=i>>14,i>>>=0,this.index=(this.index+1)%624,null==t?i/4294967296:null==e?0==t?i:1+i%t:t+i%(e-t+1)}}class g{constructor(t,e){this.a=1103515245,this.c=12345,this.m=4294967296,e&&("nr"==e?[this.a,this.c,this.m]=[1664525,1013904223,4294967296]:"mvc"==e&&([this.a,this.c,this.m]=[214013,2531011,4294967296])),this.randomseed(t)}random(t,e){const i=(this.a*this.x+this.c)%this.m;return this.x=i,null==t?i/4294967296:null==e?0==t?i:1+i%t:t+i%(e-t+1)}randomseed(t){null==t&&(t=u()),this.x=c(t)}}class m{constructor(t,e){this.a=1103515245,this.c=12345,this.m=4294967296,e&&("nr"==e?[this.a,this.c,this.m]=[1664525,1013904223,4294967296]:"mvc"==e&&([this.a,this.c,this.m]=[214013,2531011,4294967296])),this.ic=this.c,this.randomseed(t)}random(t,e){const i=this.m,s=this.a*this.x+this.c,o=s%i;return this.x=o,this.c=s/i>>0,null==t?o/4294967296:null==e?0==t?o:1+o%t:t+o%(e-t+1)}randomseed(t){null==t&&(t=u()),this.c=this.ic,this.x=c(t)}}function f(t,e,i,s){const o=this.generator||d;function n(t,e){return Math.pow(t,1/(.66*e+.34))}let r;do{const i=o.random(),s=o.random();r=i<.5?e<.5?n(s,t)*(1-e)-1+e+e:n(s,t)*e:e<.5?(1-n(1-s,t))*(1-e)+e:(1-n(1-s,t))*e+e}while(r<0||r>=1);return s?Math.floor(i+(s+1-i)*r):i?Math.floor(1+s*r):r}class w{constructor(t,e,i){t=null!=t?t:+new Date,this.seed=t,this.method=e,this.arg=i,this.generator="mwc"==e?new m(t,i):"lcg"==e?new g(t,i):new p(t)}random(t,e){return console.assert(null==t&&null==e||null!=t&&null!=e,`random(${t},${e}) Íµ¨Î¨∏ÏùÄ ÌóàÏö©ÎêòÏßÄ ÏïäÏùå. random(1,a) ÌòπÏùÄ random(0,a)Î•º Î™ÖÌôïÌûà Ïì∏ Í≤É`),this.generator.random(t,e)}getRandomFunc(){return this.generator.random.bind(this.generator)}randomseed(t){return this.generator.randomseed(t)}shuffle(t){const e=this.generator||d,i=[],s=[];for(let e=1;e<=t;e++)i[e]=t[e];for(let o=1;o<=t;o++){const t=e.random(i.length);s[s.length+1]=i[t],i.splice(t,1)}return s}bool(){return 1==(this.generator||d).random(2)}rangei(t,e){return(this.generator||d).random(Math.floor(t),Math.floor(e))}rangef(t,e){const i=this.generator||d;return null!=t&&null!=e?i.random()*(e-t)+t:i.random()}pick(t,e,i){const s=this.generator||d,o=[],n=[];console.assert(e-t+1>=i,"Î≤îÏúÑÎ≥¥Îã§ ÎßéÏùÄ ÎûúÎç§ Í∞ØÏàòÎ•º ÏöîÍµ¨Ìï®");for(let r=1;r<=i;r++){let i;do{i=s.random(t,e)}while(o[i]);o[i]=!0,n.push(i)}return n}getDamage(t,e,i,s){return f.call(this,t,e,i,s)}static getDamage(t,e,i,s){f.call(this,t,e,i,s)}save(){const t=JSON.parse(JSON.stringify(this));if(t.generator.mt)for(const e in t.generator.mt){const i=t.generator.mt[e];t.generator.mt[e]=i}return t}load(t){"mwc"==t.method?this.generator=new m(t.seed,t.arg):"lcg"==t.method?this.generator=new g(t.seed,t.arg):this.generator=new p(t.seed);for(const e in t){const i=t[e];if("generator"==e)for(const t in i){const s=i[t];"object"==typeof s?Object.assign(this[e][t],s):this[e][t]=s}else"object"==typeof i?Object.assign(this[e],i):this[e]=i}}}w.prototype.get=w.prototype.random;const y=w;class E{constructor(i,s,o){this.type=i,this.creature=o,this.power=s;const n=new e(E.texture,E.data[this.type].iconCol,E.data[this.type].iconRow,16,16,E.data[this.type].iconColor);this.icon=new t.KG([[0,30,n,{redMultiplier:[1,0,"linear"],greenMultiplier:[1,0,"linear"],blueMultiplier:[1,0,"linear"]}],[0,"goto",0]]),He.world.addLog(E.data[this.type].addLog,this.creatureName())}renew(t){this.power=t,He.world.addLog(E.data[this.type].renewLog,this.creatureName())}static addBuff(t,e,i){let s;return t.buffs[e]?(s=t.buffs[e],s.renew(i)):s=new E(e,i,t),s}process(){E.data[this.type].processFunc&&E.data[this.type].processFunc(this),E.data[this.type].removeFunc&&E.data[this.type].removeFunc(this)&&this.remove()}decreasePower(){return this.power=this.power-1,this.power<=0}remove(){He.world.addLog(E.data[this.type].removeLog,this.creatureName()),this.creature.buffs[this.type]=null}showProcessLog(...t){He.world.addLog(E.data[this.type].processLog,...t)}creatureName(){return this.creature.getName()}damage(t){this.creature.damage(t,this.creature,this.creature.getX(),this.creature.getY(),0,E.data[this.type].processSound)}}E.texture=new t.xE("buff.png",!1,{format:t.Wc.RGBA5551}),E.FIRE="F",E.POISON="P",E.FROZEN="f",E.BLIND="B",E.SILENCE="S",E.STONE="O",E.CURSE="c",E.BLESS="b",E.BLEED="L",E.CONFUSE="C",E.STUN="T",E.BERSERK="K",E.WEAKEN="W",E.SHOCK="E",E.data={[E.FIRE]:{iconCol:1,iconRow:1,iconColor:16711680,addLog:"%sÏóêÍ≤å Î∂àÏù¥ Î∂ôÏóàÎã§!",renewLog:"%sÏóêÍ≤å Î∂àÏù¥ Îòê Î∂ôÏóàÎã§!",removeLog:"%sÏóêÍ≤å Î∂ôÏùÄ Î∂àÏù¥ Í∫ºÏ°åÎã§!",removeFunc:function(t){return t.decreasePower()},processLog:"%s{Îäî} Î∂àÎ°ú Ïù∏Ìï¥ %d ÎåÄÎØ∏ÏßÄÎ•º ÏûÖÏóàÎã§!",processSound:"sound/damage_fire.wav",processFunc:function(t){const e=He.world.random(1,3);this.showProcessLog(this.creatureName(),e),this.damage(e)}},[E.POISON]:{iconCol:2,iconRow:1,iconColor:16711935,addLog:"%s{Îäî} ÎèÖÏóê Í±∏Î†∏Îã§!",renewLog:"%s{Îäî} ÎèÖÏóê Îòê ÎÖ∏Ï∂úÎêêÎã§!",removeLog:"%sÏùò Î™∏ÏóêÏÑú ÎèÖÏù¥ ÏÇ¨ÎùºÏ°åÎã§!",removeFunc:function(t){return 1==He.world.random(5)},processLog:"%s{Îäî} ÎèÖÏúºÎ°ú Ïù∏Ìï¥ %d ÎåÄÎØ∏ÏßÄÎ•º ÏûÖÏóàÎã§!",processSound:"sound/damage_poison.wav",processFunc:function(t){const e=He.world.random(1,2);this.showProcessLog(this.creatureName(),e),this.damage(e)}},[E.FROZEN]:{},[E.BLIND]:{},[E.SILENCE]:{},[E.STONE]:{},[E.CURSE]:{},[E.BLESS]:{},[E.BLEED]:{},[E.CONFUSE]:{},[E.STUN]:{},[E.BERSERK]:{},[E.WEAKEN]:{},[E.SHOCK]:{}};const C={"!":1,"?":2,"‚ô•":3,fear:4,nearDeath:5};class _ extends h{constructor(t,e,i,s){if(super(t,e,i,s),this.isCreature=!0,this.follow=null,this.hp=1,this.maxHp=1,i&&He.world.entityManager.getEntity(e,i)){const t=He.world.pathManager.getSummonFloor(e,i,1);if(0==t.length)console.log("ÏÜåÌôòÌï† ÏûêÎ¶¨Í∞Ä ÏóÜÏùå",e,i);else{e=t[0].x,i=t[0].y;const{x:s,y:o}=He.world.tileCenterToWorld(e,i);this.setPosition(s,o),[this.tileX,this.tileY]=[e,i],[this.lastTileX,this.lastTileY]=[e,i]}}this.postInit(_)}addBuff(t,e){this.buffs[t]=E.addBuff(this,t,e),this.buffLayer.clearChildren();let i=0;for(const t in this.buffs)this.buffs[t],i+=1;let s=0;for(const t in this.buffs){const e=this.buffs[t];e.icon.setPosition(16*-(i-1)/2+16*s,-25),this.buffLayer.addChild(e.icon),s+=1}}processBuff(){for(const t in this.buffs)this.buffs[t].process();this.buffLayer.clearChildren();let t=0;for(const e in this.buffs)this.buffs[e],t+=1;let e=0;for(const i in this.buffs){const s=this.buffs[i];s.icon.setPosition(16*-(t-1)/2+16*e,-25),this.buffLayer.addChild(s.icon),e+=1}}showMood(i){if(null!=this.__moodSprite&&this.__moodSprite.removeFromParent(),i){const s=C[i],o=new e(new t.xE("fx.png",!1,{format:t.Wc.RGBA5551}),s,5,16,24);o.setY(this.gaugeLayer.isVisible()?-24:-16);const n=new t.KG([[0,15,o,{scaleX:[1,.7,"outCubic"],scaleY:[1,.7,"outCubic"]}],[16,30,o,{scaleX:[.7,1,"inCubic"],scaleY:[.7,1,"inCubic"]}],[30,"goto",0]]);this.addChild(n),this.__moodSprite=n}}refreshGauge(){const e=t.cQ.clamp(this.hp/this.hpMax,0,1);1==e||0==e||this.isPlayer?this.gaugeLayer.setVisible(!1):this.gaugeLayer.setVisible(!0);const i=this.mesh.getWidth(),s=this.mesh.getHeight();if(!this.__gaugeBackSprite){const e=new t.JV(0,1,i,4);e.setPosition(-i/2,-s/2-7),this.gaugeLayer.addChild(e),this.__gaugeBackSprite=e}if(!this.__gaugeSprite){const e=new t.JV(16711680,1,i-2,2);e.setPosition(1,1),this.__gaugeBackSprite.addChild(e),this.__gaugeSprite=e}if(this.__gaugeLastValue!=e){const s=new t.JV(10485760,1,i-2,2);s.setScaleX((this.__gaugeLastValue||1)-e),s.setPosition(1+e*(i-2),1),new t.kX(s,1e3,{scaleX:0,alpha:0},{ease:t.Ui.inCubic}).onCompleteRemoveFromParent(),this.__gaugeBackSprite.addChild(s),this.__gaugeSprite.setScaleX(e),this.__gaugeLastValue=e}}getFactionRelation(t){const e=this.property.faction||"M",i=t.property.faction||"M",s=_.factionTable[e][0],o=2*_.factionTable[i][1];return s.substr(o,1)}searchTarget(t){t||(t=this.isPlayer?He.world.viewRadius:this.senseDistance);const e=this.getNearEntities(t),i=[];for(const t in e){const s=e[t];if(s.isCreature&&this.follow!=s&&this.canSee(s.tileX,s.tileY,v.BLOCK_VISION)[0]){const t=this.getFactionRelation(s),e="F"==t?4:"R"==t?3:"f"==t?2:"r"==t?1:0;i[i.length+1]=[t,s,e-.001*He.world.getDistanceBetweenEntities(this,s)]}}return i.sort(((t,e)=>e[3]-t[3])),[i[1],i]}commandFollower(t,e,i){if(i){if(this!=i.follow)throw new Error("ÏûêÏã†Ïùò Ìé´Ïù¥ ÏïÑÎãåÎç∞ Î™ÖÎ†πÏùÑ Ï†ÑÎã¨ÌïòÎ†§Ìï®");i.receiveCommand(t,e)}else{const i=He.world.entityManager.getAllEntities();for(const s in i){const o=i[s];this==o.follow&&(console.log(this.getName(),t,"Î™ÖÎ†πÏùÑ Ï†ÑÎã¨Ìï®",o.getName()),o.receiveCommand(t,e))}}}receiveCommand(t,e){console.log(this.getName(),t,"Î™ÖÎ†πÏùÑ Î∞õÏùå"),"dance"==t&&(this.enableDefaultAnimation(!1),e.mml.on("note",(()=>{const[t,e]=[this.tileWidth,this.tileHeight];this.__animationTick=(this.__animationTick+1)%2;const[i,o]=[this._textureX,this._textureY+this.__animationTick*e],[n,r]=[s.Entity.width,s.Entity.height];this.mesh.setTextureCoordinateArray([i,o,i+t,o,i,o+e,i+t,o+e]),this.shadowMesh.setTextureCoordinateArray([i,o+r,i+n,o+r,i,o,i+n,o])})).on("complete",(()=>{this.enableDefaultAnimation(!0)})))}}_.texture=new t.xE("Character.png",!1,{format:t.Wc.RGBA5551}),_.width=18,_.height=24,_.tileWidth=18,_.tileHeight=24,_.walkSpeed=200,_.perRow=Math.floor(_.texture.width/_.tileWidth),_.factionTable={O:[": f       F f   F   R",0],C:["F : f       f   f   R",1],L:["    :     f     f f R",2],H:["      :   f f r f   R",3],G:["        : F   f F   R",4],R:["F f F F r : f r f r R",5],A:["            : R r r R",6],P:["f f f f   f F : r r R",7],M:["F F F F F f   f : r R",8],V:["f f f F   f f     : r",9],U:["F F F f f f f f f f :",10]};var A=i(266);class x extends A.j{constructor(t,e,i){super(),this.setWallTable(t,e,i)}setWallTable(t,e,i){this.width=t,this.height=e,this.wallTable=i,this.isCleared=!0,this.resultTable=new Array(t*e),this.resultTable.fill(-1)}canBeSeen(t,e,i,s,o,n){o=null!=o?o:2;let[r,a]=[t,e];for(const[l,h]of function*(t,e,i,s){const o=Math.floor(Math.abs(i-t)),n=Math.floor(Math.abs(s-e)),r=i>=t?1:-1,a=s>=e?1:-1;let l=o-n,[h,d]=[t,e];for(;h!=i||d!=s;){const t=2*l;t>-1*n&&(l-=n,h+=r),t<o&&(l+=o,d+=a),yield[h,d]}}(t,e,i,s)){if(0!=(this.wallTable[h*this.width+l].wall&o))return i==l&&s==h?[x.BLOCK_VISION,r,a]:[x.SHADOW,r,a];if(n&&n(l,h))return[x.BLOCK_VISION,r,a];[r,a]=[l,h]}return[x.EMPTY,i,s]}clearResult(){this.isCleared=!0}getResult(t=this.cx,e=this.cy,i=this.radius){(this.isCleared||this.cx!=t||this.cy!=e||this.radius!=i)&&(this.resultTable.fill(Number.NEGATIVE_INFINITY),this.fillResultQuick(t,e,i),this.isCleared=!1);const s=this.resultTable;return this.cx=t,this.cy=e,this.radius=i,s}isVisible(t,e){let i=this.isCleared?null:this.resultTable[e*this.width+t];if(null==this.cx||null==this.cy||t<0||t>=this.width||e<0||e>=this.height)return 2;if(i==Number.NEGATIVE_INFINITY){if(!((t-this.cx)**2+(e-this.cy)**2<=this.radius**2))return 2;console.log(`ÏãúÏïºÏ≤¥ÌÅ¨Ï§ë ÏóÜÎäî Îç∞Ïù¥ÌÑ∞ Î∞úÍ≤¨ ${t}, ${e}`),i=this.canBeSeen(this.cx,this.cy,t,e)[0],this.resultTable[e*this.width+t]=i}return i}fillResultQuick(t,e,i){const s=this.resultTable,o=this.wallTable,[n,r]=[this.width,this.height],a=x.mask,l=Math.min(15,Math.ceil(i)),h=new Uint32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);let d=Math.max(0,e-l),c=Math.min(r-1,e+l),u=Math.max(0,t-l),p=Math.min(n-1,t+l);for(let i=d;i<=c;i++)for(let r=u;r<=p;r++)if(0!=(2&o[i*n+r].wall)){s[i*n+r]=x.BLOCK_VISION;const o=31*(e-i+16-1)+(t-r)+16-1,l=a.startIndex[o],d=a.skip[o],c=a.count[o];if(l>0)for(let t=0;t<c;t++)h[d+t]|=a.data[l-1+t]}else s[i*n+r]=x.EMPTY;d=Math.max(0,e-15),c=Math.min(r-1,e+15),u=Math.max(0,t-15),p=Math.min(n-1,t+15);for(let o=d;o<=c;o++)for(let r=u;r<=p;r++)(r-t)**2+(o-e)**2<=i**2?0==(~h[e-o+15]&1<<t-r+15)&&(s[o*n+r]=x.SHADOW):s[o*n+r]=x.SHADOW;console.log(`ÏãúÏïºÎç∞Ïù¥ÌÑ∞ ${t},${e} ${n} ${r} X:${Math.max(0,t-15)}~${Math.min(n-1,t+15)} Y:${Math.max(0,e-15)}~${Math.min(r-1,e+15)} `)}traceRay(t,e,i,s,o,n,r,a){r=null!=r?r:1;for(const[l,h,d,c]of function*(t,e,i,s){let o,n,r,a,l,h,d,c,u,p,g;h=i-t,d=s-e,c=Math.abs(1/h),u=Math.abs(1/d),g=d>=0?1:-1,p=h>=0?1:-1;const m=h>=0?0:1,f=d>=0?0:1;o=0,n=Math.floor(t),r=Math.floor(e);const w=t-Math.floor(t);a=h>0?(1-w)*c:w*c;const y=e-Math.floor(e);let E;l=d>0?(1-y)*u:y*u,E=i==t?(s-e)/(i-t+1e-5):(s-e)/(i-t);const C=e-E*t;for(;;){let t,e,i,s,h;if(Math.abs(a-l)<1e-6?(o=a,a+=c,l+=u,n+=p,r+=g,i=n+m,s=r+f):a<=l?(o=a,a+=c,n+=p,i=n+m,s=E*(n+m)+C):(o=l,l+=u,r+=g,i=(r+f-C)/E,s=r+f),h=o>1,h)return;[t,e]=[n,r],yield[t,e,i,s]}}(t/o,e/n,i/o,s/n)){const t=this.wallTable[h*this.width+l].wall;if(a&&a(l,h)){let t;return t=l==Math.floor(i/o)&&h==Math.floor(s/n)?x.EMPTY:x.CREATURE,[t,l,h,d*o,c*n]}if(0!=(t&r))return[x.BLOCK_VISION,l,h,d*o,c*n]}return[x.EMPTY,Math.floor(i/o),Math.floor(s/n),i,s]}}x.EMPTY=0,x.BLOCK_VISION=1,x.SHADOW=2,x.CREATURE=4,x.mask=i(886);class v{constructor(){this.randomGenerator=new y(0),this.random=this.randomGenerator.random.bind(this.randomGenerator),this.lightList=void 0,this.data=void 0,this.width=void 0,this.height=void 0,this.propertyTable=void 0,this.tiles=void 0}getData(t,e){return this.data[e*this.width+t]}setData(t,e,i){let s;i?s=e*this.width+t:(s=t,i=e),this.data[s]=i,this.propertyTable[s]=new Proxy({},this.__mt);const o=this.propertyTable[s];o.id=this.tiles[i].id,o.x=s%this.width,o.y=Math.floor(s/this.width),o.light&&1==o.light&&this.lightList.push({x:o.x,y:o.y,light:o.light,color:null!=o.color?o.color:16777215}),o.envSound&&this.envSounds.push({x:o.x,y:o.y,sound:o.envSound})}setDataByChar(t,e,i){this.setData(t,e,v.tileStringData[i].id)}getProperty(t,e){return this.propertyTable[e*this.width+t]}getVisibility(t,e){return this.visibilityTileChecker.isVisible(t,e)}getEntityProperty(t,e){let i;return i=e?(e-1)*this.creaturePerRow+t:t,this.creaturePropertyTable[i]}buildLightMap(){const e=[],i=[],[s,o]=[this.width,this.height];for(let t=0;t<s*o;t++)i[t]=[70,75,80];const n=x.mask;for(const e in this.lightList){const r=this.lightList[e],a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(let t=Math.max(0,r.y-15);t<=Math.min(o-1,r.y+15);t++)for(let e=Math.max(0,r.x-15);e<=Math.min(s-1,r.x+15);e++)if(this.getProperty(e,t).wall>=2){const i=31*(r.y-t+16-1)+(r.x-e)+16-1,s=n.startIndex[i],o=n.skip[i],l=n.count[i];if(s>0)for(let t=0;t<l;t++)a[o+t]|=n.data[s-1+t]}for(let e=Math.max(0,r.y-15);e<=Math.min(o-1,r.y+15);e++)for(let o=Math.max(0,r.x-15);o<=Math.min(s-1,r.x+15);o++){const[n,l]=[r.x-o,r.y-e];let[h,d,c]=[0,0,0];if(0!=(~a[l+15]&1<<n+15)){const[e,i,s]=t.cQ.hex2rgba(r.color),o=n*n+l*l;h=Math.min(255,e/(1*o)*255),d=Math.min(255,i/(4*o)*255),c=Math.min(255,s/(2*o)*255)}i[e*s+o][0]+=h,i[e*s+o][1]+=d,i[e*s+o][2]+=c}}for(let e=0;e<this.height;e++)for(let s=0;s<this.width;s++){const o=this.getProperty(s,e);if(1==o.illum){const n=e*this.width+s,[r,a,l]=t.cQ.hex2rgba(o.color);i[n][0]=255*r,i[n][1]=255*a,i[n][2]=255*l}}for(let t=0;t<this.height;t++)for(let o=0;o<this.width;o++){const n=t*this.width+o;if(0==o||0==t)e[n]=0;else{const t=Math.floor(Math.min(255,(i[n][0]+i[n-1][0]+i[n-s][0]+i[n-1-s][0])/4)),o=Math.floor(Math.min(255,(i[n][1]+i[n-1][1]+i[n-s][1]+i[n-1-s][1])/4)),r=Math.floor(Math.min(255,(i[n][2]+i[n-1][2]+i[n-s][2]+i[n-1-s][2])/4));e[n]=65536*t+256*o+r}}this.lightMap=e}getLightMap(t,e){return this.lightMap[(e-1)*this.width+t]}getTileLightMap(t,e){const i=(e-1)*this.width+t;return t>1&&t<this.width&&e>1&&e<this.height?[this.lightMap[i],this.lightMap[i+1],this.lightMap[i+this.width],this.lightMap[i+1+this.width]]:[t>1&&e>1?this.lightMap[i]:0,t<this.width&&e>1?this.lightMap[i+1]:0,t>1&&e<this.height?this.lightMap[i+this.width]:0,t<this.width&&e<this.height?this.lightMap[i+this.width+1]:0]}loadString(t){const e=t.split("\n"),i=e.length,o=e[0].length;this.width=o,this.height=i,this.tileWidth=s.World.tileWidth,this.tileHeight=s.World.tileHeight,this.tilePerRow=s.World.tilePerRow,this.creaturePerRow=_.perRow,this.envSounds=[],this.tiles=[];for(const t in v.tileStringData){const e=v.tileStringData[t];e.char=t,this.tiles[e.id]=e}this.data=[];for(let t=0;t<i;t++)for(let i=0;i<o;i++){const s=v.tileStringData[e[t].substr(i,1)];s?this.data[t*o+i]=s.id:console.log(`Ïª®Î≤ÑÌåÖÌï† Ïàò ÏóÜÎäî ÌÉÄÏùº ${s} Î∞úÍ≤¨ ${i}, ${t}`)}this.data=new Proxy(this.data,{get:(t,e)=>e in t?t[e]:0}),this.lightList=[],this.propertyTable=[],this.propertyTable=new Proxy(this.propertyTable,{get:(t,e)=>e in t?t[e]:v.defaultProperty}),this.__mt={get:(t,e)=>e in t?t[e]:this.tiles[t.id][e]||v.defaultProperty[e]},this.__dpr=JSON.parse(JSON.stringify(v.defaultProperty)),this.__dpr.bridge=1,this.__dpr.block=1,this.__dpr.road=1,this.__dpr.lava=1;for(const t in this.data){const e=this.data[t];this.setData(t,e)}for(let t=0;t<i;t++)for(let e=0;e<o;e++)this.processVType(e,t);this.creaturePropertyTable={},this.creaturePropertyTable=new Proxy(this.creaturePropertyTable,{get:(t,e)=>e in t?t[e]:v.defaultCreatureProperty}),this.spawnTable={},this.visibilityTileChecker=new x(this.width,this.height,this.propertyTable),this.buildLightMap()}processVType(t,e){const i=this.width,s=this.height,o=this.propertyTable,n=this.__dpr,r=e*i+t,a=o[r];if(a.vtype){const l=e>0&&t>0?o[r-i-1]:n,h=e>0?o[r-i]:n,d=e>0&&t<i-1?o[r-i+1]:n,c=t>0?o[r-1]:n,u=t<i-1?o[r+1]:n,p=e<s-1&&t>0?o[r+i-1]:n,g=e<s-1?o[r+i]:n,m=e<s-1&&t<i-1?o[r+i+1]:n,f=B[a.vtype](this,l,h,d,c,a,u,p,g,m);f?this.data[r]=f:console.log("IDÎ•º ÏñªÏùÑ Ïàò ÏóÜÏùå",a.vtype,t,e)}}getMapString(){let t="";for(let e=0;e<this.height;e++){for(let i=0;i<this.width;i++)t+=this.getProperty(i,e).char;t+="\n"}return t}}const B={wall:function(t,e,i,s,o,n,r,a,l,h){const d=n.id;let c=0;return c=l.block!=n.block?i.block!=n.block?o.block!=n.block&&r.block!=n.block?22:o.block!=n.block?20:r.block!=n.block?21:t.random(16,17):t.random(16,19):i.block!=n.block&&o.block!=n.block&&r.block!=n.block?4:i.block!=n.block&&o.block!=n.block?6:i.block!=n.block&&r.block!=n.block?5:t.random(1,3),d+c},water:function(t,e,i,s,o,n,r,a,l,h){const d=n.glue,c=n[d],u=(e[d]!=c?128:0)|(i[d]!=c?64:0)|(s[d]!=c?32:0)|(o[d]!=c?16:0)|(r[d]!=c?8:0)|(a[d]!=c?4:0)|(l[d]!=c?2:0)|(h[d]!=c?1:0);return 112+v.tileBlendTable[256-u]},mountain:function(t,e,i,s,o,n,r,a,l,h){const d=n.id;return o.char!=n.char&&r.char!=n.char?d+3:o.char!=n.char?d:r.char!=n.char?d+2:d+1},fence:function(t,e,i,s,o,n,r,a,l,h){const d=n.id;let c=0;return l.block==n.block&&i.block!=n.block?c=o.block==n.block?6:r.block==n.block?7:o.block!=n.block&&r.block!=n.block?t.random(6,7):t.random(0,1):i.block==n.block&&l.block!=n.block?c=o.block==n.block?4:r.block==n.block?5:o.block!=n.block&&r.block!=n.block?t.random(4,5):t.random(0,1):i.block==n.block&&l.block==n.block&&(c=o.block==n.block?10:r.block==n.block?11:8),d+c},torch:function(t,e,i,s,o,n,r,a,l,h){const d=n.id,c=[];return"M"!=o.char&&"W"!=o.char&&"B"!=o.char||c.push(24),"M"!=r.char&&"W"!=r.char&&"B"!=r.char||c.push(20),c.length>0?d+c[t.random(0,c.length-1)]:d},door:function(t,e,i,s,o,n,r,a,l,h){return"M"==i.char||"M"==l.char||"M"==o.char||"M"==r.char?103:"W"==i.char||"W"==l.char||"W"==o.char||"W"==r.char?47:"#"==i.char||"#"==l.char||"#"==o.char||"#"==r.char?51:39},cdoor:function(t,e,i,s,o,n,r,a,l,h){return"M"==i.char||"M"==l.char||"M"==o.char||"M"==r.char?87:"W"==i.char||"W"==l.char||"W"==o.char||"W"==r.char?31:"#"==i.char||"#"==l.char||"#"==o.char||"#"==r.char?50:23},dstair:function(t,e,i,s,o,n,r,a,l,h){return"R"==o.char&&"R"==r.char?(n.shadow=1,162):o.char!=n.char&&r.char!=n.char?(n.shadow=1,161):o.char==n.char?71:70},chair:function(t,e,i,s,o,n,r,a,l,h){const d=n.id,c=[];return"H"!=o.char&&"Z"!=o.char||c.push(1),"H"!=r.char&&"Z"!=r.char||c.push(0),"H"!=i.char&&"Z"!=i.char||c.push(2),"H"!=l.char&&"Z"!=l.char||c.push(3),c.length>0?d+c[t.random(0,c.length-1)]:d+t.random(0,3)},wbridge:function(t,e,i,s,o,n,r,a,l,h){const d=[];return o.char==n.char&&r.char==n.char||d.push(7),i.char==n.char&&l.char==n.char||d.push(109),d.length>0?d[t.random(0,d.length-1)]:1==t.random(1,2)?7:109}};v.tileBlendTable=new Uint8Array([46,46,40,40,46,46,40,40,41,41,33,32,41,41,33,32,42,42,35,35,42,42,34,34,44,44,19,17,44,44,18,16,46,46,40,40,46,46,40,40,41,41,33,32,41,41,33,32,42,42,35,35,42,42,34,34,44,44,19,17,44,44,18,16,43,43,45,45,43,43,45,45,37,37,31,29,37,37,31,29,39,39,23,23,39,39,21,21,27,27,15,7,27,27,11,3,43,43,45,45,43,43,45,45,36,36,30,28,36,36,30,28,39,39,23,23,39,39,21,21,25,25,13,5,25,25,9,1,46,46,40,40,46,46,40,40,41,41,33,32,41,41,33,32,42,42,35,35,42,42,34,34,44,44,19,17,44,44,18,16,46,46,40,40,46,46,40,40,41,41,33,32,41,41,33,32,42,42,35,35,42,42,34,34,44,44,19,17,44,44,18,16,43,43,45,45,43,43,45,45,37,37,31,29,37,37,31,29,38,38,22,22,38,38,20,20,26,26,14,6,26,26,10,2,43,43,45,45,43,43,45,45,36,36,30,28,36,36,30,28,38,38,22,22,38,38,20,20,24,24,12,4,24,24,8,0]),v.defaultProperty={wall:0,shadow:0},v.defaultCreatureProperty={race:"",level:1},v.EMPTY=0,v.BLOCK_PASS=1,v.BLOCK_VISION=2,v.BLOCK_ARROW=4;const T=v.BLOCK_PASS,b=v.BLOCK_VISION,M=v.BLOCK_ARROW;v.tileStringData={"~":{id:272,name:"Î¨º",wall:T,water:1,vtype:"water",below:272,bridge:1,glue:"bridge",illum:1,color:37119,GameMapColor:3166352},"-":{id:276,name:"ÍπäÏùÄ Î¨º",wall:T,water:2,vtype:"water",below:276,bridge:1,glue:"bridge",illum:1,color:37119,GameMapColor:3166352},"=":{id:280,name:"Îß§Ïö∞ ÍπäÏùÄ Î¨º",wall:T,water:3,vtype:"water",below:280,bridge:1,glue:"bridge",illum:1,color:37119,GameMapColor:3166352}," ":{id:15,name:"Î∞îÎã•",sound:1},"@":{id:62,name:"Í∏∏",sound:1,vtype:"water",below:62,road:1,glue:"road",GameMapColor:6303760},Q:{id:160,name:"Í±∞Ïπú Í∏∏",sound:1,vtype:"water",below:160,road:1,glue:"road",GameMapColor:6303760},".":{id:11,name:"Í≥†Ïö¥ ÌùôÎ∞îÎã•",sound:1},",":{id:10,name:"ÌùôÎ∞îÎã•",sound:1},";":{id:9,name:"Í±∞Ïπú ÌùôÎ∞îÎã•",sound:1},"?":{id:12,name:"ÏûêÍ∞àÎ∞≠"},"`":{id:0,name:"ÌíÄ",sound:2},'"':{id:13,name:"ÏûîÎîî",sound:2},"^":{id:1,name:"ÌÅ∞ ÌíÄ",sound:2},V:{id:3,name:"Î¨¥ÏÑ±Ìïú ÌíÄ",sound:2},G:{id:2,name:"Îç§Î∂à",wall:b,sound:3,shadow:1,GameMapColor:16384},T:{id:60,name:"ÌÅ∞ ÎÇòÎ¨¥",wall:b+T,shadow:1,GameMapColor:3186736},"(":{id:14,name:"ÎèåÎ∞îÎã•"},"{":{id:4,name:"ÌÅ∞ÎèåÎ∞îÎã•"},R:{id:68,name:"Î∞îÏúÑ",wall:b|T|M,shadow:1,noRain:1},"&":{id:64,name:"ÏÇ∞",wall:b|T|M,vtype:"mountain",shadow:1,noRain:1},W:{id:24,name:"ÎèôÍµ¥Î≤Ω",wall:b|T,vtype:"wall",shadow:1,block:1,road:1,noRain:1},M:{id:80,name:"ÎèåÎ≤Ω",wall:b|T|M,vtype:"wall",shadow:1,block:1,road:1,noRain:1},B:{id:16,name:"Î≤ΩÎèåÎ≤Ω",wall:b|T|M,vtype:"wall",shadow:1,block:1,road:1,noRain:1},"#":{id:48,name:"Ïö∏ÌÉÄÎ¶¨",wall:T,vtype:"fence",shadow:1,block:1},D:{id:39,name:"Î¨∏",vtype:"door",shadow:1,block:1,road:1,noRain:1},E:{id:23,name:"Ïû†Í∏¥ Î¨∏",vtype:"cdoor",wall:T|b|M,shadow:1,block:1,road:1,noRain:1},"|":{id:7,name:"ÎÇòÎ¨¥ Î∞îÎã•",vtype:"wbridge",sound:4,bridge:1,road:1,lava:1,noRain:1},"+":{id:6,name:"ÌÉÄÏùº",sound:5,bridge:1,road:1,lava:1,noRain:1},":":{id:8,name:"ÏûëÏùÄ ÌÉÄÏùº",bridge:1,road:1,lava:1},Z:{id:5,name:"Ìùô ÌÉÄÏùº"},I:{id:288,name:"ÌöÉÎ∂à",fire:1,vtype:"torch",color:13594645,light:1},"*":{id:300,name:"Î∞òÎîßÎ∂à",color:8367,light:1,sound:7},">":{id:70,name:"ÎÇ¥Î†§Í∞ÄÎäî Í≥ÑÎã®",vtype:"dstair",illum:1,color:10522624,road:1,noRain:1,GameMapColor:16776960},"<":{id:69,name:"Ïò¨ÎùºÍ∞ÄÎäî Í≥ÑÎã®",wall:b,shadow:1,illum:1,color:10522624,road:1,noRain:1,GameMapColor:10526720},_:{id:72,name:"Ï†úÎã®",sound:5},Y:{id:296,name:"Î∂ÑÏàò",wall:b,water:1,envSound:"fountain",shadow:1},O:{id:73,name:"Î™®Î¶¨ÏïàÏùò Ïã†ÏÉÅ",wall:T|b|M,shadow:1,noRain:1},C:{id:74,name:"ÌÇ§ÌôÄÏùò Ïã†ÏÉÅ",wall:T|b|M,shadow:1,noRain:1},L:{id:75,name:"ÎßàÌïòÏùò Ïã†ÏÉÅ",wall:T|b|M,shadow:1,noRain:1},"!":{id:61,name:"ÌëØÎßê",wall:T|b|M,shadow:1},F:{id:292,name:"Î™®Îã•Î∂à",wall:b,fire:1,envSound:"campfire",color:16728064,light:1,shadow:1},"%":{id:304,name:"Ïö©Ïïî",wall:T,fire:3,vtype:"water",color:16724016,below:304,lava:1,illum:1,glue:"lava"},H:{id:88,name:"ÌÉÅÏûê",wall:T,vtype:"mountain",shadow:1,noRain:1},")":{id:92,name:"ÏùòÏûê",vtype:"chair",sound:4,shadow:1,noRain:1},"}":{id:104,name:"Ïπ®ÎåÄ",shadow:1,sound:6,noRain:1},S:{id:105,name:"Í∞ÑÌåê",wall:T,shadow:1,illum:1,color:16777215,noRain:1},U:{id:163,name:"Í∏∞Îë•",wall:T|b|M,shadow:1,noRain:1},1:{id:-1,name:"Î¨∏ÏúÑÏπò1",wall:T|b},2:{id:-1,name:"Î¨∏ÏúÑÏπò2",wall:T|b},3:{id:-1,name:"Î¨∏ÏúÑÏπò3",wall:T|b},4:{id:-1,name:"Î¨∏ÏúÑÏπò4",wall:T|b},5:{id:-1,name:"Î¨∏ÏúÑÏπò5",wall:T|b},6:{id:-1,name:"Î¨∏ÏúÑÏπò6",wall:T|b},7:{id:-1,name:"Î¨∏ÏúÑÏπò7",wall:T|b},8:{id:-1,name:"Î¨∏ÏúÑÏπò8",wall:T|b},9:{id:-1,name:"Î¨∏ÏúÑÏπò9",wall:T|b}};for(const t in v.tileStringData){const e=v.tileStringData[t];for(const t in v.defaultProperty){const i=v.defaultProperty[t];e[t]||(e[t]=i)}}class P extends t.Kj{constructor(t,e,i,s,o){super(),this.__texture=t,null!=e&&null!=i&&null!=s&&null!=o&&this.setRect(e,i,s,o)}setRect(e,i,s,o){let[n,r]=[this.__texture.width,this.__texture.height],a=Math.ceil(n/3),l=Math.floor(r/3);this.__rect=new t.UL(e,i,s,o),this.setVertexArray([e,i,e+a,i,e+s-a,i,e+s,i,e,i+l,e+a,i+l,e+s-a,i+l,e+s,i+l,e,i+o-l,e+a,i+o-l,e+s-a,i+o-l,e+s,i+o-l,e,i+o,e+a,i+o,e+s-a,i+o,e+s,i+o]),this.setTextureCoordinateArray([0,0,a,0,n-a,0,n,0,0,l,a,l,n-a,l,n,l,0,r-l,a,r-l,n-a,r-l,n,r-l,0,r,a,r,n-a,r,n,r]),this.setIndexArray([0,1,4,1,5,4,1,2,5,2,6,5,2,3,6,3,7,6,4,5,8,5,9,8,5,6,9,6,10,9,6,7,10,7,11,10,8,9,12,9,13,12,9,10,13,10,14,13,10,11,14,11,15,14]),this.setColorArray([16777215,1,16777215,1,16777215,1,16777215,1,16777215,1,16777215,1,16777215,1,16777215,1,16777215,1,16777215,1,16777215,1,16777215,1,16777215,1,16777215,1,16777215,1,16777215,1]),this.setTexture(this.__texture)}get width(){return this.__rect.width}get height(){return this.__rect.height}getLocalBounds(t){return this.__rect}}class F extends t.jy{constructor(e,...i){super(),this.returnValue=F.funcTable[e](this,...i),t.B7.delayedCall(this.returnValue[0],this.removeFromParent,this)}getDuration(){return this.returnValue}}F.funcTable={};let S=F.funcTable;S.arrow=(e,i,s,o,n,r)=>{let a=new t.eY(new t.xE("Arrow.png",!0,{format:t.Wc.RGBA5551})),l=Math.atan2(n-s,o-i)/Math.PI*180,h=He.world.getDistance(i,s,o,n);a.setAnchorPoint(.5,.5),a.setRotation(l),a.setColorMultiplier(1,1,1),a.setPosition(i,s),e.addChild(a),He.world.entityLayer.addChild(e),o-=(o-i)/h*6,n-=(n-s)/h*6,t.$u.playSound("sound/bow_shoot.wav");let d=2*h;return new t.kX(a,d,{x:o,y:n},{ease:t.Ui.outCubic}).onComplete((()=>{r?a.removeFromParent():(console.log("ÌôîÏÇ¥ÌäïÍπÄ"),new t.kX(a,200,{x:o+t.cQ.random(-15,15),y:n+t.cQ.random(-15,15),rotation:l+360},{ease:t.Ui.outCubic}).onCompleteRemoveFromParent())})),r||(d+=200),[d]},S.swing=(e,i,s,o,n,r,a,l)=>{let h=new t.eY(new t.xE("SwordSwing.png",!0,{format:t.Wc.RGBA5551})),d=Math.atan2(n-s,o-i)/Math.PI*180,c=He.world.getDistance(i,s,o,n);h.setAnchorPoint(-.4,.5),e.addChild(h),h.setRotation(d+70),h.setColorMultiplier(1,1,1),h.setPosition(i,s),h.setAlpha(.5),e.addChild(h),He.world.entityLayer.addChild(e),t.$u.playSound("sound/swing_0.wav");let u;l.__effectTween&&(l.__effectTween.stop(),l.resetPositionAndColor());let p=i+(o-i)/c*5,g=s+(n-s)/c*5,m=l.getX(),f=l.getY();u=100;let w=new t.kX(l,100,{x:p,y:g},{ease:t.Ui.inBack}).onComplete((()=>{new t.kX(l,200,{x:m,y:f},{ease:t.Ui.inCubic})}));l.__effectTween=w;let y=new t.jy;return a.setRotation(135),a.setPosition(12,0),y.addChild(a),e.addChild(y),y.setRotation(d+160),y.setPosition(i,s),new t.kX(h,300,{blueMultiplier:1,rotation:d-90,alpha:0},{ease:t.Ui.outCubic}).onCompleteRemoveFromParent(),new t.kX(y,200,{rotation:d-130},{ease:t.Ui.outCubic}).onComplete((()=>{new t.kX(y,100,{rotation:d-150,scaleX:.5,scaleY:.5}).onCompleteRemoveFromParent()})),[300,100]},S.pickaxe=(e,i,s,o,n,r,a,l)=>{let h=Math.atan2(n-s,o-i)/Math.PI*180,d=He.world.getDistance(i,s,o,n),c=o-i>0?1:-1;He.world.entityLayer.addChild(e),t.$u.playSound("sound/swing_0.wav");let u;l.__effectTween&&(l.__effectTween.stop(),l.resetPositionAndColor());let p=i+(o-i)/d*5,g=s+(n-s)/d*5,m=l.getX(),f=l.getY();u=300;let w=new t.kX(l,100,{x:p,y:g},{ease:t.Ui.inBack}).onComplete((()=>{new t.kX(l,300,{x:m,y:f},{ease:t.Ui.inCubic})}));l.__effectTween=w;let y=new t.jy;return a.setRotation(135),a.setPosition(12,0),y.addChild(a),e.addChild(y),y.setRotation(h-200*c),y.setPosition(i,s),new t.kX(y,300,{rotation:h+5*c,x:i+2*c,y:s+5},{ease:t.Ui.inCubic}).onComplete((()=>{new t.kX(y,100,{rotation:h+5*c,y:s}).onCompleteRemoveFromParent()})),[400,300]},S.stab=(e,i,s,o,n,r,a,l)=>{let h=Math.atan2(n-s,o-i)/Math.PI*180,d=He.world.getDistance(i,s,o,n);He.world.entityLayer.addChild(e),t.$u.playSound("sound/swing_0.wav");let c,u=new t.jy;a.setRotation(135),a.setPosition(12,0),u.addChild(a),e.addChild(u),u.setRotation(h),u.setPosition(i,s);let p=i+(o-i)/d*3,g=s+(n-s)/d*3;l.__effectTween&&(l.__effectTween.stop(),l.resetPositionAndColor());let m=i+(o-i)/d*5,f=s+(n-s)/d*5,w=l.getX(),y=l.getY();c=100;let E=new t.kX(l,100,{x:m,y:f},{ease:t.Ui.inBack}).onComplete((()=>{new t.kX(l,200,{x:w,y},{ease:t.Ui.inCubic})}));return l.__effectTween=E,new t.kX(u,200,{x:p+(n==s?0:3),y:g},{ease:t.Ui.outBounce}).onComplete((()=>{new t.kX(u,100,{x:i+(n==s?0:3),y:s,rotation:h,scaleX:.5,scaleY:.5}).onCompleteRemoveFromParent()})),[300,100]},S.hand=(e,i,s,o,n,r,a,l)=>{let h=Math.atan2(n-s,o-i)/Math.PI*180,d=He.world.getDistance(i,s,o,n);He.world.entityLayer.addChild(e),t.$u.playSound("sound/swing_0.wav");let c,u=new t.jy;a.setRotation(90),a.setPosition(12,0),a.setScale(.5),u.addChild(a),e.addChild(u),u.setRotation(h),u.setPosition(i,s);let p=i+(o-i)/d*2+(n==s?0:3),g=s+(n-s)/d*2;l.__effectTween&&(l.__effectTween.stop(),l.resetPositionAndColor());let m=i+(o-i)/d*5,f=s+(n-s)/d*5,w=l.getX(),y=l.getY();c=100;let E=new t.kX(l,100,{x:m,y:f},{ease:t.Ui.inBack}).onComplete((()=>{new t.kX(l,200,{x:w,y},{ease:t.Ui.inCubic})}));return l.__effectTween=E,new t.kX(u,200,{x:p,y:g},{ease:t.Ui.inOutBack}).onComplete((()=>{new t.kX(u,100,{x:i,y:s},{ease:t.Ui.inCubic}).onCompleteRemoveFromParent()})),[300,100]},S.claw=(e,i,s,o,n,r,a,l)=>{Math.atan2(n-s,o-i),Math.PI;let h=He.world.getDistance(i,s,o,n);He.world.entityLayer.addChild(e),t.$u.playSound("sound/swing_0.wav");let d,c=new t.eY(new t.xE("Claw.png",!1,{format:t.Wc.RGBA5551}));c.setAnchorPoint(.5,.5),c.setScale(.8),c.setOverrideColor(16711680),c.setPosition(o+10,n-10),l.__effectTween&&(l.__effectTween.stop(),l.resetPositionAndColor());let u=i+(o-i)/h*7,p=s+(n-s)/h*7,g=l.getX(),m=l.getY();d=100;let f=new t.kX(l,100,{x:u,y:p},{ease:t.Ui.inOutBack}).onComplete((()=>{e.addChild(c),new t.kX(c,100,{x:o-5,y:n+5,alpha:.5},{ease:t.Ui.outCubic}).onCompleteRemoveFromParent(),new t.kX(l,200,{x:g,y:m},{ease:t.Ui.inCubic})}));return l.__effectTween=f,[300,100]},S.damage=(e,i,s,o,n,r,a,l)=>{o=null!=o?o:r.getX(),n=null!=n?n:r.getY(),i=null!=i?i:o,s=null!=s?s:n,a=null!=a?a:r,l=l||0,Math.atan2(n-s,o-i),Math.PI;He.world.getDistance(i,s,o,n);He.world.entityLayer.addChild(e),r.getX(),r.getY(),r.__effectTween&&(r.__effectTween.stop(),r.resetPositionAndColor());let h=0;return t.B7.delayedCall(l,(()=>{r.setOverrideColor(16711680),r.setScale(1.5);let e=new t.kX(r,100,{color:10485760},{ease:t.Ui.outBounce}).onChange((()=>{r.setScale(1.5+.3*Math.floor(h/2)),h=(h+1)%4})).onComplete((()=>{new t.kX(r,300-l-50,{scaleX:1,scaleY:1,color:16777215},{ease:t.Ui.inCubic})}));r.__effectTween=e})),[300,l]},S.death=(e,i,s,o,n,r,a,l)=>{o=null!=o?o:r.getX(),n=null!=n?n:r.getY(),i=null!=i?i:o,s=null!=s?s:n,a=null!=a?a:r,l=l||0;let h=Math.atan2(n-s,o-i)/Math.PI*180;He.world.getDistance(i,s,o,n),He.world.entityLayer.addChild(e);let d=r.getX(),c=r.getY(),u=t.cQ.random(10,14);h+=t.cQ.random(-5,5);let p=d+Math.cos(h/180*Math.PI)*u,g=c+Math.sin(h/180*Math.PI)*u+5;r.__effectTween&&(r.__effectTween.stop(),r.resetPositionAndColor());let m=90*Math.sign(o-i);return n-s>0&&(m=180),t.B7.delayedCall(l,(()=>{r.setOverrideColor(16711680),r.setRotation(m),r.setPosition(d,c+5),r.__animationTimer&&r.__animationTimer.stop();let e=new t.kX(r,200,{color:10485760,x:p,y:g},{ease:t.Ui.outCubic}).onComplete((()=>{new t.kX(r,1e3-l-50,{alpha:0},{ease:t.Ui.inCubic})}));r.__effectTween=e})),[1e3,l]},S.boom=(e,i,s,o,n,r,a)=>{r=r||0,He.world.entityLayer.addChild(e);let l=new t.xE("boom.png",!1,{format:t.Wc.RGBA5551}),h=new t.eY(l),d=o/(l.width/2);return h.setAnchorPoint(.5,.5),h.setOverrideColor(null!=a?a:16777215),h.setPosition(i,s),h.setBlendMode(t.jy.BlendModes.ADD),t.B7.delayedCall(r,(()=>{e.addChild(h),h.setScale(0),new t.kX(h,.6*n,{scaleX:.95*d,scaleY:.95*d,alpha:.4},{ease:t.Ui.outCircular}).onComplete((()=>{new t.kX(h,.4*n,{scaleX:d,scaleY:d,alpha:0},{ease:t.Ui.outCubic})}))})),[n,r]},S.breakProp=(e,i,s,o,n,r,a,l)=>{o=null!=o?o:r.getX(),n=null!=n?n:r.getY(),i=null!=i?i:o,s=null!=s?s:n,a=null!=a?a:r,l=l||0;let h=Math.atan2(n-s,o-i)/Math.PI*180;He.world.getDistance(i,s,o,n),He.world.entityLayer.addChild(e);let d=r.getX(),c=r.getY();t.cQ.random(10,14);h+=t.cQ.random(-2,2),Math.cos(h/180*Math.PI),Math.sin(h/180*Math.PI);let u=10*Math.cos(h/180*Math.PI),p=10*Math.sin(h/180*Math.PI);r.__effectTween&&(r.__effectTween.stop(),r.resetPositionAndColor());let g=[];0!=r.property.slice&&([g[0],g[1],g[2],g[3]]=r.mesh.sliceMesh());for(let e=0;e<(null!=r.property.particle?r.property.particle:4);e++){let[e,i]=r.mesh.getColRow();g.push(r.mesh.clone(t.cQ.random(13,16),i))}let m=[];for(let e=0;e<g.length;e++){let i=t.cQ.random(200,300),s=t.cQ.random(10,40),o=t.cQ.random(-14,-2),n=t.cQ.random(4,7);m.push([0,i,g[e],{x:[0,t.cQ.random(-15-3*u,15),"outCubic"]}]),m.push([0,s,g[e],{y:[0,o,"outCubic"]}]),m.push([s+1,3*s,g[e],{y:[o,n,"outBounce"]}]),m.push([0,2*s,g[e],{rotation:[0,t.cQ.random(-720,720),"outCubic"]}])}return t.B7.delayedCall(l,(()=>{let i=new t.KG(m);e.addChild(i),i.setPosition(d,c),r.setVisible(!1),r.__animationTimer&&r.__animationTimer.stop();let s=new t.kX(i,300,{x:d+u,y:c+p,scaleX:.9,scaleY:.9},{ease:t.Ui.linear}).onComplete((()=>{new t.kX(i,2e3-l-50,{scaleX:1,scaleY:1,alpha:0},{ease:t.Ui.inCubic})}));r.__effectTween=s})),[2e3,l]},S.hitProp=(e,i,s,o,n,r,a,l)=>{o=null!=o?o:r.getX(),n=null!=n?n:r.getY(),i=null!=i?i:o,s=null!=s?s:n,a=null!=a?a:r,l=l||0,Math.atan2(n-s,o-i),Math.PI;let h=He.world.getDistance(i,s,o,n);He.world.entityLayer.addChild(e);let d=r.getX(),c=(r.getY(),d+(o-i)/h*0);r.__effectTween&&(r.__effectTween.stop(),r.resetPositionAndColor());let u=0;return t.B7.delayedCall(l,(()=>{r.setOverrideColor(8421504);let e=new t.kX(r,100,{color:16777215},{ease:t.Ui.outBounce}).onChange((()=>{r.setX(c+4*Math.floor(u)-2),u=(u+.5)%2})).onComplete((()=>{r.setX(c),new t.kX(r,300-l-50,{color:16777215},{ease:t.Ui.inCubic})}));r.__effectTween=e})),[300,l]};class D extends t.jy{constructor(){super(),this.elementalsByXy=[],this.layers={[D.FIRE]:new t.jy,[D.WATER]:new t.jy,[D.POISON]:new t.jy}}addElemental(i,s,o,n,r,a){this.elementalsByXy[s+","+o]&&this.removeElemental(s,o),r=null!=r?r:s,a=null!=a?a:o;const l=new e(new t.xE("elemental.png",!1,{format:t.Wc.RGBA5551}),D.data[i].col,D.data[i].row,16,24,D.data[i].color);if(l.setShader(He.world.floorTileMap._shader),l.setBlendMode(D.data[i].blend),l.tileX=s,l.tileY=o,l.type=i,l.life=n,l.newLife=n,r){const e=t.cQ.clamp(n/2,.5,1);if(l.type==D.WATER)l.setAlpha(0),l.position=He.world.tileCenterToWorld(s,o),new t.kX(l,300,{alpha:e});else if(l.type==D.POISON){l.setAlpha(0);const{x:i,y:n}=He.world.tileCenterToWorld(s,o);l.position=He.world.tileCenterToWorld(r,a),new t.kX(l,1e3,{alpha:e,x:i,y:n},{ease:t.Ui.outCubic})}else{l.setAlpha(0);const{x:i,y:n}=He.world.tileCenterToWorld(s,o);l.position=He.world.tileCenterToWorld(r,a),new t.kX(l,600,{alpha:e,x:i,y:n},{ease:t.Ui.inOutCubic})}}else l.position=He.world.tileCenterToWorld(s,o);this.layers[i].addChild(l),this.elementalsByXy[s+","+o]=l}removeElemental(t,e){let i;return"number"==typeof t?(i=this.elementalsByXy[t+","+e],i.removeFromParent(),delete this.elementalsByXy[t+","+e]):(i=t,i.removeFromParent(),delete this.elementalsByXy[i.tileX+","+i.tileY]),i}getElemental(t,e){return this.elementalsByXy[t+","+e]}process(){const e=[];for(const i in this.elementalsByXy){const s=this.elementalsByXy[i];if(s.life=s.newLife,s.type==D.POISON){const e=t.cQ.clamp(s.life/2,.4,1);s.setScale(1.5*e),s.setAlpha(.9*e)}else if(s.type==D.FIRE){const e=t.cQ.clamp(s.life/2+.7,.8,1);s.setAlpha(e)}else s.setAlpha(t.cQ.clamp(s.life/2,.4,1));e.push(s)}for(const t in e){const i=e[t],s=this.getElemental(i.tileX-1,i.tileY),o=this.getElemental(i.tileX+1,i.tileY),n=this.getElemental(i.tileX,i.tileY-1),r=this.getElemental(i.tileX,i.tileY+1);if(i.type==D.FIRE?(s&&s.type==D.WATER||o&&o.type==D.WATER||n&&n.type==D.WATER||r&&r.type==D.WATER)&&this.removeElemental(i):i.type==D.POISON&&(s&&s.type==D.FIRE||o&&o.type==D.FIRE||n&&n.type==D.FIRE||r&&r.type==D.FIRE)&&this.removeElemental(i),i.getParent()){const t=He.world.getProperty(i.tileX-1,i.tileY).wall&v.BLOCK_PASS,e=He.world.getProperty(i.tileX+1,i.tileY).wall&v.BLOCK_PASS,a=He.world.getProperty(i.tileX,i.tileY-1).wall&v.BLOCK_PASS,l=He.world.getProperty(i.tileX,i.tileY+1).wall&v.BLOCK_PASS;console.assert(1==v.BLOCK_PASS);let[h,d,c,u]=[0,0,0,0];if(i.life>0&&i.life<=1)i.newLife=He.world.random(0,1)*i.life*.5;else{h=s&&s.type==i.type?s.life:0,d=o&&o.type==i.type?o.life:0,c=n&&n.type==i.type?n.life:0,u=r&&r.type==i.type?r.life:0;const p=(Math.max(d,Math.max(h,Math.max(c,u)))+i.life)/2.2;i.newLife=p,p>.5&&(0!=t||s||this.addElemental(i.type,i.tileX-1,i.tileY,0,i.tileX,i.tileY),0!=e||o||this.addElemental(i.type,i.tileX+1,i.tileY,0,i.tileX,i.tileY),0!=a||n||this.addElemental(i.type,i.tileX,i.tileY-1,0,i.tileX,i.tileY),0!=l||r||this.addElemental(i.type,i.tileX,i.tileY+1,0,i.tileX,i.tileY))}if(i.newLife<=0&&this.removeElemental(i),i.type==D.WATER){const t=He.world.getItems(i.tileX,i.tileY);t&&this.moveItemOnWater(t,i,h,d,c,u)}else if(i.type==D.POISON){const t=He.world.getEntity(i.tileX,i.tileY);t&&t.addBuff(E.POISON,3)}else if(i.type==D.FIRE){const t=He.world.getEntity(i.tileX,i.tileY);t&&t.addBuff(E.FIRE,3)}}}}moveItemOnWater(t,e,i,s,o,n){const r=[];if(e.life>=i&&i>0&&r.push([-1,0]),e.life>=s&&s>0&&r.push([1,0]),e.life>=o&&o>0&&r.push([0,-1]),e.life>=n&&n>0&&r.push([0,1]),r.length>0){const i=t[He.world.random(t.length)],[s,o]=(i.tileX,i.tileY,r[He.world.random(r.length)]),[n,a]=[e.tileX+s,e.tileY+o];i.move(n,a),He.world.addLog("%s{Í∞Ä} Î¨ºÏóê Îñ†ÎÇ¥Î†§Í∞îÎã§!",i.name)}}}D.POISON=1,D.FIRE=2,D.WATER=3,D.data={[D.POISON]:{col:1,row:4,color:4194432,blend:t.jy.ALPHA},[D.WATER]:{col:9,row:4,color:12543,blend:t.jy.ALPHA},[D.FIRE]:{col:5,row:4,color:12582912,blend:t.jy.ADD}};const G={A:0,B:2,C:-9,D:-7,E:-5,F:-4,G:-2};function L(t){const[e,i,s,o]=/([a-z])([#-]?)(\d)/i.exec(t);return"N"==i?parseInt(o)-13:12*(parseInt(o)-4)+G[i]+("#"==s?1:0)+("-"==s?-1:0)}function I(t){return 440*1.0594630943592953**L(t)}function R(t){const e=[],i=[];let s=120,o=4,n=4,r=15,a=0,l=0,h=!1;do{const d=/^(&*)([a-z<>])([^a-z<>]*)[&a-z<>]/i.exec(t.substr(l));let c,u,p,g;if(null==d?([c,u,p,g]=/^(&*)([a-z<>])([^a-z<>]*)/i.exec(t.substr(l)),h=!0):[c,u,p,g]=d,l=l+c.length-1,"O"==p)o=parseFloat(g);else if("T"==p)s=parseFloat(g),i.push([a,s]);else if("V"==p)r=parseFloat(g);else if("R"==p){let t;if(/\d+/.test(g)){const[e]=g.match(/\d+/);t=parseFloat(e)}else t=n;/\./.test(g)&&(t/=1.5),e.push([a,0,0]),a+=240/t}else if("L"==p)n=parseFloat(g),/\./.test(g)&&(n/=1.5);else if(">"==p)o=Math.max(0,o+1);else if("<"==p)o=Math.max(0,o-1);else if(/[A-GN]/.test(p)){let t,i;if(/[+#-]/.test(g)){const[e]=g.match(/[+#-]/);"#"==e||"+"==e?t=p+"#"+o:"-"==e&&(t=p+"-"+o)}else t=p+o;if(/\d+/.test(g)){const[t]=g.match(/\d+/);i=parseFloat(t)}else i=n;/\./.test(g)&&(i/=1.5);const s=""!=u,l=I(t);e.push([a,l,r,s]),a+=240/i}}while(!h);return e.push([a,0,0]),[e,i]}function k(t){console.assert(/MML@([\s\S]*);/m.test(t),"Can't found MML tag.");let[e,i]=/MML@([\s\S]*);/m.exec(t),s=[];const o=[];i&&(i=i.toUpperCase(),i=i.replace(/\s/g,""),s=i.split(","));const n=[];for(const t in s){const e=s[t];let i;[o[t],i]=R.call(this,e);for(const t in i){const e=i[t];n.push(e)}}n.sort(((t,e)=>t[0]-e[0]));for(let t=n.length-1;t>1;t--)n[t]==n[t-1]&&n.splice(t,1);return[o,n]}function O(){let e,i,s=Number.POSITIVE_INFINITY;this.tempoPosition<this.tempos.length&&this.tempos[this.tempoPosition][0]<=this.time&&(this.tempo=this.tempos[this.tempoPosition][1],this.tempoPosition=this.tempoPosition+1,this.tempoPosition<this.tempos.length&&(s=Math.min(s,this.tempos[this.tempoPosition][0])));for(const t in this.channels){const e=this.channels[t];if(this.positions[t]<e.length){const[o,n,r,a]=e[this.positions[t]];if(o<=this.time){const e=this.sound[t];n>0?(e.setVolume(Math.pow(Math.min(1,r/15),2)*this.volume),e.setPitch(n/440*this.pitchMod),a?(e.setPause(!0),e.setPause(!1)):(e.stop(),e.play(),i=!0)):e&&(e.stop(),this.sc[t]=null),this.positions[t]=this.positions[t]+1}this.positions[t]<e.length&&(s=Math.min(s,e[this.positions[t]][0]))}}if(s<Number.POSITIVE_INFINITY){let o=t.cQ.clamp(t.B7.now()-this.ms,-100,100);if(0==this.time&&(o=0),e=(s-this.time)/this.tempo*1e3/this.speed,this.timer=t.B7.delayedCall(e-.5*o,O,this),this.time=s,this.ms=t.B7.now()+e,i){const i=new t.ju("note",{duration:e});this.dispatchEvent(i)}}else{console.log("End of song"),this.stop();const e=new t.ju("complete");this.dispatchEvent(e)}}class X extends t.pB{constructor(e,i){super(),this.instrument=i,this.channels=void 0,this.tempos=void 0,[this.channels,this.tempos]=k.call(this,e),this.positions=[],this.tempoPosition=0,this.tempo=120,this.sound=[],this.sc=[],this.speed=1,this.pitchMod=1,this.volume=1,console.log(this.channels);for(const e in this.channels)this.positions[e]=0,this.sound[e]="object"==typeof i?new t.$u(i[e]):new t.$u(i)}setSpeed(t){this.speed=t}setPitch(t){this.pitchMod=t}play(){this.time=0,this.ms=t.B7.now(),console.log("Begin song"),O.call(this)}stop(){this.timer&&(this.timer.stop(),this.timer=null);for(const t in this.channels)this.sc[t]&&(this.sc[t].stop(),this.sc[t]=null)}setVolume(t){this.volume=t}}const W=16753920,Y=16776960,N=i(962);class U extends h{constructor(t,e,i,s){super(t,e,i,s),this.isItem=!0,this.fillProperties(U.property,t),this.props=this.addComponent(new N.Props(U.property,t)),this.controller=this.addComponent(new N.WorldEntity(He.world,this.props));const o=this.property;this.name=o.name||t,this.rarity=this.options.rarity||this.property.rarity||0,this.color=null!=this.options.color?this.options.color:U.rarityColor[this.rarity],this.texture=this.options.filtering?U.textureFiltered:U.texture,this.tileWidth=U.tileWidth,this.tileHeight=U.tileHeight,this.postInit(U)}showDrop(){this.movieClip.gotoAndPlay("drop"),this.property.dropSoundImm?this.property.dropSound?t.$u.playSound("sound/"+this.property.dropSound):t.$u.playSound("sound/drop_default.wav"):(t.$u.playSound("sound/drop_spin.wav"),this.property.dropSound?t.B7.delayedCall(900,(()=>{this.getParent()&&t.$u.playSound("sound/"+this.property.dropSound)})):t.B7.delayedCall(900,(()=>{this.getParent()&&t.$u.playSound("sound/drop_default.wav")})))}setTileXy(t,e){this.lastTileX!=this.tileX&&this.lastTileY!=this.tileY&&([this.lastTileX,this.lastTileY]=[this.tileX,this.tileY]),this.addedToWorld?(this.tileX,this.tileY,He.world.entityManager.removeEntity(this),this.tileX=t,this.tileY=e,He.world.entityManager.addEntity(this)):[this.tileX,this.tileY]=[t,e]}getIcon(t,e){return new U(this.__key,{filtering:t,flip:e})}getTypeIcon(){const t=this.property.type||"etc",[i,s]=U.typeToIcon[t];return new e(U.textureEquipSlot,i,s,16,16)}drop(t,e){this.equipped=!1;const{x:i,y:s}=He.world.tileCenterToWorld(t,e);this.setPosition(i,s),this.tileX=t,this.tileY=e,He.world.entityManager.addEntity(this),this.showDrop()}isEquippable(){const t=this.property.type;return!!(U.typeEquipMax[t]&&U.typeEquipMax[t]>0)&&U.typeEquipMax[t]}isRanged(){return"ranged"==this.property.type}equip(){console.log("Ïû•ÎπÑÏû•Ï∞©",this.name),this.equipped=!0}unequip(){console.log("Ïû•ÎπÑÌï¥Ï†ú",this.name),this.equipped=!1}getInventorySprite(){const e=new t.jy,i=new t.eY(new t.xE("itemPanel.png",!1,{format:t.Wc.RGBA5551}));i.setAnchorPoint(.5,.5);const s=this.getIcon();s.setPosition(-44,1),i.addChild(s),i.setOverrideColor(this.color);const o=He.interface.getHiresTextWrap(this.name);if(o.setPosition(-31,-7),o.setTextColor(this.color),e.addChild(i),e.addChild(o),this.isEquippable())e.updateEquip=()=>{e.equipIcon&&e.equipIcon.removeFromParent();const i=new t.eY(new t.xE("itemTypeBack.png",!1,{format:t.Wc.RGBA5551}));i.setAnchorPoint(.5,.5),i.setPosition(44,0),this.equipped?i.setOverrideColor(16777215):i.setOverrideColor(2105376);const s=this.getTypeIcon();s.setOverrideColor(0),i.addChild(s),e.addChild(i),e.equipIcon=i},e.updateEquip();else{const t=this.getTypeIcon();t.setOverrideColor(2105376),t.setPosition(44,0),e.addChild(t)}return e}static parseDamageString(t){let[,e,i]=/([^/]+)\/?(.*)/.exec(t);function s(t){let[,e,i,s,o]=/(\d+)~?(\d*)([A-E]?)([+-]*)/.exec(t);s=s?{A:3,B:2,C:1.75,D:1.5,E:1.25}[s.toUpperCase()]:1;const n={"+++":1,"++":.75,"+":.6,"//-":0,"//":.25,"-":.4};return o=null!=n[o]?n[o]:.5,[parseFloat(e),""==i?e:parseFloat(i),s,o]}i=""==i?e:i;const[o,n,r,a]=s(e);return[o,n,r,a,...s(i)]}calculateDamage(){const[t,e,i,s,o,n,r,a]=U.parseDamageString(this.property.attack);return He.world.randomGenerator.getDamage(i,s,t,e)}}U.property={Î°±ÏÜåÎìú:{image:[1,1],type:"melee",attack:"4~8B/4~9C"},Î∏åÎ°úÎìúÏÜåÎìú:{image:[2,1],type:"melee",attack:"4~9C/4~9B"},ÎèÑÎÅº:{image:[3,1],type:"melee",attack:"3~10E/3~10D"},ÌÅ¨Î°úÏö∞Î∞î:{image:[4,1],type:"melee",attack:"2~6"},ÏàèÏÜåÎìú:{image:[5,1],type:"melee",attack:"3~6B"},ÏôÑÎìú:{image:[6,1],type:"melee",attack:"2~5"},ÏôÑÎìú2:{image:[7,1],type:"melee",attack:"2~5"},Ï†ÑÌà¨ÎèÑÎÅº:{image:[8,1],type:"melee",attack:"3~11E/3~11D"},ÏÜêÎèÑÎÅº:{image:[10,1],type:"melee",attack:"3~11E/3~10D"},Î™ΩÎë•Ïù¥:{image:[11,1],type:"melee",attack:"2~8/2~7"},ÎßùÏπò:{image:[12,1],type:"melee",attack:"2~9/1~10"},ÎÇòÏù¥ÌîÑ:{image:[13,1],type:"melee",anim:"stab",attack:"3~7C",desc:"Îëê Îºò Ï†ïÎèÑ Í∏∏Ïù¥Ïùò Ïπº. ÌÑ±Ïù¥ÎÇò ÏòÜÍµ¨Î¶¨ Îì±Ïùò Ï†ÅÏùò Í∏âÏÜåÎ•º Ï∞åÎ•¥Í∏∞ Ï¢ãÎèÑÎ°ù ÎêòÏñ¥ÏûàÎã§."},ÏÇºÏßÄÏ∞Ω:{image:[14,1],type:"melee",anim:"stab",attack:"3~9C/2~10B"},ÎåÄÌòïÎßùÏπò:{image:[15,1],type:"melee",attack:"3~9/2~10"},ÏÜêÏóêÎÅºÎäî:{image:[16,1],type:"melee",anim:"hand",attack:"1~6"},ÏôÑÎìú3:{image:[17,1],type:"melee",attack:"2~5"},ÏàèÎ≥¥Ïö∞:{image:[18,1],type:"ranged",attack:"2~7D/1~7C",desc:"ÎÇòÎ¨¥ÏôÄ ÌôúÏãúÏúÑÏùò ÌÉÑÏÑ±ÏùÑ Ïù¥Ïö©Ìï¥ Î©ÄÎ¶¨ ÏûàÎäî Ï†ÅÏùÑ ÎßûÏ∂îÎäî Î¨¥Í∏∞. ÏÑúÏÑú Îπ†Î•¥Í≤å Ïè† Ïàò ÏûàÏùÑ Ï†ïÎèÑÏùò Ï†ÅÎãπÌïú ÌÅ¨Í∏∞Ïùò ÌôúÏù¥Îã§."},Ïã≠ÏûêÍ∂Å:{image:[19,1],type:"ranged",attack:"2~7C/1~6B"},ÏôÑÎìú4:{image:[2,2],type:"melee",attack:"2~5"},Ìó¨Î≤ÑÎìú:{image:[4,2],type:"melee",attack:"1~11C/2~12B"},ÏßÄÌå°Ïù¥2:{image:[5,2],type:"melee",attack:"1~8"},ÏÉàÏ¥ù:{image:[6,2],type:"ranged",attack:"1~4"},Ï∞Ω:{image:[7,2],type:"melee",anim:"stab",attack:"2~10C/2~10C"},Ï∞Ω2:{image:[8,2],type:"melee",anim:"stab",attack:"2~10C/3~11C"},Î†åÏä§:{image:[9,2],type:"melee",anim:"stab",attack:"4~10D/5~11C"},ÏãúÎØ∏ÌÑ∞:{image:[10,2],type:"melee",attack:"5~8B"},ÌåîÏãúÏò®:{image:[11,2],type:"melee",attack:"4~9B"},Î™®ÎãùÏä§ÌÉÄ:{image:[12,2],type:"melee",attack:"2~9"},Ï≤†Ìá¥:{image:[13,2],type:"melee",attack:"3~9"},Ï±ÑÏ∞ç:{image:[14,2],type:"melee",attack:"1~10/1~12"},ÌîÑÎ†àÏùº:{image:[15,2],type:"melee",attack:"1~11/2~13"},ÎåÄÌòïÌëúÏ∞Ω:{image:[16,2],type:"melee",attack:"1~5E/1~4D"},ÌëúÏ∞Ω:{image:[17,2],type:"melee",attack:"1~4E/1~3"},Î∂ÄÎ©îÎûë:{image:[18,2],type:"melee",attack:"1~6/1~5"},ÏßÄÌå°Ïù¥:{image:[19,2],type:"melee",attack:"1~8"},Îß®ÏÜê:{image:[5,3],type:"hand",anim:"hand",attack:"1~2/1"},Ï±ÑÍ¥ëÏÇΩ:{image:[16,5],type:"pickaxe",anim:"pickaxe",hitSound:"pickaxe_0.wav"},Í≥°Í¥≠Ïù¥:{image:[20,5],type:"pickaxe",anim:"pickaxe",hitSound:"pickaxe_0.wav",desc:"Í¥ëÏÑùÏùÑ Î∂ÄÏà¥ÏÑú Ï∫êÎÇº Ïàò ÏûàÎèÑÎ°ù ÎßåÎì§Ïñ¥ÏßÑ ÎèÑÍµ¨. Ïù¥Í≤ÉÏù¥ ÏûàÏúºÎ©¥ Í¥ëÎ¨ºÏùÑ Îπ®Î¶¨ Ï∫ò Ïàò ÏûàÎã§."},ÎßåÎèåÎ¶∞:{image:[1,15],type:"instrument",desc:"ÏùåÏú†ÏãúÏù∏Îì§Ïù¥ ÎßéÏù¥ ÏÇ¨Ïö©ÌïòÎäî ÏÜåÌòïÏùò ÏïÖÍ∏∞Ïù¥Îã§. Ïö∏Î¶ºÌÜµÏù¥ Îë•Í∏ÄÍ≥† 8Ï§ÑÏùò ÌòÑÏùÑ Í∞ÄÏ°åÎã§.",instrument:"sound/mml_mandolin-a4.wav"},ÌïòÌîÑ:{image:[1,15],type:"instrument",desc:"ÏºàÌã± ÌïòÌîÑ, Ïù¥ÎØ∏ÏßÄÎäî ÏóÜÏñ¥ÏÑú ÏùºÎã® ÎßåÎèåÎ¶∞Ï≤òÎüº ÏÉùÍ∏¥Í±∏Î°ú ÌïòÏûê.",instrument:"sound/mml_celtic-harp-a4.wav"},Î†àÌä∏Î°úMSX:{image:[1,15],type:"instrument",desc:"8Bit FM ÏÇ¨Ïö¥ÎìúÍ∞Ä ÎÇòÎäî Ïã†Î¨òÌïú ÏïÖÍ∏∞",instrument:"sound/mml_retro-a4.wav"},Î†àÌä∏Î°úAPPLE:{image:[1,15],type:"instrument",desc:"APPLE ][Ïùò ÏÇ¨Ïö¥ÎìúÍ∞Ä Ïó∞ÏÉÅÎêòÎäî ÏïÖÍ∏∞",instrument:"sound/mml_retro-apple-a4.wav"},ÏïÖÎ≥¥1:{image:[2,15],type:"note",name:'ÏïÖÎ≥¥ "ÏïÑÏ∂î"',desc:"Ïû¨Ï±ÑÍ∏∞ÏôÄ ÏßùÏÇ¨ÎûëÏùÄ Ïà®Í∏∏ Ïàò ÏóÜÎã§Îäî ÎÇ¥Ïö©Ïùò Í∞ÄÏÇ¨Í∞Ä Îã¥Í∏¥ ÎÖ∏ÎûòÏùò ÏïÖÎ≥¥",mml:"\n\t\t\tMML@t128v15>>L4F2E2D.L8C16<B-16>C<B-AGG>C<F2ECD2<CDDD16E16v14o1G>GL16>EFGArGD<B-GD<B-GL8>C2C#2rA>DEFA>C4L16rv15FG>C<FG>L32C.<C.FG>CFG>C<CFG>CFG>C2&C8&C&C2L8ro4FF4v14o1B-4>B-<B-B->B-rC4.>C<CrCB-4<A4>A<AA4>A4D4>D<DrD>D4<<B-4>B-<B-B->B-rC4.>C<CrC>C4<C#4>C#<C#C#4>C#<D4>D4<AD>D<D4<B4>B<BB4>B4<B-4>B-<B-B-4>B-4<A4>A<AA4>A4D4>D<DD4>D4<<G>G<GA4A>A4<B->B-<B-B4B>B4C4>C<GCG>C<Cr>C<C4r4>C<C<B-4B-4>C4C4D-4D-A->E-4<E-.<A-.>A-<A-4A->A-<A-4A->A-<A-4A->A-<A-4G>G<G4G>G<G>C4>C<C>C<C>C<C>C<F>F<F>F<F>F<FE-4>E-<E->E-<E->E-<E-D4>D<DF#4>F#<F#G4>G<G-4F4<B-.A-.>A-<A-4A->A-<A-4A->A-<A-4A->A-<A-4G>G<G4G>G<G>C4>C<C>C<C>C<C>C<F>F<F>F<F>F<FE-4>E-<E->E-<E->E-<E-D4>D<DF#4>F#<F#F4>F<B->B-C4<B4v15o5C#4C#>C#4<<EEEED#D#>C#C#<BBA#16B.&BB>B<BA#B>C#DDC#C#16<G#.GG#>C#16<B.A4rAG#AB16>C#.&C#r4.C#D#E4EEED#<A#>D#C#4<BB4A#4B.>C#.&C#<G#.G#16rEEEED#D#>C#C#<BBA#16B.&BB.B16BA#B>C#DDC#C#16<G#.GG#>C#16<B.AA.A16AG#AB16>C#.&C#rC#C#C#D#E4EEED#<A#>D#C#4<BB4B4B4t76L16>>C#.<C#.F#B.<B.>EA.<A.>EL32o3rF#A>>CG#2.&G#&G#16.o2E.B.>EF#.G#16&G#64&G#2.&G#2.,\n\t\t\tv14>B-2G2F.r.rCr2<GF2r2v15F2E2D2E.E16F16G2F.E8C1.&&C2L8rCC4rEEFF4rEF4A4E4F4r4GFFEEDDCC4G4F4rEEFF4rEF4A4E4F4rB-B-B-B-AAGGFF4EEF4A4A.A16AGF16G16G4rEEEG>DC4.C.C16C<B-AG4AF4.AAAF4.G4.rF16G16AGFG4A4B-4.r4AGFG4.r2.F4E4F4G4A-4G4A-4B-.>C.&C<G.G16rE-E-E-E-DD>CC<B-B-A16B-.&B-B-.B-16B-AB->CD-D-CC16<G.F#G>C16<B-.A-A-.A-16A-GA-B-16>C.&C<A-.A-16r>CDE-4E-E-E-D<A>DC4<B-B-4A-4B-.>C.&C<G.G16rE-E-E-E-DD>CC<B-B-A16B-.&B-B-.B-16B-AB->CD-D-CC16<G.F#G>C16<B-.A-A-.A-16A-GA-B-16>C.&CrCCCDE-4E-E-E-D<A>DC4<B-B-2B.>C#16v14L4o2A1A1G#1>C#<C#C#C#8>C#16<F#8.F#F#F#8F#8EEEE8E8D#>L8D#<D#G4>G<GG#4>G#<G4F#4<B.A.>A<A4A>A<A4A>A<A4A>A<A4G#>G#<G#4G#>G#<G#>C#4>C#<C#>C#<C#>C#<C#>C#<F#>F#<F#>F#<F#>F#<F#E4>E<E>E<E>E<ED#4>D#<D#G4>G<GF#4F#F#4BF#<B4L16>>A.>E.A<G#.>E.F#<F#.>C#.E<<B1L32r8r.r.>>Et54<B>G#B>E>E1&E4.,\n\t\t\tv14<B-1C1<A2>F2<B->F8B-.&B-B-2B-2F2A2<D1&D1&D1L8rDD4>>rC2.CrC4CC4C4rC2.ArB-4AD4C4rC2.CrC4CC4C4rE2.DD4C4C2F2rD4E4.G.G16r>D4<G4.G4r>CCF4.F.F16rFEC<D4.E2rD4.D2rF4.F4DD<B-r1L4B-B-B-B->D-D-D-L8D-.E-.&E-C4rGGF4.F.F.rF.F.&FF.F.FFF4.E4F4E.E-.&E-C4rCCC4.E-4rA-GF#2L4ArF.G-E-L8F.G.&GC4rCC<B-4.>F.F.rF.F.&FF4rFFF4.E4D-4E.E-.&E-C.C.E-E-E-4.A-.A-.A-GF#2A4r4L4E-.FGrE.>G#r.<<B.r.rB.>>F#.r<F#FD#F8.E2&E16L8rEEE2r4AG#G2A#4r4F#4.G4E4F#.G#.&G#C#4rG#G#F#4.r2F#.F#2.r.F#4.F4D#4F.E.&EE4.EEE4.A4.AG#G2A#4r4A4EE4F#4F#4;\n\t\t\t"},ÏïÖÎ≥¥2:{image:[2,15],type:"note",name:'ÏïÖÎ≥¥ "Îç∞Ïä§Ìã∞Îãà"',desc:"ÏóêÎ¶∞ÏùÑ Î∞îÎùºÎ≥¥Í∏∞ÎßåÌïòÎäî Ïù¥Ïõ®Ïπ¥Ïùò ÏïàÌÉÄÍπåÏõÄÏù¥ Îã¥Í∏¥ ÎÖ∏ÎûòÏùò ÏïÖÎ≥¥",mml:"\n\t\t\tMML@t106v15L8r16G#.ABB>C16C.&C<E.F#.&F#A.B.>D<B.BB16B16B16BAAG16GF#.r.D#16AGGA16B.G#ABB>C16C.&Cr16E.DCC<B16B.&BF#E16EB16B16B16BA16A.GGF#AG16G16E2>F#.E.<B>G.F#.&F#A.G.<A16>e16F.E.<A>F.E.<A>G.F.&F<G32>C#32E32A4.&A32r<FFF16F.<AB->CC<B-16>F.&FrB-.B-16D16E16FFFF16F.GEDDE16C.&CrG.A.FDDE16F.DEFDA16A.&ArF.A16F16G16AAAA16A.B-GF16G.&Gr4A4>E4F<FFF16F.<AB->CC<B-16>F.&F>C<A.B-16D16E16FFFF16F.EFG16A2&A16rAB-F#o1B>B<B>B<B->B-<B->B-<A>A<A>AD>D<D>D<G#>G#<G#>G#<A>A<A>A<D4>D<D4A>D<DG.>D16G4<CG>C<CF.>C16F<F<B->FB-<B-B.B16r4B.>BB.E>E<F#>F#<G#>G#<E4o4B>C16C.&Cr<F#GAAB16B.&Br4r16B16B16B16BAAG16GF#.r.D#16AGGA16B.G#ABB>C16C.&Cr16E.DCC<B16B.&Br4r16B16B16B16BA16A.GGF#AG16G16o2E>E<E>E<D>D<D>D<C>C<C>C<<B>B<B>BD>D<D>D<C>C<C>C<B->B-<B->B-<A2L32DA1.r4.r16.,\n\t\t\tv14r16L8D.DEG#.G.&GC.C.&CF#.F#.rG.G.&GE4E4D#4F#4r16E.ED#D4D4<<A.>AE16<AD.>D.<DG.>GD16<GCG>C<CF#4>F#<F#<B.>B.<B>E>E<E>E<D>D<D>D<C>C<C>C<<B>B<B>BD>D<D>D<C>C<C>C<<B->B-<B->B-<A2>D4>D4<DA>D4<G4>G.D16<G>DG<GC4>C.<G16C4>C4<F4>F.C16<F>CF4<<B-4>B-4<B->FB-<B-B4>B4<BB>B4C4>C.<G16C4>C4<C#4>C#.<A16C#A>C#<C#D4>D4<DA>D4<G4>G..D16<G>DG<GC4>C.<G16C4>C4<E-4>E-.<E-16DD>D<D>>v15A.G.GrGAEG.F.F4.DEFF16E.EFEGF16F16D2rAB-F#A.G.GrGAEG.F.F4FGFE.E.ED#.B.AAG#G#A16BG#.ABo1A4>A4DA>D<DG4>G<GCG>C<CF#4>F#4<<B4>B4E16>E<E16>E<F#G#>EG#<G#<A4>A4DA>D<DF4>F<FEB>E<E<A.>E16A4<B>F#B<Bo5F#.E.<B>F#.E.<B>G.F#.&F#A.G.<A16>E16F.E.<A>F.E.<A>G.F.&FL32rC#EA4.&Arr<<F#A>CE1&E4.r4.rrr,\n\t\t\tv14r16<L8E.F#G#<A2>D4.<F#G2>C2<F#4.AB2r16E.EF#G#.>E.&E>L4EGF#AAGL8<AG16G.&G>E.E<A.>E4D#4>F#.E.<BB.B.GB.B.&B>D#.D#.r<A.A.rA.A.rA.A.&Ar2<A.>C4r.F.A.B-.D16r4.F.F.<B-.B-16r4.>D.<B-.>C2rC.E.C.<A16r4.>A4.F2rD.D.F.C16r4.G.F.B-.C16r4E4A4A4r4.>C.<A.B-2rF.F.D2r<B-.>E-.F.D-16r4F#4C4>A.G.&GA.B-.&B->C.<F.&FE.F.&FF.E.&EF.E.&ED.<A.A.B-.><F4L2DDE-D<AB>E<B4>E4L8E-.G.CE-.E-.CE.F#.>D<B4E4E.CC.<B.>D.rE16>E.ED#D<E.G.D.G.CF#.F#.DA.F.AA.G#.&G#E4ECD#<B.B.L2>GGBAAAAG;\n\t\t\t"},ÏïÖÎ≥¥3:{image:[2,15],type:"note",name:'ÏïÖÎ≥¥ "ÏïàÎÖï"',desc:"Ïñ∏Ï†úÎÇò ÎÑàÏùò Îí§ÏóêÏÑú Î™∞Îûò Î∞îÎùºÎ¥§Îã§Îäî ÎÖ∏ÎûòÏùò ÏïÖÎ≥¥",mml:"\n\t\t\tMML@t90t125>L4GFL8E-.G.C4.>C4.<FGA-2&A->C2<C4.<B16>C16DCDE-4.GF4.CD4.FE-4G4A-2&A-A-GE-<B-2&B-r<B-L16>E-FGB-v13L8o1A-rA->A-<A->A-<A->A-<B->B-<B->B-<B->B-<B-A-G>G<G>G<G>G<G>GC>C<C>C<C>C<C<B-A->A-<A->A-<A->A-<A->A-<B->B-<B->B-<B->B-<B->B-C>C<C>C<C>C<C>C<<G>G<G>G<G>G<G>G<A->A-<A->A-<A->A-<A->A-<B->B-<B->B-<B->B-<B-A-G>G<G>G<G>G<G>GC>C<C>C<C>C<C<B-A->A-<A->A-<A->A-<A->A-<B->B-<B->B-<B->B-<B->B-C>C<C>C<C>C<C>C<<G>G<G>G<G>G<G>G<A-4A-4A->A-GF4.F4FCFC4.C4C4C4<B-4.>CrC>C4<F4F>F<F>F<F4<B->B-<B->B-<B->B-<B-4>E>E<E>E<E>E<EA4A<A>A<AB>C+<A>D4D<B4>B<B>C4.C<A4>A<AG4>G<G>G<G>G<G>C4>C<C>C<C>C<C>C<F4F>F<F>F<F4<B->B-<B->B-<B->B-<B-4>E>E<E>E<E>E<EA4A<A>A<AB>C+<A>D4D<B4>B<B>C4.C<A4>A<AG4>G<G>G<G>G<G>C4>C<C>C<C>C<C>C<<B->B-<B->B-<B->B-16<B-.>B-<B->B-<B->FB-4<B-4A>A<A>A<A>A16<A.>A<A->A-<A->FA-4<A-4G>G<GA4>A<AB-4>B<B-B4>B<B>C4.>C<C>C<C>C<C4.r2.o5v14F4ACACAB-2&B-B-4.E4<G>EB-2D4<A>D<G4.L16AB>CEF4L4A8GDE.G8F>C8<A8B-.&B->D.<<L16v12C8.<B>CDEDEFGFGA>C4v14o2L8><F4F>F<F>F<F4<B->B-<B->B-<B->B-<B-4>E>E<E>E<E>E<EA4A<A>A<AB>C+<A>D4D<B4>B<B>C4.C<A4>A<AG4>G<G>G<G>G<G>C4>C<C16>C<C16>C<G16>C16<C4o6v15DEFCEF<B>EF<B-2&B-<A1&A4F1.&F1&F1r1,\n\t\t\tv14B-A-L8G.B-.E-4.>C4.r4C2&CF2<F2FE-FG4.GF4.CB-4.FB-4B-4>C2&C<A-GE-<B-2&B-<B-<B->B-16F16<B-o5E-rv15<B-4B-4A-GGFE-16F.r4E-FGA-GFrE-E-FGE-F4G4B-4B-rB-B-B-4B-B-B-A-G4r4FE-G4GA-GFF4r4E-FGE-E-4>E-r<B-B-B-4B-B-B-4B-4r4E-FGA-GFFE-E-E->C4<G4F4G4B-rB-B-B-4B->E-DC<B-4r4E-FGA-GFF4E-E->E-4DCC4D4G4<B->E-4D<A-A-4.A->E-4D<GG4.G>E-4D<FF4.rF4G4.>>C4<<AAAAB->C4C<B-B-AB-16AFG.&GGGGGAB-4B-B->C<AGFF4.AG4D4E4.GF4>C<AB-2&B-<B->DFB-4B-AAGFGGA4AAAAB->C4C<B-B-AB-16AFG.&GGGGGAB-4B-B->C<A>DEEF4<AGG4>FEE4<GF4>ECCD4r16D.DC<B-A4B-G2<B-4>>F4<AAA4AB-AGG4>C4<FFAAAB-AGGFF4G4E-4F4DEFF4GAA4GFFr>D<AG2&GFG>D<F4.r2.>C4<AAAAB->C4C<B-B-AB-16AFG.rGGGGAB-4B-B->C<AGFF4.AG4D4E4.GF4>C<AB-2&B-<B->DFB-4B-AAGFGGA4AAAAB->C4C<B-B-AB-16AFG.&GGGGGAB-4B-B->C<A>DEEF4<AG4.>FE4.<GF4>ECCD4r16D<F16>DC<B-A4B-G4>C2o3L4B-.A.A-.G.&GC1&C<F1.&F1&F1,\n\t\t\tv14<L8E-2.&E-E-1D1&D<G1>C4.<A2B-2G2F2&F>F4.<B-2&B-r2>>B-rE-2.r<B-2.rB-rB-rB-2rB-2.r>E-rE-2.rE-2.rE-rE-2.r<B-2r>B-4B-rE-2.rE-2.rE-rE-4<B-2r>Gr2B-4E-rE-2.rE-2.rE-1rF2.r>C4.A-2F1&F<E-1<L4B-.>CC.>A2<F.>F.DCr8G.&G<D.>D.&DA2F.GDE2F2B-.r16D8.D.>C.r16<F8.F2>C2.r8<F.DC.G.&G<D>D2&DA2<A.>GD<G2>F2B-.r2r8>C.r16<F8.FrA2&A.G.&G>C<AG2&G.<C.Dr2<B-.>C2D2D2>C1C.r2.o2Fo4F2C8<B->GG.&Go2Er.r>A.&A2.<D.<B2>>C8<C.<A2>G8<G>GL8GAB->C<C4r4.C16G16>C4o6L4C2<<F.>F.DC.G1D.rA2<A.>GD<G2>F2B-.r<B-.>B-.&B->C2<F.F.F.D.&D<E1r<A1.;\n\t\t\t"},ÏïÖÎ≥¥4:{image:[2,15],type:"note",name:'ÏïÖÎ≥¥ "ÎÑàÎ¨¥ÎÑàÎ¨¥ÎÑàÎ¨¥"',desc:"ÎÑàÎ¨¥ÎÑàÎ¨¥ÎÑàÎ¨¥ ÏûêÍæ∏ÏûêÍæ∏ÏûêÍæ∏ Î≥¥Í≥† Ïã∂Ïñ¥ÏßÄÎùºÎäî ÏóºÏõêÏùÑ Îã¥ÏùÄ ÎÖ∏ÎûòÏùò ÏïÖÎ≥¥",mml:"\n\t\t\tMML@t190v12<cegel8cegec2r2.b4ggggggr2ggggggggggggr2g4.gggbbaaggf+f+ee<bbaal4ggab>ed16el8&e.r4bbggggggr2ggggggggggggr2g4.gggbbaaggf+f+ee<bbaal4ggab>ed16el8&e.r2.f+gggg4gee4r4gggel4ere8d8egbarl8ef+f+f+f+4f+dl4drd8d8degggal8agg4r4f+ggggggee4r4gggel4ere8d8egbarl8ef+f+f+f+4f+dl4drd8d8bb+bbag8f+8f+grbggl8gggggga4a4.br1r4ggf+d4dr4ggf+d4dr4ddl4bb+bbagf+gd16b8.>bggl8ggggggl4aa.ba8r1g<c-32f+8&f+16.>d8d8rgf+d8d8rd8d8bb+bbagf+gl8<ggggggr2ggggggggggggr2g4.gggbbaaggf+f+ee<bbaal4ggab>ed16el8&e.r4bbggggggr2ggggggggggggr2g4.gggbbaaggf+f+ee<bbaal4ggab>ed16e2.&e8.,\n\t\t\tl16<<c&c&c&c&c&c&c&c&c&c&c&c&c&c&c&c&c&c&c&c&c&c&c&c&c&c&c&c&c&c&c&cr2l4r.v9<<e8>c.>g.c<c2cc<a.>>e.<a<a2aab.>>f+.<b<b2>bde2eeeeee8e8c2>g8c8r<c2>gc<<a2>>e8c8r<<a2aab2n30>b<b2>bde2eeeeel8ee>cgb2.g2g4c4<<a4.>>e4<a>er<a>egeb4a4c-f+a2.f+4.<bbl4c-.ebd+>d+8<d+8dac+>c+8<c+8c8.r16c>g2g2gc<<a.>>e<a8>e8r8n9e<a.>a8<<bb>>f+2l4.f+<b8b8c-ebl8>e<eeb>e4.e<e4>cgl2b.<cl4>ee<<a32>a&a16.>e32g&g16.<a<a.>a.rg1>dagf+l8<eb>e2gel4.<e>ec-8e8<c>gl4c<ccc2<a32>a&a16.>e32g&g16.<a<a8>a>e32g8&g16.<ar8g2>g8<g.<g2>>f+8d8<g<e.>>e.<eeeee8e8c.>e.c<c2cc<a.>>e.<a<a2aab.>>f+.<b<b2>bde2eeeeeec2>g8c8r<c2>gc<<a2>>e8c8r<<a2aav12l8o4bbaaggf+f+ee<bbaal4ggab>ed16e2.&e8.,\n\t\t\tr1.r1rv10<<b8<e8>c.b.rc2cc<a.>g.r<a2aab.>a.rc-2f+de2eeeee>e8e8<c2b8r.c2br<a2>a8r.<a2aab2>arc-2f+de2eeeeel8eer4>deer4.<b2b4r4<a>>cc<g4rgrl4>ccecr1<a.r2r.er2.dr2c8.r16c32l16.>de8c-32er4.<b2b4r4<a8>>c8c8<g4r8g32b+r8<a32>>c8&c<g32>c8&cl4<ba<bb>a2a.r1e.rb32>e8&e16.<babr>eee<c2ggr1r1f+1r1>dddddddd<c32l8>e&e16.bc-g4g4ggggggl4aa.ba8r1g<g>d8d8rgf+d8d8rdbb+bbagf+gl8ccccccl4r<c>c8c8<cc<a.>g8>c8c8r<<an36aab.>a.rc-2f+de2eeeeel8>>bbggggggr4<<c4>>ggggggggggggl4rn21g.g8g8g8o0b2n30>b<b2>bde2eeeee2;\n\t\t"},ÏïÖÎ≥¥5:{image:[2,15],type:"note",name:'ÏïÖÎ≥¥ "ÌîΩÎØ∏"',desc:"ÎßéÏùÄ ÏÇ¨ÎûåÎì§ Ï§ëÏóêÏÑú ÎÇòÎ•º ÎΩëÏïÑ Îã¨ÎùºÎäî ÎÇ¥Ïö©Ïùò ÎÖ∏ÎûòÏùò ÏïÖÎ≥¥",mml:"\n\t\t\tMML@t90v15L32E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&E&Et128v14L8rEo2E>ErErErErErErErE<E>ErErErErErErErE<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<Er2.rE>E<E>E<E>E<E>E<E>E<E>E<E>E<E16B16>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E16B16>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E16B16>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E16B16>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E16B16>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E16B16>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E16B16>E<E>E<E>E<E>E<E>E<E>E<E16>E.<ErE4L8EEEEEEEE<AAAABBL16B>B<B>BL8EEEEEEEE<AAAABBL16B>B<B>BE8E8E>E<E>E<E8E8E>E<E>E<<A>A<A>A<A>A<A>A<B>B<B>BB4E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<r1L8E>E<E>E<E>E<E16B16>E<E>E<E>E<E>E<E16B16>E<E>E<E>E<E>E<E16B16>E<E>E<E>E<E>ErE<E>E<E>E<E>E<E16B16>E<E>E<E>E<E>E<E16B16>E<E>E<E>E<E>E<E16B16>Er1<F#F#GGG#G#AAAAA#A#BB>CC#DD#EFF#GG#Ar1L4<EEEEEEEEEEEEEEEEL8E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<L16E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<r1L8E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<L16E>E<E>E<E>E<E>E<L32E>E<E>E<E>E<E>E<E>E<E>E<E>E<E>E<L8E,\n\t\t\tr1.v15L8BG#BG#BG#BG#BG#BG#BG#BG#BG#BG#BG#BG#BG#BG#BG#BG#BG#BG#BG#BG#BG#BG#BG#BG#BG#BG#BG#BG#r1rBBBBBAG#AB4Br4.ErBBBBBAG#AB4Br4.ErBBBBBAG#AB4BrBABG#4B4BB4BrB4BBBB4rBBBBBAG#AB4Br4.ErBBBBBAG#AB4Br4.ErBBBBBAG#AB4B4BABG#4B4BB4BrB4BBBB4E4F#4G#EEA4A4G#ABB4E4F#4G#EEA4A4G#ABB4E4F#4G#EEA4A4G#A4BG#G#2rBrBrEEEG#EE4BG#BG#EF#G#4BG#BG#EF#G#4BG#BG#BG#BG#BG#BG#EF#G#4BG#BG#EF#G#4BG#BG#EF#G#4BG#BG#BG#BG#rBBAA4BG#v14C#C#DDD#D#EEEEFFF#F#GG#AA#B>CC#DD#Ev15r<BBAA4B4E4E4E.E.ErE4EE.E.&EE4E4E.E.E>E4E4F#4EF#<E4E4E.E.ErE4EE.E.&EE4E4E.E.ErBBBA4B4E>E<E>E<E.>E.<ErEE>E<E.>E.<EE>E<E>E<E.>E.<E>E4E4F#4EF#<E>E<F>F<F#.>G.<GG#>G#<A>A<A#.>B.<B>C>C<C#>C#<D.>D#.<D#r<BBBA4B4L4G#rG#rG#rv13G#rv11G#rv9G#rv7G#rv5G#r2.,\n\t\t\tr1.v14r1.rE8E8r1.r.E8r1.rE8E8r1.r1r.E8r1.r.E8r1.r.E8r2r.E8r2r.E8r2r.E8r.E8r.E8r.E8r.E8r.E8r.E8r.E8r2r.E8r.E8r.E8r.E8r.E8r.E8r.E8r2L8r>ErErErErErErErErErErErErErErErErErErErErErErErErErErErEr1<rErErErErErErErErErErErErErErErErErErErErErErErErErErErEr1v15L4G#rArBr>C#rL8DD#EFF#GG#Ar1<<B4B4B.B.BrB4BB.B.&BB4B4B.B.B>L4GGAB<BBL8B.B.BrB4BB.B.&BB4B4B.B.Br1r2r.>E.r2r.rE.r2r.rE.rG4G4A4B>Cr2F#.<G.r2r>A#.<B.r2r>>D.<D#.rr1;\n\t\t"},Í≥®Îìú:{image:[1,14],effect:"gold",dropSound:"drop_gold.wav",dropSoundImm:!0,getSound:"get_gold.wav",bundle:"gold"},Î¨º:{image:[1,1],type:"potion",desc:"Ìà¨Î™ÖÌïú Ïï°Ï≤¥Ïù¥Îã§.",uname:"Ìà¨Î™ÖÌïú Î¨ºÏïΩ"},"ÌååÏù¥Ïñ¥Î≥ºÌä∏ Ïä§ÌÅ¨Î°§":{image:[1,1],type:"scroll",desc:"Ìà¨Î™ÖÌïú Ïï°Ï≤¥Ïù¥Îã§.",uname:'Ïä§ÌÅ¨Î°§:"Ï†úÏò§Ïä§Îùº"'},"ÌååÏù¥Ïñ¥Î≥ºÌä∏ ÏßÄÌå°Ïù¥":{image:[1,1],type:"melee",desc:"Ìà¨Î™ÖÌïú Ïï°Ï≤¥Ïù¥Îã§.",uname:"Ïª§Î∏åÍ∞Ä ÏÉàÍ≤®ÏßÑ ÏßÄÌå°Ïù¥"},"ÌååÏù¥Ïñ¥Î≥ºÌä∏ ÎßàÎ≤ïÏ±Ö":{image:[1,1],type:"book",desc:"Ìà¨Î™ÖÌïú Ïï°Ï≤¥Ïù¥Îã§.",uname:"ÌôîÎ†§Ìïú Ïª§Î≤ÑÏùò Ï±Ö"}},U.texture=new t.xE("Items.png",!1,{format:t.Wc.RGBA5551}),U.textureFiltered=new t.xE("Items.png",!0,{format:t.Wc.RGBA5551}),U.textureEquipSlot=new t.xE("equipSlot.png",!1,{format:t.Wc.RGBA5551}),U.width=16,U.height=24,U.tileWidth=16,U.tileHeight=24,U.perRow=Math.floor(U.texture.width/U.tileWidth),U.rarityColor=[16777215,42577,44783,10354781,16773632],U.typeToIcon={ammor:[1,1],helm:[2,1],boots:[3,1],pants:[4,1],melee:[5,1],ranged:[6,1],shield:[7,1],belt:[8,1],accessory:[9,1],ring:[10,1],pickaxe:[11,1],instrument:[12,1],note:[13,1],food:[12,1],potion:[13,1],scroll:[14,1],key:[15,1],book:[16,1],usable:[1,2],etc:[2,2],hand:[3,2]},U.typeEquipMax={ammor:1,helm:1,boots:1,pants:1,melee:1,ranged:1,shield:1,belt:1,accessory:1,ring:2,pickaxe:1,instrument:1,note:1},U.gold="Í≥®Îìú",U.bareHand="Îß®ÏÜê",U.validIdList=[];for(const t in U.property)U.property[t],t&&U.validIdList.push(t);const V={};function j(t,e){const i=He.world.getDistanceBetweenEntities(this,this.follow);i>this.senseDistance?(console.log(this.mode),"followExatly"!=this.mode&&He.world.addLog("%s{Í∞Ä} %s{Î•º} Ï∞æÏïÑ ÎÇòÏÑ∞Îã§.",this.getName(),this.follow.getName()),this.mode="followExatly"):i>.5*this.senseDistance?("followFast"!=this.mode&&He.world.addLog("%s{Í∞Ä} %s{Î•º} Îî∞ÎùºÏò®Îã§.",this.getName(),this.follow.getName()),this.mode="followFast"):this.mode=i>1?"followSlow":"roaming"}function $(t,e){const i=this.getSchdule();let s=this.places[i.place];s||(s=He.world.places[i.place]),s||(console.log(this.places),console.log("Ïû•ÏÜåÎ•º Ï∞æÏùÑ ÏàòÍ∞Ä ÏóÜÎã§.",i.place)),"moveToPlace"!=this.mode&&(He.world.getDistance(this.tileX,this.tileY,s.x,s.y)<=(i.radius||.5*this.senseDistance)&&this.canSee(s.x,s.y)[0]?this.mode=i.action:(console.log(i.place,"Î°ú Ïù¥ÎèôÏãúÏûë"),this.mode="moveToPlace",null!=this.path&&0!=this.path.length||(this.path=He.world.pathManager.findPath(this.tileX,this.tileY,s.x,s.y,!0))))}class H extends _{constructor(t,e,i,s){super(t,e,i,s),this.isMonster=!0,console.assert(H.property[t],`${t}Ïù¥ÎùºÎäî Î™¨Ïä§ÌÑ∞Ïùò Ï†ïÎ≥¥Í∞Ä ÏóÜÎã§.`),this.fillProperties(H.property,t);const o=this.property;this.senseDistance=o.senseDistance||6,this.weaponRange=o.weaponRange||1,this.AI=o.AI||"default",this.hpMax=o.hp||1,this.hp=this.hpMax,this.texture=_.texture,this.tileWidth=_.tileWidth,this.tileHeight=_.tileHeight,this.mode=void 0,this.postInit(H)}getWeaponImage(t,e){return null}processAI(){this.target&&!this.target.addedToWorld&&(this.target=null),this.follow&&!this.follow.addedToWorld&&(this.follow=null);const t=this.target&&He.world.getDistanceBetweenEntities(this,this.target),e=this.mode;V[this.AI](this,this.target,t),this.lastMode=e}calculateDamage(){const[t,e,i,s,o,n,r,a]=U.parseDamageString(this.property.attack);return He.world.randomGenerator.getDamage(i,s,t,e)}stop(){}attack(t,e){this.stopPreviousAction("attack");const{x:i,y:s}=He.world.tileCenterToWorld(this.tileX,this.tileY),{x:o,y:n}=He.world.tileCenterToWorld(t.tileX,t.tileY),[r,a]=new F("claw",i,s,o,n,!0,this.getWeaponImage(!0,!0),this).getDuration();t.stop(),t.damage(e,this,i,s,a||r),He.world.entityManager.wait(300)}death(e,i,s,o,n,r){n=n||0,this.enableDefaultAnimation(!1),this.shadowMesh.removeFromParent(),this.detachFromWorld(),new F("death",s,o,this.getX(),this.getY(),this,i,n),t.B7.delayedCall(n,(()=>{this.stopPreviousAction("death"),this.enableDefaultAnimation(!1),He.interface.addLog("%s{Î•º} Í≥µÍ≤©ÌïòÏó¨ <yellow>%d</yellow> ÎåÄÎØ∏ÏßÄ!",this.getName(),e),He.interface.addLog("%s{Î•º} Ïì∞Îü¨Îú®Î†∏Îã§!",this.getName()),this.refreshGauge();const i=new t.DK;i.setTexture(new t.xE("Blood.png",!1)),console.log("ÏÇ¨Îßù",this.getPosition());for(let e=1;e<=10;e++){const e=t.cQ.random(0,359),s=t.cQ.random(1,6);let o,n=this.getPosition();i.addParticles([{x:o,y:n,size:t.cQ.random(4,30),angle:e,ttl:60+t.cQ.random(1,100),speedX:Math.cos(e)*s,speedY:Math.sin(e)*s,speedAngular:t.cQ.random(1,30)-15,decay:.5,color:4194304,alpha:1}])}He.world.floorLayer.addChild(i),t.$u.playSound(r||"sound/damage_0.wav"),t.$u.playSound("sound/finish_1.wav"),t.B7.delayedCall(5e3,(()=>{i.removeFromParent(),this.removeFromWorld()}))})),this.property.explosion&&("water"==this.property.explosion?(t.$u.playSound("sound/explosion_water.wav"),new F("boom",this.getX(),this.getY(),20,350,n,255),He.world.elemental.addElemental(D.WATER,this.tileX,this.tileY,10)):"fire"==this.property.explosion?(t.$u.playSound("sound/explosion_fire.wav"),new F("boom",this.getX(),this.getY(),50,300,n,16748544),He.world.elemental.addElemental(D.FIRE,this.tileX,this.tileY,10)):"poison"==this.property.explosion&&(t.$u.playSound("sound/explosion_gas.wav"),new F("boom",this.getX(),this.getY(),30,400,n,16711935),He.world.elemental.addElemental(D.POISON,this.tileX,this.tileY,10))),this.afterDeath(e,i,s,o,n,r)}afterDeath(t,e,i,s,o,n){He.player.exp=He.player.exp+1;const r=He.world.random(1,4),a=He.world.pathManager.getSplashFloor(this.tileX,this.tileY,r);for(let t=0;t<r;t++)He.world.entityManager.addEntity(new U(U.gold,a[t].x,a[t].y,{amount:He.world.random(1,30),drop:!0,dropX:this.tileX,dropY:this.tileY,dropDelay:100*(r-t)+o}));1==He.world.random(1,3)&&He.world.entityManager.addEntity(new U(U.validIdList[He.world.random(0,U.validIdList.length-1)],this.tileX,this.tileY,{drop:!0,dropX:this.tileX,dropY:this.tileY,dropDelay:100+o}))}damage(e,i,s,o,n,r){if(n=n||0,this.hp=this.hp-e,this.hp<=0)this.death(e,i,s,o,n,r);else{let a;this.target?1==He.world.random(1,Math.floor(this.hp/10)+1)&&(this.target=i):(this.target=i,a="!"),new F("damage",s,o,this.getX(),this.getY(),this,i,n),t.B7.delayedCall(n,(()=>{this.showMood(a),this.stopPreviousAction("damage"),He.interface.addLog("%s{Î•º} Í≥µÍ≤©ÌïòÏó¨ <yellow>%d</yellow> ÎåÄÎØ∏ÏßÄ!",this.getName(),e),i==this.follow&&He.world.addLog("%s{Í∞Ä} %sÏùò Í≥µÍ≤©ÏùÑ Î∞õÍ≥† ÌôîÍ∞Ä ÎÇ¨Îã§!",this.getName(),i.getName()),this.refreshGauge(),r?t.$u.playSound("sound/"+r):(console.log("ÏÇ¨Ïö¥Îìú ÏßÄÏ†ï ÏïàÎê®"),t.$u.playSound(r||"sound/damage_0.wav"))}))}}getSchdule(t,e){if(null==this.property.schedule)return;let i,s;i=t?{hour:t,min:e||0}:He.world.getDateTime(),console.log(`Í≤åÏûÑ ÎÇ¥Ïùò ÏãúÍ∞Ñ ${i.hour}Ïãú ${i.min}Î∂Ñ`);for(let t=this.property.schedule.length-1;t>=0;t--){const e=this.property.schedule[t];if(e.hour<i.hour||e.hour==i.hour&&e.min<=i.min){s=e,console.log("Ïä§ÏºÄÏ•¥ Í≤∞Ï†ï",s.hour,s.min,"Î∂ÄÌÑ∞",s.place,"Ïóê ÏûàÏñ¥Ïïº ÌïúÎã§.");break}}return null==s&&(s=this.property.schedule[this.property.schedule.length-1],null==s&&console.log("Ïä§ÏºÄÏ•¥ÏùÑ Ï∞æÏùÑ ÏàòÍ∞Ä ÏóÜÎã§. Ïù¥Í±¥ Îç∞Ïù¥ÌÑ∞Î•º ÏûòÎ™ª ÏûëÏÑ±Ìïú Í≤ÉÏûÑ.")),s}static pickMonsters(e){const i=[];for(const s in H.property){const o=H.property[s];t.cQ.filterAttrib(e,o.whiteAttrib,o.blackAttrib)&&i.push(s)}return i}static parseMonsterList(t){const e=t.split(",");let i=0;for(const t in e){const s=e[t],[,o,n]=/([a-zA-Z?]?)(.*)/.exec(s);e[t]={name:n,type:""==o?null:o},"?"!=o&&(i+=1)}return[e,i]}}V.trackFast=function(t,e,i,s){s=s||1;let[o,n]=[Math.sign(e.tileX-t.tileX),Math.sign(e.tileY-t.tileY)];const r=t.getPropertyRel(o,0),a=t.getEntityPropertyRel(o,0),l=t.getPropertyRel(0,n),h=t.getEntityPropertyRel(0,n);(r.wall>0||a)&&0==n&&(n=2*(He.world.random(1,2)-1)-1),(l.wall>0||h)&&0==o&&(o=2*(He.world.random(1,2)-1)-1),0==o||0==n||(1==He.world.random(1,2)?o=0:n=0);const d=t.getPropertyRel(o*s,n*s),c=t.getEntityPropertyRel(o*s,n*s);d.wall>0||c||t.moveToRel(o*s,n*s)},V.trackSlow=function(t,e,i,s){He.world.random(1,4)>1&&V.trackFast(t,e,i,s)},V.trackExactly=function(t,e,i,s){if(i<=t.senseDistance&&t.canSee(e.tileX,e.tileY));else if(t.path&&0!=t.path.length||(t.path=He.world.pathManager.findPath(t.tileX,t.tileY,e.tileX,e.tileY,!0)),t.path&&t.path.length>0){const[i,s]=[t.path[0].x,t.path[0].y];t.path.shift(),0==t.path.length&&(t.path=null),t.moveTo(i,s)||(console.log(t.getName(),"Í∏∏Ïù¥ ÎßâÌòîÏùå",e.getName()),t.path=null)}else console.log(t.getName(),"ÌÉÄÍ≤üÏóê Ïù¥Î•¥Îäî Í∏∏ÏùÑ Î™ªÏ∞æÏùå",e.getName())},V.followFast=function(t,e,i,s){V.trackFast(t,t.follow,i,s)},V.followSlow=function(t,e,i,s){He.world.random(1,4)>1&&V.trackFast(t,t.follow,i,s)},V.followExatly=function(t,e,i,s){i=He.world.getDistanceBetweenEntities(t,t.follow),V.trackExactly(t,t.follow,i,s)},V.retreatSlow=function(t,e,i){return V.trackSlow(t,e,i,-1)},V.retreatFast=function(t,e,i){return V.trackFast(t,e,i,-1)},V.moveToPlace=function(t,e,i){if(t.path&&t.path.length>0){const[e,i]=[t.path[0].x,t.path[0].y];t.path.shift(),0==t.path.length&&(t.path=null),t.moveTo(e,i)||(console.log(t.getName(),"Í∏∏Ïù¥ ÎßâÌòîÏùå"),t.path=null)}else t.mode=null,$.call(t,e,i),t.mode||(t.mode="roaming"),console.log(t.getName(),"pathÍ∞Ä ÎÅùÎÇ¨Ïùå. Îã§ÏùåÏùÄ ",t.mode)},V.roaming=function(e,i,s){const[o,n]=t.cQ.dirToOffset(He.world.random(1,4)),r=e.getPropertyRel(o,n),a=e.getEntityPropertyRel(o,n);r.wall>0||a||e.moveToRel(o,n)},V.stop=function(t,e,i){},V.attack=function(t,e,i){t.attack(e,t.calculateDamage())},V.searchTarget=function(t,e,i){V.roaming(t,e,i)},V.sleep=function(i,s,o){if(i.lastMode==i.mode)return;i.enableDefaultAnimation(!1);const n=new t.B7(1e3);n.start(),n.on(t.ju.TIMER,(()=>{const s=new e(new t.xE("fx.png",!1,{format:t.Wc.RGBA5551}),11,4,16,24),o=new t.KG([[0,60,s,{y:[-4,t.cQ.random(-30,-15),"outCubic"],scaleX:[.2,1],scaleY:[.2,1]}],[50,60,s,{alpha:[1,0,"outCubic"]}]]);i.addChild(o),t.B7.delayedCall(1e3,(()=>{o.removeFromParent()}))})),i.once("stopAction",(()=>{n.stop()}))},V.shop=function(t,e,i){V.roaming(t,e,i)},V.playMusic=function(i,s,o){if(i.lastMode==i.mode)return;He.interface.addLog("%s{Îäî} ÎÖ∏ÎûòÎ•º Î∂ÄÎ•¥Í∏∞ ÏãúÏûëÌñàÎã§.",i.getName()),i.enableDefaultAnimation(!1);const n=new X("\n\tMML@t128v15>>L4F2E2D.L8C16<B-16>C<B-AGG>C<F2ECD2<CDDD16E16v14o1G>GL16>EFGArGD<B-GD<B-GL8>C2C2rA.length>DEFA>C4L16rv15FG>C<FG>L32C.<C.FG>CFG>C<CFG>CFG>C2&C8&C&C2L8ro4FF4v14o1B-4>B-<B-B->B-rC4.>C<CrCB-4<A4>A<AA4>A4D4>D<DrD>D4<<B-4>B-<B-B->B-rC4.>C<CrC>C4<C4.length>C#<CC.length4.length>C#<D4>D4<AD>D<D4<B4>B<BB4>B4<B-4>B-<B-B-4>B-4<A4>A<AA4>A4D4>D<DD4>D4<<G>G<GA4A>A4<B->B-<B-B4B>B4C4>C<GCG>C<Cr>C<C4r4>C<C<B-4B-4>C4C4D-4D-A->E-4<E-.<A-.>A-<A-4A->A-<A-4A->A-<A-4A->A-<A-4G>G<G4G>G<G>C4>C<C>C<C>C<C>C<F>F<F>F<F>F<FE-4>E-<E->E-<E->E-<E-D4>D<DF4.length>F#<FG4.length>G<G-4F4<B-.A-.>A-<A-4A->A-<A-4A->A-<A-4A->A-<A-4G>G<G4G>G<G>C4>C<C>C<C>C<C>C<F>F<F>F<F>F<FE-4>E-<E->E-<E->E-<E-D4>D<DF4.length>F#<FF4.length>F<B->B-C4<B4v15o5C4C.length#>C4.length<<EEEEDD.length#>CC.length#<BBA16B.length.&BB>B<BAB.length>CDDC.lengthC.length16.length<G#.GG#>C16.length<B.A4rAGAB16.length>C#.&Cr4.CD.length.lengthE4EEED.length#<A#>DC.length4.length<BB4A4B.length.>C#.&C#<G#.G16rEEEED.lengthD.length#>CC.length#<BBA16B.length.&BB.B16BAB.length>CDDC.lengthC.length16.length<G#.GG#>C16.length<B.AA.A16AGAB16.length>C#.&CrC.lengthC.lengthC.lengthD.lengthE4EEED.length#<A#>DC.length4.length<BB4B4B4t76L16>>C#.<C#.FB.length.<B.>EA.<A.>EL32o3rFA.length>>CG2.length.&G#&G16.o2E.length.B.>EF#.G16.length&G64.length&G2.length.&G2.length.,\n\tv14>B-2G2F.r.rCr2<GF2r2v15F2E2D2E.E16F16G2F.E8C1.&&C2L8rCC4rEEFF4rEF4A4E4F4r4GFFEEDDCC4G4F4rEEFF4rEF4A4E4F4rB-B-B-B-AAGGFF4EEF4A4A.A16AGF16G16G4rEEEG>DC4.C.C16C<B-AG4AF4.AAAF4.G4.rF16G16AGFG4A4B-4.r4AGFG4.r2.F4E4F4G4A-4G4A-4B-.>C.&C<G.G16rE-E-E-E-DD>CC<B-B-A16B-.&B-B-.B-16B-AB->CD-D-CC16<G.FG.length>C16<B-.A-A-.A-16A-GA-B-16>C.&C<A-.A-16r>CDE-4E-E-E-D<A>DC4<B-B-4A-4B-.>C.&C<G.G16rE-E-E-E-DD>CC<B-B-A16B-.&B-B-.B-16B-AB->CD-D-CC16<G.FG.length>C16<B-.A-A-.A-16A-GA-B-16>C.&CrCCCDE-4E-E-E-D<A>DC4<B-B-2B.>C16v14L4o2A1A1G.length1.length>C#<CC.lengthC.length8.length>C16.length<F8.FF.length.lengthF.length8F.length8EEEE8E8D.length#>L8D#<DG4.length>G<GG4.length>G#<G4F4.length<B.A.>A<A4A>A<A4A>A<A4A>A<A4G#>G#<G4G.length#>G#<G#>C4.length>C#<C#>C#<C#>C#<C#>C#<F#>F#<F#>F#<F#>F#<FE4.length>E<E>E<E>E<ED4.length>D#<DG4.length>G<GF4F.lengthF.length4BF.length#<B4L16>>A.>E.A<G#.>E.F#<F#.>C#.E<<B1L32r8r.r.>>Et54<B>GB.length>E>E1&E4.,\n\tv14<B-1C1<A2>F2<B->F8B-.&B-B-2B-2F2A2<D1&D1&D1L8rDD4>>rC2.CrC4CC4C4rC2.ArB-4AD4C4rC2.CrC4CC4C4rE2.DD4C4C2F2rD4E4.G.G16r>D4<G4.G4r>CCF4.F.F16rFEC<D4.E2rD4.D2rF4.F4DD<B-r1L4B-B-B-B->D-D-D-L8D-.E-.&E-C4rGGF4.F.F.rF.F.&FF.F.FFF4.E4F4E.E-.&E-C4rCCC4.E-4rA-GF2L4ArF.G.length-E-L8F.G.&GC4rCC<B-4.>F.F.rF.F.&FF4rFFF4.E4D-4E.E-.&E-C.C.E-E-E-4.A-.A-.A-GF2A4r4L4E.length-.FGrE.>Gr.length.<<B.r.rB.>>F#.r<FFD.lengthF8.E2.length&E16L8rEEE2r4AGG2A.length4r4F.length4.G4E4F.length#.G#.&GC.length4rG.lengthG.lengthF.length4.r2F.length#.F2.r.length.F4.F4D4F.length.length.E.&EE4.EEE4.A4.AGG2A.length4r4A4EE4F.length4F.length4.length;\n\t","sound/mml_celtic-harp-a4.wav");i.commandFollower("dance",{mml:n});const{x:r,y:a}=He.world.worldToTile(He.world.viewX,He.world.viewY);function l(e){const{x:s,y:o}=He.world.worldToTile(e.viewX,e.viewY),r=He.world.getDistance(s,o,i.tileX,i.tileY);n.setVolume(.5-.5*t.cQ.clamp(r/16,0,1))}o=He.world.getDistance(r,a,i.tileX,i.tileY),n.setVolume(.5-.5*t.cQ.clamp(o/16,0,1)),n.play(),n.on("note",(()=>{i.__animationTick=(i.__animationTick+1)%2,i.changeImage(i.imageCol,i.imageRow+i.__animationTick);const s=new e(new t.xE("fx.png",!1,{format:t.Wc.RGBA5551}),t.cQ.random(9,10),4,16,24),o=new t.KG([[0,60,s,{y:[-2,t.cQ.random(-30,-15),"outBack"],x:[7,t.cQ.random(-5,20),"inOutSine"]}],[50,60,s,{alpha:[1,0,"outCubic"]}]]);i.addChild(o),t.B7.delayedCall(1e3,(()=>{o.removeFromParent()}))})),He.world.on("viewChanged",l),n.on("complete",(()=>{He.world.removeEventListener("viewChanged",l)})),i.once("stopAction",(()=>{n.stop(),He.world.removeEventListener("viewChanged",l)}))},V.default=function(t,e,i,s){if(e)if("searchTarget"==t.mode)i<=t.senseDistance&&t.canSee(e.tileX,t.tileY)?(e==He.player&&(t.showMood("!"),He.interface.addLog("%s{Í∞Ä} %s{Î•º} Î∞úÍ≤¨ÌñàÎã§!",e.getName(),t.getName())),t.mode="trackFast"):1==He.world.random(1,20)&&(t.target=null,t.mode="roaming");else if(i>=1.5*t.senseDistance)e==He.player&&He.interface.addLog("%s{Îäî} %sÏùò Ï∂îÏ†ÅÏóêÏÑú Î≤óÏñ¥ÎÇ¨Îã§.",e.getName(),t.getName()),t.mode="searchTarget";else if(i<=t.weaponRange)"retreatFast"==t.mode&&1==He.world.random(1,6)||"retreatSlow"==t.mode&&He.world.random(1,3),t.mode="attack";else if(t.canSee(e.tileX,e.tileY))t.hp/t.hpMax<=.2?"retreatSlow"!=t.mode&&(t.showMood("fear"),He.world.addLog("%s{Í∞Ä} ÎèÑÎßùÏπòÍ∏∞ ÏãúÏûëÌñàÎã§!",t.getName()),t.mode="retreatSlow"):t.mode="trackSlow";else{const i=He.world.random(1,10);10==i?(e==He.player&&He.interface.addLog("%s{Îäî} %sÏùò Ï∂îÏ†ÅÏóêÏÑú Î≤óÏñ¥ÎÇ¨Îã§.",e.getName(),t.getName()),t.mode="searchTarget"):i<=5?(t.path=null,t.mode="trackExactly"):"trackFast"==t.mode&&"trackSlow"==t.mode||(t.mode=1==He.world.random(1,2)?"trackSlow":"trackFast")}else{const s=t.searchTarget();if(s){const[e,i]=s;"f"==e?(t.showMood("!"),t.target=i,t.mode="trackSlow",He.world.addLog("%s{Í∞Ä} %sÏóêÍ≤å Ï†ÅÎåÄÍ∞êÏùÑ ÎìúÎü¨ÎÉàÎã§!",t.getName(),t.target.getName())):"F"==e?(t.showMood("!"),t.target=i,t.mode="trackFast",He.world.addLog("%s{Í∞Ä} %sÏóêÍ≤å Í∞ïÌïú Ï†ÅÎåÄÍ∞êÏùÑ ÎìúÎü¨ÎÉàÎã§!",t.getName(),t.target.getName())):"r"==e?(t.showMood("fear"),t.target=i,t.mode="retreatSlow",He.world.addLog("%s{Í∞Ä} %s{Î•º} Î≥¥Í≥† Îí∑Í±∏ÏùåÏßàÏπòÍ∏∞ ÏãúÏûëÌñàÎã§!",t.getName(),t.target.getName())):"R"==e&&(t.showMood("fear"),t.target=i,t.mode="retreatFast",He.world.addLog("%s{Í∞Ä} %s{Î•º} Î≥¥Í≥† ÎèÑÎßùÏπòÍ∏∞ ÏãúÏûëÌñàÎã§!",t.getName(),t.target.getName()))}t.target||(t.follow?j.call(t,e,i):t.property.schedule&&$.call(t,e,i)),t.mode||(console.log("ÏïÑÎ¨¥Í≤ÉÎèÑ Í≤∞Ï†ïÎêòÏßÄ ÏïäÏïÑÏÑú Î°úÎ∞ç"),t.mode="roaming")}null==t.mode&&(console.log(t.getName(),t.mode,t.target),console.log("Î™®ÎìúÏÑ§Ï†ïÏù¥ ÏûòÎ™ªÎêòÏóàÏùå",t.getName())),V[t.mode](t,t.target,i),t.follow&&t.follow==e&&1==He.world.random(1,5)&&(He.world.addLog("%s{Í∞Ä} Ï†ïÏã†ÏùÑ Ï∞®Î†∏Îã§.",t.getName()),t.target=null)},V.citizen=function(t,e,i,s){V.default(t,e,i)},V.cat=function(t,e,i,s){V.default(t,e,i,s)},H.property={Ï•ê:{image:[2,3],color:W,faction:"A",attack:"1~3",hp:5,whiteAttrib:"*",blackAttrib:""},Ï•êÍ∞ÄÏ°±:{list:"KÏ•ê,Ï•ê,Ï•ê,Ï•ê,?Ï•ê,?Ï•ê",whiteAttrib:"cave,dungeon",blackAttrib:""}},H.AI=V;class z extends H{constructor(t,e,i,s){if(super(t,e,i,s),this.isPet=!0,null==i){const t=He.world.pathManager.getSummonFloor(He.player.tileX,He.player.tileY,1);0==t.length?console.log("ÏÜåÌôòÌï† ÏûêÎ¶¨Í∞Ä ÏóÜÏùå"):(e=t[0].x,i=t[0].y,this.position=He.world.tileCenterToWorld(e,i),[this.tileX,this.tileY]=[e,i],[this.lastTileX,this.lastTileY]=[e,i])}this.fillProperties(z.property,t);const o=this.property;this.senseDistance=o.senseDistance||6,this.weaponRange=o.weaponRange||1,this.follow=He.player,this.AI=o.AI||"default",this.hpMax=o.hp||1,this.hp=this.hpMax,this.texture=_.texture,this.tileWidth=_.tileWidth,this.tileHeight=_.tileHeight,this.postInit(z)}called(t){1==He.world.getDistanceBetweenEntities(this,t)?1==He.world.random(1,2)?(He.interface.addLog("%s{Îäî} ÌíÄÏ©ç Îõ∞Ïñ¥ Ïò¨ÎûêÎã§.",this.getName()),this.swapLocation(t)):He.interface.addLog("%s{Îäî} Îß§Ïö∞ Ï¢ãÏïÑÌñàÎã§.",this.getName()):He.interface.addLog("%s{Îäî} Ïö∏Ïùå ÏÜåÎ¶¨Î•º ÎÉàÎã§.",this.getName())}afterDeath(t,e,i,s,o,n){}}Object.assign(z.property,{Í≥†ÏñëÏù¥:{image:[12,3],color:Y,faction:"P",attack:"2~5",hp:13,AI:"cat"}}),z.maxPet=5;class K extends H{constructor(t,e,i,s){super(t,e,i,s),this.isNpc=!0,this.AI="roaming",this.fillProperties(K.property,t);let o=this.property;this.places=[],this.senseDistance=o.senseDistance||6,this.weaponRange=o.weaponRange||1,this.AI=o.AI||"default",this.hpMax=o.hp||1,this.hp=this.hpMax,this.texture=_.texture,this.tileWidth=_.tileWidth,this.tileHeight=_.tileHeight,this.postInit(K)}attack(t,e){let{x:i,y:s}=He.world.tileCenterToWorld(this.tileX,this.tileY),{x:o,y:n}=He.world.tileCenterToWorld(t.tileX,t.tileY),[r,a]=new F("claw",i,s,o,n,!0,this.getWeaponImage(!0,!0),this).getDuration();t.stop(),t.damage(e,this,i,s,a||r),He.world.entityManager.wait(300)}damage(e,i,s,o,n,r){if(n=n||0,this.hp=this.hp-e,this.hp<=0){this.removeFromWorld(),new F("death",s,o,this.getX(),this.getY(),this,i,n),t.B7.delayedCall(n,(()=>{let e=new t.DK;e.setTexture(new t.xE("Blood.png")),console.log("ÏÇ¨Îßù",this.getPosition());for(let i=1;i<=10;i++){let i=t.cQ.random(360),s=t.cQ.random(6),{x:o,y:n}=this.getPosition();e.addParticles([{x:o,y:n,size:t.cQ.random(4,30),angle:i,ttl:60+t.cQ.random(100),speedX:t.cQ.cos(i)*s,speedY:t.cQ.sin(i)*s,speedAngular:t.cQ.random(30)-15,decay:.5,color:4194304,alpha:1}])}He.world.floorLayer.addChild(e),t.$u.playSound(r||"sound/damage_0.wav"),t.$u.playSound("sound/finish_1.wav"),t.B7.delayedCall(5e3,(()=>{e.removeFromParent(),this.removeFromWorld()}))})),He.interface.addLog("%s{Î•º} Í≥µÍ≤©ÌïòÏó¨ %d ÎåÄÎØ∏ÏßÄ!",this.getName(),e),He.interface.addLog("%s{Î•º} Ïì∞Îü¨Îú®Î†∏Îã§!",this.getName()),He.player.exp=He.player.exp+1;let a=t.cQ.random(4),l=He.world.pathManager.getSplashFloor(this.tileX,this.tileY,a);for(let e=1;e<=a;e++)He.world.entityManager.addEntity(new U(l[e].x,l[e].y,{id:U.gold,amount:t.cQ.random(30),drop:!0,dropX:this.tileX,dropY:this.tileY,dropDelay:100*(a-e)}));1==t.cQ.random(3)&&He.world.entityManager.addEntity(new U(this.tileX,this.tileY,{id:U.validIdList[t.cQ.random(U.validIdList.length)],drop:!0,dropX:this.tileX,dropY:this.tileY,dropDelay:100})),this.property.explosion&&("water"==this.property.explosion?(new F("boom",this.getX(),this.getY(),20,350,n,255),He.world.elemental.addElemental(D.WATER,this.tileX,this.tileY,10)):"fire"==this.property.explosion?(new F("boom",this.getX(),this.getY(),50,300,n,16748544),He.world.elemental.addElemental(D.FIRE,this.tileX,this.tileY,10)):"poison"==this.property.explosion&&(new F("boom",this.getX(),this.getY(),30,400,n,16711935),He.world.elemental.addElemental(D.POISON,this.tileX,this.tileY,10)))}else new F("damage",s,o,this.getX(),this.getY(),this,i,n),t.B7.delayedCall(n,(()=>{t.$u.playSound(r||"sound/damage_0.wav")})),He.interface.addLog("%s{Î•º} Í≥µÍ≤©ÌïòÏó¨ %d ÎåÄÎØ∏ÏßÄ!",this.getName(),e)}}Object.assign(K.property,{ÎÇòÏò§:{image:[17,1],color:Y,faction:"H",attack:"2~5",hp:25,AI:"citizen",schedule:[{hour:7,min:0,place:"room"},{hour:8,min:30,place:"work",action:"playMusic"},{hour:17,min:0,place:"room"},{hour:21,min:0,place:"bed",radius:0,action:"sleep"}]}});const Q={tile:1,door:2,interact:3,talk:4,attack:5,aim:6,player:7,target:8};function q(t){this.isVisibleDeeply()&&He.world.sightManager.setZoom(He.world.sightManager.getZoom()-t.wheel/1e3)}function J(e,i,s){if(this.holdTimer=null,this.__drag){console.log("ÌôÄÎìú"),this.__drag.dragCursor=!0;const{x:o,y:n}=He.world.stageToTile(e,i);let{x:r,y:a}=He.world.tileCenterToStage(o,n);const l=1/He.world.zoom,h=1/He.world.zoom;[r,a]=[r*l,a*h],this.__drag.ex=t.wU.logicalViewport.width/2-r+e,this.__drag.ey=t.wU.logicalViewport.height/2-a+i,this.twCursor&&this.twCursor.stop(),s?(this.x=r,this.y=a,this.twCursor=null):this.twCursor=new t.kX(this,300,{x:r,y:a},{ease:t.Ui.outCubic}).onComplete((()=>{this.twCursor=null})),this.__drag.click=!1,this.__drag.holded=!0}}function Z(e){if(!this.isVisibleDeeply())return;console.log("Ïª§ÏÑú"+this.getPath(!0)),this.hideAutoAction();const{x:i,y:s}=He.stage.globalToLocal(e.x,e.y);this.__drag={ox:He.world.viewX,oy:He.world.viewY,ex:i,ey:s,click:!0,cx:this.x,cy:this.y},this.locked||(e.type==t.ju.MOUSE_DOWN?(this.__drag.dragCursor=!0,J.call(this,i,s,!0)):(this.mesh.hitTestPoint(e.x,e.y)&&(this.__drag.dragCursor=!0),this.holdTimer=new t.B7(500,1).on(t.ju.TIMER,(()=>{J.call(this,i,s)})),this.holdTimer.start()))}function tt(t){if(this.__drag){this.aimLine&&this.aimLine.removeFromParent();const{x:e,y:i}=He.stage.globalToLocal(t.x,t.y),o=1/He.world.zoom,n=1/He.world.zoom,r=(this.__drag.ex-e)/o,a=(this.__drag.ey-i)/n,l=this.__drag.ox+this.moveDir*r,h=this.__drag.oy+this.moveDir*a,{x:d,y:c}=He.world.stageToWorld(this.__drag.ex,this.__drag.ey),u=this.getPosition(),{x:p,y:g}=He.world.stageToWorld(u.x,u.y);this.locked?console.log("ÎùΩ"):(this.stopSnap(),this.__drag.dragCursor?null==this.twCursor&&this.setPosition(this.__drag.cx-r*this.mesh.getScaleX(),this.__drag.cy-a*this.mesh.getScaleY()):He.world.sightManager.moveViewTo(l,h),(Math.abs(r)>s.World.tileWidth/2||Math.abs(a)>s.World.tileHeight/2)&&(this.__drag.click=!1,He.interface.hideInfo(),this.holdTimer&&(this.holdTimer.stop(),this.holdTimer=null)),this.dragging(d,c,p,g),t.stopPropagation())}}function et(e){if(console.log("Ïª§ÏÑúUP "+this.getPath(!0)),this.holdTimer&&(this.holdTimer.stop(),this.holdTimer=null),this.__drag){this.aimLine&&this.aimLine.removeFromParent();const{x:i,y:s}=He.stage.globalToLocal(e.x,e.y),o=1/He.world.zoom,n=1/He.world.zoom,r=(this.__drag.ex-i)/o,a=(this.__drag.ey-s)/n,l=this.__drag.ox+this.moveDir*r,h=this.__drag.oy+this.moveDir*a,{x:d,y:c}=He.world.stageToWorld(this.__drag.ex,this.__drag.ey),u=this.getPosition(),{x:p,y:g}=He.world.stageToWorld(u.x,u.y);if(this.locked){if(this.__drag.click){const{x:e,y:o}=He.world.stageToWorld(i,s);this.reservedClick.push([e,o,t.B7.now()]),console.log("ÏÑ†ÏûÖÎ†• Ï†ÄÏû•",this.reservedClick.length)}}else{if(this.__drag.dragCursor||He.world.sightManager.moveViewTo(l,h),this.__drag.holded||this.snapToWorld(),this.__drag.click){this.__drag=null;const{x:t,y:e}=He.world.stageToWorld(i,s);this.click(t,e)}else this.__drag=null,this.drag(d,c,p,g);e.stopPropagation()}}}function it(t){const e=t.touches;if(2==e.length&&this.isVisibleDeeply()){this.aimLine&&this.aimLine.removeFromParent(),this.__drag=null;const[i,s,o,n]=[e[0].x,e[0].y,e[1].x,e[1].y];this.__touches={dist:Math.sqrt((o-i)*(o-i)+(n-s)*(n-s)),zoom:He.world.sightManager.getZoom()},t.stopPropagation()}}function st(t){const e=t.touches;if(this.__touches&&2==e.length){const[i,s,o,n]=[e[0].x,e[0].y,e[1].x,e[1].y],r=Math.sqrt((o-i)*(o-i)+(n-s)*(n-s)),a=this.__touches.dist/(r+1e-5);He.world.sightManager.setZoom(this.__touches.zoom*a),this.setType("tile"),t.stopPropagation()}}function ot(t){t.allTouches,this.__touches&&(this.__touches=null,this.snapToPlayer(),t.stopPropagation())}function nt(e){if(this.locked)return;console.log(e.keyCode);const[i,s]=[He.player.tileX,He.player.tileY];let o,n;this.__drag=null,e.keyCode==t.VD.LEFT?[o,n]=[-1,0]:e.keyCode==t.VD.RIGHT?[o,n]=[1,0]:e.keyCode==t.VD.UP?[o,n]=[0,-1]:e.keyCode==t.VD.DOWN?[o,n]=[0,1]:e.keyCode==t.VD.S?He.world.entityManager.safeExecute((()=>{He.saveLoad.save()})):e.keyCode==t.VD.L?He.world.entityManager.safeExecute((()=>{He.saveLoad.load()})):e.keyCode==t.VD.P&&He.player.playMusic("\n        MML@t106L8r16G#.ABB>C16C.&C<E.F#.&F#A.B.>D<B.BB16B16B16BAAG16GF#.r.D#16AGGA16B.G#ABB>C16C.&Cr16E.DCC<B16B.&BF#E16EB16B16B16BA16A.GGF#AG16G16E2>F#.E.<B>G.F#.&F#A.G.<A16>e16F.E.<A>F.E.<A>G.F.&F<G32>C#32E32A4.&A32r<FFF16F.<AB->CC<B-16>F.&FrB-.B-16D16E16FFFF16F.GEDDE16C.&CrG.A.FDDE16F.DEFDA16A.&ArF.A16F16G16AAAA16A.B-GF16G.&Gr4A4>E4F<FFF16F.<AB->CC<B-16>F.&F>C<A.B-16D16E16FFFF16F.EFG16A2&A16rAB-F#o1B>B<B>B<B->B-<B->B-<A>A<A>AD>D<D>D<G#>G#<G#>G#<A>A<A>A<D4>D<D4A>D<DG.>D16G4<CG>C<CF.>C16F<F<B->FB-<B-B.B16r4B.>BB.E>E<F#>F#<G#>G#<E4o4B>C16C.&Cr<F#GAAB16B.&Br4r16B16B16B16BAAG16GF#.r.D#16AGGA16B.G#ABB>C16C.&Cr16E.DCC<B16B.&Br4r16B16B16B16BA16A.GGF#AG16G16o2E>E<E>E<D>D<D>D<C>C<C>C<<B>B<B>BD>D<D>D<C>C<C>C<B->B-<B->B-<A2L32DA1.r4.r16.,\n        v14r16L8D.DEG#.G.&GC.C.&CF#.F#.rG.G.&GE4E4D#4F#4r16E.ED#D4D4<<A.>AE16<AD.>D.<DG.>GD16<GCG>C<CF#4>F#<F#<B.>B.<B>E>E<E>E<D>D<D>D<C>C<C>C<<B>B<B>BD>D<D>D<C>C<C>C<<B->B-<B->B-<A2>D4>D4<DA>D4<G4>G.D16<G>DG<GC4>C.<G16C4>C4<F4>F.C16<F>CF4<<B-4>B-4<B->FB-<B-B4>B4<BB>B4C4>C.<G16C4>C4<C#4>C#.<A16C#A>C#<C#D4>D4<DA>D4<G4>G..D16<G>DG<GC4>C.<G16C4>C4<E-4>E-.<E-16DD>D<D>>v15A.G.GrGAEG.F.F4.DEFF16E.EFEGF16F16D2rAB-F#A.G.GrGAEG.F.F4FGFE.E.ED#.B.AAG#G#A16BG#.ABo1A4>A4DA>D<DG4>G<GCG>C<CF#4>F#4<<B4>B4E16>E<E16>E<F#G#>EG#<G#<A4>A4DA>D<DF4>F<FEB>E<E<A.>E16A4<B>F#B<Bo5F#.E.<B>F#.E.<B>G.F#.&F#A.G.<A16>E16F.E.<A>F.E.<A>G.F.&FL32rC#EA4.&Arr<<F#A>CE1&E4.r4.rrr,\n        v14r16<L8E.F#G#<A2>D4.<F#G2>C2<F#4.AB2r16E.EF#G#.>E.&E>L4EGF#AAGL8<AG16G.&G>E.E<A.>E4D#4>F#.E.<BB.B.GB.B.&B>D#.D#.r<A.A.rA.A.rA.A.&Ar2<A.>C4r.F.A.B-.D16r4.F.F.<B-.B-16r4.>D.<B-.>C2rC.E.C.<A16r4.>A4.F2rD.D.F.C16r4.G.F.B-.C16r4E4A4A4r4.>C.<A.B-2rF.F.D2r<B-.>E-.F.D-16r4F#4C4>A.G.&GA.B-.&B->C.<F.&FE.F.&FF.E.&EF.E.&ED.<A.A.B-.><F4L2DDE-D<AB>E<B4>E4L8E-.G.CE-.E-.CE.F#.>D<B4E4E.CC.<B.>D.rE16>E.ED#D<E.G.D.G.CF#.F#.DA.F.AA.G#.&G#E4ECD#<B.B.L2>GGBAAAAG;\n        "),null!=o&&(e.stopPropagation(),"E"==He.world.getProperty(i+o,s+n).char||He.world.entityManager.getEntity(i+o,s+n)?He.player.interact(i+o,s+n):He.player.findPathAndMoveTo(i+o,s+n))}function rt(e,i){if(He.interface.isSidePanelOpened())return;this.tw&&this.tw.stop(),this.twCursor&&this.twCursor.stop(),this.twCursor=new t.kX(this,500,{x:He.world.viewWidth/2,y:He.world.viewHeight/2},{ease:t.Ui.outCubic});const s=new t.kX(He.world,500,{viewX:e,viewY:i},{ease:t.Ui.outCubic}).onChange((()=>{console.assert(!Number.isNaN(He.world.viewX)),He.interface.isSidePanelOpened()||He.world.sightManager.moveViewTo(He.world.viewX+He.world.getX()/2,He.world.viewY+He.world.getY()/2)})).onComplete((()=>{this.tw=null}));this.tw=s}function at(e,i){new t.Kj;const s=new P(new t.xE("BlackFrame.png",!1,{format:t.Wc.RGBA5551})),o=e.getWidth()+i.getWidth()+40,n=Math.max(e.getHeight(),i.getHeight())+10,r=new t.jy;s.setRect(-o/2,-n/2,o,n),s.setAlpha(.8);const a=new t.eY(new t.xE("useTo.png",!1,{format:t.Wc.RGBA5551}));a.setOverrideColor(16748544),a.setAnchorPoint(.5,.5),a.setPosition(0,0),a.setBlendMode(t.jy.BlendModes.ADD);const l=new t.KG([[0,60,a,{alpha:[0,1]}],[61,120,a,{alpha:[1,0]}],[120,"goto",0]]);return r.addChild(s),r.addChild(l),e.setPosition(-o/2/2.1,-2),r.addChild(e),i.setPosition(o/2/2.1,-2),r.addChild(i),r}class lt extends t.jy{constructor(){super(),this.mesh=new e(new t.xE("cursors.png",!1,{format:t.Wc.RGBA4444}),1,1,32,32),this.addChild(this.mesh),this.setType("player"),this.moveDir=1,this.mode="melee",this.reservedClick=[],this.__touches=null,this.setPosition(He.world.viewWidth/2,He.world.viewHeight/2),this.addEventListener(t.ju.POINTER_DOWN,Z,this),this.addEventListener(t.ju.POINTER_UP,et,this),this.addEventListener(t.ju.POINTER_MOVE,tt,this),this.addEventListener(t.ju.KEY_DOWN,nt,this),this.addEventListener(t.ju.MOUSE_WHEEL,q,this),this.addEventListener(t.ju.MOUSE_DOWN,it,this),this.addEventListener(t.ju.MOUSE_UP,ot,this),this.addEventListener(t.ju.TOUCHES_MOVE,st,this)}holded(){if(this.__drag&&this.__drag.holded)return!0}cancelHold(){this.holdTimer&&(this.holdTimer.stop(),this.holdTimer=null),this.__drag=null}setType(t,e){this.mesh.setColRow(Q[t],1),e?this.mesh.setOverrideColor(e):this.mesh.setOverrideColor(16777215,1)}resetScale(){const t=1/He.world.zoom,e=1/He.world.zoom;this.mesh.setScale(t,e)}snapToWorld(){const t=this.getPosition(),{x:e,y:i}=He.world.stageToTile(t.x,t.y);if(!this.tw){const{x:t,y:s}=He.world.tileCenterToWorld(e,i);rt.call(this,t,s)}return[e,i]}snapToPlayer(){const[t,e]=[He.player.tileX,He.player.tileY];if(!this.__drag){const{x:i,y:s}=He.world.tileCenterToWorld(t,e);rt.call(this,i,s)}return this.setType("player"),[t,e]}stopSnap(){this.tw&&(this.tw.stop(),this.tw=null),!this.holded()&&this.twCursor&&(this.twCursor.stop(),this.twCursor=null)}setTileXy(t,e){const{x:i,y:s}=He.world.tileCenterToStage(t,e);this.setPosition(i,s)}getTileXy(){const{x:t,y:e}=this.getPosition();return He.world.stageToTile(t,e)}lock(e){this.unlockTimer&&this.unlockTimer.stop(),this.locked=!0,this.setVisible(!1),e&&(this.unlockTimer=t.B7.delayedCall(e,this.unlock,this))}unlock(){this.unlockTimer&&this.unlockTimer.stop(),this.unlockTimer=null,this.locked=!1,this.setVisible(!0)}processReservedClick(){for(;this.reservedClick.length>0&&this.reservedClick[0][2]<t.B7.now()-500;)this.reservedClick.shift();this.reservedClick.length>0&&(console.log("ÏÑ†ÏûÖÎ†•Ï≤òÎ¶¨",this.reservedClick.length),this.click(this.reservedClick[0][0],this.reservedClick[0][1]),this.reservedClick.shift())}setMode(t){this.mode=t}click(t,e){let{x:i,y:s}=He.world.worldToTile(t,e),o=He.world.entityManager.getEntity(i,s);const n=o&&o instanceof H&&!(o instanceof z)&&!(o instanceof K)&&o.canBeSeen(),r=o&&o.isProp&&o.canBeSeen(),a=r&&!o.property.needPickAxe,l=(r&&o.property.needPickAxe,He.world.getDistance(He.player.tileX,He.player.tileY,i,s));if(He.player.stop(),o==He.player)return this.setType("player"),void He.player.doNothing("ÏïÑÎ¨¥ ÌñâÎèôÎèÑ ÌïòÏßÄ ÏïäÍ≥† Í∏∞Îã§Î†∏Îã§.");{let h=this.mode;if(n&&"melee"==this.mode&&1==l)h="melee";else if(n&&"ranged"==this.mode)h="ranged";else if(r&&1==l)h="melee";else if(a&&l>1&&"ranged"==this.mode)h="ranged";else{const n=He.player.getNearEntities(5,45,t,e);let r=!0;for(const a in n){const l=n[a];if(l&&l instanceof H&&!(l instanceof z)&&!(l instanceof K)&&l.canBeSeen()[0]){o=l,[i,s]=[o.tileX,o.tileY],({x:t,y:e}=He.world.tileCenterToWorld(i,s)),r=!1;break}if(l&&l.isProp&&!l.property.needPickAxe&&l.canBeSeen()[0]){o=l,[i,s]=[o.tileX,o.tileY],[t,e]=He.world.tileCenterToWorld(i,s).xy,r=!1;break}if(l&&l.isProp&&l.property.needPickAxe&&1==He.world.getDistanceBetweenEntities(l,He.player)){o=l,[i,s]=[o.tileX,o.tileY],[t,e]=He.world.tileCenterToWorld(i,s).xy,r=!1;break}}if(r)return He.world.entityManager.getItems(i,s)&&console.log("ÏïÑÏù¥ÌÖú ÏßëÍ∏∞"),void He.player.interact(i,s,!1,t,e)}this.setType("aim"),He.player.interact(i,s,"ranged"==h,t,e)}}drag(t,e,i,o){const{x:n,y:r}=He.world.worldToTile(i,o),[a,l]=[He.player.tileX,He.player.tileY],h=He.world.entityManager.getEntity(n,r),d=h&&h instanceof H&&!(h instanceof z)&&!(h instanceof K)&&h.canBeSeen(),c=h&&h.isProp&&h.canBeSeen(),u=(c&&h.property.needPickAxe,c&&h.property.needPickAxe,He.world.getProperty(n,r)),p=!h&&"E"==u.char,g=He.world.getDistance(a,l,n,r),m=this.mode;let f;if((d||c)&&(this.setType("aim"),"ranged"==m?(c?He.player.interact(n,r,g>1,i,o):He.player.interact(n,r,!0,i,o),f=!0):1==g&&(He.player.interact(n,r,!1,i,o),f=!0)),!f)if(u.revealed)p&&1==g?He.player.interact(n,r):"E"==u.char?(this.setType("door"),He.player.findPathAndMoveTo(n,r,n,r)):He.player.findPathAndMoveTo(n,r,n,r);else{const{x:t,y:e}=He.world.tileCenterToWorld(a,l),[h,d,c,u,p]=He.world.map.visibilityTileChecker.traceRay(t,e,i,o,s.World.tileWidth,s.World.tileHeight,v.BLOCK_PASS|v.BLOCK_VISION);"E"==He.world.getProperty(d,c).char?(this.setType("door"),He.player.findPathAndMoveTo(d,c,d,c)):He.player.findPathAndMoveTo(n,r)}}dragging(e,i,o,n){const{x:r,y:a}=He.world.worldToTile(o,n),[l,h]=[He.player.tileX,He.player.tileY],d=He.world.entityManager.getEntity(r,a),c=d&&d instanceof H&&!(d instanceof z)&&!(d instanceof K)&&d.canBeSeen()[0],u=d&&d.isProp&&d.canBeSeen()[0],p=u&&!d.property.needPickAxe,g=(u&&d.property.needPickAxe,He.world.getProperty(r,a)),m=null!=d&&"E"==g.char,f=He.world.getDistance(l,h,r,a);if(r==l&&a==h)this.setType("player");else if("ranged"==this.mode)if((c||p)&&(f>1||1==f&&"ranged"==this.mode)){this.__drag.aimed||(t.$u.playSound("sound/bow_aim.wav"),this.__drag.aimed=!0);const{x:e,y:i}=He.world.stageToWorld(this.getX(),this.getY()),{x:r,y:a}=He.world.tileCenterToWorld(l,h),[d,c,u,p,g]=He.world.map.visibilityTileChecker.traceRay(r,a,o,n,s.World.tileWidth,s.World.tileHeight,v.BLOCK_VISION|v.BLOCK_ARROW,((t,e)=>He.world.entityManager.getEntity(t,e))),m=new t.bn;m.setLineStyle(1,16777215,.5),m.moveTo(r-e,a-i),m.lineTo(p-e,g-i),m.endPath(),m.setScale(1/He.world.zoom),this.addChild(m),this.aimLine=m,d==x.EMPTY?this.setType("aim"):this.setType("aim",3158064)}else if(g.revealed)"E"==g.char?this.setType("door"):m&&1==f?this.setType("interact"):this.setType("tile");else{const{x:e,y:i}=He.world.stageToWorld(this.getX(),this.getY()),{x:r,y:a}=He.world.tileCenterToWorld(l,h),[d,c,u,p,g]=He.world.map.visibilityTileChecker.traceRay(r,a,o,n,s.World.tileWidth,s.World.tileHeight,v.BLOCK_VISION|v.BLOCK_ARROW);if("E"==He.world.getProperty(c,u).char){this.setType("door");const s=new t.bn;s.setLineStyle(1,16777215,.5),s.moveTo(r-e,a-i),s.lineTo(p-e,g-i),s.endPath(),s.setScale(1/He.world.zoom),this.addChild(s),this.aimLine=s}else this.setType("tile")}}showAutoAction(){null!=this.autoActionSprite&&this.autoActionSprite.removeFromParent(),null!=this.autoActionTargetSprite&&this.autoActionTargetSprite.removeFromParent();const[e,i,s,o,n]=this.getAutoAction();if(!e||!i||!o)return;const r=at.call(this,i,s);this.autoActionSprite=r,r.setPosition(t.wU.logicalViewport.width/2,t.wU.logicalViewport.height-40),r.setInteractive({preventRelease:!0,disableBasicAnimation:!0,pressAnimation:(t,e)=>t.target.move(e.downThisPosition.x,e.downThisPosition.y+3,50),releaseAnimation:(t,e)=>t.target.move(e.downThisPosition.x,e.downThisPosition.y,100),press:()=>{this.cancelHold(),this.__drag=null,this.doAutoAction()}});const a=this.mesh.clone(Q.target,1);a.setOverrideColor(16748544),a.setBlendMode(t.jy.BlendModes.ADD);const l=He.world.tileCenterToStage(o,n);a.setPosition(l.x,l.y);const h=new t.KG([[0,60,a,{alpha:[0,1],rotation:[0,360,"outCubic"]}],[61,120,a,{alpha:[1,0],rotation:[360,720,"inCubic"]}],[120,"goto",0]]);h.addEventListenerOnStage(t.ju.ENTER_FRAME,(()=>{const{x:t,y:e}=He.world.tileCenterToStage(o,n),i=1/He.world.zoom,s=1/He.world.zoom;a.setScale(i,s),a.setPosition(t*i,e*s)})),He.interface.hudLayer.origin.addChildAt(h,0),this.autoActionTargetSprite=h,He.interface.hudLayer.origin.addChild(r)}hideAutoAction(){if(this.autoActionSprite){const e=this.autoActionSprite;new t.kX(this.autoActionSprite,200,{alpha:0}).onComplete((()=>{null!=e&&e.removeFromParent()})),this.autoActionSprite=null}if(this.autoActionTargetSprite){const e=this.autoActionTargetSprite;new t.kX(this.autoActionTargetSprite,200,{alpha:0}).onComplete((()=>{null!=e&&e.removeFromParent()})),this.autoActionTargetSprite=null}}getAutoAction(t,e){let i,s,o;const n=He.player.getNearEntities(5,null,t,e);let r,a,l,h=!0;for(const r in n){const d=n[r];if(d&&d.isMonster&&!d.isPet&&!d.isNpc&&d.canBeSeen()[0]){i=d,[s,o]=[i.tileX,i.tileY],[t,e]=He.world.tileCenterToWorld(s,o).xy,a=He.player.getWeaponImage(),l=i.mesh.clone(),h=!1;break}if(d&&d.isProp&&!d.property.needPickAxe&&d.canBeSeen()[0]){d.canBeSeen()[0],i=d,[s,o]=[i.tileX,i.tileY],[t,e]=He.world.tileCenterToWorld(s,o).xy,a=He.player.getWeaponImage(),l=i.mesh.clone(),h=!1;break}if(d&&d.isProp&&d.property.needPickAxe&&1==He.world.getDistanceBetweenEntities(d,He.player)){a=He.player.getEquippedItemImage("pickaxe")||He.player.getWeaponImage(),i=d,[s,o]=[i.tileX,i.tileY],[t,e]=He.world.tileCenterToWorld(s,o).xy,l=i.mesh.clone(),h=!1;break}}return h||(1==He.world.getDistanceBetweenEntities(i,He.player)?r=i.isProp?()=>{He.player.interact(s,o,!1,t,e)}:()=>{He.player.interact(s,o,"ranged"==this.mode,t,e)}:"ranged"==this.mode&&(r=()=>{He.player.interact(s,o,!0,t,e)})),[r,a,l,s,o]}doAutoAction(t,e){this.hideAutoAction();const[i,s,o,n,r]=this.getAutoAction(t,e);console.log("ÏûêÎèôÏï°ÏÖò Ïã§Ìñâ"),n&&i()}}function ht(t){return[Math.floor(t/65536)%65536/255,Math.floor(t/256)%256/255,t%256/255]}function dt(e){if(0==e.isVisible())return;e.clicked=!0,e.sound&&playSound(e.sound);let i=new t.ju("click");i.checked=e.checked,e.dispatchEvent(i)}function ct(t,e){e.getRegion?t.setTextureRegion(e):t.setTexture(e)}function ut(t){t._tween=null,t._tweenSprite=null,t._tweenText=null,t._tweenIcon=null}function pt(t){t._tween&&t._tween.stop(),t._tweenSprite&&t._tweenSprite.stop(),t._tweenText&&t._tweenText.stop(),t._tweenIcon&&t._tweenIcon.stop(),ut(t)}function gt(e,i){0!=this.isVisibleDeeply()&&((this.hitBox||this.upSprite).hitTestPoint(e.x,e.y)||i)&&(this.pointerHold=!0,this.clicked||(pt(this),this.tween=new t.kX(this.upSprite,this.down.duration,{scaleX:this.down.scaleX,scaleY:this.down.scaleY,x:this.down.x,y:this.down.y,alpha:this.down.alpha},{ease:this.down.ease}),this.tween.addEventListener("complete",(()=>{ut(this),this.isCompletelyDownState=!0,this.singleSpriteType||(this.upSprite.setVisible(!1),this.downSprite.setVisible(!0),this.buttonChild&&this.downSprite.addChild(this.buttonChild)),this.checkBox&&(this.checked?(console.log("Ï≤¥ÌÅ¨Î∞ïÏä§ÏºúÍ∏∞",this.upSprite.icon,this.up.iconChecked),ct(this.upSprite.icon,this.up.iconChecked),ct(this.downSprite.icon,this.down.iconChecked||this.up.iconChecked)):(console.log("Ï≤¥ÌÅ¨Î∞ïÏä§ÎÅÑÍ∏∞",this.upSprite.icon,this.up.icon),ct(this.upSprite.icon,this.up.icon),ct(this.downSprite.icon,this.down.icon||this.up.icon)))})),this.checkBox&&(this.checked=!this.checked),this.tweenSprite=new t.kX(this.upSprite.image,this.down.duration,{redMultiplier:this.down.colorR,greenMultiplier:this.down.colorG,blueMultiplier:this.down.colorB},{ease:this.down.ease}),this.upSprite.text&&(this.tweenText=new t.kX(this.upSprite.text,this.down.duration,{x:this.down.textX,y:this.down.textY,redMultiplier:this.down.textColorR,greenMultiplier:this.down.textColorG,blueMultiplier:this.down.textColorB,alpha:this.down.alpha},{ease:this.down.ease})),this.upSprite.icon&&(this.tweenIcon=new t.kX(this.upSprite.icon,this.down.duration,{x:this.down.iconX,y:this.down.iconY},{ease:this.down.ease})),this.buttonChild&&(this.tweenChild=new t.kX(this.buttonChild,this.down.duration,{redMultiplier:this.down.textColorR,greenMultiplier:this.down.textColorG,blueMultiplier:this.down.textColorB,alpha:this.down.alpha},{ease:this.down.ease})),!i&&this.clickOnDown?dt(this):this.down.sound&&playSound(this.down.sound)),e.stopPropagation())}function mt(e){e.isCompletelyDownState=!1,e.singleSpriteType||(e.upSprite.setVisible(!0),e.downSprite.setVisible(!1),e.buttonChild&&e.upSprite.addChild(e.buttonChild)),e._tween=new t.kX(e.upSprite,e.up.duration,{scaleX:e.up.scaleX,scaleY:e.up.scaleY,x:e.up.x,y:e.up.y,alpha:e.up.alpha},{ease:e.up.ease}),e._tween.addEventListener("complete",(()=>{ut(e)})),e._tweenSprite=new t.kX(e.upSprite.image,e.up.duration,{redMultiplier:e.up.colorR,greenMultiplier:e.up.colorG,blueMultiplier:e.up.colorB},{ease:e.down.ease}),e.upSprite.text&&(e._tweenText=new t.kX(e.upSprite.text,e.up.duration,{x:e.up.textX,y:e.up.textY,redMultiplier:e.up.textColorR,greenMultiplier:e.up.textColorG,blueMultiplier:e.up.textColorB,alpha:e.up.alpha},{ease:e.up.ease})),e.upSprite.icon&&(e._tweenIcon=new t.kX(e.upSprite.icon,e.up.duration,{x:e.up.iconX,y:e.up.iconY},{ease:e.up.ease})),e.buttonChild&&(e._tweenChild=new t.kX(e.buttonChild,e.up.duration,{redMultiplier:e.up.textColorR,greenMultiplier:e.up.textColorG,blueMultiplier:e.up.textColorB,alpha:e.up.alpha},{ease:e.up.ease})),e.clicked=!1}function ft(t,e){if(0==this.isVisible())return;if(!this.pointerHold)return;t.stopPropagation(),e||(this.pointerHold=!1),pt(this);let[i,s,o,n]=this.cancelBound,r=this.globalToLocal(t.x,t.y),a=r.x,l=r.y;!this.clicked&&!this.clickOnDown&&!e&&i<=a&&a<i+o&&s<=l&&l<s+n&&dt(this),this.clicked&&this.holdDownOnClick||(e&&this.up.sound&&playSound(this.up.sound),mt(this),e&&this.checkBox&&(this.checked=!this.checked,this.checked?(console.log("Ï∫îÏä¨Î°ú Ï≤¥ÌÅ¨Î∞ïÏä§ÏºúÍ∏∞"),ct(this.upSprite.icon,this.up.iconChecked),ct(this.downSprite.icon,this.down.iconChecked||this.up.iconChecked)):(console.log("Ï∫îÏä¨Î°ú Ï≤¥ÌÅ¨Î∞ïÏä§ÎÅÑÍ∏∞"),ct(this.upSprite.icon,this.up.icon),ct(this.downSprite.icon,this.down.icon||this.up.icon))))}function wt(t){if(0!=this.isVisible()&&this.pointerHold){let[e,i,s,o]=this.cancelBound,{x:n,y:r}=this.globalToLocal(t.x,t.y);e<=n&&n<e+s&&i<=r&&r<i+o?this.isCompletelyDownState||null!=this.tween||gt.call(this,t,!0):this.isCompletelyDownState&&null==this.tween&&ft.call(this,t,!0),t.stopPropagation()}}function yt(e){return e.RGBA5551?[new t.eY(e),!0]:[e,!1]}class Et extends t.jy{constructor(e){super(),e=e||{},this.checkBox=e.checkBox,this.checked=e.checked,this.holdDownOnClick=e.holdDownOnClick,this.clickOnDown=e.clickOnDown,this.sound=e.sound,this.textureTypeImage=!0,this.singleSpriteType=!1,this.isCompletelyDownState=!1,this.textMaxWidth=e.textMaxWidth,this.buttonChild=e.buttonChild,this.buttonChildPos=e.buttonChildPos||{x:0,y:0},this.hitBox=e.hitBox,this.hitBoxPos=e.hitBoxPos||{x:0,y:0},this.spriteTypeIcon=e.spriteTypeIcon;let i=e.up,s=e.down||{},o=e.disable||{};s.width=i.width,s.height=i.height,i.textColor=i.textColor||0,i.textX=i.textX||0,i.textY=i.textY||0,i.iconX=i.iconX||0,i.iconY=i.iconY||0,i.iconColor=i.iconColor||16777215,i.iconScale=i.iconScale||1,i.color=i.color||16777215,i.alpha=i.alpha||1,i.scaleX=i.scaleX||i.scale||1,i.scaleY=i.scaleY||i.scale||1,i.x=i.x||0,i.y=i.y||0,i.ease=i.ease||t.Ui.outBack,i.duration=i.duration||150,i.useSpriteAnchorPoint=i.useSpriteAnchorPoint||!1,s.text=s.text||i.text,s.textColor=s.textColor||i.textColor,s.textX=s.textX||i.textX,s.textY=s.textY||i.textY,s.iconX=s.iconX||i.iconX,s.iconY=s.iconY||i.iconY,s.iconColor=s.iconColor||i.iconColor,s.iconScale=s.iconScale||i.iconScale,s.color=s.color||i.color,s.alpha=s.alpha||i.alpha,s.scaleX=s.scaleX||s.scale||i.scaleX,s.scaleY=s.scaleY||s.scale||i.scaleY,s.x=s.x||i.x,s.y=s.y||i.y,s.ease=s.ease||i.ease,s.duration=s.duration||i.duration,o.color=o.color||8421504,o.alpha=o.alpha||1,o.spriteTypeAlpha=o.spriteTypeAlpha||.6,this.up=i,this.down=s,this.disable=o,[i.colorR,i.colorG,i.colorB]=ht(i.color),[s.colorR,s.colorG,s.colorB]=ht(s.color),[i.textColorR,i.textColorG,i.textColorB]=ht(i.textColor),[s.textColorR,s.textColorG,s.textColorB]=ht(s.textColor);{let e;this.upSprite=new t.jy;let s,o={x:.5,y:.5};i.image?([e,this.textureTypeImage]=yt(i.image),!this.textureTypeImage&&i.useSpriteAnchorPoint&&(o=e.getAnchorPoint())):e=Mesh.createBox(0,0,i.width,i.height,16777215),e.setAnchorPoint?e.setAnchorPoint(o.x,o.y):e.setPosition(-o.x*e.getWidth(),-o.y*e.getHeight()),e.setColorMultiplier(i.colorR,i.colorG,i.colorB),this.upSprite.addChild(e),i.text&&(this.upSprite.textInfo={font:i.font,x:i.textX,y:i.textY,r:i.textColorR,g:i.textColorG,b:i.textColorB,alignLeft:i.textAlignLeft,color:i.textColor}),i.icon&&(s=this.checkBox&&this.checked?this.spriteTypeIcon?i.iconChecked:new t.eY(i.iconChecked):this.spriteTypeIcon?i.icon:new t.eY(i.icon),s.setScale(i.iconScale),s.setAnchorPoint(.5,.5),s.setPosition(i.iconX,i.iconY),s.setOverrideColor(i.iconColor),this.upSprite.addChild(s)),this.buttonChild&&(this.buttonChild.setPosition(this.buttonChildPos.x,this.buttonChildPos.y),this.buttonChild.setColorMultiplierByHex(i.textColor),this.upSprite.addChild(this.buttonChild)),this.upSprite.setX(i.x),this.upSprite.setY(i.y),this.upSprite.setScaleX(i.scaleX),this.upSprite.setScaleY(i.scaleY),this.addChild(this.upSprite),this.upSprite.image=e,this.upSprite.icon=s,this.upSprite.setAlpha(i.alpha)}{let e,o;this.downSprite=new t.jy,s.image?e=yt(s.image):this.textureTypeImage?i.image?e=yt(i.image):(e=new t.bn,e.makeBox(0,0,s.width,s.height,16777215)):(this.singleSpriteType=!0,e=new t.jy),e.setAnchorPoint(.5,.5),e.setColorMultiplier(s.colorR,s.colorG,s.colorB),this.downSprite.addChild(e),s.text&&(this.downSprite.textInfo={font:s.font||i.font,x:s.textX,y:s.textY,r:s.textColorR,g:s.textColorG,b:s.textColorB,alignLeft:s.textAlignLeft||i.textAlignLeft,color:s.textColor}),(s.icon||i.icon)&&(o=this.checkBox&&this.checked?this.spriteTypeIcon?s.iconChecked||i.iconChecked:new t.eY(s.iconChecked||i.iconChecked):this.spriteTypeIcon?s.icon||i.icon:new t.eY(s.icon||i.icon),o.setScale(s.iconScale),o.setAnchorPoint(.5,.5),o.setOverrideColor(s.iconColor),o.setPosition(s.iconX,s.iconY),this.downSprite.addChild(o)),this.downSprite.setX(s.x),this.downSprite.setY(s.y),this.downSprite.setScaleX(s.scaleX),this.downSprite.setScaleY(s.scaleY),this.downSprite.setVisible(!1),this.addChild(this.downSprite),this.downSprite.icon=o,this.downSprite.setAlpha(s.alpha)}this.setText(i.text,s.text);{this.hitBox&&(this.hitBox.setAlpha(0),this.hitBox.setPosition(this.hitBoxPos.x,this.hitBoxPos.y),this.addChild(this.hitBox));let{x:t,y:e,width:i,height:s}=(this.hitBox||this.upSprite).getBounds(this);this.cancelBound=[t-Et.cancelMargin,e-Et.cancelMargin,i+2*Et.cancelMargin,s+2*Et.cancelMargin]}this.setEnabled(!0)}_setText(e,i){let s=e.textInfo,o=new t.nv(s.font,i);o.setTextColor(16777215),o.setColorMultiplier(s.r,s.g,s.b);let[,n,,r]=s.font.getBounds0(),[a,,l]=s.font.getBounds(i),[h,d]=[.5,.5];s.alignLeft&&(h=0);let c=1;this.textMaxWidth&&l>this.textMaxWidth&&(c=this.textMaxWidth/l,o.setScaleX(c)),h=(a+l*h)/o.getWidth()*c,d=(n+r*d)/o.getHeight(),o.setAnchorPoint(h,d),o.setPosition(s.x,s.y),e.addChild(o),e.text=o,e.textStr=i}setText(t,e){this.up.text=t,this.down.text=e,this.upSprite.text&&(this.upSprite.text.removeFromParent(),this.upSprite.text=null),this.downSprite.text&&(this.downSprite.text.removeFromParent(),this.downSprite.text=null),t&&this.upSprite.textInfo&&this._setText(this.upSprite,t),e&&this.downSprite.textInfo&&this._setText(this.downSprite,e)}setIconScale(t,e){this.upSprite.icon&&this.upSprite.icon.setScale(t,e),this.downSprite.icon&&this.downSprite.icon.setScale(t,e)}setTextScale(t,e){this.upSprite.text&&this.upSprite.text.setScale(t,e),this.downSprite.text&&this.downSprite.text.setScale(t,e)}setTextColor(t){this.upSprite.text&&this.upSprite.text.setTextColor(t),this.downSprite.text&&this.downSprite.text.setTextColor(t),this.upSprite.textInfo&&(this.upSprite.textInfo.color=t),this.downSprite.textInfo&&(this.downSprite.textInfo.color=t)}setButtonColor(t){this.up.color=t,this.down.color=t;let e,i=ht(t);this.up.colorR,this.up.colorG,this.up.colorB=e,this.down.colorR,this.down.colorG,this.down.colorB=e,this.upSprite.image.setColorMultiplier(e,undefined,i)}setEnabled(e){e!=this.enabled&&(1==e?(pt(this),this.upSprite.addEventListener(t.ju.POINTER_DOWN,gt,this),this.downSprite.addEventListener(t.ju.POINTER_DOWN,gt,this),this.upSprite.addEventListener(t.ju.POINTER_UP,ft,this),this.downSprite.addEventListener(t.ju.POINTER_UP,ft,this),this.upSprite.addEventListener(t.ju.POINTER_MOVE,wt,this),this.downSprite.addEventListener(t.ju.POINTER_MOVE,wt,this),this.enabled=!0,this.setColorMultiplier(1,1,1),this.setAlpha(1)):(pt(this),this.upSprite.removeEventListener(t.ju.POINTER_DOWN,gt,this),this.downSprite.removeEventListener(t.ju.POINTER_DOWN,gt,this),this.upSprite.removeEventListener(t.ju.POINTER_UP,ft,this),this.downSprite.removeEventListener(t.ju.POINTER_UP,ft,this),this.upSprite.removeEventListener(t.ju.POINTER_MOVE,wt,this),this.downSprite.removeEventListener(t.ju.POINTER_MOVE,wt,this),this.enabled=!1,1==this.textureTypeImage?(this.setOverrideColor(this.disable.color),this.setAlpha(this.disable.alpha),this.upSprite.setColorMultiplier(this.up.colorR,this.up.colorG,this.up.colorB)):(this.setOverrideColor(this.disable.color),this.setAlpha(this.disable.spriteTypeAlpha)),this.upSprite.setVisible(!0),this.downSprite.setVisible(!1),this.upSprite.setPosition(this.up.x,this.up.y),this.upSprite.setScale(this.up.scaleX,this.up.scaleY),this.upSprite.setAlpha(this.up.alpha),this.upSprite.text&&(this.upSprite.text.setPosition(this.up.textX,this.up.textY),this.upSprite.text.setColorMultiplier(this.up.textColorR,this.up.textColorG,this.up.textColorB,this.up.alpha)),this.upSprite.icon&&this.upSprite.icon.setPosition(this.up.iconX,this.up.iconY)))}setCanceled(){let e=new t.ju("cancel");e.x=0,e.y=0,ft(this,e)}forceUp(){mt(this)}}Et.cancelMargin=30;class Ct extends h{constructor(t,e,i,s){super(t,e,i,s),this.isProp=!0,this.char=t,this.fillProperties(Ct.property,t);const o=this.property;this.name=o.name,this.imageNum=He.world.random(0,o.images.length-1),this.colorNum=He.world.random(0,o.colors.length-1),this.hp=o.hp,this.hpMax=this.hp,this.texture=Ct.texture,this.tileWidth=Ct.tileWidth,this.tileHeight=Ct.tileHeight,this.postInit(Ct)}damage(e,i,s,o,n,r){if(n=n||0,this.hp=this.hp-e,this.hp<=0){this.detachFromWorld(),new F("breakProp",s,o,this.getX(),this.getY(),this,i,n),t.B7.delayedCall(n,(()=>{const e=new t.DK;e.setTexture(new t.xE("Blood.png",!1)),console.log("ÏÇ¨Îßù",this.getPosition());for(let i=1;i<=10;i++){const i=t.cQ.random(0,359),s=t.cQ.random(1,6),{x:o,y:n}=this.getPosition();e.addParticles([{x:o,y:n,size:t.cQ.random(4,30),angle:i,ttl:60+t.cQ.random(1,100),speedX:Math.cos(i)*s,speedY:Math.sin(i)*s,speedAngular:t.cQ.random(1,30)-15,decay:.5,color:4210752,alpha:1}])}He.world.floorLayer.addChild(e),t.$u.playSound("sound/"+this.property.breakSound),t.B7.delayedCall(5e3,(()=>{e.removeFromParent(),this.removeFromWorld()}))})),He.interface.addLog("%s{Î•º} Î∂ÄÏâàÎã§!",this.name),He.player.exp=He.player.exp+1;const e=He.world.random(1,4),r=He.world.pathManager.getSplashFloor(this.tileX,this.tileY,e);for(let t=0;t<e;t++)He.world.entityManager.addEntity(new U(U.gold,r[t].x,r[t].y,{amount:He.world.random(1,30),drop:!0,dropX:this.tileX,dropY:this.tileY,dropDelay:100*(e-t)+n}));1==He.world.random(1,3)&&He.world.entityManager.addEntity(new U(U.validIdList[He.world.random(0,U.validIdList.length-1)],this.tileX,this.tileY,{drop:!0,dropX:this.tileX,dropY:this.tileY,dropDelay:100+n})),this.property.explosion&&("water"==this.property.explosion?(t.$u.playSound("sound/explosion_water.wav"),new F("boom",this.getX(),this.getY(),20,350,n,255),He.world.elemental.addElemental(D.WATER,this.tileX,this.tileY,10)):"fire"==this.property.explosion?(t.$u.playSound("sound/explosion_fire.wav"),new F("boom",this.getX(),this.getY(),50,300,n,16748544),He.world.elemental.addElemental(D.FIRE,this.tileX,this.tileY,10)):"poison"==this.property.explosion&&(t.$u.playSound("sound/explosion_gas.wav"),new F("boom",this.getX(),this.getY(),30,400,n,16711935),He.world.elemental.addElemental(D.POISON,this.tileX,this.tileY,10)))}else new F("hitProp",s,o,this.getX(),this.getY(),this,i,n),He.interface.addLog("%s{Î•º} Í≥µÍ≤©ÌïòÏó¨ %d ÎåÄÎØ∏ÏßÄ!",this.getName(),e)}}function _t(){let i=this.baseSpr,s=this.target,o=t.wU.logicalViewport.width/2,n=(t.wU.logicalViewport.height-this.height)/2+20,r=s.getIcon();r.setPosition(o,n+23),i.addChild(r);let a=He.interface.getHiresTextField(s.name);a.setTextColor(s.color),a.setPosition(o-a.getWidth()/2,n+44-10),i.addChild(a);let l=He.interface.getHiresTextWrap(s.getDesc(),this.width-20,100,15,je.ttf,"center");if(l.setAnchorPoint(.5,0),l.setTextColor(12632256),l.setPosition(o,n+50),i.addChild(l),"instrument"==s.property.type){let r=new t.eY(new t.xE("detailButton.png",!1,{format:t.Wc.RGBA5551}));r.setAnchorPoint(.5,.5);let a=He.interface.getHiresTextField("Ïó∞Ï£ºÌïúÎã§",He.interface.uiTtf);a.setTextColor(0),a.setPosition(-a.getWidth()/2+4,-7),r.addChild(a);let l=new e(new t.xE("detailButtonIcon.png",!1,{format:t.Wc.RGBA5551}),1,2,16,16,0,1);l.setScale(.75),l.setPosition(-a.getWidth()/2-4,0),r.addChild(l);let h=new Et({up:{image:r,useSpriteAnchorPoint:!0},down:{y:1}});h.setPosition(o,n+this.height-63),i.addChild(h),h.on("click",(()=>{this.close(),He.player.inventory.close((()=>{let t=He.player.inventory.findEquippedItemByType("note")[0];t?He.player.playMusic(t.property.mml):He.interface.addLog("Ïó∞Ï£º Ìï† ÏïÖÎ≥¥Í∞Ä ÏóÜÎã§.")}))})),s.isEquippable()&&!s.equipped&&h.setEnabled(!1)}{let r,a;s.equipped?(r="Ïû•ÎπÑÌï¥Ï†ú",a=2):(r="Ïû•ÎπÑÌïúÎã§",a=1);let l=new t.eY(new t.xE("detailButton.png",!1,{format:t.Wc.RGBA5551}));l.setAnchorPoint(.5,.5);let h=He.interface.getHiresTextField(r,He.interface.uiTtf);h.setTextColor(0),h.setPosition(-h.getWidth()/2+4,-7),l.addChild(h);let d=new e(new t.xE("detailButtonIcon.png",!1,{format:t.Wc.RGBA5551}),a,1,16,16,0,1);d.setScale(.75),d.setPosition(-h.getWidth()/2-4,0),l.addChild(d);let c=new Et({up:{image:l},down:{y:1}});c.setPosition(o-30,n+this.height-38),i.addChild(c),c.on("click",(()=>{this.close(),He.player.inventory.tryEquip(s)})),s.isEquippable()||c.setEnabled(!1)}{let s=new t.eY(new t.xE("detailButton.png",!1,{format:t.Wc.RGBA5551}));s.setAnchorPoint(.5,.5);let r=He.interface.getHiresTextField("ÎçòÏßÑÎã§",He.interface.uiTtf);r.setTextColor(0),r.setPosition(-r.getWidth()/2+4,-7),s.addChild(r);let a=new e(new t.xE("detailButtonIcon.png",!1,{format:t.Wc.RGBA5551}),7,1,16,16,0,1);a.setScale(.75),a.setPosition(-r.getWidth()/2-4,0),s.addChild(a);let l=new Et({up:{image:s},down:{y:1}});l.setPosition(o+30,n+this.height-38),l.setEnabled(!1),i.addChild(l)}{let s=new t.eY(new t.xE("detailButton.png",!1,{format:t.Wc.RGBA5551}));s.setAnchorPoint(.5,.5);let r=He.interface.getHiresTextField("Í∞êÏ†ïÌïúÎã§",He.interface.uiTtf);r.setTextColor(0),r.setPosition(-r.getWidth()/2+4,-7),s.addChild(r);let a=new e(new t.xE("detailButtonIcon.png",!1,{format:t.Wc.RGBA5551}),4,1,16,16,0,1);a.setScale(.75),a.setPosition(-r.getWidth()/2-4,0),s.addChild(a);let l=new Et({up:{image:s},down:{y:1}});l.setPosition(o-30,n+this.height-18),l.setEnabled(!1),i.addChild(l)}{let r=new t.eY(new t.xE("detailButton.png",!1,{format:t.Wc.RGBA5551}));r.setAnchorPoint(.5,.5);let a=He.interface.getHiresTextField("Î≤ÑÎ¶∞Îã§",He.interface.uiTtf);a.setTextColor(0),a.setPosition(-a.getWidth()/2+4,-7),r.addChild(a);let l=new e(new t.xE("detailButtonIcon.png",!1,{format:t.Wc.RGBA5551}),3,1,16,16,0,1);l.setScale(.75),l.setPosition(-a.getWidth()/2-4,0),r.addChild(l);let h=new Et({up:{image:r},down:{y:1}});h.setPosition(o+30,n+this.height-18),i.addChild(h),h.on("click",(()=>{this.close(),He.player.inventory.dropItem(s)}))}}function At(t){this.close(),t.stopPropagation()}function xt(t){this.wf.hitTestPoint(t.x,t.y)&&t.stopPropagation()}Ct.texture=new t.xE("prop.png",!1,{format:t.Wc.RGBA5551}),Ct.width=16,Ct.height=24,Ct.tileWidth=16,Ct.tileHeight=24,Ct.perRow=Math.floor(Ct.texture.width/Ct.tileWidth),Ct.property={"@":{name:"Ìï≠ÏïÑÎ¶¨",hp:1,hitSound:null,breakSound:"break_2.wav",colors:[13612938],images:[[1,1],[2,1],[3,1],[4,1],[5,1],[6,1],[7,1]]},"#":{name:"ÎÇòÎ¨¥ÏÉÅÏûê",hp:1,hitSound:null,breakSound:"break_1.wav",colors:[9520412],images:[[1,2],[2,2],[3,2]]},"&":{name:"Í¥ëÎ¨º",hp:5,hitSound:null,breakSound:"break_1.wav",slice:!1,particle:15,needPickAxe:!0,colors:[4989768],images:[[1,3],[2,3],[3,3],[4,3]]}};class vt extends t.jy{constructor(t){super(),this.width=140,this.height=180,console.log("ÏûêÏÑ∏Ìïú Ï†ïÎ≥¥ ÏöîÏ≤≠",t.name),this.target=t}show(){let[e,i,s,o]=t.wU.logicalRenderBounds.xywh,n=t.Kj.createBox(e,i,s,o,0,.7);this.addChild(n),n.on(t.ju.POINTER_DOWN,At,this),n.on(t.ju.POINTER_UP,At,this),this.back=n;let r=new P(new t.xE("RectFrame.png",!1,{format:t.Wc.RGBA5551}));this.openRate=0,n.addChild(r),He.interface.modalLayer.origin.addChild(this),r.on(t.ju.POINTER_DOWN,xt,this),r.on(t.ju.POINTER_UP,xt,this),this.wf=r,this.baseSpr=new t.jy,this.wf.addChild(this.baseSpr),_t.call(this),new t.kX(this,300,{openRate:1},{ease:t.Ui.outBack}).onChange((()=>{r.setRect((t.wU.logicalViewport.width-this.width)/2,(t.wU.logicalViewport.height-this.height*this.openRate)/2+20,this.width,this.height*this.openRate)})),t.$u.playSound("sound/top_menu_open.wav")}close(){t.$u.playSound("sound/top_menu_close.wav"),this.back.removeEventListener(t.ju.POINTER_DOWN,At,this),this.back.removeEventListener(t.ju.POINTER_UP,At,this),new t.kX(this,200,{openRate:0},{ease:t.Ui.inBack}).onChange((()=>{this.wf.setRect((t.wU.logicalViewport.width-this.width)/2,(t.wU.logicalViewport.height-this.height*this.openRate)/2+20,this.width,this.height*this.openRate)})).onComplete((()=>{this.removeFromParent()}))}}function Bt(e,i,s){const o=new t.jy,n=t.Kj.createBox(-Math.floor(this.width/2),-10,this.width,20,16777215),r=t.Kj.createBox(1-Math.floor(this.width/2),-9,this.width-4,18,16711680);o.addChild(n),o.addChild(r);const a=new t.nv(null,e.text);return a.setPosition(Math.floor(-a.getWidth()/2),Math.floor(-a.getHeight()/2+Font.getDefault().getAscender())),a.setTextColor(16777215),o.addChild(a),[o,null,20]}function Tt(t){return"top"==this.align?t<this.topPosition?this.itemHeight<this.height?t=this.topPosition:t+this.itemHeight<this.height&&(t=this.height-this.itemHeight):this.itemHeight<this.height?t+this.itemHeight>0&&(t=this.topPosition):this.height<t+this.itemHeight&&(t=this.topPosition):"bottom"==this.align&&(t+this.itemHeight>this.topPosition+this.height?this.itemHeight<this.height?t=this.height-this.itemHeight-1:t>0&&(t=0):this.itemHeight<this.height?t+this.itemHeight<this.height&&(t=this.height-this.itemHeight-1):t+this.itemHeight<this.topPosition+this.height&&(t=this.height-this.itemHeight-1)),t}function bt(t){return!(t>=this.parentSprite.getNumChildren()||t<0)}function Mt(t){if(!bt.call(this,t)||t>=this.parentSprite.getNumChildren())return[!1,null];const e=this.parentSprite.getChildAt(t),i=null!=e._height?e._height:e.getHeight();let s,o,n=0+this.cutOffsetTop,r=this.height+this.cutOffsetBottom;return this.clip&&(n=null!=this.clip.top?this.clip.top:n,r=null!=this.clip.bottom?this.clip.bottom:r),this.dontHide?o=!0:(s=e.getY()+this.parentSprite.getY(),o=s+i/2>n&&s-i/2<r),[o,e]}function Pt(t,e,i){let s,o,n,r=this.y1;i&&(s=i[e],[o,n]=[s._$$customWidth,s._$$customHeight]),s||([s,o,n]=this.spriteFunc(this,e,t,this.owner),s._$$customWidth=null!=o?o:s._$$customWidth,s._$$customHeight=null!=n?n:s._$$customHeight),e.targetPosY=r;const a=null!=n?n:s.getHeight(),l=null!=o?o:s.getWidth();0==t&&this.params.pullToRefresh&&(this.pullLength=a+this.params.padding,r-=this.pullLength),this.animationFunc?(s.setPosition(this.width/2+(s.getWidth()-l)/2,r+Math.floor(a/2)),this.animationFunc(this,s,t)):s.setPosition(this.width/2+(s.getWidth()-l)/2,r+Math.floor(a/2)),this.parentSprite.addChild(s),s._skipLineFeed&&t!=this.items.length-1||(this.y1=this.y1+a+this.params.padding),this.items[t].sprite=s,s.setVisible(!1)}function Ft(t,e){if(null!=this.items&&0!=this.items.length)for(let i=t=t||0;i<this.items.length;i++){const t=this.items[i];if(!bt.call(this,i)&&(Pt.call(this,i,t,e),null!=this.sprDynamic&&(this.itemHeight=Math.max(this.y1,this.y2)-this.params.padding-this.params.topMargin,this.itemHeight>this.height-this.targetPosY)))break}}function St(){if(!(this.lowerbound&&this.upperbound&&Mt.call(this,this.lowerbound)&&Mt.call(this,this.upperbound))||Mt.call(this,this.lowerbound-1)||Mt.call(this,this.upperbound+1)){if(this.lowerbound=null,this.upperbound=null,this.items)for(const e in this.items){if(this.items[e],null!=this.sprDynamic&&!bt.call(this,e)){if(this.upperbound)break;Ft.call(this,e)}const[i,s]=Mt.call(this,e);if(null!=s&&s.isVisible()!=i){s.setVisible(i);const e=new t.ju("setVisible");e.visible=i,s.dispatchEvent(e)}if(null!=this.lowerbound){if(i){if(this.lowerbound!=e){const i=new t.ju("moved");i.lowerbound=e,this.dispatchEvent(i)}this.lowerbound=e}}else null!=this.upperbound&&(i||(this.upperbound=parseInt(e)-1))}this.upperbound=null!=this.upperbound?this.upperbound:this.items.length}}function Dt(){let e;if(e=1==this.locked?this.pullLength||0:this.targetPosY,this.drag);else{const i=(.5*e+4.5*this.currentPosY)/5;Math.abs(this.currentPosY-i)>.1?(this.currentPosY=i,this.parentSprite.setY(i),St.call(this)):(this.parentSprite.setY(this.targetPosY),this.removeEventListener(t.ju.ENTER_FRAME,Dt,this)),this.setBackgroundY(i)}const i=new t.ju("movePosition");i.y=this.parentSprite.getY(),i.backgroundY=.9*i.y,this.dispatchEvent(i)}function Gt(e){if(!this.locked&&this.isVisible()){const{x:i,y:s}=this.globalToLocal(e.x,e.y),{x:o,y:n}=this.hitArea.globalToLocal(e.x,e.y),[r,a]=[this.hitArea.getWidth(),this.hitArea.getHeight()],l=Math.min(0,(this.width-r)/2);let h;if(h=this.params.background?.9*this.currentPosY-10:0,o>l&&o<r&&n>h-this.params.margin&&n<a+this.params.margin){let o;for(let t=0;t<this.parentSprite.getNumChildren();t++)if(this.parentSprite.getChildAt(t).hitTestPoint(e.x,e.y)){o=t;break}this.clickIndex=o,[this.startPosX,this.startPosY]=[i,s],this.originalPosY=this.parentSprite.getY(),this.lastPosY=s,this.currentPosY=this.originalPosY+s-this.startPosY,this.velY=0,this.pointerTime=t.B7.now(),this.drag=!0,this.isClick=!0,e.stopPropagation()}else{const i=new t.ju("close");i.x=e.x,i.y=e.y,this.dispatchEvent(i),e.stopPropagation()}}}function Lt(e){if(this.drag&&this.isVisible()){const{y:i}=this.globalToLocal(e.x,e.y);this.drag=!1;const s=t.B7.now()-this.pointerTime;this.velY=this.velY/Math.pow(3,s/1e3*30);const o=i-this.startPosY,n=10*this.velY;if(this.targetPosY=Tt.call(this,this.originalPosY+o+n),this.pulled){console.log("ÎãπÍ≤ºÏùå"),this.pulled=!1;const e=new t.ju("refresh");e.sprite=this.parentSprite.getChildAt(1),e.item=this.items[1],this.dispatchEvent(e),this.setLocked(!0)}else if(this.isClick&&this.itemTouchEnable)if(null==this.clickIndex){const i=new t.ju("close");i.x=e.x,i.y=e.y,this.dispatchEvent(i)}else for(let i=0;i<this.items.length;i++){const s=this.items[i].sprite;if(s&&s.hitTestPoint(e.x,e.y)){let o,n=this.globalToLocal(e.x,e.y);const r=new t.ju("click");r.index=i,r.item=this.items[i],r.item._target=s,r.x=o,r.y=n,this.dispatchEvent(r);break}}this.addEventListener(t.ju.ENTER_FRAME,Dt,this),e.stopPropagation()}}function It(e){if(this.drag&&this.isVisible()){const{x:i,y:s}=this.globalToLocal(e.x,e.y);let o=this.originalPosY+s-this.startPosY;if(this.stickOnBorder&&(o=Tt.call(this,o)),this.parentSprite.getY()!=o){this.currentPosY=o,this.parentSprite.setY(o),St.call(this),this.setBackgroundY(o);const e=new t.ju("movePosition");e.y=this.parentSprite.getY(),e.backgroundY=.9*e.y,this.dispatchEvent(e)}this.velY=this.velY+(s-this.lastPosY);const n=t.B7.now()-this.pointerTime;if(this.velY=this.velY/Math.pow(3,30*n),this.pointerTime=t.B7.now(),(Math.abs(this.startPosX-i)>10||Math.abs(this.startPosY-s)>10)&&(this.isClick=!1),!this.pulled&&this.pullLength&&this.pullLength<=o){console.log("ÎãπÍ∏∞Í∏∞ Ï§ÄÎπÑ"),this.pulled=!0;const e=new t.ju("refreshReady");e.sprite=this.parentSprite.getChildAt(1),e.item=this.items[1],this.dispatchEvent(e)}else if(this.pulled&&this.pullLength&&o<this.pullLength){console.log("ÎãπÍ∏∞Í∏∞ Ï∑®ÏÜå"),this.pulled=!1;const e=new t.ju("refreshCancel");e.sprite=this.parentSprite.getChildAt(1),e.item=this.items[1],this.dispatchEvent(e)}e.stopPropagation(),this.lastPosY=s}}function Rt(t,e){e=null!=e?e:this.items.length,"object"==typeof t?this.items.splice(e,0,{text:t[0],data:t[1]}):"string"==typeof t&&this.items.splice(e,0,{text:t})}class kt extends t.jy{constructor(e,i,s,o){super(),o=null!=o?o:{},this.params=o,o.topMargin=null!=o.topMargin?o.topMargin:0,o.bottomMargin=null!=o.bottomMargin?o.bottomMargin:0,this.height=null!=s?s:t.wU.logicalViewport.height,this.width=null!=i?i:t.wU.logicalViewport.width,this.dontHide=o.dontHide,this.lockColumn=o.lockColumn,this.owner=o.owner,this.sprDynamic=o.sprDynamic,this.animationFunc=o.animationFunc,this.align=null!=o.align?o.align:"top",this.stickOnBorder=o.stickOnBorder,this.cutOffsetTop=null!=o.cutOffsetTop?o.cutOffsetTop:0,this.cutOffsetBottom=null!=o.cutOffsetBottom?o.cutOffsetBottom:0,this.topPosition=0,o.background&&(this.topPosition=o.background.headerHeight,this.makeBackground());const n=this.cutOffsetTop+this.cutOffsetBottom+o.topMargin+o.bottomMargin;this.setCustomBounds(0,0,i,s+n),this.refreshHitArea(),this.soundTimers=[],this.parentSprite=new t.jy,this.parentSprite.setY(this.topPosition),this.addChild(this.parentSprite),this.spriteFunc=null!=o.spriteFunc?o.spriteFunc:Bt,this.targetPosY=0,this.currentPosY=0,o.padding=null!=o.padding?o.padding:1,this.items=[],this.setItems(e),this.itemTouchEnable=!0,o.margin=null!=o.margin?o.margin:0,this.clip=o.clip,this.updateClip(),this.pullLength=void 0}updateClip(){this.clip&&this.setClip(0,0,this.width,this.height)}setLocked(t){this.locked&&null==t&&(this.currentPosY=this.pullLength),this.locked=t}refreshHitArea(){let e;e=this.params.fitHitAreaToScreenWidth?t.Kj.createBox(t.wU.logicalRenderBounds.left,0,t.wU.logicalRenderBounds.width,this.height,16711680):t.Kj.createBox(0,0,this.width,this.height,16711680),e.setAlpha(.2),e.setVisible(!1),this.addChild(e),this.hitArea&&this.hitArea.removeFromParent(),this.hitArea=e,this.hitArea.addEventListener(t.ju.POINTER_DOWN,Gt,this),this.hitArea.addEventListener(t.ju.POINTER_UP,Lt,this),this.hitArea.addEventListener(t.ju.POINTER_MOVE,It,this)}setCurY(e=null,i=!1){null==e&&(e=this.currentPosY),this.targetPosY=e,this.removeEventListener(t.ju.ENTER_FRAME,Dt,this),i?(this.currentPosY=e,this.parentSprite.setY(e)):this.addEventListener(t.ju.ENTER_FRAME,Dt,this),St.call(this)}add(t){Rt.call(this,t),this.setItems()}insert(t,e){Rt.call(this,t,e),this.setItems()}getIndex(t){return this.items.indexOf(t)}getItem(t){return this.items[t]}setItem(t,e){this.removeAt(e),this.insert(t,e)}getNumOfItems(){return this.items.length}refresh(){this.setItems(null,!1,!0)}setItems(e=null,i=!1,s=!1){let o,n;if((null==this.y1||null==this.y2||i||null!=e||null==this.sprDynamic)&&(this.y1=0+this.params.topMargin,this.y2=0+this.params.topMargin),i||null!=e){if(this.parentSprite.clearChildren(),this.items=[],null!=e)for(const t in e){const i=e[t];Rt.call(this,i)}}else if(s){const{x:t,y:e}=this.parentSprite.getPosition();this.parentSprite.clearChildren(),this.parentSprite.setPosition(t,e)}else n=this.parentSprite,o=this._lastSprites,n.removeFromParent(),this.parentSprite=new t.jy,this.addChild(this.parentSprite),this.parentSprite.position=n.getPosition();if(this.lowerbound=null,this.upperbound=null,null!=this.items&&Ft.call(this,0,o),null==this.sprDynamic)if(this.itemHeight=Math.max(this.y1,this.y2)-this.params.padding-this.params.topMargin+this.params.bottomMargin,this.itemHeight<this.height&&this.targetPosY+this.itemHeight<0&&(this.targetPosY=0,this.addEventListener(t.ju.ENTER_FRAME,Dt,this)),null!=this.items){this._lastSprites=[];for(const t in this.items){const e=this.items[t];t<this.parentSprite.getNumChildren()?this._lastSprites[e]=this.parentSprite.getChildAt(t):this._lastSprites[e]=null}}else this._lastSprites=null;"bottom"==this.align&&this.parentSprite.setY(this.height-this.itemHeight),St.call(this),"bottom"==this.align&&(this.targetPosY=this.height-this.itemHeight-1,this.parentSprite.setY(this.targetPosY))}clear(){for(const t in this.soundTimers)this.soundTimers[t].stop();this.soundTimers=[],this.items=[],this.setItems()}remove(t){const e=this.items.indexOf(t);console.assert(e>=0),this.removeAt(e)}removeAt(t){this.items.splice(t,1),this.setItems()}moveTo(e){e=e||1,this.items&&this.items.length>0?(e>this.items.length&&(e=this.items.length),this.targetPosY=-this.items[e].targetPosY,this.targetPosY<0&&(this.itemHeight<this.height?this.targetPosY=this.topPosition:this.targetPosY+this.itemHeight<this.height&&(this.targetPosY=this.height-this.itemHeight))):this.targetPosY=this.topPosition,this.currentPosY!=this.targetPosY&&this.addEventListener(t.ju.ENTER_FRAME,Dt,this)}setItemsTouchDisabled(){this.itemTouchEnable=!1;const e=new t.ju("itemsTouchDisabled");this.dispatchEvent(e)}setItemsTouchEnabled(){this.itemTouchEnable=!0;const e=new t.ju("itemsTouchEnabled");this.dispatchEvent(e)}makeBackground(){if(this.params.background.image){const e=this.params.background.image,[i,s]=[e.getWidth()/e.getScaleX(),e.getHeight()/e.getScaleY()],[o,n]=[t.wU.logicalRenderBounds.width/i,(this.topPosition-10)/s],r=Math.max(o,n),a=Math.max(o,t.wU.logicalRenderBounds.height/s),l=(this.topPosition-10)/2,h=t.wU.logicalRenderBounds.height/2;e.setScale(r),e.setPosition(this.width/2-i*r/2,l-s*r/2),this.addChild(e),this.headerImage=e,this.headerImageMinScale=r,this.headerImageMaxScale=a,this.headerImageMinY=l,this.headerImageMaxY=h}const e=new t.bn;e.makeBox(t.wU.logicalRenderBounds.left,-10,t.wU.logicalRenderBounds.width,t.wU.logicalRenderBounds.height+10,this.params.background.color||16777215),this.addChild(e),this.background=e,this.setBackgroundY(this.topPosition)}setBackgroundY(e){if(this.background){if(e=t.cQ.clamp(e,0,t.wU.logicalRenderBounds.height/.9),this.params.background.image){const i=this.headerImage,[s,o]=[i.getWidth()/i.getScaleX(),i.getHeight()/i.getScaleY()],n=e/t.wU.logicalRenderBounds.height,r=t.cQ.lerp(this.headerImageMinScale,this.headerImageMaxScale,n);e=t.cQ.lerp(this.headerImageMinY,this.headerImageMaxY,t.Ui.linear(n)),this.headerImage.setScale(r),this.headerImage.setPosition(this.width/2-s*r/2,e-o*r/2);const a=t.cQ.lerp(this.params.background.darkLevel||.5,1,t.Ui.linear(n));this.headerImage.setColorMultiplier(a,a,a)}this.background.setY(.9*e>0&&.9*e||0)}}fadeIn(e){this.parentSprite.setAlpha(0),new t.kX(this.parentSprite,e||1e3,{alpha:1})}getVisibleItemSprites(){const t=[];for(let e=this.lowerbound;e<=this.upperbound;e++)t.push(this.items[e].sprite);return t}}function Ot(t,e,i,s){const o=e.data.item.getInventorySprite();return[o,null,o.getHeight()-3]}function Xt(t){const e=t.item.data.item;t.x>=90&&!this.tryUse(e)?this.tryEquip(e):new vt(e).show()}class Wt{constructor(t){this.items=[],this.size=t}isFull(){return this.items.length>=this.size}addItem(t){return this.items.length>=this.size?null:(this.items.push(t),this.items.length)}getIndex(t){return this.items.indexOf(t)}findEquippedItemByType(t){const e=[];for(const i in this.items){const s=this.items[i];s.property.type==t&&s.equipped&&e.push(s)}return e}findItemByType(t){const e=[];for(const i in this.items){const s=this.items[i];s.property.type==t&&e.push(s)}return e}removeItem(t){const e=this.getIndex(t);if(e)return this.removeItemAt(e)}removeItemAt(t){const e=this.items[t];return this.items.splice(t,1),e}close(e,i){t.$u.playSound("sound/inventory_close.wav"),He.interface.slideClose((()=>{this.baseSpr.removeFromParent(),this.listView=null,this.baseSpr=null,e?e(i):He.world.showMapInfo(He.player.tileX,He.player.tileY)})).onChange((()=>{}))}dropItem(t){He.world.addLog("%s{ÏùÑ} Î∞îÎã•Ïóê Î≤ÑÎ†∏Îã§.",t.name);for(const e in this.listView.items){const i=this.listView.items[e];i.data.item==t&&this.listView.remove(i)}He.player.inventory.removeItem(t),He.interface.actionSelector.unselect(t),t.drop(He.player.tileX,He.player.tileY),0==He.player.inventory.items.length&&He.player.inventory.setListView(He.player.inventory.baseSpr)}setListView(e){{const i=He.interface.getBitmapTextField(t.cQ.format("%d/%d",this.items.length,this.size));this.items.length==this.size?i.setTextColor(16711680):i.setTextColor(16777215),i.setPosition(0,-20),e.addChild(i)}if(0==this.items.length);else{const i=[];for(const t in this.items){const e=this.items[t];i.push([e.name,{item:e}])}const s=new kt(i,120,t.wU.logicalRenderBounds.height-20,{owner:this,align:"bottom",cutOffsetBottom:20,spriteFunc:Ot,animationFunc:(e,i,s)=>{const o=e.getNumOfItems()-s+1,{x:n,y:r}=i.getPosition();i.setX(n+160),new t.kX(i,300,{x:n,y:r},{delay:.02*o,ease:t.Ui.outCubic})}});s.setPosition(0,-t.wU.logicalRenderBounds.height),s.addEventListener("click",Xt,this),e.addChild(s),this.listView=s,this.listView.addEventListener("close",(()=>this.close()))}}open(){const e=new t.jy;t.$u.playSound("sound/inventory_open.wav"),console.log("Ïù∏Î≤§ÌÜ†Î¶¨ Î≥¥Í∏∞");for(const t in this.items){const e=this.items[t];console.log(e.name)}He.interface.slideOpen(-120,0,(()=>{this.close()})).onChange((()=>{})),this.setListView(e),this.baseSpr=e,He.interface.hudLayer.bottomRight.addChild(e)}tryEquip(e,i){this.getIndex(e);const s=e.isEquippable()||0,o=this.findEquippedItemByType(e.property.type),n=s-o.length;return s&&s>0?1==s?(!o[0]||i&&o[0]==e||(He.world.addLog("%s{ÏùÑ} Ïû•ÎπÑÌï¥Ï†úÌñàÎã§.",o[0].name),o[0].unequip(),He.interface.actionSelector.unselect(o[0]),this.listView&&this.listView.getItem(this.getIndex(o[0])).sprite.updateEquip(),t.$u.playSound("sound/inventory_unequip.wav")),o[0]!=e&&(He.world.addLog("%s{ÏùÑ} Ïû•ÎπÑÌñàÎã§.",e.name),e.equip(),this.listView&&this.listView.getItem(this.getIndex(e)).sprite.updateEquip(),t.$u.playSound("sound/inventory_equip.wav"),He.player.getSelectedAction().property.type==e.property.type&&He.interface.actionSelector.select(e),He.player.doNothing()),He.interface.actionSelector.refresh(),!0):n>0?(He.world.addLog("%s{ÏùÑ} Ïû•ÎπÑÌñàÎã§.",e.name),e.equip(),this.listView&&this.listView.getItem(this.getIndex(e)).sprite.updateEquip(),t.$u.playSound("sound/inventory_equip.wav"),void He.player.doNothing()):(He.world.addLog("Îã§Î•∏ Ïû•ÎπÑÎ•º Î≤óÍ∏∞ Ï†ÑÏóêÎäî %s{ÏùÑ} Ïû•ÎπÑÌï† Ïàò ÏóÜÎã§.",e.name),!1):(console.log("Ïû•ÎπÑÌï† Ïàò ÏóÜÎäî ÏïÑÏù¥ÌÖúÏùÑ Ïû•ÎπÑÌïòÎ†§Ìï®"),!1)}tryUse(t){return"usable"==t.property.type||null}}class Yt extends h{constructor(t,e,i,s){super(t,e,i,s),this.isSkill=!0,this.fillProperties(Yt.property,t);const o=this.property;this.name=o.name||t,this.color=Yt.color[o.type],this.texture=this.options.filtering?Yt.textureFiltered:Yt.texture,this.tileWidth=Yt.tileWidth,this.tileHeight=Yt.tileHeight,this.postInit(Yt)}getIcon(t,e){let i;return"melee"==this.property.type?(i=He.player.getEquippedItem("melee"),i=i?i.getIcon():He.player.baseWeapon.getIcon()):"ranged"==this.property.type?(i=He.player.getEquippedItem("ranged"),i=i?i.getIcon():He.player.baseWeapon.getIcon()):i=new Yt(this.__key,{filtering:t,flip:e}),i}getInventorySprite(){const e=new t.jy,i=new t.eY(new t.xE("skillPanel.png",!1,{format:t.Wc.RGBA5551})),s=this.color;i.setOverrideColor(s),i.setAnchorPoint(.5,.5),e.addChild(i);const o=this.getIcon();o.setPosition(-44,1),e.addChild(o);const n=He.interface.getHiresTextWrap(this.name);return n.setPosition(-25,-7),n.setTextColor(this.color),e.addChild(n),e}isEquippable(){return!1}}function Nt(t){t.path=null,t.interactX&&(1==He.world.getDistance(t.tileX,t.tileY,t.interactX,t.interactY)&&t.interact(t.interactX,t.interactY),t.interactX=null,t.interactY=null),He.interface.cursor.snapToPlayer(),He.world.showMapInfo(t.tileX,t.tileY),t.targetX=null,t.targetY=null}function Ut(e){if(e.path&&e.path.length>0){const{x:i,y:s}=e.path[0];e.path.shift(),He.world.entityManager.getEntity(i,s)?(console.log("ÌïúÎ≤àÎçî Ï∞æÍ∏∞"),e.stop(),e.findPathAndMoveTo(e.targetX,e.targetY,e.interactX,e.interactY)):e.doTurn((()=>{if(console.log(`Ïù¥Îèô ${He.world.turn}, ${i}, ${s}, ${e.targetX}, ${e.targetY}`),He.world.entityManager.getEntity(i,s))null!=e.targetX&&e.findPathAndMoveTo(e.targetX,e.targetY,e.interactX,e.interactY);else{e.moveTo(i,s).onChange((()=>{const{x:t,y:i}=e.getPosition();He.world.sightManager.moveEyeTo(t,i)})),e.pickUpGold();const o=He.world.map.getProperty(i,s).sound||0;t.$u.playSound("sound/footstep_"+o+".wav"),e.playPositionSound(i,s)}return[_.walkSpeed,1]}))}}function Vt(e,i,o,n,r){let a;if(o){const{x:t,y:e}=He.world.tileCenterToWorld(this.tileX,this.tileY),[i,o]=[n,r],[l,h,d,c,u]=He.world.map.visibilityTileChecker.traceRay(t,e,i,o,s.World.tileWidth,s.World.tileHeight,v.BLOCK_VISION|v.BLOCK_ARROW,((t,e)=>He.world.entityManager.getEntity(t,e)));console.log(i,o,l,h,d,c,u,He.world.stageToWorld(...this.getPosition().xy)),l==x.EMPTY||l==x.CREATURE?(a=He.world.entityManager.getEntity(h,d),[n,r]=[c,u]):(a=null,[n,r]=[c,u])}console.log(" ÌîåÎ†àÏù¥Ïñ¥ Í≥µÍ≤©");const l=Math.atan2(i-this.tileY,e-this.tileX)/Math.PI*180,h=t.cQ.angleToDir(l);let d,c,u,p,g=this.getSelectedWeapon()[0],m=g.calculateDamage();if(o)[u,p]=a?new F("arrow",this.getX(),this.getY(),n,r,!0).getDuration():new F("arrow",this.getX(),this.getY(),n,r,!1).getDuration(),console.log("ÌôîÏÇ¥Î∞úÏÇ¨",n,r);else{let e;if([d,c]=t.cQ.dirToOffset(h),a=this.getEntityRel(d,c),a&&a.isProp&&a.property.needPickAxe){const t=this.getEquippedItem("pickaxe");t&&(g=t)}e=g.property.anim||"swing";const{x:i,y:o}=He.world.tileCenterToWorld(this.tileX,this.tileY);[u,p]=a?new F(e,i,o,i+d*s.World.tileWidth,o+c*s.World.tileHeight,!0,g.getIcon(!0,!0),this).getDuration():new F(e,i,o,i+d*s.World.tileWidth,o+c*s.World.tileHeight,!1,g.getIcon(!0,!0),this).getDuration()}if(p=p||u,a){a.isProp&&(m="pickaxe"==g.property.type?5:1),He.interface.cursor.lock(p||u);const{x:e,y:i}=He.world.tileCenterToWorld(this.tileX,this.tileY),{x:s,y:o}=He.world.tileCenterToWorld(a.tileX,a.tileY);(a instanceof H||a instanceof Ct)&&(a.damage(m,this,e,i,p),t.B7.delayedCall(Math.max(0,p-50),(()=>{t.$u.playSound("sound/"+(g.property.hitSound||"damage_0.wav"))})))}else He.interface.cursor.lock(100)}function jt(t,e){1==e?(He.interface.addLog("%s{Îäî} %s{Î•º} Ïì∞Îã§Îì¨ÏóàÎã§.",this.getName(),t.getName()),t.called(this)):(He.interface.addLog("%s{Îäî} %s{Î•º} Î∂àÎ†ÄÎã§.",this.getName(),t.getName()),t.called(this))}Yt.property={Í∑ºÏ†ëÎ¨¥Í∏∞:{image:[1,1],type:"melee"},ÏõêÍ±∞Î¶¨Î¨¥Í∏∞:{image:[1,1],type:"ranged"},Ïä§Îß§Ïãú:{image:[1,1],type:"active"},ÏåçÍ≤ÄÎÇúÌÉÄ:{image:[2,1],type:"magic"}},Yt.texture=new t.xE("Skills.png",!1,{format:t.Wc.RGBA5551}),Yt.textureFiltered=new t.xE("Skills.png",!0,{format:t.Wc.RGBA5551}),Yt.width=32,Yt.height=32,Yt.tileWidth=32,Yt.tileHeight=32,Yt.perRow=Math.floor(Yt.texture.width/Yt.width),Yt.color={melee:15602779,ranged:15602779,active:15602779,passive:10526880,magic:44783};class $t extends _{constructor(t,e,i,s){super(t,e,i,s),this.isPlayer=!0,this.faction="player",this.texture=$t.texture,this.tileWidth=$t.tileWidth,this.tileHeight=$t.tileHeight,this.property={image:[1,1],faction:"O"},this.name="ÎÇòÌÅ¨",this.hp=30,this.hpMax=30,this.mp=20,this.mpMax=20,this.level=1,this.exp=0,this.expMax=30,this.gold=0,this.inventory=new Wt(20),this.str=0,this.dex=0,this.int=0,this.luck=0,this.skills=[new Yt("Í∑ºÏ†ëÎ¨¥Í∏∞"),new Yt("ÏõêÍ±∞Î¶¨Î¨¥Í∏∞")],this.baseWeapon=new U(U.bareHand),this.selectedAction=this.baseWeapon,this.startX=void 0,this.startY=void 0,this.postInit($t)}selectAction(t){He.interface.actionSelector.select(t)}getSelectedWeapon(){const t=this.selectedAction;let e;return"melee"==t.property.type?e=this.inventory.findEquippedItemByType("melee"):"ranged"==t.property.type&&(e=this.inventory.findEquippedItemByType("ranged")),e||this.baseWeapon}selectSkillByType(t){let e;for(const i in this.skills){const s=this.skills[i];if(s.property.type==t){e=s;break}}He.interface&&He.interface.actionSelector.select(e)}selectSkill(t){let e;for(const i in this.skills){const s=this.skills[i];if(s.name==t){e=s;break}}He.interface&&He.interface.actionSelector.select(e)}getSelectedAction(){return this.selectedAction}getWeaponImage(t,e){return this.selectedAction.getIcon(t,e)}getEquippedItem(t){return this.inventory.findEquippedItemByType(t)[0]}getEquippedItemImage(t){const e=this.getEquippedItem(t);return null!=e?e.getIcon():null}processAutoMove(){this.path&&this.path.length>0?(console.log("ÏûêÎèôÏù¥Îèô ÎÇ®ÏùÄ Ïà´Ïûê",this.path.length),Ut(this)):(null==this.targetX||this.targetX==this.tileX&&this.targetY==this.tileY||this.findPathAndMoveTo(this.targetX,this.targetY,this.interactX,this.interactY),this.path&&this.path.length>0||Nt(this))}findPathAndMoveTo(t,e,i,s){let o;if(He.interface.hideInfo(),this.path&&this.path.length>0&&(o=!0),this.tileX==t&&this.tileY==e)return void Nt(this);this.stop(),[this.startX,this.startY]=[this.tileX,this.tileY],[this.targetX,this.targetY]=[t,e],this.interactX=i,this.interactY=s;const n=He.world.pathManager.findPath(this.tileX,this.tileY,t,e);this.path=n,o||(n&&n.length>0?function(t){Ut(t)}(this):Nt(this))}stop(){this.path=null,this.targetX=this.tileX,this.targetY=this.tileY}pickUpGold(){const t=He.world.entityManager.getItems(this.tileX,this.tileY);if(null!=t)for(let e=0;e<t.length;e++){const i=t[e];"gold"==i.property.bundle&&this.pickUpItem(i)}}doTurn(t,e){let[i,s]=[0,1];He.world.entityManager.doDelayedEnemyTurnIfExist((()=>{He.world.entityManager.clearMonsterMood(),t?(console.log(`‚ñ∂ÌîåÎ†àÏù¥Ïñ¥ÌÑ¥ ${He.world.turn}`),[i,s]=t(e)):console.log(`‚ñ∂ÌîåÎ†àÏù¥Ïñ¥ÌÑ¥(ÏïÑÎ¨¥ Í≤ÉÎèÑ ÏïàÌï®) ${He.world.turn}`);for(let t=0;t<s;t++)this.processBuff(),He.world.turn=He.world.turn+1,He.world.entityManager.doEnemyTurn(i)}))}pickUpItem(e){"gold"==e.property.bundle?(He.world.entityManager.removeEntity(e),this.gold=this.gold+e.amount,He.world.addLog("<yellow>%d Í≥®Îìú</yellow>Î•º Ï£ºÏõ†Îã§.",e.amount),t.$u.playSound("sound/"+e.property.getSound)):this.inventory.isFull()?(He.world.entityManager.removeEntity(e),He.world.addLog("ÏÜåÏßÄÌíàÏù¥ Í∞ÄÎìùÏ∞®ÏÑú %s{Î•º} Ï£ºÏùÑ Ïàò ÏóÜÏóàÎã§.",e.name),e.drop(e.tileX,e.tileY),He.world.showMapInfo(this.tileX,this.tileY)):this.doTurn((()=>(He.world.entityManager.removeEntity(e),He.world.addLog("%s{Î•º} Ï£ºÏõ†Îã§.",e.name),this.inventory.addItem(e),e.property.getSound?t.$u.playSound("sound/"+e.property.getSound):t.$u.playSound("sound/get_default.wav"),[0,1])))}openDoor(t,e){this.doTurn((()=>(He.world.openDoor(t,e),[300,1])))}doNothing(t){t&&He.interface.addLog(t),this.doTurn()}interact(t,e,i,s,o){this.doTurn((()=>{He.interface.hideInfo(),console.log("Ïù∏ÌÑ∞ÎûôÏÖò",He.world.turn),this.stop();const n=He.world.entityManager.getEntity(t,e),r=He.world.getProperty(t,e),a=He.world.getDistance(t,e,this.tileX,this.tileY);return 1==a&&"E"==r.char?(console.log("Î¨∏Ïó¥Í∏∞ ÏãúÎèÑ"),He.world.openDoor(t,e)):n&&n.isPet&&n.follow==this?jt.call(this,n,a):Vt.call(this,t,e,i,s,o),[300,1]}))}damage(e,i,s,o,n,r){n=n||0,t.B7.delayedCall(n,(()=>{He.interface.addLog("%sÎ°úÎ∂ÄÌÑ∞ <yellow>%d</yellow> ÎåÄÎØ∏ÏßÄÎ•º Î∞õÏïòÎã§!",i.getName(),e),r?t.$u.playSound("sound/"+r):(console.log("ÏÇ¨Ïö¥Îìú ÏßÄÏ†ï ÏïàÎê®"),t.$u.playSound(r||"sound/damage_0.wav"))})),this.hp=this.hp-e,He.interface.cursor.snapToPlayer(),new F("damage",s,o,this.getX(),this.getY(),this,i,n)}playPositionSound(e,i){He.world.map.getProperty(e,i);const s=He.world.getProperty(e-1,i),o=He.world.getProperty(e+1,i),n=He.world.getProperty(e,i-1),r=He.world.getProperty(e,i+1),a=He.world.getProperty(e,i),l=He.world.elemental.getElemental(e-1,i),h=He.world.elemental.getElemental(e+1,i),d=He.world.elemental.getElemental(e,i-1),c=He.world.elemental.getElemental(e,i+1),u=He.world.elemental.getElemental(e,i),p=(s.fire||0)+(o.fire||0)+(n.fire||0)+(r.fire||0)+(a.fire||0),g=l&&l.type==D.FIRE?1:0;h&&(h.type,D.FIRE),d&&(d.type,D.FIRE),c&&(c.type,D.FIRE),u&&(u.type,D.FIRE),t.$u.playSingleSound("sound/loop_torch.wav",Math.min(1,.7*p),!0),t.$u.playSingleSound("sound/loop_fire.wav",Math.min(1,g),!0),u&&u.type==D.WATER&&t.$u.playSound("sound/env_water.wav");for(const s in He.world.map.envSounds){const o=He.world.map.envSounds[s],n=He.world.getDistance(o.x,o.y,e,i)/10+1,r=1/(n*n);t.$u.playSingleSound("sound/loop_"+o.sound+".wav",r,!0,o)}t.B7.delayedCall($t.walkSpeed,(()=>{const e=He.world.waterAmount/10;t.$u.playSingleSound("sound/loop_water.wav",Math.min(1,e),!0)}))}playMusic(i){He.interface.cursor.hideAutoAction(),this.enableDefaultAnimation(!1),this.changeImage(1,5);const s=this.getEquippedItem("instrument");let o;o=s?s.property.instrument:"sound/mml_celtic-harp-a4.wav",i=new X(i,o),this.commandFollower("dance",{mml:i}),i.setVolume(.5),i.on("note",(()=>{this.__animationTick=(this.__animationTick+1)%2,this.changeImage(1,5+this.__animationTick);const i=new e(new t.xE("fx.png",!1,{format:t.Wc.RGBA5551}),t.cQ.random(9,10),4,16,24),s=new t.KG([[0,60,i,{y:[-2,t.cQ.random(-30,-15),"outBack"],x:[7,t.cQ.random(-5,20),"inOutSine"]}],[50,60,i,{alpha:[1,0,"outCubic"]}]]);this.addChild(s),t.B7.delayedCall(1e3,(()=>{s.removeFromParent()}))})),i.play(),He.world.once("enemyTurn",(()=>{i.stop(),this.enableDefaultAnimation(!0)}))}}function Ht(){console.log("‚ñ∑Ï†ÅÌÑ¥",this.world.turn);const t=[];for(const e in this.AITable){const i=this.AITable[e];t.push([Math.abs(i.tileX-He.player.tileX)+Math.abs(i.tileY-He.player.tileY),i])}t.sort(((t,e)=>t[0]==e[0]?t[1].tileX==e[1].tileX?t[1].tileY-e[1].tileY:t[1].tileX-e[1].tileX:t[0]-e[0]));for(const e in t){const i=t[e];i[1].processBuff(),i[1].processAI()}console.log(" - Ï†ÅÌÑ¥ÎÅù",this.world.turn),console.log("‚ÄªÏóòÎ¶¨Î©òÌÉà",this.world.turn),this.world.elemental.process()}function zt(e,i){const s=i.property.bundle;if(null!=s&&null!=e){let t=0;for(;t<e.length;)if(e[t].property.bundle==s)if(null!=i.property.bundleMax){const s=i.property.bundleMax-(i.amount+e[t].amount);s>0?(i.amount=i.property.bundleMax,e[t].amount=s):(i.amount=i.amount+e[t].amount,e.splice(t,1))}else e[t].removeFromParent(),console.log("Í≥®Îìú Ìï©ÏπòÍ∏∞",i.amount,e[t].amount),i.amount=i.amount+e[t].amount,e[t].amount=0,e.splice(t,1);else t+=1}"gold"==s&&(i.amount<=5?t.B7.delayedCall(1e3,(()=>i.changeImage(1,14))):i.amount<=20?t.B7.delayedCall(1e3,(()=>i.changeImage(2,14))):i.amount<=100?t.B7.delayedCall(1e3,(()=>i.changeImage(3,14))):t.B7.delayedCall(1e3,(()=>i.changeImage(4,14))))}$t.texture=new t.xE("Player.png",!1,{format:t.Wc.RGBA5551}),$t.width=18,$t.height=24;class Kt extends t.wA{onAdded(t){this.world=t,this.AITable={},this.entitiesByXy={},this.itemsByXy={},this.reservedPlayerTurnFuncs=[]}addEntity(e){if(e.addedToWorld=!0,this.world.map.getVisibility(e.tileX,e.tileY)>0?e.setVisible(!1):e.setVisible(!0),e.isItem){let i=this.itemsByXy[e.tileX+","+e.tileY];if(null==i&&(i=[],this.itemsByXy[e.tileX+","+e.tileY]=i,i=this.itemsByXy[e.tileX+","+e.tileY]),i.length>0)if("gold"==e.property.bundle)if(e.dropAnimationTimer){const s=e.dropAnimationTimer.getDelay();t.B7.delayedCall(s+1e3,(()=>{i.length>1&&e.setVisible(!1)}))}else i.length>1&&e.setVisible(!1);else if(e.dropAnimationTimer){const s=e.dropAnimationTimer.getDelay();t.B7.delayedCall(s+1e3,(function(){this.setVisible(!1)}),i[i.length-1])}else i[i.length-1].setVisible(!1);zt.call(this,i,e),"gold"==e.property.bundle?i.unshift(e):i.push(e),this.world.itemLayer.addChild(e)}else if(e.isCreature||e.isProp){if(this.world.entityLayer.addChild(e),e.shadowMesh&&this.world.shadowLayer.addChild(e.shadowMesh),e instanceof H&&e.AI&&(this.AITable[e.id]=e),this.entitiesByXy[e.tileX+","+e.tileY])throw new Error("‚òû‚òû‚òû ÌÅ¨Î¶¨Ï≥êÍ∞Ä ÏûàÎäî ÏúÑÏπòÏóê Îòê ÌÅ¨Î¶¨Ï≥êÎ•º ÏÉùÏÑ±ÌïòÎ†§Ìï®");if(this.entitiesByXy[e.tileX+","+e.tileY]=e,e instanceof $t){const{x:t,y:i}=e.getPosition();this.world.sightManager.moveEyeTo(t,i),this.world.sightManager.moveViewTo(t,i),this.world.onEnterFrame(),this.world.sightManager.refreshEntityVisibility(),e.playPositionSound(e.tileX,e.tileY)}}}removeEntity(t){this.detachEntity(t,!0)}detachEntity(t,e){if(t.addedToWorld=!1,e&&(t.removeFromParent(),this.dropAnimationTimer&&(this.dropAnimationTimer.stop(),this.dropAnimationTimer=null)),t.isItem){const e=this.itemsByXy[t.tileX+","+t.tileY];if(!e)throw new Error("ÏõîÎìúÏóê Ï°¥Ïû¨ÌïòÏßÄ ÏïäÎäî ÏïÑÏù¥ÌÖúÏùÑ ÏõîÎìúÏóêÏÑú ÏÇ≠Ï†úÌïòÎ†§Í≥†Ìï®");for(let i=0;i<e.length;i++)if(e[i]==t){t.removeFromParent(),i==e.length-1&&i>0&&e[i-1].setVisible(!0),e.splice(i,1),0==e.length&&delete this.itemsByXy[t.tileX+","+t.tileY];break}}else(t.isCreature||t.isProp)&&(t.shadowMesh&&e&&t.shadowMesh.removeFromParent(),t.AI&&delete this.AITable[t.id],this.entitiesByXy[t.tileX+","+t.tileY]==t&&delete this.entitiesByXy[t.tileX+","+t.tileY])}getEntity(t,e){return this.entitiesByXy[t+","+e]}getAllEntities(){const t=[];for(let e=0;e<this.world.map.height;e++)for(let i=0;i<this.world.map.width;i++){const s=this.getEntity(i,e);s&&t.push(s)}return t}getItems(t,e){return this.itemsByXy[t+","+e]}getNumOfItems(t,e){const i=this.itemsByXy[t+","+e];return i?i.length:0}moveTopItemToBottom(t,e){const i=this.getItems(t,e);if(i&&i.length>1){const t=i[i.length];t.setVisible(!1),i[i.length]=null,i.unshift(t),i[i.length-1].setVisible(!0)}}getEntitiesInRect(t,e,i,s){const o=[];for(const n in this.entitiesByXy){const r=this.entitiesByXy[n];r.tileX>=t&&r.tileX<=i&&r.tileY>=e&&r.tileY<=s&&o.push(r)}return o}clearMonsterMood(){for(const t in this.entitiesByXy){const e=this.entitiesByXy[t];e.showMood&&e.showMood()}}doEnemyTurn(e){this.doDelayedEnemyTurnIfExist((()=>{this.enemyTurnTimer=t.B7.delayedCall(e,(()=>{const e=new t.ju("enemyTurn");this.world.dispatchEvent(e),this.enemyTurnTimer=null,Ht.call(this),this.doPlayerTurn()}))}))}wait(e,i){if(i)He.interface.cursor.lock();else if(this.waitSkip)return;this.waitTimer=t.B7.delayedCall(e,(()=>{this.waitTimer=null,i&&He.interface.cursor.unlock()}))}doDelayedEnemyTurnIfExist(t,e){this.enemyTurnTimer?(console.log("ÎåÄÍ∏∞Ï§ë Ï†Å ÌÑ¥Ïù¥ ÏûàÎã§"),this.enemyTurnTimer.stop(),this.enemyTurnTimer=null,Ht.call(this),t.call(e)):this.waitTimer?(console.log("ÎåÄÍ∏∞Ï§ë waitÍ∞Ä ÏûàÎã§"),this.waitTimer.stop(),this.waitTimer=null,this.waitSkip=!0):t(e)}doPlayerTurn(){this.world.processDateTime();const e=new t.ju("playerTurn");if(this.world.dispatchEvent(e),this.waitSkip=!1,this.world.sightManager.refreshEntityVisibility(),this.reservedPlayerTurnFuncs.length>0){He.interface.hideInfo(),He.interface.cursor.hideAutoAction(),console.log("ÏòàÏïΩÏûëÏóÖÏã§Ìñâ");for(const t in this.reservedPlayerTurnFuncs){const e=this.reservedPlayerTurnFuncs[t];if(e[0].call(e[1]))return void(this.reservedPlayerTurnFuncs=[])}this.reservedPlayerTurnFuncs=[]}He.interface.cursor.processReservedClick(),He.player.processAutoMove()}safeExecute(t,e){this.isTurnProcessing()?this.reservedPlayerTurnFuncs.push([t,e]):(He.interface.hideInfo(),He.interface.cursor.hideAutoAction(),t(e))}isTurnProcessing(){return null!=this.enemyTurnTimer||null!=this.waitTimer}forceStopTurnProcessing(){null!=this.enemyTurnTimer&&(this.enemyTurnTimer.stop(),this.enemyTurnTimer=null),null!=this.waitTimer&&(this.waitTimer.stop(),this.waitTimer=null)}}var Qt=i(110),qt=i.n(Qt);class Jt extends t.wA{onAdded(t){this.world=t}findPath_old(t,e,i,s){let o,[n,r]=this.findNearestFloor(t,e,i,s),a=this.world.getProperty(t,e),l=this.world.getProperty(i,s);return!o&&function(t,e){return 0==this.map.getProperty(t,e).wall&&!this.getEntity(t,e)}(i,s)&&i>=1&&i<=this.world.map.width&&s>=1&&s<=this.world.map.height&&r.includes(l),o||(o=qt().path(a,n,r,!0,(function(t,e){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)<=1}))),o}findNearestFloor(t,e,i,s){let o=[],n=[],r=999999,a=this.world.map.getProperty(t,e),l=t=>o[t.y*this.world.map.width+t.x],h=(t,e)=>{o[t.y*this.world.map.width+t.x]=e},d=(t,e,o)=>{let c;for(;c=this.world.map.getProperty(t,e),999999==r||0==(c.wall&v.BLOCK_PASS)&&c.revealed&&!l(c)&&!this.world.entityManager.getEntity(t,e);){{h(c,!0);let o=Math.abs(i-t)+Math.abs(s-e);r>o&&(r=o,a=c),n.push(c);let u=this.world.map.getProperty(t,e-1),p=this.world.map.getProperty(t,e+1);0!=u.wall||!c.revealed||l(u)||this.world.entityManager.getEntity(t,e-1)||(d(t,e-1,-1),d(t+1,e-1,1)),0!=p.wall||!c.revealed||l(p)||this.world.entityManager.getEntity(t,e+1)||(d(t,e+1,-1),d(t+1,e+1,1))}t+=o}};return d(t,e,-1),d(t+1,e,1),[a,n]}findPath(t,e,i,s,o){let n,r,a,l=3*(Math.abs(i-t)+Math.abs(s-e)),h=this.world.getProperty(t,e),d=this.world.getProperty(i,s);if(null==h.x||null==h.y)return null;if((0!=(d.wall&v.BLOCK_PASS)||!o&&!d.revealed||this.world.entityManager.getEntity(i,s))&&(n=!0),1==Math.abs(i-t)+Math.abs(s-e))return n?null:[d];let c=[],[u,p]=[t,e],g=0,m=[],f=[],w=new Map,y=999999,E=null,C=t=>c[t.y*this.world.map.width+t.x],_=(t,e)=>{c[t.y*this.world.map.width+t.x]=e},A=(t,e,n,a)=>{let h=this.world.getProperty(t,e),d=Math.abs(i-t)+Math.abs(s-e);if(y>d)y=d,E=h;else if(d>l)return;if(f.push(h),w.set(h,n),t==i&&e==s)return r=!0,!0;let c=this.world.getProperty(t,e-1),u=this.world.getProperty(t+1,e),p=this.world.getProperty(t,e+1),g=this.world.getProperty(t-1,e);0!=(c.wall&v.BLOCK_PASS)||!o&&!c.revealed||C(c)||this.world.entityManager.getEntity(t,e-1)||(_(c,!0),a.push([t,e-1,h])),0!=(u.wall&v.BLOCK_PASS)||!o&&!u.revealed||C(u)||this.world.entityManager.getEntity(t+1,e)||(_(u,!0),a.push([t+1,e,h])),0!=(p.wall&v.BLOCK_PASS)||!o&&!p.revealed||C(p)||this.world.entityManager.getEntity(t,e+1)||(_(p,!0),a.push([t,e+1,h])),0!=(g.wall&v.BLOCK_PASS)||!o&&!g.revealed||C(g)||this.world.entityManager.getEntity(t-1,e)||(_(g,!0),a.push([t-1,e,h]))};for(_(h,!0),A(t,e,null,m);!r&&m.length>0;){g+=1;let t=m;m=[];for(let e in t){let i=t[e];if(A(i[0],i[1],i[2],m))break}}let[x,B]=[[],[]];r?(console.log("Í≥®Ïù∏ Í∞ÄÎä•"),a=d):(a=E,console.log("Í≥®Ïù∏ Î∂àÍ∞ÄÎä•",a.x,a.y)),console.log("Ïä§ÌÉ≠Ïùò ÏµúÏ¢ÖÍ≤∞Í≥º",g),console.log(a.x,a.y),B.push(a);do{a=w.get(a),B.push(a)}while(null!=a&&(a.x!=t||a.y!=e));for(let t=B.length-2;t>=0;t--)x.push(B[t]);return x}getSplashFloor(t,e,i){let s=[],[,o]=this.findNearestFloor(t,e,t,e),n=[];for(let i in o){let s=o[i],r=Math.abs(s.x-t)+Math.abs(s.y-e);n.push([r,s])}n.sort(((t,e)=>t[0]-e[0]));for(let o in n){let r=n[o];if(0==this.world.map.visibilityTileChecker.canBeSeen(t,e,r[1].x,r[1].y,1)[0]&&(s.push(r[1]),s.length>=i))break}if(s.length<i)for(let t=1;t<=i;t++)s.push(n[0][1]);return s}getSummonFloor(t,e,i){let s=[],[,o]=this.findNearestFloor(t,e,t,e),n=[];for(let i in o){let s=o[i],r=Math.abs(s.x-t)+Math.abs(s.y-e);n.push([r,s])}n.sort(((t,e)=>t[0]-e[0]));for(let t in n){let e=n[t];if(!this.world.entityManager.getEntity(e[1].x,e[1].y)&&(s.push(e[1]),s.length>=i))break}return s}}var Zt=i(636);class te{getShader(t){return te.shaders[t]}}const ee="\n    precision mediump float;\n\n    attribute vec2 a_position;\n    attribute vec4 a_color;\n    attribute vec2 a_texCoord;\n\n    uniform mat4 u_viewMatrix;\n    uniform mat4 u_worldMatrix;\n    uniform vec2 u_anchor;\n\n    varying mediump vec2 v_texCoord;\n    varying mediump vec2 v_position;\n    varying lowp vec4 v_colorOverride;\n\n    void main() {\n        mat4 anchorMat = mat4(1);\n\n        anchorMat[3].xy = u_anchor;\n        gl_Position = vec4((u_viewMatrix * u_worldMatrix * anchorMat * vec4(a_position, 0.0,1.0)).xy, 0, 1);\n        v_position = gl_Position.xy;\n        v_colorOverride = vec4(a_color.xyz*a_color.www,1.0);\n        v_texCoord = a_texCoord;\n    }\n";te.shaders={mask:new Zt.e("\n        precision mediump float;\n\n        attribute vec2 a_position;\n        attribute vec4 uvuv;\n        attribute vec2 a_texCoord;\n\n        uniform mat4 u_viewMatrix;\n        uniform mat4 u_worldMatrix;\n        uniform vec2 u_anchor;\n\n        varying mediump vec2 v_texCoord;\n        varying mediump vec2 v_position;\n\n        varying mediump vec2 v_texCoord1;\n        varying mediump vec2 v_texCoord2;\n        \n        void main() {\n            mat4 anchorMat = mat4(1);\n\n            anchorMat[3].xy = u_anchor;\n            gl_Position = vec4((u_viewMatrix * u_worldMatrix * anchorMat * vec4(a_position, 0.0,1.0)).xy, 0, 1);\n\n            v_position = gl_Position.xy;\n            //256*128\n            vec4 uvuv2 = uvuv.wzyx;\n            // v_texCoord1 = ((uvuv2.wz * vec2(2.0,2.0*3.0/2.0)  )*vec2(18.0/16.0,26.0/24.0)) / vec2(512.0,256.0);\n            // v_texCoord2 = ((uvuv2.yx * vec2(2.0,2.0*3.0/2.0)  )*vec2(18.0/16.0,26.0/24.0)) / vec2(512.0,256.0);\n            v_texCoord1 = uvuv2.wz / vec2(512.0,256.0);\n            v_texCoord2 = uvuv2.yx / vec2(512.0,256.0);\n\n            v_texCoord = a_texCoord;\n        }\n        ","\n        varying mediump vec2 v_position;\n        varying mediump vec2 v_texCoord;\n        varying mediump vec2 v_texCoord1;\n        varying mediump vec2 v_texCoord2;\n\n        uniform lowp sampler2D maskSampler;\n        uniform lowp sampler2D baseSampler;\n\n        uniform mediump float mask;\n        uniform mediump vec2 texSize;\n\n\n        void main() {\n            highp vec2 uv = v_texCoord;\n\n            lowp vec4 tile = texture2D(baseSampler, floor(v_texCoord)/texSize);\n            lowp vec4 mask1 = texture2D(maskSampler, v_texCoord1);\n            lowp vec4 mask2 = texture2D(maskSampler, v_texCoord2);\n\n            lowp vec4 c;\n            lowp vec3 mask0 = vec3(mask1.g,1.0,mask2.g);\n            c.xyz = mix( vec3(0.0,1.0,1.0), mask0.xyz , step(1.0/256.0,tile.g + mask) );\n            c.a = 1.0;\n            gl_FragColor = c;\n\n            gl_FragColor.xyz *= gl_FragColor.a;\n        }\n        ",null,{mask:0}),shadow:new Zt.e("\n        precision mediump float;\n\n        attribute vec2 a_position;\n        attribute vec3 custom;\n        attribute vec4 a_color;\n\n        uniform mat4 u_viewMatrix;\n        uniform mat4 u_worldMatrix;\n        uniform vec2 u_anchor;\n\n        uniform vec4 eyePos;\n\n\n        varying mediump vec2 v_position;\n        varying lowp vec4 v_colorOverride;\n\n        void main() {\n            mat4 anchorMat = mat4(1);\n\n            anchorMat[3].xy = u_anchor;\n            gl_Position = vec4((u_viewMatrix * u_worldMatrix * anchorMat * vec4(custom.xy, 0.0,1.0)).xy, 0, 1);\n\n            mediump float scale;\n            mediump vec2 s;\n            mediump vec2 delta = gl_Position.xy - eyePos.xy;\n            s = abs(delta);\n            scale = max(s.x,s.y);\n\n            gl_Position.xy += delta * custom.z / (scale+0.001);\n            v_position = gl_Position.xy;\n            v_colorOverride = vec4(0,1,1,1);\n        }\n        ","\n        varying mediump vec2 v_position;\n        varying lowp vec4 v_colorOverride;\n\n        void main() {\n            gl_FragColor = v_colorOverride;\n            gl_FragColor.xyz *= gl_FragColor.a;\n        }\n        ",null,{eyePos:[0,0,0,0]}),tileMap:new Zt.e(ee,"\n        varying mediump vec2 v_position;\n        varying mediump vec2 v_texCoord;\n        varying lowp vec4 v_colorOverride;\n\n        uniform lowp sampler2D fogSampler;\n        uniform lowp sampler2D baseSampler;\n\n        uniform highp vec4 offset;\n        uniform highp vec4 viewInfo;\n        uniform lowp vec4 color1;\n        uniform lowp vec4 color2;\n        uniform lowp vec4 glossy;\n        uniform mediump vec2 texSize;\n\n        void main() {\n            mediump vec2 viewPos = viewInfo.xy;\n            mediump vec2 viewSize = viewInfo.zw;\n            mediump vec2 uv = v_texCoord;\n            mediump vec2 a;\n\n            highp vec2 uv2;\n            mediump vec2 delta = (-glossy.xy+v_position.xy*0.5-viewPos.xy)*glossy.zw;\n            lowp float fallOff = max(0.0,(1.0-dot(delta,delta)))*color1.a;\n\n            uv2.x = (v_position.x*0.5+0.5)*viewSize.x+viewPos.x;\n            uv2.y = (v_position.y*0.5+0.5)*viewSize.y+viewPos.y;\n            uv/=texSize;\n            if (uv.y>=408.0/512.0) uv += offset.xy; \n\n            lowp vec4 c = \ttexture2D(baseSampler, uv) * v_colorOverride;\n            lowp vec4 fog = texture2D(fogSampler, uv2);\n\n            lowp vec3 fallOffColor = fallOff*color1.xyz*(1.0-min(1.0,c.g*1000.0));\n\n            lowp float gray = dot(c.xyz,vec3(0.3,0.6,0.1)*0.5);\n            c.xyz = c.xyz + fallOffColor.xyz;\n            gl_FragColor.xyz =  mix(color2.xyz*gray,c.xyz,fog.r*color2.a) * c.a * fog.b;\n            \n            gl_FragColor.a = c.a;\n            gl_FragColor.xyz *= gl_FragColor.a;\n        }\n        ",null,{offset:[0,0,0,0],viewInfo:[0,0,0,0],color1:[0,0,0,0],color2:[0,0,0,0],glossy:[0,0,0,0]}),light:new Zt.e(ee,"\n        varying mediump vec2 v_position;\n        varying mediump vec2 v_texCoord;\n        varying lowp vec4 v_colorOverride;\n\n        uniform sampler2D fogSampler;\n        uniform sampler2D baseSampler;\n\n        uniform mediump vec4 viewInfo;\n\n        void main() {\n            mediump vec2 viewPos = viewInfo.xy;\n            mediump vec2 viewSize = viewInfo.zw;\n            mediump vec2 uv = v_texCoord;\n            mediump vec2 a;\n\n            mediump vec2 uv2;\n            uv2.x = (v_position.x*0.5+0.5)*viewSize.x+viewPos.x;\n            uv2.y = (v_position.y*0.5+0.5)*viewSize.y+viewPos.y;\n\n            lowp vec4 c = texture2D(baseSampler, uv);\n            lowp vec4 fog = texture2D(fogSampler, uv2);\n            \n            lowp float gray = dot(c.xyz,vec3(0.3,0.6,0.1))*0.05;\n\n            c *= v_colorOverride;\n            gl_FragColor = mix(vec4(gray,gray,gray,1),c,fog.x);\n            gl_FragColor.a = c.a;\n            gl_FragColor.xyz *= gl_FragColor.a;\n            // gl_FragColor = vec4(c.www,1);\n        }\n        ",null,{viewInfo:[0,0,0,0]})};const ie=new te,se=new t.xE("sight.png",!1,{format:t.Wc.RGB565});function oe(t){if(null!=t){let e,i;return e=t%s.World.tilePerRow,i=Math.floor(t/s.World.tilePerRow),[e,i]}return null}const ne=[];function re(){const e=new t.xE(s.World.shadowMaskTextureName),i=new t.xE(s.World.tileTextureName),o=this.visibilityTexture,n=new t.xE("Light.png",!1,{format:t.Wc.RGBA5551});ie.getShader("mask").setTexture("maskSampler",e).setTexture("baseSampler",i).setConstant("texSize",i.size),ie.getShader("tileMap").setTexture("baseSampler",i).setTexture("fogSampler",o).setConstant("texSize",i.size),ie.getShader("light").setTexture("baseSampler",n).setTexture("fogSampler",o),e.waitEvents([t.ju.LOADED,[t.ju.LOADED,i]],(()=>{console.log("ÌÖçÏä§Ï≥ê Î™®Îëê Î°úÎî©ÌñàÏùå"),this.invalidateEye()})),e.eventToPromise(t.ju.LOADED).then((()=>{console.log("Ïù¥Îü∞ÏãùÏúºÎ°ú Ïù¥Î≤§Ìä∏Î•º...")}))}ne[1]=[0,4,2,4,6,23],ne[2]=[5,1,7,1,3,7],ne[4]=[0,1,4,1,5,4],ne[8]=[6,7,2,7,3,2],ne[5]=[0,1,2,1,5,2,2,5,6,5,7,6],ne[9]=[0,3,2,0,4,7,0,7,3,4,5,7],ne[6]=[6,4,7,4,0,3,4,3,7,0,1,3],ne[10]=[4,5,6,6,5,1,6,1,2,1,3,2];class ae extends t.wA{onAdded(e){this.world=e,this.__revealCache=void 0,this.visibilityTexture=new t.AC(s.World.shadowWidth,s.World.shadowHeight),re.call(this)}cacheReveal2(t,e,i){const s=this.__revealCache[t+","+e];this.__revealCache[t+","+e]=(null!=s?s:0)|i}cacheReveal3(t,e){const i=this.__revealCache;i[t+","+e]=(i[t-1+","+(e-1)]<<0?128:0)|(i[t+","+(e-1)]<<1?64:0)|(i[t+1+","+(e-1)]<<2?32:0)|(i[t-1+","+e]<<3?16:0)|(i[t+1+","+e]<<4?8:0)|(i[t-1+","+(e+1)]<<5?4:0)|(i[t+","+(e+1)]<<6?2:0)|(i[t+1+","+(e+1)]<<7?1:0)}revealTile(e,i,s){const o=this.world.getProperty(e,i);if((1==s||!o.revealed)&&e>=0&&e<this.world.map.width&&i>=0&&i<this.world.map.height){0==o.revealed&&this.cacheReveal3(e,i),o.revealed=!0,this.cacheReveal2(e-1,i-1,1),this.cacheReveal2(e,i-1,7),this.cacheReveal2(e+1,i-1,4),this.cacheReveal2(e-1,i,41),this.cacheReveal2(e+1,i,148),this.cacheReveal2(e-1,i+1,4),this.cacheReveal2(e,i+1,224),this.cacheReveal2(e+1,i+1,32),He.interface.autoMap.drawTile(e,i);const[s,n]=oe(this.world.map.getData(e,i));let r,a;o.below&&([r,a]=oe(o.below+1));let[l,h,d,c]=this.world.map.getTileLightMap(e,i);if(0==o.shadow){const t=this.world.getProperty(e-1,i-1).shadow,s=this.world.getProperty(e,i-1).shadow,o=this.world.getProperty(e+1,i-1).shadow,n=this.world.getProperty(e-1,i).shadow,r=this.world.getProperty(e+1,i).shadow,a=this.world.getProperty(e-1,i+1).shadow,u=this.world.getProperty(e,i+1).shadow,p=this.world.getProperty(e+1,i+1).shadow;(t>0||s>0||n>0)&&(l=l>>1&8355711),(o>0||s>0||r>0)&&(h=h>>1&8355711),(a>0||u>0||n>0)&&(d=d>>1&8355711),(p>0||u>0||r>0)&&(c=c>>1&8355711)}o.below&&this.world.belowTileMap.setTile(e,i,r,a,null,l,1,h,1,d,1,c,1),o.shadow>0?this.world.wallTileMap.setTile(e,i,s,n,null,l,1,h,1,d,1,c,1):this.world.floorTileMap.setTile(e,i,s,n,null,l,1,h,1,d,1,c,1);for(const s in this.world.map.lightList){const o=this.world.map.lightList[s];if(o.x==e&&o.y==i){const e=new t.Kj,i=60,s=o.color,n=.5;e.setVertexArray([-i,-i,i,-i,-i,i,i,i]),e.setTextureCoordinateArray([0,0,1,0,0,1,1,1]),e.setIndexArray([0,1,2,1,3,2]),e.setColorArray([s,n,s,n,s,n,s,n]),e.position=this.world.tileCenterToWorld(o.x,o.y),e.setShader(ie.getShader("light")),this.world.lightLayer.addChild(e),e.setBlendMode(t.jy.BlendModes.ADD),e.motionBlur=!1,o.mesh=e}}}}getShadowMesh(e,i,o,n=null,r=!1){const a=[],l=[],h=[],[d,c]=[t.wU.logicalRenderBounds.width,t.wU.logicalRenderBounds.height],[u,p]=[s.World.tileWidth,s.World.tileHeight],g=Math.floor(e/s.World.tileWidth),m=Math.floor(i/s.World.tileHeight),f=Math.floor(o+1),{x:w,y}=this.world.worldToTile(this.world.viewX-d/2*this.world.zoom,this.world.viewY-c/2*this.world.zoom),[E,C]=[w+Math.floor(d*this.world.zoom/u)+1,y+Math.floor(c*this.world.zoom/p)+1],_=Math.max(0,Math.max(w,g-f)),A=Math.min(this.world.map.width-1,Math.min(E,g+f)),x=Math.max(0,Math.max(y,m-f)),B=Math.min(this.world.map.height-1,Math.min(C,m+f));n=n||this.world.map.getVisibility.bind(this.world.map);for(let t=x;t<=B;t++)for(let e=_;e<=A;e++){const i=(e-g)**2+(t-m)**2;if(0!=i&&i<f**2){const i=n(e,t),s=this.world.getProperty(e,t);if(!r&&i<=1&&h.push(s),0!=(s.wall&v.BLOCK_VISION)){const[i,s]=[e*u,t*p],o=a.length/3;a.push(i,s,0,i+u,s,0,i,s+p,0,i+u,s+p,0,i,s,1,i+u,s,1,i,s+p,1,i+u,s+p,1),l.push(o+0,o+1,o+2,o+1,o+3,o+2,o+4,o+1,o+0,o+4,o+5,o+1,o+1,o+5,o+7,o+1,o+7,o+3,o+2,o+3,o+7,o+2,o+7,o+6,o+4,o+0,o+2,o+4,o+2,o+6)}}}const T=new t.Kj;return T.setIndexArray(l),T.setGenericArray("custom",a,t.Kj.ArrayTypes.FLOAT32,3,!1),{mesh:T,visibleTileList:h}}computeVisibility(){const[e,i]=[this.world.eyeX,this.world.eyeY];if(null==e||null==i)return;const o=1/this.world.zoom,n=1/this.world.zoom,[r,a]=[s.World.tileWidth,s.World.tileHeight],l=Math.floor(e/s.World.tileWidth),h=Math.floor(i/s.World.tileHeight),d=Math.floor(100*this.world.viewRadius+.005)/100;let{x:c,y:u}=this.world.worldToTile(this.world.viewX-t.wU.logicalRenderBounds.width/2*this.world.zoom,this.world.viewY-t.wU.logicalRenderBounds.height/2*this.world.zoom),[p,g]=[c+Math.floor(t.wU.logicalRenderBounds.width*this.world.zoom/r),u+Math.floor(t.wU.logicalRenderBounds.height*this.world.zoom/a)];c-=1,u-=1,p+=1,g+=1,t.B7.now();let m,f,w,y,E,C=this.__visibilityCache;if(C&&C.eyeTileX==l&&C.eyeTileY==h&&C.viewX1==c&&C.viewY1==u&&C.viewX2==p&&C.viewY2==g&&C.radius==Math.floor(d))f=C.mWall,w=C.mFloor,m=C.m;else{const s=[],o=[],n=[],y=[],E=[],_=[],A=[],x=[];let B,T;if(C&&C.eyeTileX==l&&C.eyeTileY==h&&C.radius==d)B=!0,T=C.visibility,m=C.m;else{let t;this.world.map.visibilityTileChecker.getResult(l,h,d),({mesh:m,visibleTileList:t}=this.getShadowMesh(e,i,d)),console.assert(m.indices);for(const e in t){const i=t[e];this.revealTile(i.x,i.y)}T={}}this.waterAmount=0;for(let t=u;t<=g;t++)for(let e=c;e<=p;e++){const i=this.world.map.getProperty(e,t);if(null==i)break;if(i.water&&!i.envSound){const i=He.world.getDistance(e,t,l,h);this.waterAmount=this.waterAmount+1/(i*i)}if(0==!!i.revealed);else{const[l,h]=[e*r,t*a];let d,c=47;const u=this.__revealCache[e+","+t];d=v.tileBlendTable[null!=u?u:0];const p=this.world.map.getVisibility.bind(this.world.map);if(p(e,t)<=1)if(B){const i=T[e+","+t];c=null!=i?i:0}else c=v.tileBlendTable[(p(e-1,t-1)<=1?128:0)|(p(e,t-1)<=1?64:0)|(p(e+1,t-1)<=1?32:0)|(p(e-1,t)<=1?16:0)|(p(e+1,t)<=1?8:0)|(p(e-1,t+1)<=1?4:0)|(p(e,t+1)<=1?2:0)|(p(e+1,t+1)<=1?1:0)],T[e+","+t]=c;const g=15&c,m=c>>4,f=15&d,w=d>>4;if(i.shadow>0&&d<47){const[,i,,]=this.world.wallTileMap.getArray(e,t),d=s.length/2;s.push(l,h,l+r,h,l,h+a,l+r,h+a),o.push(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7]),n.push(d+0,d+1,d+2,d+1,d+3,d+2),y.push(18*g+1,26*m+1,18*f+1,26*w+1,18*g+17,26*m+1,18*f+17,26*w+1,18*g+1,26*m+25,18*f+1,26*w+25,18*g+17,26*m+25,18*f+17,26*w+25)}else{let s;if(i.shadow>0?[,s,,]=this.world.wallTileMap.getArray(e,t):[,s,,]=this.world.floorTileMap.getArray(e,t),null!=s&&d>0&&d<47){const t=E.length/2;E.push(l,h,l+r,h,l,h+a,l+r,h+a),_.push(s[0],s[1],s[2],s[3],s[4],s[5],s[6],s[7]),A.push(t+0,t+1,t+2,t+1,t+3,t+2),x.push(8*g,8*m,8*f,8*w,8*g+8,8*m,8*f+8,8*w,8*g,8*m+8,8*f,8*w+8,8*g+8,8*m+8,8*f+8,8*w+8)}}}}f=new t.Kj,f.setVertexArray(s),f.setTextureCoordinateArray(o),f.setIndexArray(n),f.setGenericArray("uvuv",y,t.Kj.ArrayTypes.UINT16,4,!1),w=new t.Kj,w.setVertexArray(E),w.setTextureCoordinateArray(_),w.setIndexArray(A),w.setGenericArray("uvuv",x,t.Kj.ArrayTypes.UINT16,4,!1),this.__visibilityCache={},C=this.__visibilityCache,C.visibility=T,C.eyeTileX=l,C.eyeTileY=h,C.viewX1=c,C.viewY1=u,C.viewX2=p,C.viewY2=g,C.radius=Math.floor(d),C.m=m,C.mWall=f,C.mFloor=w}m.setColorMultiplier(0,1,1),m.setBlendMode(t.jy.BlendModes.MULTIPLY),y=s.World.shadowWidth/t.wU.logicalRenderBounds.width*o,E=s.World.shadowHeight/t.wU.logicalRenderBounds.height*n;const _=s.World.shadowWidth/2-Math.floor(this.world.viewX)*s.World.shadowScale,A=s.World.shadowHeight/2-Math.floor(this.world.viewY)*s.World.shadowScale;m.setScale(s.World.shadowScale),f.setScale(s.World.shadowScale),w.setScale(s.World.shadowScale),m.setPosition(_,A),f.setPosition(_,A),w.setPosition(_,A);const x=new t.Kj;{x.setColorArray([16777215,1,16777215,1,16777215,1,16777215,1]),x.setIndexArray([0,1,2,1,3,2]),x.setTexture(se);const e=t.wU.logicalRenderBounds.width/o,i=t.wU.logicalRenderBounds.height/n;x.setVertexArray([-e/2,-i/2,e/2,-i/2,-e/2,i/2,e/2,i/2]),x.setScale(s.World.shadowScale),x.setPosition(s.World.shadowWidth/2,s.World.shadowHeight/2);const r=s.World.tileWidth*(.9*d-1)/se.width,a=s.World.tileHeight*(.9*d-1)/se.height,l=s.World.tileHeight/s.World.tileWidth/r/2/2,h=s.World.tileWidth/s.World.tileHeight/a/2,c=(-this.world.eyeX+this.world.viewX)*l+se.width/2,u=(-this.world.eyeY+this.world.viewY)*h+se.height/2,p=this.world.viewWidth/r/y*2,g=this.world.viewHeight/a/E*2;x.setTextureCoordinateArray([c-p/2,u-g/2,c+p/2,u-g/2,c-p/2,u+g/2,c+p/2,u+g/2]),x.setBlendMode(t.jy.BlendModes.MULTIPLY)}this.visibilityTexture.clear(16777215,1),w.setShader(ie.getShader("mask")),ie.getShader("mask").setConstant("mask",1),this.visibilityTexture.draw(w);{let t=(e-Math.floor(this.world.viewX))/s.World.shadowWidth,o=(i-Math.floor(this.world.viewY))/s.World.shadowHeight;t=2*t*s.World.shadowScale,o=2*o*s.World.shadowScale,m.setShader(ie.getShader("shadow")),ie.getShader("shadow").setConstant("eyePos",[t,o,0,0])}this.visibilityTexture.draw(m),this.visibilityTexture.draw(x),ie.getShader("mask").setConstant("mask",0),f.setShader(ie.getShader("mask")),ie.getShader("mask").setTexture("maskSampler",new t.xE(s.World.shadowMaskTextureName)),this.visibilityTexture.draw(f)}invalidateVisibility(){this.__visibilityCache=null}refreshEntityVisibility(){this.world.entityLayer.sortChildren();for(const e in this.world.entityManager.entitiesByXy){const i=this.world.entityManager.entitiesByXy[e];i.visibleTw&&i.visibleTw.stop(),0!=(this.world.map.getVisibility(i.tileX,i.tileY)&v.BLOCK_VISION)?(i.isPlayer&&console.log("ÌîåÎ†àÏù¥Ïñ¥Í∞Ä ÏïàÎ≥¥ÏûÑ",i.tileX,i.tileY,this.world.map.getVisibility(i.tileX,i.tileY)),i.visibleTw=new t.kX(i,200,{alpha:0},{ease:t.Ui.linear}).onComplete((()=>{i.setVisible(!1)}))):(i.setVisible(!0),i.visibleTw=new t.kX(i,100,{alpha:1},{ease:t.Ui.linear}))}for(const e in this.world.entityManager.itemsByXy){const i=this.world.entityManager.itemsByXy[e],s=i[i.length-1];s.visibleTw&&s.visibleTw.stop(),0!=(this.world.map.getVisibility(s.tileX,s.tileY)&v.BLOCK_VISION)?s.visibleTw=new t.kX(s,200,{alpha:0},{ease:t.Ui.linear}).onComplete((()=>{s.setVisible(!1)})):s.isVisible()||(s.setVisible(!0),s.visibleTw=new t.kX(s,100,{alpha:1},{ease:t.Ui.linear}))}for(const t in this.world.map.lightList){const e=this.world.map.lightList[t];e.mesh&&(0!=(this.world.map.getVisibility(e.x,e.y)&v.BLOCK_VISION)?e.mesh.removeFromParent():this.world.lightLayer.addChild(e.mesh))}}canBeSeen(t,e,i){const{x:s,y:o}=this.world.worldToTile(this.world.eyeX,this.world.eyeY);if(i){const[n,r,a]=this.world.map.visibilityTileChecker.canBeSeen(s,o,t,e,i);return[n==x.EMPTY,n,r,a]}{let[i,n,r]=[this.world.map.getVisibility(t,e),t,e];return i!=x.EMPTY&&([i,n,r]=this.world.map.visibilityTileChecker.canBeSeen(s,o,t,e,v.BLOCK_VISION)),[i==x.EMPTY,i,n,r]}}canSee(t,e,i,s,o){const[n,r,a]=this.world.map.visibilityTileChecker.canBeSeen(t,e,i,s,o||v.BLOCK_VISION);return[n==x.EMPTY,n,r,a]}updateShaderViewInfo(){const e=1/this.world.zoom,i=1/this.world.zoom,o=s.World.shadowWidth/s.World.shadowScale,n=s.World.shadowHeight/s.World.shadowScale,r={viewInfo:[.5-(t.wU.logicalRenderBounds.width/2/e+this.world.x)/o,.5-(t.wU.logicalRenderBounds.height/2/i-this.world.y)/n,t.wU.logicalRenderBounds.width/e/o,t.wU.logicalRenderBounds.height/i/n],color1:this.world.__envColor1,color2:this.world.__envColor2};r.viewInfo[1]=1-r.viewInfo[1],r.viewInfo[3]=-r.viewInfo[3],ie.getShader("tileMap").setConstants(r),ie.getShader("light").setConstants(r)}setZoom(e){const i=Math.min(s.World.zoomMax,Math.min(s.World.shadowWidth/t.wU.logicalRenderBounds.width,s.World.shadowHeight/t.wU.logicalRenderBounds.height));return this.world.zoom=t.cQ.clamp(e,s.World.zoomMin,i),this.world.worldLayer.setScaleX(1/this.world.zoom),this.world.worldLayer.setScaleY(1/this.world.zoom),this.lastPos=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],this.moveViewTo(this.world.viewX,this.world.viewY),this.updateShaderViewInfo(),He.interface.cursor.resetScale(),this.world.zoom}getZoom(){return this.world.zoom}moveViewTo(e,i){console.assert(!Number.isNaN(e)),this.world.viewX=e,this.world.viewY=i;const s=1/this.world.zoom,o=1/this.world.zoom,[n,r]=[e*s-this.world.viewWidth/2,i*o-this.world.viewHeight/2],a=new t.ju("viewChanged");a.viewX=e,a.viewY=i,this.world.dispatchEvent(a)}moveEyeTo(e,i){this.world.eyeX==e&&this.world.eyeY==i||(this.world.eyeX=e,this.world.eyeY=i);const s=new t.ju("eyeChanged");s.eyeX=e,s.eyeY=i,this.world.dispatchEvent(s)}invalidateEye(){this.world.lastPos=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],this.world.map.visibilityTileChecker.clearResult(),this.world.map.visibilityTileChecker.getResult()}}var le=i(990),he=i.n(le);function de(t,e,i){let s,o,n,r=(t,e,n)=>{if(o[e+","+n])return;let r=this.read(e,n);if("number"==typeof r&&r>=i)return[t,e,n,r];if(2==this.readLock(e,n)&&"number"!=typeof r&&!this.isSpace(e,n))return;let a=[t,e,n,r];o[e+","+n]=a,s.push([a,e-1,n]),s.push([a,e+1,n]),s.push([a,e,n-1]),s.push([a,e,n+1])};do{let i,a=this.read(t,e);o={},s=[[null,t,e]];do{let t=s;s=[],n&&t.length;for(let e in t){let[s,o,n]=t[e];if(i=r(s,o,n),i)break}}while(null==i&&0!=s.length);let l=i;if(l){let t=l,[e,i,s,o]=t,n=[];do{[e,i,s]=t,n.push([i,s]),t=e}while(null!=t&&("number"!=typeof o||o!=a));return n}n&&console.assert(),n=!0}while(n)}function*ce(t,e,i,s){let o,n,r,a,l,h,d,c,u,p,g;h=i-t,d=s-e,c=Math.abs(1/(h+1e-5)),u=Math.abs(1/(d+1e-5)),g=d>=0?1:-1,p=h>=0?1:-1,o=0,n=Math.floor(t),r=Math.floor(e);let m=t-Math.floor(t);a=h>0?(1-m)*c:m*c;let f,w=e-Math.floor(e);for(l=d>0?(1-w)*u:w*u;!f;)a<=l?(o=a,a+=c,n+=p):(o=l,l+=u,r+=g),f=o>1,yield[n,r]}class ue{constructor(t){if(t=t||{},this.options=t,this.options.floor=null!=this.options.floor?this.options.floor:1,this.options.seed,this.random=new y(this.options.seed),this.options.seed=null!=this.options.seed?this.options.seed:this.random.seed,this.options.width=null!=this.options.width?this.options.width:{min:24,max:40},this.options.height=null!=this.options.height?this.options.height:{min:24,max:40},this.options.numOfFloor=null!=this.options.numOfFloor?this.options.numOfFloor:{min:5,max:10},this.width="number"==typeof this.options.width?this.options.width:this.random.random(this.options.width.min,this.options.width.max),this.height="number"==typeof this.options.height?this.options.height:this.random.random(this.options.height.min,this.options.height.max),this.attrib=[],t.attrib)for(let e in t.attrib){let i=t.attrib[e];this.attrib[e]=i}if(this.map=[],this.readMap=this.map,this.writeMap=this.map,this.startX=void 0,this.startY=void 0,this.endX=void 0,this.endY=void 0,this.lockMap=[],this.clear(null,this.lockMap),this.entityMap=[],this.clear(null,this.entityMap),this.scoreList=void 0,"wildness"==t.type);else if("dungeon"==t.type){this.numOfFloor="number"==typeof this.options.numOfFloor?this.options.numOfFloor:this.random.random(this.options.numOfFloor.min,this.options.numOfFloor.max),this.floor=this.options.floor;let t,e=null!=this.options.cave?this.options.cave:this.random.random(0,10)/10,i=Math.min(Math.abs(1-e),Math.abs(0-e));this.caveStart=this.random.random(Math.floor(this.numOfFloor*(1-e-i)),Math.floor(this.numOfFloor*(1-e+i))),this.bossFloors=[],this.numOfBoss=Math.min(null!=this.options.numOfBoss?this.options.numOfBoss:0,this.numOfFloor),this.numOfBoss>0&&(this.numOfBoss>1?this.bossFloors=this.random.pick(1,this.numOfFloor-1,this.numOfBoss-1):this.bossFloors[this.numOfBoss-1]=this.numOfFloor),this.shopFloors={},this.numOfShop=Math.min(null!=this.options.numOfShop?this.options.numOfShop:0,this.numOfFloor),this.numOfShop>1&&(this.shopFloors=this.random.pick(1,this.numOfFloor-1,this.numOfShop)),this.campfireFloors={},this.numOfCampfire=Math.min(null!=this.options.numOfCampfire?this.options.numOfCampfire:0,this.numOfFloor),this.numOfCampfire>1&&(this.campfireFloors=this.random.pick(1,this.numOfFloor-1,this.numOfCampfire));for(let t=1;t<=this.floor;t++)this.random.random(0,0);if(this.floor<this.caveStart?(this.attrib.push("dungeon"),t=this.generateDungeon()):(this.attrib.push("cave"),t=this.generateCave()),!t){this.getMapString(this.map);console.assert(t,"ÎçòÏ†Ñ ÏÉùÏÑ± Ïã§Ìå®")}this.computeInterestingMap(),this.placeProps(),this.placeMonsters(),this.floor<this.numOfFloor&&this.makeDownStair(),this.closeDoors()}}setReadWrite(t,e){this.readMap=t||this.map,this.writeMap=e||this.map}cloneMap(t){t=t||this.readMap;let e=[];for(let i=0;i<this.height;i++){e[i]=[];for(let s=0;s<this.width;s++)e[i][s]=t[i][s]}return e}clear(t,e){(e=e||this.writeMap).length=0;for(let i=0;i<this.height;i++)if(e[i]=[],null!=t)for(let s=0;s<this.width;s++)e[i][s]=t}getMapString(t){t=t||this.readMap;let e="";for(let i=0;i<this.height;i++)e+=t[i].join(""),i!=this.height-1&&(e+="\n");return e}logMapString(t){t=t||this.readMap;let e="";for(let i=0;i<this.height;i++){for(let s=0;s<this.width;s++){let o=t[i][s];"object"==typeof o?o=o[2]:"number"==typeof o?o=t[i][s].tostring():null==o&&(o="¬∞"),e+=o.tostring()}e+="\n"}return e}getEntityList(t){t=null!=t?t:this.entityMap;let e=[];for(let i=0;i<this.height;i++)for(let s=0;s<this.width;s++)t[i][s]&&e.push({type:t[i][s][0],x:s,y:i,char:t[i][s][1],options:t[i][s][2]});return e}addEntity(t,e,i,s,o){this.draw(t,e,[i,s,o],this.entityMap)}removeEntity(t,e){this.draw(t,e,null,this.entityMap)}readEntity(t,e){let i=this.read(t,e,this.entityMap);return i&&i[0]||null}isSpace(t,e){let i=this.read(t,e);return"string"==typeof i&&0==(v.tileStringData[i].wall&v.BLOCK_PASS)}countSurrounded(t,e,i){let s=0;return s+=this.read(t-1,e-1)!=i?0:1,s+=this.read(t,e-1)!=i?0:1,s+=this.read(t+1,e-1)!=i?0:1,s+=this.read(t-1,e)!=i?0:1,s+=this.read(t+1,e)!=i?0:1,s+=this.read(t-1,e+1)!=i?0:1,s+=this.read(t,e+1)!=i?0:1,s+=this.read(t+1,e+1)!=i?0:1,s}countSurroundedBlock(t,e){let i=0;return i+=this.isSpace(t-1,e-1)?0:1,i+=this.isSpace(t,e-1)?0:1,i+=this.isSpace(t+1,e-1)?0:1,i+=this.isSpace(t-1,e)?0:1,i+=this.isSpace(t+1,e)?0:1,i+=this.isSpace(t-1,e+1)?0:1,i+=this.isSpace(t,e+1)?0:1,i+=this.isSpace(t+1,e+1)?0:1,i}checkBox(t,e,i,s){for(let o=e;o<=s;o++)for(let e=t;e<=i;e++)if(null!=this.read(e,o))return!0;return!1}checkMapString(t,e,i){let s=i.split("\n"),o=s.length,n=s[0].length;for(let i=0;i<o;i++)for(let o=0;o<n;o++)if("0"!=s[i].substr(o,1)&&null!=this.read(t+o,e+i))return!0;return!1}getMapStringSize(t){let e=t.split("\n"),i=e.length;return[e[1].length,i,e]}getSpaceTable(t,e,i,s){t=t||1,e=e||1,i=i||this.width,s=s||this.height;let o=[];for(let n=e;n<=s;n++)for(let e=t;e<=i;e++)this.isSpace(e,n)&&o.push([e,n]);return o}getSameCharTable(t,e,i,s,o){let n=[];for(let r=e;r<=s;r++)for(let e=t;e<=i;e++)this.read(e,r)==o&&n.push([e,r]);return n}getPassages(t,e){let i=[];return this.isSpace(t-1,e)&&i.push([-1,0]),this.isSpace(t+1,e)&&i.push([1,0]),this.isSpace(t,e-1)&&i.push([0,-1]),this.isSpace(t,e+1)&&i.push([0,1]),i}getConnectedNearFloor(t,e,i,s){let o={},n=[[t,e]],r=[],a=(t,e)=>{let a=this.read(t,e);if(!o[t+","+e]&&this.isSpace(t,e)&&"<"!=a){if(o[t+","+e]=!0,"D"!=a&&this.read(t,e,s)&&r.push([t,e]),r.length>=i)return!0;n.push([t-1,e]),n.push([t+1,e]),n.push([t,e-1]),n.push([t,e+1])}};do{let t=n;n=[];for(let e in t){let[i,s]=t[e];if(a(i,s))return r}}while(0!=n.length);return r}draw(t,e,i,s){console.assert(null!=i,"cÍ∞Ä undefined"),console.assert(null!=i,"cÍ∞Ä null"),t<0||t>=this.width||e<0||e>=this.height||((s=null!=s?s:this.writeMap)[e][t]=i)}read(t,e,i){return t<0||t>=this.width||e<0||e>=this.height?"W":(i=null!=i?i:this.readMap)[e][t]}readLock(t,e){return t<0||t>=this.width||e<0||e>=this.height?2:(null!=e&&null!=t&&null!=this.lockMap[e]||this.lockMap[e],this.lockMap[e][t])}drawBox(t,e,i,s,o){for(let n=e;n<=s;n++)for(let e=t;e<=i;e++)this.draw(e,n,o)}traceRay(t,e,i,s,o,n){for(let[r,a]of ce(t,e,i,s)){let t=this.read(r,a);if(n&&"number"==typeof t&&t>=o)return[r,a,t];if(t==o)return[r,a,t]}return[i,s,o]}traceRayToSpace(t,e,i,s){for(let[o,n]of ce(t,e,i,s))if(this.isSpace(o,n))return[o,n]}drawLine(t,e,i,s,o,n){for(let[r,a,l,h]of ce(t,e,i,s)){let t=this.read(r,a);!n||"%"!=t&&"~"!=t?this.draw(r,a,o):this.draw(r,a,"|")}}drawMapString(t,e,i,s){let o=i.split("\n"),n=o.length,r=o[0].length;for(let i=0;i<n;i++)for(let n=0;n<r;n++){let r=o[i].substr(n,1);"0"!=r&&this.draw(t+n,e+i,null!=s?s:r)}}connect(t,e,i,s,o){let n,r=this.random.random(1,3);1==r?(1==this.random.random(1,3)&&(n=!0),this.drawLine(t,e,i,s,o,n)):2==r?(this.random.random(1,4)>1&&(n=!0),this.drawLine(t,s,i,s,o,n)):(this.random.random(1,4)>1&&(n=!0),this.drawLine(i,e,i,s,o,n))}floodFill(t,e,i){let s=[],o=this.read(t,e);function n(t,e,r){let a;for(;this.read(t,e)==o;)a=!0,s.push([t,e]),this.draw(t,e,i),this.read(t,e-1)==o&&n(t,e-1,-1)&&n(t+1,e-1,1),this.read(t,e+1)==o&&n(t,e+1,-1)&&n(t+1,e+1,1),t+=r;return a}return console.assert(o!=i,"Ïπ†Ìï† Í≥≥Ïù¥ Í∞ôÏúºÎ©¥ ÏïàÎêòÏßÄ"),n(t,e,-1)&&n(t+1,e,1),s}floodFillSpace(t,e,i){let s=[],o=(t,e,n)=>{let r;for(;this.isSpace(t,e);)r=!0,s.push([t,e]),this.draw(t,e,i),this.isSpace(t,e-1)&&o(t,e-1,-1)&&o(t+1,e-1,1),this.isSpace(t,e+1)&&o(t,e+1,-1)&&o(t+1,e+1,1),t+=n;return r};return o(t,e,-1)&&o(t+1,e,1),s}countSectors(t){let e=[];if(t){for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)if(this.isSpace(i,t)){const s=e.length;if(e.push({sectorNumber:s,pos:this.floodFillSpace(i,t,s)}),e[s].pos.length,this.random.random(1,Math.floor(this.width*this.height*.005))>e[s].pos.length){e[s].pos.length;for(let t in e[s].pos){let[i,o]=e[s].pos[t];2!=this.readLock(i,o)&&this.draw(i,o,"W")}e.splice(s,1)}}e.length}else{let t=this.cloneMap();this.setReadWrite(t,t);for(let t=0;t<this.height;t++)for(let i=0;i<this.width;i++)if(this.isSpace(i,t)){const s=e.length;e.push({sectorNumber:s,pos:this.floodFillSpace(i,t,"W")})}e.length,this.setReadWrite()}return e}connectSectors(){let t=this.cloneMap();this.setReadWrite(t,t);let e=this.countSectors(!0);const i=e.length-1;for(let t=0;t<i;t++){let t,i=0;e[0].sectorNumber;do{i+=1;let[s,o]=e[0].pos[this.random.random(0,e[0].pos.length-1)];t=de.call(this,s,o,e[0].sectorNumber+1),t.length}while(null==t&&i<=Math.min(e[0].pos.length,5));if(t)for(let e in t){let i=t[e],[s,o]=i,n=this.read(s,o);parseInt(e)>0&&("%"==n||"~"==n?this.draw(s,o,"|"):this.draw(s,o," "))}else for(let t in e[0].pos){let i=e[0].pos[t],[s,o]=i;2!=this.readLock(s,o)&&this.draw(s,o,"B")}e.shift()}this.setReadWrite(t);for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++){let i=this.read(e,t);"string"==typeof i&&this.draw(e,t,i)}this.setReadWrite()}decoFloor(){let e,i="",s=(e,s,o)=>{let n=t.cQ.clamp(o+(this.floor-1)*s,0,10);n>0&&(i+=e.repeat(n))};s('"',-4,10),s(".",-3,10),s(";",-2,10),s(",",-1,10),s("?",1,5),s("(",.5,-1),s("{",1,-1),this.random.random(1,this.floor)>5?e="R":this.random.random(1,this.floor)>10&&(e="&");for(let t=0;t<this.height;t++)for(let s=0;s<this.width;s++){let o=this.read(s,t);if(" "==o){let e=this.random.random(0,i.length-1),o=i.substr(e,1);this.draw(s,t,o)}"W"==o&&e&&this.draw(s,t,e)}}makeRiver(t){let[e,i]=[this.width,this.height],[s,o]=[this.random.random(0,e-1),this.random.random(0,i-1)],n=this.random.random(0,359);const r=(s,o,n)=>{let r,a,l=this.random.random(1,5),h=1;for(;!(s<0||s>=e||o<0||o>=i||h>100);)r=s+Math.cos(180*n/Math.PI)*l,a=o+Math.sin(180*n/Math.PI)*l,this.drawLine(s,o,r,a,t),[s,o]=[r,a],n+=this.random.random(-30,30),l=this.random.random(1,5),h+=1};r(s,o,n),r(s,o,-n)}getCustomBlockList(){let t=this.floor,e=[];const i={};for(let s in he()){let o=he()[s];if(o.special)"boss"==o.special&&this.bossFloors.includes(this.floor)&&(i.boss=i.boss||[],i.boss.push(o)),"shop"==o.special&&this.shopFloors.includes(this.floor)&&(i.shop=i.shop||[],i.shop.push(o)),"campfire"==o.special&&this.campfireFloors.includes(this.floor)&&(i.campfire=i.campfire||[],i.campfire.push(o));else{let i,n=o.chanceToAppear||1;if(o.whiteAttrib)for(let t in o.whiteAttrib){let e,s,r=o.whiteAttrib[t];if("string"==typeof r?e=r:(e=r[1],s=r[2]),this.attrib.includes(e)){i=!0,n*=s||1;break}}if(i&&o.blackAttrib)for(let t in o.blackAttrib){let e,s,n=o.blackAttrib[t];if("string"==typeof n?e=n:(e=n[1],s=n[2]),this.attrib.includes(e)){i=!1;break}}if(i&&o.appearFloor){let e,s=1;for(let i in o.appearFloor){let n=o.appearFloor[i],[r,a,l]=n;if(t>=r&&t<=a){e=!0,s=l||1;break}}e?n*=s:i=!1}if(i&&this.random.random(1,Math.floor(100*n))<=100){let t,i,n;t=s,i=o.mustPlace,n=o.maxTry,e.push([t,n,i])}}}for(let t in i){let s,o,n,r=i[t],a=this.random.random(0,r.length-1);s=t,o=r[a].mustPlace,n=r[a].maxTry,e.unshift([s,n,o])}return e}placeCustomBlocks(t){t=null!=t?t:this.getCustomBlockList();let e,i=this.cloneMap(),s=this.cloneMap(this.lockMap),o=[];for(let i in t){let s=t[i],[n,r,a]=s,[l,h]=this.placeCustomBlock(n,r);if(null==l&&1==a){e=!0;break}o.push([l,h])}return e?(this.map=i,this.lockMap=s,void this.setReadWrite()):o}placeCustomBlock(t,e){let i,s,o,n=he()[t],r=n.map[this.random.random(0,n.map.length-1)],[a,l]=this.getMapStringSize(r),[h,d]=[this.width,this.height],c=n.margin,u=0;this.setReadWrite(this.lockMap);do{if(u+=1,u>(e||1))return void this.setReadWrite();i=this.random.random(c,h-c-a),s=this.random.random(c,d-c-l),o=this.checkMapString(i,s,r)}while(o);if(this.drawMapString(i,s,r),this.setReadWrite(null,this.lockMap),c>0)for(let t=s-c;t<=s+c;t++)for(let e=i-c;e<=i+c;e++)this.drawMapString(e,t,r,1);this.drawMapString(i,s,r,2),this.setReadWrite();let p=this.random.random(n.doorMin,n.doorMax),g=[],m=[];for(let t=0;t<n.doorMax;t++)m.push(t+1);for(let t=0;t<p;t++){let t=this.random.random(0,m.length-1);g.push(m[t]),m.splice(t,1)}for(let t=0;t<p;t++){g[t];let e,o,n,r=this.getSameCharTable(i,s,i+a-1,s+l-1,g[t].toString()),h=0;do{h+=1,[e,o]=r[this.random.random(0,r.length-1)],n=this.getPassages(e,o)}while(!(2==n.length||h>5));if(this.draw(e,o,"D"),n&&2!=n.length){n.length,console.assert(1==n.length,"Î¨∏Ïù¥ ÌïúÏ™ΩÎèÑ ÏïàÏó¥Î†§ÏûàÏúºÎ©¥ ÏïàÎêòÏûñÏïÑ. Î∏îÎ°ùÎç∞Ïù¥ÌÑ∞ Ïò§Î•ò");let[t,i]=n[0];this.draw(e-t,o-i," ")}}for(let t=s;t<s+l;t++)for(let e=i;e<i+a;e++){let i=this.read(e,t);"123456789".indexOf(i)>=0&&this.draw(e,t,n.wall||"M")}return[i,s]}computeInterestingMap(){let t,[e,i]=[this.startX,this.startY],s={},o=[[0,e,i]],n=(t,e,i)=>{if(s[e+","+i]||!this.isSpace(e,i))return;let n=0;n+=0==this.read(e-1,i)?1:0,n+=0==this.read(e+1,i)?1:0,n+=0==this.read(e,i-1)?1:0,n+=0==this.read(e,i+1)?1:0;let r=[t+=Math.pow(n,4),e,i];s[e+","+i]=r,o.push([t+1,e-1,i]),o.push([t+1,e+1,i]),o.push([t+1,e,i-1]),o.push([t+1,e,i+1])};do{t=o,o=[];for(let e in t){let[i,s,o]=t[e];n(i,s,o)}}while(0!=t.length);let r=[];this.setReadWrite(r,r),this.clear(0);for(let t in s){let[e,i,o]=s[t];this.draw(i,o,e)}let a=this.cloneMap(r);this.setReadWrite(r,a);let l=0;for(let t in s){let[,e,i]=s[t];if(this.read(e,i)>0){let t=0;t+=0!=this.read(e-1,i)?1:0,t+=0!=this.read(e+1,i)?1:0,t+=0!=this.read(e,i-1)?1:0,t+=0!=this.read(e,i+1)?1:0;let s=0;s+=this.read(e-1,i),s+=this.read(e+1,i),s+=this.read(e,i-1),s+=this.read(e,i+1);let o=s/t,n=Math.max(0,2*this.read(e,i,a)-o);l=Math.max(l,n),this.draw(e,i,n)}}this.setReadWrite(a,a);for(let t in s){let e=s[t],[,i,o]=e,n=this.read(i,o)/l;e[0]=n,this.draw(i,o,String.fromCharCode(65+25*n))}let h=[];for(let t in s){let e=s[t],[,i,o]=e,n=this.read(i,o,this.map);"DE><FYI*".indexOf(n)<0&&h.push(e)}return h.sort(((t,e)=>e[0]-t[0])),h.length-=z.maxPet,this.setReadWrite(),this.scoreList=h,this.getMapString(a),a}pickEvents(t,e){const i=this.scoreList.slice(),s=[];for(let o=0;o<t;o++){console.assert(i.length>0);let t=this.random.random(0,i.length-1);console.assert(t>=0);for(let i=0;i<e;i++)t=this.random.random(0,t),console.assert(t>=0);s.push([i[t][0],i[t][1],i[t][2]]),i.length>1&&i.splice(t,1)}return s}makeRooms(t,e){let i=[],s=(t,e,o,n,r)=>{if(r<8&&(t=2),n<8&&(t=1),1==t&&r>4&&!(r<15&&1==this.random.random(1,2))){let i=this.random.random(2,r-2);s(3-t,e,o,n,i),s(3-t,e,o+i,n,r-i)}else if(2==t&&n>4&&!(n<15&&1==this.random.random(1,2))){let i=this.random.random(2,n-2);s(3-t,e,o,i,r),s(3-t,e+i,o,n-i,r)}else console.assert("dirÏù¥ 1,2Í∞Ä ÏïÑÎãò"),i.push([e,o,n,r])};s(this.random.random(1,2),3,3,this.width-5,this.height-5),this.setReadWrite(this.lockMap);for(let t in i){let e=i[t],[s,o,n,r]=e;if(n>3&&r>3){let e,a,l,h;1==this.random.random(1,4)?(e=this.random.random(s+1,s+n-1-2),a=this.random.random(o+1,o+r-1-2),l=this.random.random(e+2,s+n-1),h=this.random.random(a+2,o+r-1)):[e,a,l,h]=[s+1,o+1,s+n-1,o+r-1],this.checkBox(e-1,a-1,l+1,h+1)?i[t]=null:i[t]=[e,a,l,h]}else i[t]=null}this.setReadWrite();let o=[];for(let t in i){let e=i[t];if(e){o.push(e);let[t,i,s,n]=e;this.setReadWrite(),this.drawBox(t-1,i-1,s+1,n+1,"M"),this.drawBox(t,i,s,n," "),this.setReadWrite(this.lockMap,this.lockMap),this.drawBox(t-1,i-1,s+1,n+1,2),this.drawBox(t,i,s,n,1),this.setReadWrite();let r=[1,2,3,4];for(let t=1;t<=this.random.random(0,3);t++)r.push(this.random.random(1,4));for(let e in r){let o=r[e];if(1==o){let e=this.random.random(t,s);"D"!=this.read(e-1,i-1)&&"D"!=this.read(e+1,i-1)&&"M"!=this.read(e,i-2)&&(this.draw(e,i-1,"D"),this.draw(e,i-2," "))}else if(2==o){let t=this.random.random(i,n);"D"!=this.read(s+1,t-1)&&"D"!=this.read(s+1,t+1)&&"M"!=this.read(s+2,t)&&(this.draw(s+1,t,"D"),this.draw(s+2,t," "))}else if(3==o){let e=this.random.random(t,s);"D"!=this.read(e-1,n+1)&&"D"!=this.read(e+1,n+1)&&"M"!=this.read(e,n+2)&&(this.draw(e,n+1,"D"),this.draw(e,n+2," "))}else if(4==o){let e=this.random.random(i,n);"D"!=this.read(t-1,e-1)&&"D"!=this.read(t-1,e+1)&&"M"!=this.read(t-2,e)&&(this.draw(t-1,e,"D"),this.draw(t-2,e," "))}}}}return o}eraseTinyHallAndDoor(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++)if(" "==this.read(e,t)){let i=0;i+=this.isSpace(e-1,t)?0:1,i+=this.isSpace(e,t-1)?0:1,i+=this.isSpace(e+1,t)?0:1,i+=this.isSpace(e,t+1)?0:1,3==i&&("D"!=this.read(e-1,t)&&"D"!=this.read(e+1,t)&&"D"!=this.read(e,t-1)&&"D"!=this.read(e,t+1)||this.draw(e,t,"W"))}for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++)if("D"==this.read(e,t)){let i=0;i+=this.isSpace(e-1,t)?0:1,i+=this.isSpace(e,t-1)?0:1,i+=this.isSpace(e+1,t)?0:1,i+=this.isSpace(e,t+1)?0:1,3==i&&this.draw(e,t,"M")}}makeUpStair(t){let e,i;do{[e,i]=t[this.random.random(0,t.length-1)]}while("D"==this.read(e,i));this.draw(e,i,"<"),[this.startX,this.startY]=[e,i]}makeDownStair(){let t,e,i,s,o=1;do{o-=.1;let n=this.pickEvents(1,o);[t,e,i]=n[0],"D"!=this.read(e,i)&&(this.isSpace(e-1,i)&&"D"!=this.read(e-1,i)&&(s=-1),this.isSpace(e+1,i)&&"D"!=this.read(e+1,i)&&(s=1))}while(!s);return this.draw(e,i,">"),this.draw(e+s,i,">"),this.endX=Math.min(e,e+s),this.endY=i,[this.endX,this.endY]}decoRooms(t){for(let e in t){let i=t[e],[s,o,n,r]=i,a=n-s+1,l=r-o+1;if(this.random.random(1,4)<=1+a*l/60){let t=0,e=0;a>=5&&(t=1+(a>5?1:0)+a%2),l>=5&&(e=1+(l>5?1:0)+l%2);let i=0,n=0;for(let r=1;r<=e;r++)for(let h=1;h<=t;h++){let d=i+s+Math.floor((h-1)*(a-2)/(t-.999))+1,c=n+o+Math.floor((r-1)*(l-2)/(e-.999))+1;" "==this.read(d,c)&&this.draw(d,c,"U")}}let h=Math.max(0,this.random.random(1,3+Math.floor(a*l/30))-2);for(let t=1;t<=h;t++){let t,e;if(1==this.random.random(1,4))t=this.random.random(s,n),e=this.random.random(o,r);else{let i=this.random.random(1,4);1==i?(t=this.random.random(s,n),e=o):2==i?(t=n,e=this.random.random(o,r)):3==i?(t=this.random.random(s,n),e=r):4==i&&(t=s,e=this.random.random(o,r))}" "==this.read(t,e)&&this.draw(t,e,"I")}let d="ZZZZZ:::::::+++++||........,,,{",c=Math.max(1,this.random.random(1,6)-3),u=[];for(let t=1;t<=c;t++){let t=this.random.random(0,d.length-1);u.push(d.substr(t,1))}for(let t=o;t<=r;t++)for(let e=s;e<=n;e++)" "==this.read(e,t)&&this.draw(e,t,u[this.random.random(0,c-1)])}}closeDoors(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++)"D"==this.read(e,t)&&this.draw(e,t,"E")}generateCave(){this.clear(" ");let[t,e]=[this.width,this.height],i=this.random.random(30,40),s=this.random.random(2,3),o=this.random.random(3,5);for(let s=0;s<e;s++)for(let e=0;e<t;e++)this.random.random(1,100)<i&&this.draw(e,s,"W");for(let i=1;i<=o;i++){let i=this.cloneMap(this.map);this.setReadWrite(i);for(let i=0;i<e;i++)for(let e=0;e<t;e++){let t=this.countSurroundedBlock(e,i);t<=s?this.draw(e,i," "):t>=4&&this.draw(e,i,"W")}}this.setReadWrite();for(let i=0;i<e;i++)this.draw(0,i,"W"),this.draw(t-1,i,"W");for(let i=0;i<t;i++)this.draw(i,0,"W"),this.draw(i,e-1,"W");let n=this.random.random(0,this.floor<this.random.random(1,10)?2:0),r=Math.max(0,this.floor>this.random.random(5,10)?2:0);for(let t=0;t<n;t++)this.makeRiver("~");for(let t=0;t<r;t++)this.makeRiver("%");for(let i=0;i<Math.floor(t*e/(50*(1+this.floor/10)));i++){let[i,s]=[this.random.random(0,t-1),this.random.random(0,e-1)];" "!=this.read(i,s)||"W"!=this.read(i-1,s)&&"W"!=this.read(i+1,s)||this.draw(i,s,"I")}let a,l=0;do{l+=1,a=this.placeCustomBlocks()}while(!(a||l>5));if(!a)return;this.connectSectors(),this.eraseTinyHallAndDoor(),this.decoFloor();let h=this.countSectors();if(!(h.length>1))return this.makeUpStair(h[0].pos),h[0].pos;console.assert(!1,`ÏÑπÌÑ∞Í∞Ä ÎßéÎã§. ${h.length}`)}generateDungeon(){this.clear("W");let t,[e,i]=[this.width,this.height],s=0;do{s+=1,t=this.placeCustomBlocks()}while(!(t||s>5));console.assert(t,"Ïª§Ïä§ÌÖÄ Î∏îÎ°ùÏùÑ Î∞∞ÏπòÌïòÎäî Í≥ºÏ†ïÏóêÏÑú Ïã§Ìå®");let o=this.makeRooms(1,10);this.connectSectors(),this.eraseTinyHallAndDoor(),this.decoRooms(o),this.decoFloor();let n=this.countSectors();return n.length>1?(this.getMapString(),void console.assert(!1,`ÏÑπÌÑ∞Í∞Ä ÎßéÎã§. ${n.length}`)):(this.makeUpStair(n[0].pos),n[0].pos)}placeProps(){for(let t in this.scoreList){let e=this.scoreList[t],[i,s,o]=e;this.countSurroundedBlock(s,o)<6&&0==this.countSurrounded(s,o,"D")&&(1==this.random.random(1,Math.max(1,100-Math.pow(3*this.countSurrounded(s,o,"M"),2)))&&this.addEntity(s,o,"prop","@"),1==this.random.random(1,Math.max(1,100-Math.pow(3*this.countSurrounded(s,o,"W"),2)))&&this.addEntity(s,o,"prop","&"),1==this.random.random(1,Math.max(1,100-Math.pow(3*this.countSurrounded(s,o,"M"),2)))&&this.addEntity(s,o,"prop","#"))}}placeMonsters(){let t=H.pickMonsters(this.attrib);this.attrib;let e={};this.setReadWrite(e,e),this.clear(null);for(let t in this.scoreList){let e=this.scoreList[t],[i,s,o]=e;this.draw(s,o,i>0?"@":".")}this.setReadWrite();for(let i=1;i<=Math.floor(this.scoreList.length/10);i++){let i=t[this.random.random(0,t.length-1)],[s,o,n]=this.scoreList[this.scoreList.length-1];if(H.property[i].list){let[t,s]=H.parseMonsterList(H.property[i].list),r=this.getConnectedNearFloor(o,n,this.random.random(s,t.length),e);for(let e in r){let[i,s]=r[e];this.addEntity(i,s,"monster",t[e].name)}}else null==this.readEntity(o,n)&&this.addEntity(o,n,"monster",i)}}}function pe(){if(null!=this.floorTileMap){this.__animationTick=(this.__animationTick+1)%4;const t=1*this.__animationTick/256*s.World.tileWidth;ie.getShader("tileMap").setConstant("offset",[t,0,0,0])}}function ge(e){console.assert(null==this.floorTileMap,"ÏõîÎìúÏóê mapÏùÑ Ïó¨Îü¨Î≤à ÏÉùÏÑ±ÌïòÎ†§Ìï®"),this.map=e,this.belowTileMap=new t.Kw(this.map.width,this.map.height,null,s.World.tileWidth,s.World.tileHeight,2,2,1,1,s.World.tileWidth,s.World.tileHeight),this.floorTileMap=new t.Kw(this.map.width,this.map.height,null,s.World.tileWidth,s.World.tileHeight,2,2,1,1,s.World.tileWidth,s.World.tileHeight),this.wallTileMap=new t.Kw(this.map.width,this.map.height,null,s.World.tileWidth,s.World.tileHeight,2,2,1,1,s.World.tileWidth,s.World.tileHeight);for(const t in this.map.spawnTable){const e=this.map.spawnTable[t],i=new H(e.x,e.y,{id:e.id,color:this.map.getEntityProperty(e.id).color||16748544});this.entityManager.addEntity(i)}this.floorLayer.addChildAt(this.floorTileMap,0),this.floorLayer.addChildAt(this.belowTileMap,0),this.wallLayer.addChildAt(this.wallTileMap,0),this.floorTileMap.setShader(ie.getShader("tileMap")),this.belowTileMap.setShader(ie.getShader("tileMap")),this.wallTileMap.setShader(ie.getShader("tileMap")),this.floorTileMap.motionBlur=!1,this.belowTileMap.motionBlur=!1,this.wallTileMap.motionBlur=!1,ie.getShader("tileMap").setConstant("glossy",[0,0,s.World.shadowWidth/s.World.shadowHeight*8/this.zoom,8/this.zoom]),this.sightManager.updateShaderViewInfo(),this.sightManager.__revealCache={},this.addEventListenerOnStage(t.ju.ENTER_FRAME,this.onEnterFrame,this)}class me extends t.jy{constructor(e){super(),He.world?console.log("GLOBAL.worldÍ∞Ä Ï°¥Ïû¨ÌïòÎäîÎç∞ ÏõîÎìúÎ•º ÏÉùÏÑ±Ï§ë"):He.world=this,this.entityManager=this.addComponent(new Kt),this.sightManager=this.addComponent(new ae),this.pathManager=this.addComponent(new Jt),console.assert(null!=this.entityManager&&null!=this.sightManager&&null!=this.pathManager,"WorldÏùò Manager Ï¥àÍ∏∞ÌôîÍ∞Ä Ïã§Ìå®Ìï®."),this.options=e||{};const[i,s]=[t.wU.logicalViewport.width,t.wU.logicalViewport.height];if(this.viewWidth=i,this.viewHeight=s,this.zoom=1,this.viewX=null,this.viewY=null,this.eyeX=null,this.eyeY=null,this.viewRadius=10,this.lastPos=[0,0,0,0],this.__envColor1=[1,1,1,.2],this.__envColor2=[.4,.5,.6,1],this.map=void 0,this.turn=1,this.dateTimeOrigin=0,this.__time=0,this.__rain=-1,this.time=0,this.rain=-1,this.__timer=new t.B7(250,0),this.__timer.start(),this.__animationTick=0,this.__timer.addEventListenerOnStage(t.ju.TIMER,pe,this,this),this.randomGenerator=new y(this.options.seed),this.random=this.randomGenerator.random.bind(this.randomGenerator),this.worldLayer=new t.jy,this.clipLayer=new t.jy,this.floorLayer=new t.jy,this.shadowLayer=new t.jy,this.wallLayer=new t.jy,this.itemLayer=new t.jy,this.entityLayer=new t.jy,this.lightLayer=new t.jy,this.effectLayer=new t.jy,this.clipLayer.addChild(this.worldLayer),this.worldLayer.addChild(this.floorLayer),this.worldLayer.addChild(this.shadowLayer),this.worldLayer.addChild(this.wallLayer),this.worldLayer.addChild(this.lightLayer),this.worldLayer.addChild(this.itemLayer),this.worldLayer.addChild(this.entityLayer),this.worldLayer.addChild(this.effectLayer),this.belowTileMap=void 0,this.floorTileMap=void 0,this.wallTileMap=void 0,this.addChild(this.clipLayer),this.elemental=new D,this.floorLayer.addChild(this.elemental.layers[D.WATER]),this.effectLayer.addChild(this.elemental.layers[D.POISON]),this.effectLayer.addChild(this.elemental.layers[D.FIRE]),this.waterAmount=0,this.clearAutoMap=!0,this.places=[],this.options.loadData)this.setMapString(this.options.loadData.mapString),this.randomGenerator.load(this.options.loadData.random),this.options.loadData=null,console.log("ÏÑ∏Ïù¥Î∏åÎç∞Ïù¥ÌÑ∞Î°úÎìú"),this.ready();else if(this.options.url)this.type="wildness",console.log("URLÏóêÏÑú Îç∞Ïù¥ÌÑ∞Î•º Î∞õÏïÑÏò®Îã§.",this.options.url),this.setMapUrl(this.options.url).on("complete",(()=>{this.ready()})),this.options.url=null;else if(this.options.worldGen)this.type="wildness",console.log("WORLD GENERATOR Î•º ÌÜµÌï¥ÏÑú ÏÉùÏÑ±."),this.setByWorldGen(this.options.worldGen),this.ready(),this.options.worldGen=null;else{if("dungeon"==this.options.type||"wildness"==this.options.type){this.type="dungeon",this.proceduralMap=new ue(this.options),this.setMapString(this.proceduralMap.getMapString()),this.enterX=this.proceduralMap.startX,this.enterY=this.proceduralMap.startY;const t=this.proceduralMap.getEntityList();for(const e in t){const i=t[e];let s;"prop"==i.type?s=new Ct(i.char,i.x,i.y,i.options):"monster"==i.type?s=new H(i.char,i.x,i.y,i.options):"npc"==i.type&&(s=new K(i.char,i.x,i.y,i.options)),this.entityManager.addEntity(s)}}this.ready()}this.sightManager.updateShaderViewInfo()}ready(e){t.B7.delayedCall(e||0,(()=>{this.processDateTime();const e=new t.ju("ready");this.dispatchEvent(e)}))}getProperty(t,e){return this.map.getProperty(t,e)}onEnterFrame(){const[e,i,o,n,r]=this.lastPos,a=1/this.zoom,l=1/this.zoom;if(this.sightManager.updateShaderViewInfo(),ie.getShader("tileMap").setConstant("glossy",[0,0,s.World.shadowWidth/s.World.shadowHeight*1,1]),this.renderWhetherEffect(this.viewX-(i||this.viewX),this.viewY-(o||this.viewY)),this.clearAutoMap&&(He.interface.autoMap.clear(),this.clearAutoMap=!1),e!=this.viewRadius||i!=this.viewX||o!=this.viewY||n!=this.eyeX||r!=this.eyeY){const[t,e]=[this.viewX-this.viewWidth/2*this.zoom,this.viewY-this.viewHeight/2*this.zoom],[i,o]=[this.viewX+this.viewWidth/2*this.zoom,this.viewY+this.viewHeight/2*this.zoom];let n,r,a,l;n=Math.floor(t/s.World.tileWidth)+1-1,r=Math.floor(e/s.World.tileHeight)+1-1,a=Math.floor(i/s.World.tileWidth)+1+1,l=Math.floor(o/s.World.tileHeight)+1+1,this.sightManager.computeVisibility(),this.lastPos=[this.viewRadius,this.viewX,this.viewY,this.eyeX,this.eyeY]}if(this.lightLayer.getNumChildren()>0&&t.cQ.random(0,20)<=this.lightLayer.getNumChildren()){const e=this.lightLayer.getChildAt(t.cQ.random(0,this.lightLayer.getNumChildren()-1));e.setScale(.01*t.cQ.random(1,10)+.9),e.setAlpha(.03*t.cQ.random(1,10)+.7)}this.worldLayer.setPosition(-(this.viewX*a-this.viewWidth/2),-(this.viewY*l-this.viewHeight/2))}setMap(t){const e=new v;e.loadFile(t),ge.call(this,e)}setMapUrl(t){return new UrlLoader(t).on("complete",(t=>{const e=t.data,i=new v;i.loadString(e),ge.call(this,i)})).on("error",(()=>{console.log("UrlLoader ERROR")}))}setMapString(t){const e=new v;e.loadString(t),ge.call(this,e)}tileToWorld(e,i){return new t.E9(Math.floor(e)*s.World.tileWidth,Math.floor(i)*s.World.tileHeight)}tileCenterToWorld(e,i){return new t.E9(Math.floor(e)*s.World.tileWidth+.5*s.World.tileWidth,Math.floor(i)*s.World.tileHeight+.5*s.World.tileHeight)}worldToTile(e,i){return new t.E9(Math.floor(e/s.World.tileWidth),Math.floor(i/s.World.tileHeight))}stageToTile(e,i){const o=1/this.zoom,n=1/this.zoom,r=this.viewWidth/2/o,a=this.viewHeight/2/n;return new t.E9(Math.floor((e/o+this.viewX-r)/s.World.tileWidth),Math.floor((i/n+this.viewY-a)/s.World.tileHeight))}stageToWorld(e,i){const s=1/this.zoom,o=1/this.zoom,n=this.viewWidth/2/s,r=this.viewHeight/2/o;return new t.E9(e/s+this.viewX-n,i/o+this.viewY-r)}worldToStage(e,i){const s=1/this.zoom,o=1/this.zoom,n=this.viewWidth/2/s,r=this.viewHeight/2/o;return new t.E9(e-this.viewX+n,i-this.viewY+r)}tileToStage(e,i){const o=1/this.zoom,n=1/this.zoom,r=this.viewWidth/2/o,a=this.viewHeight/2/n;return new t.E9(Math.floor(e-1)*s.World.tileWidth-this.viewX+r,Math.floor(i-1)*s.World.tileHeight-this.viewY+a)}tileCenterToStage(e,i){const o=1/this.zoom,n=1/this.zoom,r=this.viewWidth/2/o,a=this.viewHeight/2/n;return new t.E9(Math.floor(e)*s.World.tileWidth+.5*s.World.tileWidth-this.viewX+r,Math.floor(i)*s.World.tileHeight+.5*s.World.tileHeight-this.viewY+a)}getDistance(t,e,i,s){return Math.sqrt((i-t)*(i-t)+(s-e)*(s-e))}getDistanceBetweenEntities(t,e){return this.getDistance(t.tileX,t.tileY,e.tileX,e.tileY)}addLog(...t){He.interface.addLog(...t)}destroy(e){He.world==this&&(He.world=null),t.$u.stopAllSingleSound(),e||this.removeFromParent(),console.log("ÏõîÎìúÎ•º ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÌååÍ¥¥ÌñàÏäµÎãàÎã§.")}showMapInfo(e,i){if(He.interface.isSidePanelOpened())return;const s=[];let o;const n=e=>{o=e=null!=e?e:o;const i=s[e];i.button2=()=>{e>1&&t.B7.delayedCall(100,(()=>{n(e-1)}))},s.length>1?i.needNext=!0:i.needNext=!1,He.interface.showInfo(i)};">"==this.getProperty(e,i).char&&(s[s.length]={type:"interact",buttonType:"yesno",button1:()=>{He.world.entityManager.removeEntity(He.player),this.destroy(!0),this.options.floor=this.options.floor+1,He.world=new me(this.options),He.sceneManager.changeScene(He.world,5e3,t.i$.circleInOut,t.Ui.linear),He.player.setTileXy(He.world.enterX,He.world.enterY),He.player.resetPositionAndColor(),He.world.entityManager.addEntity(He.player),He.interface.actionSelector.select(),He.interface.cursor.lock(),He.world.on("enterEnd",(()=>{console.log("Ïù¥ÎèôÏôÑÎ£å"),He.interface.cursor.unlock(),He.interface.cursor.resetScale()}))},text:void 0},"dungeon"==this.options.type?s[s.length-1].text=t.BJ.format("ÏßÄÌïò %dÏ∏µÏúºÎ°ú ÎÇ¥Î†§Í∞ÄÍ≤†ÏäµÎãàÍπå?",this.options.floor+1):s[s.length-1].text=t.BJ.format("%s ÎçòÏ†ÑÏóê Îì§Ïñ¥Í∞ÄÍ≤†ÏäµÎãàÍπå?","Í∞úÎ∞úÏ§ë"));const r=[];if("E"==this.getProperty(e-1,i).char&&r.push(["ÏÑúÏ™Ω",-1,0]),"E"==this.getProperty(e,i+1).char&&r.push(["ÎÇ®Ï™Ω",0,1]),"E"==this.getProperty(e+1,i).char&&r.push(["ÎèôÏ™Ω",1,0]),"E"==this.getProperty(e,i-1).char&&r.push(["Î∂ÅÏ™Ω",0,-1]),r.length>0){for(const t in r){const o=r[t];s[s.length]={type:"interact",text:`${o[0]} Î∞©Ìñ•Ïùò Î¨∏ÏùÑ Ïó¥Í≤†ÏäµÎãàÍπå?`,buttonType:"yesno",button1:()=>{He.player.openDoor(e+o[1],i+o[2])}}}1==r.length&&(s[0].text="Î¨∏ÏùÑ Ïó¥Í≤†ÏäµÎãàÍπå?")}const a=this.entityManager.getItems(e,i);if(a)for(let t=0;t<a.length;t++)s[s.length]={type:"item",item:a[a.length-1],button1:()=>{He.player.pickUpItem(a[a.length-1])}};s.length>0&&n(s.length-1),He.interface.cursor.showAutoAction()}openDoor(e,i){t.$u.playSound("sound/door_open.wav"),this.map.setDataByChar(e,i,"D"),this.map.processVType(e,i),console.log("Î¨∏Ïó¥Í∏∞",this.map.getProperty(e,i).char,He.player.tileX,He.player.tileY,e,i),this.sightManager.revealTile(e,i,!0),this.sightManager.invalidateEye(),this.sightManager.invalidateVisibility(),this.sightManager.refreshEntityVisibility()}processDateTime(){const e=(this.dateTimeOrigin+this.turn)/s.World.turnPerDay*24,i=Math.floor(e%24),o=(Math.floor(60*e%60),t.cQ.clamp(this.rain+t.cQ.random(-40,35)/100,-1,1.3)),n={radius:3,c1:[1,1,1,.2],c2:[1,1,1,.5]};if("wildness"!=this.type)return this.time=e,void(this.rain=o);this.rain<=.2&&o>.2?He.interface.addLog("ÎπÑÍ∞Ä Ïò§Í∏∞ ÏãúÏûëÌïúÎã§."):this.rain>=-.2&&o<-.2&&He.interface.addLog("ÎπÑÍ∞Ä Í∑∏Ï≥§Îã§."),Math.floor(this.time%24)<6&&i>=6&&(o<=0?He.interface.addLog("ÌÉúÏñëÏù¥ Îñ†Ïò§Î•¥Í≥† ÏûàÎã§."):He.interface.addLog("ÎÇ†Ïù¥ Î∞ùÏïòÎã§.")),Math.floor(this.time%24)<18&&i>=18&&(o<=0?He.interface.addLog("ÌÉúÏñëÏù¥ ÏßÄÍ≥† ÏûàÎã§."):He.interface.addLog("ÎÇ†Ïù¥ Ï†ÄÎ¨ºÏóàÎã§.")),this.__tweenTime&&this.__tweenTime.stop(),this.time=e,this.rain=o,this.__tweenTime=new t.kX(this,500,{__time:e,__rain:o}).onChange((()=>{let e,i,o;for(const t in s.World.timeTable)if(s.World.timeTable[t].time>this.__time%24){i=s.World.timeTable[parseInt(t)-1],o=s.World.timeTable[t],e=(this.__time%24-i.time)/(o.time-i.time);break}const r=t.cQ.lerp(i.radius,o.radius,e);let a=[t.cQ.lerp(i.c1[1],o.c1[1],e),t.cQ.lerp(i.c1[2],o.c1[2],e),t.cQ.lerp(i.c1[3],o.c1[3],e),t.cQ.lerp(i.c1[4],o.c1[4],e)],l=[t.cQ.lerp(i.c2[1],o.c2[1],e),t.cQ.lerp(i.c2[2],o.c2[2],e),t.cQ.lerp(i.c2[3],o.c2[3],e),t.cQ.lerp(i.c2[4],o.c2[4],e)];const h=Math.min(1,this.__rain);a=[t.cQ.lerp(a[1],n.c1[1],h),t.cQ.lerp(a[2],n.c1[2],h),t.cQ.lerp(a[3],n.c1[3],h),t.cQ.lerp(a[4],n.c1[4],h)],l=[t.cQ.lerp(l[1],n.c2[1],h),t.cQ.lerp(l[2],n.c2[2],h),t.cQ.lerp(l[3],n.c2[3],h),t.cQ.lerp(l[4],n.c2[4],h)],this.viewRadius=r,this.__envColor1=a,this.__envColor2=l,this.sightManager.updateShaderViewInfo()}))}renderWhetherEffect(e,i){const o=[1,1,1,1],n=[1,1,1,1];if("wildness"==this.type&&this.__rain>0){const i=Math.min(1,this.__rain),r=80*(101-100*i);if(1==t.cQ.random(r)&&null!=this.lightningTimer){const e=this.viewRadius,i=this.__envColor1,s=this.__envColor2;this.viewRadius=15,this.__envColor1=o,this.__envColor2=n,this.sightManager.updateShaderViewInfo(),this.lightningTimer=t.B7.delayedCall(20,(()=>{this.viewRadius=e,this.__envColor1=i,this.__envColor2=s,this.sightManager.updateShaderViewInfo(),this.lightningTimer=null})),t.B7.delayedCall(t.cQ.random(3e3),(()=>{const e=new t.$u("sound/env_lightning.wav").play(t.cQ.random(5e3));e&&(e.setPitch(.01*t.cQ.random(80,100)),e.setVolume(.01*t.cQ.random(50,100)))}))}const[a,l]=[this.viewX-this.viewWidth/2/.5,this.viewY-this.viewHeight/2/.5],[h,d]=[this.viewX+this.viewWidth/2/.5,this.viewY+this.viewHeight/2/.5];let c,u,p,g;c=Math.floor(a/s.World.tileWidth)+1,u=Math.floor(l/s.World.tileHeight)+1,p=Math.floor(h/s.World.tileWidth)+1,g=Math.floor(d/s.World.tileHeight)+1,this.rainSprite||(this.rainSprite=new t.DK,this.rainSprite.setTexture(new t.xE("rainDrop.png",!1,{format:t.Wc.RGBA4444})),this.effectLayer.addChild(this.rainSprite)),t.$u.playSingleSound("sound/loop_rain.wav",this.rain,!0);const m=Math.atan2(-e,20)+90*Math.PI/180,f=this.eyeX/s.World.tileWidth,w=this.eyeY/s.World.tileHeight,y=16*this.getScaleX(),E=101-100*Math.pow(i,2),C=2^this.viewRadius;for(let e=u;e<=g;e++)for(let i=c;i<=p;i++){const o=(i-1)*s.World.tileWidth+t.cQ.random(s.World.tileWidth),n=(e-1)*s.World.tileHeight+t.cQ.random(s.World.tileHeight),r=8,a=this.getProperty(i,e);1==t.cQ.random(E)&&(i-f)**2+(e-w)**2<=C&&a.revealed&&!a.noRain&&this.rainSprite.addParticles([{x:o,y:n-2*r,size:y,angle:m/Math.PI*180+90,ttl:3,speedX:Math.cos(m)*r,speedY:Math.sin(m)*r,color:16777215,alpha:.4}])}}}getDateTime(){return{day:Math.floor(this.time/24),hour:Math.floor(this.time%24),min:Math.floor(60*this.time%60),sec:Math.floor(60*this.time*60%60)}}isRainy(){return 100*this.rain>20}}let fe=new t.JV(16777215,1,1,1),we=new t.JV(16777215,1,1,1),ye=new t.JV(16777215,1,1,1),Ee=new t.JV(16777215,1,1,1),Ce=new t.JV(16777215,1,1,1);function _e(t){if(this.hitTestPointPixel(t.x,t.y)){let{x:e,y:i}=this.getParent().globalToLocal(t.x,t.y);this.__drag={ox:this.getX(),oy:this.getY(),ex:e,ey:i},t.stopPropagation()}}function Ae(t){if(this.__drag){let{x:e,y:i}=this.getParent().globalToLocal(t.x,t.y),s=e+this.__drag.ox-this.__drag.ex,o=i+this.__drag.oy-this.__drag.ey;this.setPosition(s,o),this.__drag=null,t.stopPropagation()}}function xe(t){if(this.__drag){let{x:e,y:i}=this.getParent().globalToLocal(t.x,t.y),s=e+this.__drag.ox-this.__drag.ex,o=i+this.__drag.oy-this.__drag.ey;this.setPosition(s,o),t.stopPropagation()}}we.setPosition(0,-1),ye.setPosition(1,0),Ee.setPosition(0,1),Ce.setPosition(-1,0),fe.addChild(we),fe.addChild(ye),fe.addChild(Ee),fe.addChild(Ce);class ve extends t.jy{constructor(){super(),this.mapScale=2,this.clear();let e=new t.JV(16777215,1);e.setScale(this.mapScale);let i=new t.KG([[0,30,e,{alpha:[1,0],scaleX:[2*this.mapScale,this.mapScale],scaleY:[2*this.mapScale,this.mapScale],x:[-this.mapScale,-this.mapScale/2],y:[-this.mapScale,-this.mapScale/2]}],[30,"goto",0]]);this.mapLayer=new t.jy,this.mapLayer.addChild(i),this.addChild(this.mapLayer),this.relX=0,this.relY=0,this.xMin=Number.MAX_VALUE,this.xMax=Number.MIN_VALUE,this.yMin=Number.MAX_VALUE,this.yMax=Number.MIN_VALUE,this.mapLayer.on(t.ju.POINTER_DOWN,_e,this).on(t.ju.POINTER_UP,Ae,this).on(t.ju.POINTER_MOVE,xe,this)}clear(){this.bitmap&&this.bitmap.removeFromParent(),He.world&&He.world.map&&(this.rtt=new t.AC(He.world.map.width,He.world.map.height),this.bitmap=new t.eY(this.rtt),this.addChildAt(this.bitmap,0),this.bitmap.setScale(this.mapScale),this.bitmap.setBlendMode(t.jy.BlendModes.SCREEN))}setPlayerPosition(t,e){this.bitmap.setPosition(Math.floor(-t*this.mapScale+1),Math.floor(-e*this.mapScale+1)),[this.relX,this.relY]=[t,e],this.setClip(-50,-50,100,100)}drawTile(e,i,s){let o=He.world.getProperty(e,i);we.setColor(16711680,0),ye.setColor(16711680,0),Ee.setColor(16711680,0),Ce.setColor(16711680,0),(s||o.revealed)&&(0!=(o.wall&v.BLOCK_PASS)?s?"E"==o.char?fe.setColor(10485760,1):fe.setColor(null!=o.mapColor?o.mapColor:6316128,1):"E"==o.char?fe.setColor(16728064,1):fe.setColor(null!=o.mapColor?o.mapColor:8421504,1):(fe.setColor(null!=o.mapColor?o.mapColor:2105376,1),s||(He.world.getProperty(e,i-1).revealed||we.setColor(16728064,1),He.world.getProperty(e+1,i).revealed||ye.setColor(16728064,1),He.world.getProperty(e,i+1).revealed||Ee.setColor(16728064,1),He.world.getProperty(e-1,i).revealed||Ce.setColor(16728064,1))),fe.setPosition(e-1,i-1),this.rtt.draw(fe)),this.xMin=Math.min(this.xMin,e),this.xMax=Math.max(this.xMax,e),this.yMin=Math.min(this.yMin,i),this.yMax=Math.max(this.yMax,i);let n=this.xMax-this.xMin,r=this.yMax-this.yMin;this.mapScale=t.cQ.clamp(50/Math.max(n,r),1,2),this.bitmap.setScale(this.mapScale),this.bitmap.setPosition(Math.floor(-this.relX*this.mapScale+1),Math.floor(-this.relY*this.mapScale+1))}drawAll(t){this.rtt.clear(0,1);for(let e=0;e<He.world.map.height;e++)for(let i=0;i<He.world.map.width;i++)this.drawTile(i,e,t);return this.bitmap}hitTestPointPixel(t,e){if(this.hitTestPoint(t,e)){let{x:i,y:s}=this.bitmap.globalToLocal(t,e),o=Math.floor(i),n=Math.floor(s);return console.log(t,e,i,s,this.relX,this.relY),o>=this.relX-5&&o<=this.relX+5&&n>=this.relY-5&&n<=this.relY+5||!(i<this.relX-50||i>this.relX+50||s<this.relY-50||s>this.relY+50)&&!!He.world.getProperty(o,n).revealed}return!1}}function Be(e){let i=new t.ju("indexChanging");i.index=e.getIndex(),e.dispatchEvent(i)}function Te(e){if(Math.abs(e.posX-e.targetPosX)<.1)return e.posX=e.targetPosX,e.updateVisual(),e.hitArea.removeEventListener(t.ju.ENTER_FRAME,Te,e),e.timer&&e.timer.start(),void function(e){let i=new t.ju("indexChanged");i.index=e.getIndex(),e.dispatchEvent(i)}(e);e.velX=(e.targetPosX-e.posX)/8,e.posX=e.posX+e.velX,e.updateVisual()}function be(e,i){if(e.hitArea.hitTestPoint(i.x,i.y)){e.hitArea.hasEventListener(t.ju.ENTER_FRAME)&&e.hitArea.removeEventListener(t.ju.ENTER_FRAME,Te,e);let[s,o]=e.getParent().globalToLocal(i.x,i.y);e.mouse={},e.mouse.x=s,e.mouse.y=o,e.mouse.posX=e.posX,e.mouse.lastX=s,e.mouse.time=t.B7.now(),e.mouse.isClick=!0,e.velX=0,i.stopPropagation(),e.timer&&e.timer.stop()}}function Me(e,i){if(e.mouse){let[s,o]=e.getParent().globalToLocal(i.x,i.y),n=s-e.mouse.x,r=t.B7.now(),a=s-e.mouse.lastX;e.velX=e.velX/Math.pow(3,(r-e.mouse.time)/1e3*20),e.velX=e.velX+a,e.mouse.time=r,e.mouse.lastX=s,e.posX=e.mouse.posX+n,e.updateVisual(),(Math.abs(e.mouse.x-s)>20||Math.abs(e.mouse.y-o)>20)&&(e.mouse.isClick=!1),i.stopPropagation()}}function Pe(e,i){if(e.mouse){let[s,o]=e.getParent().globalToLocal(i.x,i.y),n=t.B7.now(),r=s-e.mouse.lastX;e.velX=e.velX/Math.pow(3,(n-e.mouse.time)/1e3*20),e.velX=e.velX+r,e.targetPosX=Math.floor((e.posX+4*e.velX)/e.width+.5)*e.width,Be(e),e.hitArea.hasEventListener(t.ju.ENTER_FRAME)||e.hitArea.addEventListener(t.ju.ENTER_FRAME,Te,e),e.mouse.isClick&&function(e){let i=new t.ju("click");i.index=e.getIndex(),e.dispatchEvent(i)}(e),e.mouse=null,i.stopPropagation()}}function Fe(e){e.targetPosX=Math.floor(e.posX/e.width+.5-1)*e.width,e.hitArea.hasEventListener(t.ju.ENTER_FRAME)||e.hitArea.addEventListener(t.ju.ENTER_FRAME,Te,e)}class Se extends t.jy{constructor(e,i,s,o){if(super(),this.imageList=s,this.width=e,this.height=i,this.options=o||{},this.numOfImage=this.imageList.length,this.totalWidth=this.imageList.length*this.width,this.options.background&&this.options.background.image)this.options.background.image.setAnchorPoint(.5,.5),this.options.background.image.setPosition(this.width/2,this.height/2),this.addChild(this.options.background.image),this.options.background.image.getWidth()/this.options.background.image.getHeight()>1?this.options.background.image.setScale(this.height/this.options.background.image.getHeight()):this.options.background.image.setScale(this.width/this.options.background.image.getWidth());else{let s=0;this.options.background&&this.options.background.color&&(s=this.options.background.color);let o=t.Kj.createBox(0,0,e,i,s);this.addChild(o)}{let s=t.Kj.createBox(0,0,e,i,0);this.addChild(s),s.setVisible(!1),s.addEventListener(t.ju.MOUSE_DOWN,be,this),s.addEventListener(t.ju.MOUSE_MOVE,Me,this),s.addEventListener(t.ju.MOUSE_UP,Pe,this),this.hitArea=s}{let o=new t.jy;for(let t in s){let n=s[t],r=parseInt(t);n&&(n.setPosition((r-.5)*e-n.getWidth()/2,i/2-n.getHeight()/2),o.addChild(n))}this.parentSpr=o}this.addChild(this.parentSpr),this.posX=0,this.targetPosX=0,t.B7.delayedCall(1,Be,this),this.addEventListener(t.ju.ADDED_TO_STAGE,(()=>{this.options.autoRotationTime&&(this.timer&&(this.timer.stop(),this.timer.removeEventListener(t.ju.TIMER,Fe,this),this.timer=null),this.timer=new t.B7(1e3*this.options.autoRotationTime,0),this.timer.addEventListener(t.ju.TIMER,Fe,this),this.timer.start())})),this.addEventListener(t.ju.REMOVED_FROM_STAGE,(()=>{this.options.autoRotationTime&&this.timer&&(this.timer.removeEventListener(t.ju.TIMER,Fe,this),this.timer.stop(),this.timer=null)}))}updateVisual(){this.parentSpr.setX(this.posX-this.getWidth()/2);let t=-this.posX%this.width,e=Math.ceil(-this.posX/this.width),i=e-1,s=e;e%=this.numOfImage,i%=this.numOfImage;for(let t in this.imageList){let e=this.imageList[t];e&&e.setVisible(!1)}this.imageList[e+1]&&(this.imageList[e+1].setVisible(!0),this.imageList[e+1].setX((s+.5)*this.width)),this.imageList[i+1]&&(this.imageList[i+1].setX((s-.5)*this.width),t>0&&this.imageList[i+1].setVisible(!0))}getIndex(){return Math.floor(-this.targetPosX/this.width+.5)%this.numOfImage+1}setIndex(e){this.mouse||(this.targetPosX=-e*this.width,this.hitArea.hasEventListener(t.ju.ENTER_FRAME)||this.hitArea.addEventListener(t.ju.ENTER_FRAME,Te,this))}getWidth(){return this.width*this.getScaleX()}getHeight(){return this.height*this.getScaleY()}}let De=new t.xE("dot6.png",!1,{format:t.Wc.RGBA5551}),Ge=new t.xE("dot10.png",!1,{format:t.Wc.RGBA5551});class Le extends t.jy{constructor(){super()}close(e){t.$u.playSound("sound/top_menu_close.wav"),He.interface.slideClose((()=>{this.baseSpr.removeFromParent(),He.world.showMapInfo(He.player.tileX,He.player.tileY)})).onChange((()=>{this.baseSpr.setY(He.world.getY()-Le.height)}))}open(){let e=new t.jy;t.$u.playSound("sound/top_menu_open.wav"),console.log("ÌÉë Î©îÎâ¥"),this.baseSpr=e,He.interface.hudLayer.addChild(e);let i={},[s,o,n]=He.stage.renderViewport.xywh,r=Le.height;i[0]=t.Kj.createBox(s,o,n,r,0),i[1]=t.Kj.createBox(s,o,n,r,16711680),i[2]=t.Kj.createBox(s,o,n,r,255),this.makeCharacterPanel(i[0]);let a=new Se(n,Le.height,i).on("indexChanging",(e=>{!function(e,i,s){e.indexDotSprite.removeFromParent();let o=new t.jy;for(let e=0;e<=s;e++){let n;i==e?(n=new t.eY(Ge),n.setAnchorPoint(.5,.5),n.setAlpha(.9)):(n=new t.eY(De),n.setAnchorPoint(.5,.5),n.setAlpha(.5)),n.setPosition(-s/2*8+8*(e-.5),0),o.addChild(n)}o.setPosition(application.logicalViewport.width/2,Le.height-10),e.indexDotSprite=o,e.baseSpr.addChild(o)}(this,e.index,i.length)}));e.addChild(a),He.interface.slideOpen(0,Le.height,(()=>{this.close()})).onChange((()=>{this.baseSpr.setY(He.world.getY()-Le.height)}))}makeCharacterPanel(e){{let i=new t.eY(new t.xE("nameFrame.png",!1,{format:t.Wc.RGBA4444}));i.setAnchorPoint(.5,.5),i.setPosition(application.logicalViewport.width/2,30),e.addChild(i)}{let i=He.interface.getHiresTextField(t.cQ.format("Î†àÎ≤®%d Î∞îÎ∞îÎ¶¨Ïïà Ï†ÑÏÇ¨",He.player.level),je.uiTtf);i.setTextColor(12632256),i.setPosition(application.logicalViewport.width/2-i.getWidth()/2,55),e.addChild(i)}{let i=He.interface.getHiresTextField(t.cQ.format("ÍπÄÎÇòÌÅ¨",He.player.level));i.setTextColor(0),i.setPosition(application.logicalViewport.width/2-i.getWidth()/2,32),e.addChild(i)}{let i=new t.eY(new t.xE("paperdoll.png",!1,{format:t.Wc.RGBA5551}));i.setAnchorPoint(.5,.5),i.setPosition(application.logicalViewport.width/2-20,110),e.addChild(i)}{let i=new t.nv(je.font,t.cQ.format("STR %d",He.player.str));i.setTextColor(16777215),i.setPosition(application.logicalViewport.width/2+10,100),e.addChild(i)}{let i=new t.nv(je.font,t.cQ.format("DEX %d",He.player.dex));i.setTextColor(16777215),i.setPosition(application.logicalViewport.width/2+10,108),e.addChild(i)}{let i=new t.nv(je.font,t.cQ.format("INT %d",He.player.int));i.setTextColor(16777215),i.setPosition(application.logicalViewport.width/2+10,116),e.addChild(i)}{let i=new t.nv(je.font,t.cQ.format("LUCK %d",He.player.luck));i.setTextColor(16777215),i.setPosition(application.logicalViewport.width/2+10,124),e.addChild(i)}{let t=He.interface.getHiresTextWrap("Î∂ÅÏ™ΩÏßÄÎ∞©Ïùò Î∞îÎ∞îÎ¶¨ÏïàÏùÄ ÌÉÄÍ≥†ÎÇú Ï†ÑÏÇ¨Ïù¥Îã§.\nÍ∑∏Îì§ÏùÄ ÌèâÏÉùÏùÑ Ïö©Î≥ëÏù¥ÎÇò Î™®ÌóòÍ∞ÄÎ°ú ÏÇ¥ÏïÑÍ∞ÄÎ©∞ ÎÅùÏóÜÎäî Ï†ÑÌà¨Î•º ÌÜµÌï¥\nÏûêÏã†ÏùÑ Ï¶ùÎ™ÖÌïòÍ≥† Î∞úÌï†ÎùºÎ°ú Í∞ÄÍ∏∞Î•º ÍøàÍæºÎã§.",application.logicalViewport.width-2*s.Interface.margin,40,15,je.uiTtf,"center");t.setTextColor(12632256),t.setPosition(application.logicalViewport.width/2,160),t.setScale(.8*t.getScaleX(),.8*t.getScaleY()),e.addChild(t)}}}function Ie(e,i,s,o){let n=i.data.item.getInventorySprite();return[n,t.wU.logicalViewport.width,n.getHeight()-3]}function Re(e){let i=e.item.data.item;i.isEquippable()&&He.player.inventory.tryEquip(i,!0),t.$u.playSound("sound/changer_select.wav"),this.select(i),this.close()}function ke(){let e=[];{let t=He.player.skills;if(t.length>0)for(let i in t){let s=t[i];e.push(s)}}for(let t in e){let i=e[t];this.actions.includes(i)||this.actions.unshift(i)}for(let t=this.actions.length-1;t>=0;t--)e.includes(this.actions[t])||this.actions.splice(t,1);let i=[];for(let t in this.actions){let e=this.actions[t];i.push([e.name,{item:e}])}let o=new kt(i,t.wU.logicalViewport.width,t.wU.logicalViewport.height-40,{owner:He.world,align:"bottom",stickOnBorder:!0,spriteFunc:Ie,animationFunc:(e,i,s)=>{let o=e.getNumOfItems()-s+1,n=i.getX();i.setX(n-10),i.setAlpha(0),new t.kX(i,100,{x:n,alpha:1},{delay:.02*o,ease:t.Ui.outCubic})}});o.setPosition(s.Interface.margin,0),o.addEventListener("click",Re,this),o.addEventListener("close",this.close,this),this.baseSpr.addChild(o),this.listView=o}Le.height=220;class Oe extends t.jy{constructor(e){super(),this.listView=void 0,this.selectedIcon=e,this.actions=[];let[i,s,o,n]=[t.wU.logicalRenderBounds.left,t.wU.logicalRenderBounds.top,t.wU.logicalRenderBounds.width,t.wU.logicalRenderBounds.height],r=new t.jy;r.addEventListener(t.ju.POINTER_DOWN,(t=>{this.isVisible()&&(this.close(),t.stopPropagation())})),this.addChild(r),this.setVisible(!1),this.baseSpr=r}refresh(){let t=He.player.selectedAction;this.selectedIcon.setColRow(1,1);let e=t.getIcon();"melee"==t.property.type||"ranged"==t.property.type?He.interface.cursor.setMode(e.property.type):He.interface.cursor.setMode(t.property.type),this.selectedIcon.clearChildren(),e.setX(-8),this.selectedIcon.addChild(e)}select(t){let e;t=t||He.player.selectedAction,He.player.selectedAction=t,this.refresh();for(let i=0;i<this.actions.length;i++){let s=this.actions[i];if(console.log(s.name),s==t){e=i;break}}this.actions.splice(e),this.actions.push(t)}unselect(t){if(t==He.player.selectedAction)if("hybrid"==He.interface.cursor.mode){let t=He.player&&He.player.inventory.findEquippedItemByType("ranged"),e=He.player&&He.player.inventory.findEquippedItemByType("melee");t?this.select(t):this.select(e)}else this.select(He.player.baseWeapon);this.refresh()}open(){He.interface.hudLayer.addChild(this),t.$u.playSound("sound/changer_open.wav"),He.interface.hideInfo(),ke.call(this),this.setVisible(!0)}close(){t.$u.playSound("sound/changer_close.wav"),this.setVisible(!1),this.baseSpr.clearChildren(),this.removeFromParent(),He.world.showMapInfo(He.player.tileX,He.player.tileY)}isOpen(){return this.isVisible()}}function Xe(){const[e,i,s,o,n,r,a,l]=this.oldValue,h=He.player;if(!h)return;this.waitingForWorldAndPlayer&&He.world&&h&&(this.waitingForWorldAndPlayer=!1,this.show());const[d,c,u,p,g,m,f,w]=[h.hp,h.hpMax,h.mp,h.mpMax,h.level,h.exp,h.expMax,h.gold];d!=e&&(this.twHp&&this.twHp.stop(),this.twHp=new t.kX(this,300,{hp:d},{ease:t.Ui.outCubic})),c!=i&&(this.twHpMax&&this.twHpMax.stop(),this.twHpMax=new t.kX(this,300,{hpMax:c},{ease:t.Ui.outCubic})),u!=s&&(this.twMp&&this.twMp.stop(),this.twMp=new t.kX(this,300,{mp:u},{ease:t.Ui.outCubic})),p!=o&&(this.twMpMax&&this.twMpMax.stop(),this.twMpMax=new t.kX(this,300,{mpMax:p},{ease:t.Ui.outCubic})),m!=r&&(this.twExp&&this.twExp.stop(),this.twExp=new t.kX(this,300,{exp:m},{ease:t.Ui.outCubic})),f!=a&&(this.twExpMax&&this.twExpMax.stop(),this.twExpMax=new t.kX(this,300,{expMax:f},{ease:t.Ui.outCubic})),w!=l&&(this.twGold&&this.twGold.stop(),this.twGold=new t.kX(this,300,{gold:w},{ease:t.Ui.outCubic})),this.level=g,this.statusChanging&&this.setGauge(this.hp,this.hpMax,this.mp,this.mpMax,this.level,this.exp,this.expMax,this.gold),this.hp==d&&this.hpMax==c&&this.mp==u&&this.mpMax==p&&this.exp==m&&this.expMax==f&&this.gold==w?this.statusChanging=!1:this.statusChanging=!0,this.oldValue=[d,c,u,p,g,m,f,w],this.autoMap.setPlayerPosition(h.tileX,h.tileY)}function We(e,i,s,o,n,r,a,l,h){const d=new t.jy;if(h){const e=new t.JV(0,1,n+2,r+2);e.setPosition(s-1,o-1),d.addChild(e)}let c;if(c=h?i/4:10*Math.ceil(i/100),i>0){const h=Math.floor((i-1)/c);if(e>0){const l=new t.JV(a,1,Math.min(1,e/i)*n,r);l.setPosition(s,o),d.addChild(l)}for(let a=1;a<=h;a++){const h=a*n*c/i;let u;u=a*c<e?0:l;const p=new t.JV(u,1,1,r);p.setPosition(s+h,o),d.addChild(p)}}if(!h){const t=this.getBitmapTextField(Math.floor(e)+"/"+Math.floor(i).toString());t.setTextColor(a),t.setPosition(s,o+16-8),d.addChild(t)}return d}function Ye(t){if(t==this.logFrame.lastPos)return;const e=Math.floor(t/je.LOG_LINE_SPACING),i=e+Math.floor(34/je.LOG_LINE_SPACING)+1,s=t%je.LOG_LINE_SPACING;this.logTextLayer.clearChildren();for(let t=Math.min(i,this.logText.length-1);t>=e;t--){let i;this.logText[t].textWrap?i=this.logText[t].textWrap:(i=this.getHiresTextWrap(this.logText[t].text),this.logText[t].textWrap=i);const o=-1-je.LOG_LINE_SPACING*(1+t-e)+s;i.setPosition(0,o),this.logTextLayer.addChildAt(i,0)}this.logFrame.lastPos=t}function Ne(t){const{x:e,y:i}=He.stage.globalToLocal(t.x,t.y);if(this.isVisible()&&this.logFrame.hitTestPoint(t.x,t.y)&&!this.isSidePanelOpened()&&(this.logFrame.__drag={ex:e,ey:i,click:!0},this.logFrame.isVisible()&&!this.isSidePanelOpened()&&!this.actionSelector.isOpen())){if(this.showLog(),this.logHideTimer&&(this.logHideTimer.stop(),this.logHideTimer=null),this.logTextLayer.getNumChildren()>0&&this.logTextLayer.getChildAt(0)._tw)for(let t=0;t<this.getNumChildren();t++)this.logTextLayer.getChildAt(t)._tw.toEnd();t.stopPropagation()}}function Ue(e){const{x:i,y:s}=He.stage.globalToLocal(e.x,e.y,t.mL);if(this.logFrame.isVisible()){if(this.logFrame.__drag){if(this.logText.length>=Math.floor(34/je.LOG_LINE_SPACING)){this.logFrame.__drag.ex;let t=this.logScrollPos+s-this.logFrame.__drag.ey;t=Math.max(0,Math.min(je.LOG_LINE_SPACING*this.logText.length-34+1,t)),Ye.call(this,t)}e.stopPropagation()}}else if(this.logFrame.__drag){const t=i-this.logFrame.__drag.ex,e=Math.max(0,this.logScrollPos+s-this.logFrame.__drag.ey);(Math.abs(t)>10||Math.abs(e)>10)&&(this.logFrame.__drag.click=!1)}}function Ve(e){if(this.logFrame.isVisible()&&this.logFrame.__drag){if(this.logHideTimer=t.B7.delayedCall(3e3,this.hideLog,this),this.logText.length>=Math.floor(34/je.LOG_LINE_SPACING)){const{x:t,y:i}=He.stage.globalToLocal(e.x,e.y);let s=Math.max(0,this.logScrollPos+i-this.logFrame.__drag.ey);s=Math.max(0,Math.min(je.LOG_LINE_SPACING*this.logText.length-34+1,s)),Ye.call(this,s),this.logScrollPos=s}e.stopPropagation()}this.logFrame.__drag=null}class je extends t.jy{constructor(){super();const{x:i,y:o}=He.world.getPosition();this.hudLayer=t.Ar.fromRenderViewport(),this.addChild(this.hudLayer),this.cursor=new lt,this.hudLayer.origin.addChild(this.cursor),this.logWindowLayer=t.Ar.fromRenderViewport(),this.modalLayer=t.Ar.fromRenderViewport(),this.on(t.ju.ADDED_TO_STAGE,(()=>{t.mL.addChild(this.logWindowLayer),t.mL.addChild(this.modalLayer)})),this.oldValue=[0,0,0,0],this.hp=0,this.hpMax=0,this.mp=0,this.mpMax=0,this.level=0,this.exp=0,this.expMax=0,this.gold=0,this.logText=[],this.autoMap=new ve,this.autoMap.setPosition(-s.Interface.margin-12,-70),this.hudLayer.bottomRight.addChild(this.autoMap);{const e=new P(new t.xE("WindowFrame.png",!1,{format:t.Wc.RGBA5551}));let i,o,n,r;const a=new t.Ar,l=()=>{e.setRect(Math.floor(t.wU.logicalRenderBounds.left+s.Interface.margin),30,Math.floor(t.wU.logicalRenderBounds.width-2*s.Interface.margin),50),[i,o]=[t.wU.logicalRenderBounds.left+s.Interface.margin+9,38],[n,r]=[t.wU.logicalRenderBounds.width-2*(s.Interface.margin+9),34],a.setRect(i,o,n,r),a.setClip(0,0,n,r)};this.logFrame=e,this.logTextLayer=new t.jy,this.logFrame.setVisible(!1),a.bottomLeft.addChild(this.logTextLayer),e.addChild(a),this.logWindowLayer.origin.addChild(e),this.logWindowLayer.on(t.ju.RESIZE,(()=>{l()})),l(),e.on(t.ju.POINTER_DOWN,Ne,this).on(t.ju.POINTER_MOVE,Ue,this).on(t.ju.POINTER_UP,Ve,this),this.logScrollPos=0}{const e=new t.eY(new t.xE("Status.png",!1,{format:t.Wc.RGBA5551}));this.statusSprite=e,e.setAnchorPoint(.5,.5);const i=new Et({up:{image:e},down:{color:10526880,y:2},pixelPerfect:!0});i.setPosition(0,s.Interface.margin+10),i.addEventListener("click",(()=>{this.topMenu.open()})),t.mL.addEventListener(t.ju.RESIZE,(e=>{i.setScale(Math.min(1,t.wU.logicalRenderBounds.width/i.getWidth()))})),this.hudLayer.topMiddle.addChild(i),this.topMenu=new Le,this.hudLayer.topMiddle.addChild(this.topMenu)}{const e=new t.eY(new t.xE("InventoryIcon.png",!1,{format:t.Wc.RGBA5551}));e.setAnchorPoint(.5,.5);const i=new Et({up:{image:e},down:{color:10526880,y:2}});i.setPosition(-s.Interface.margin-12,-s.Interface.margin-16),i.addEventListener("click",(()=>{He.player.inventory.open()})),this.hudLayer.bottomRight.addChild(i)}{const i=new e(new t.xE("ItemBackground.png",!1,{format:t.Wc.RGBA5551}),1,1,48,32),o=new Et({up:{image:i,useSpriteAnchorPoint:!0},down:{y:2}});o.setPosition(s.Interface.margin+i.getWidth()/2,-i.getHeight()/2-s.Interface.margin),this.hudLayer.bottomLeft.addChild(o),this.actionSelector=new Oe(i),o.addEventListener("click",(()=>{this.actionSelector.open()}))}this.waitingForWorldAndPlayer=!0,this.hide(),this.addEventListenerOnStage(t.ju.ENTER_FRAME,Xe,this)}getBitmapTextField(e){return new t.nv(je.font,e)}getHiresTextField(e,i){return new t.nv(i||je.ttf,e)}getHiresTextWrap(e,i,s,o,n,r,a){return t.nv.fromTextWrap(e,i,s,o,n||je.ttf,r,a)}setGauge(t,e,i,s,o,n,r,a){this.statusHp&&this.statusHp.removeFromParent(),this.statusMp&&this.statusMp.removeFromParent(),this.statusExp&&this.statusExp.removeFromParent(),this.statusGold&&this.statusGold.removeFromParent();const[l,h]=[85,8],d=We.call(this,t,e,15-l,2-h,76,11,16711680,5898240);this.statusSprite.addChild(d),this.statusHp=d;const c=We.call(this,i,s,109-l,2-h,58,11,44783,16730);this.statusSprite.addChild(c),this.statusMp=c;{const t=this.getBitmapTextField("LV."+o.toString());t.setTextColor(16777215),t.setPosition(0-l,-10-h);const e=this.getBitmapTextField("g"+Math.floor(a).toString());e.setTextColor(16764928),e.setPosition(168-e.getWidth()-l,-10-h),this.statusSprite.addChild(e),this.statusGold=e;const i=We.call(this,n,r,t.getWidth()+3-l,-6-h,this.statusSprite.getWidth()-t.getWidth()-7-e.getWidth(),5,16776960,6316032,!0);this.statusSprite.addChild(i),this.statusExp=i,this.statusExp.addChild(t)}}addLog(...e){this.showLog();const i=t.BJ.format(...e);if(console.log("Î°úÍ∑∏Ï∂úÎ†•",i),this.logTextLayer.getNumChildren()>0&&this.logTextLayer.getChildAt(0)._tw)for(let t=0;t<this.logTextLayer.getNumChildren();t++)this.logTextLayer.getChildAt(t)._tw.toEnd();if(this.logText.unshift({text:i}),this.logText.length>je.LOG_MAX_LINE&&(this.logText.length=je.LOG_MAX_LINE),!this.logFrame.__drag)if(0==this.logScrollPos){const e=this.getHiresTextWrap(i,null,null,null,je.ttf);this.logText[0].textWrap=e,e.setTextColor(16777215),e.setPosition(0,-1),this.logTextLayer.addChildAt(e,0);for(let e=this.logTextLayer.getNumChildren()-1;e>=0;e--){const i=this.logTextLayer.getChildAt(e),s=i.getY();if(s<-50)i.removeFromParent();else{const e=new t.kX(i,300,{y:s-je.LOG_LINE_SPACING},{ease:t.Ui.outCubic});i._tw=e,e.addEventListener("complete",(()=>{i._tw=null}))}}}else{const t=0;Ye.call(this,t),this.logScrollPos=0}}hideLog(){this.logHideTimer&&(this.logHideTimer.stop(),this.logHideTimer=null),this.loTween&&this.loTween.stop(),this.loTween=new t.kX(this.logFrame,300,{alpha:0},{ease:t.Ui.linear}).onComplete((()=>{for(let t=0;t<this.logText.length;t++)this.logText[t].textWrap.setOverrideColor(7368816);this.logFrame.setVisible(!1),this.loTween=null}))}showLog(){this.loTween&&this.loTween.toEnd(),this.logFrame.setAlpha(1),this.logFrame.setVisible(!0),null!=this.logHideTimer&&(this.logHideTimer.stop(),this.logHideTimer=null),this.logHideTimer=t.B7.delayedCall(3e3,this.hideLog,this)}showInfo(e){let i,s,o,n;console.log("ÏúÑÏπòÏóê ÎåÄÌïú Ï†ïÎ≥¥",e.type),this.infoLayer&&this.infoLayer.removeFromParent(),this.infoLayer=new t.jy,this.hudLayer.center.addChild(this.infoLayer);let r,a,l,h=16777215;if("interact"==e.type){o=this.getHiresTextWrap(e.text,null,null,null,null,"center"),console.log("Ïù∏Ìè¨Ï∞Ω",e.text),o.setTextColor(10526880),i=o.getTextWidth()+16,s=o.getHeight()+18;const[t,n]=[0,-43];o.setPosition(t,n)}else if("item"==e.type){n=new U(e.item.__key),h=e.item.color,o=this.getHiresTextWrap(n.name),o.setTextColor(h),i=o.getTextWidth()+16,s=o.getHeight()+18;const[t,r]=[(-i-20)/2+16+10,-43];o.setPosition(t,r),n.setPosition((-i-20)/2+16,-36),n.setOverrideColor(h)}if(r=new P(new t.xE("RectFrame.png",!1,{format:t.Wc.RGBA5551})),r.setRect((-i-20)/2,-s-20,i+20,s),r.setOverrideColor(h>>1&8355711),r.setAlpha(1),this.infoFrame=r,this.infoLayer.addChildAt(r,0),this.infoLayer.addChild(o),null!=n&&this.infoLayer.addChild(n),"item"==e.type||"pickup"==e.buttonType){const i=new t.eY(new t.xE("PickUpButton.png",!1,{format:t.Wc.RGBA5551}));if(a=new Et({up:{image:i,color:16752640},down:{color:9449472,y:2}}),e.needNext){const e=new t.eY(new t.xE("NextButton.png",!1,{format:t.Wc.RGBA5551}));l=new Et({up:{image:e,color:10526880},down:{color:6316128,y:2}})}}else if("yesno"==e.buttonType){let e=new t.eY(new t.xE("YesButton.png",!1,{format:t.Wc.RGBA5551}));a=new Et({up:{image:e,color:16752640},down:{color:9449472,y:2}}),e=new t.eY(new t.xE("NoButton.png",!1,{format:t.Wc.RGBA5551})),l=new Et({up:{image:e,color:10526880},down:{color:6316128,y:2}})}else if("okcancel"==e.buttonType){let e=new t.eY(new t.xE("OkButton.png",!1,{format:t.Wc.RGBA5551}));a=new Et({up:{image:e,color:16752640},down:{color:9449472,y:2}}),e=new t.eY(new t.xE("NoButton.png",!1,{format:t.Wc.RGBA5551})),l=new Et({up:{image:e,color:10526880},down:{color:6316128,y:2}})}else if("interact"==e.buttonType){const i=new t.eY(new t.xE("InteractButton.png",!1,{format:t.Wc.RGBA5551}));if(a=new Et({up:{image:i,color:41215},down:{color:9449472,y:2}}),e.needNext){const e=new t.eY(new t.xE("NextButton.png",!1,{format:t.Wc.RGBA5551}));l=new Et({up:{image:e,color:10526880},down:{color:6316128,y:2}})}}l?(a.setPosition(-22,55),this.infoLayer.addChild(a),l.setPosition(22,55),this.infoLayer.addChild(l),a.addEventListener("click",(()=>{this.hideInfo(),e.button1&&e.button1()})),l.addEventListener("click",(()=>{this.hideInfo(),e.button2&&e.button2()}))):a&&(a.setPosition(0,55),this.infoLayer.addChild(a),a.addEventListener("click",(()=>{this.hideInfo(),e.button1&&e.button1()})))}hideInfo(){if(!this.infoLayer)return;this.infoTween&&this.infoTween.stop();const e=new t.kX(this.infoLayer,100,{alpha:0},{ease:t.Ui.linear});this.infoTween=e,e.addEventListener("complete",(()=>{this.infoLayer.removeFromParent(),this.infoTween=null}),this)}slideOpen(e,i,s){if(this.slideInfo){const[t,e,i,s,o,n,r,a]=this.slideInfo;r.stop(),He.world.setPosition(o,n),He.world.sightManager.moveViewTo(i+He.world.getX()/2,s+He.world.getY()),He.world.sightManager.updateShaderViewInfo(),a.removeFromParent()}this.hideInfo(),this.cursor.hideAutoAction();const[o,n]=[He.world.viewX,He.world.viewY],{x:r,y:a}=He.world.getPosition();He.interface.cursor.lock();const[l,h,d,c]=t.wU.deviceViewport.xywh,u=t.Kj.createBox(l+e,h-i,d+Math.abs(e),c+Math.abs(i),16711680,.5);u.setVisible(!1),this.addChildAt(u,0);const p=new t.kX(He.world,300,{x:r+e,y:a+i},{ease:t.Ui.outBack}).onChange((()=>{He.world.sightManager.moveViewTo(o+He.world.getX()/2,n+He.world.getY()/2),He.world.sightManager.updateShaderViewInfo(),this.logFrame.setY(He.world.getY()),this.setPosition(...He.world.getPosition().xy)})).onComplete((()=>{u.addEventListener(t.ju.POINTER_DOWN,(t=>{s&&s(),t.stopPropagation()}))}));return this.slideInfo=[e,i,o,n,r,a,p,u],p}slideClose(e){if(this.slideInfo){let[i,s,o,n,r,a,l,h]=this.slideInfo;return l.stop(),l=new t.kX(He.world,300,{x:r,y:a},{ease:t.Ui.outCubic}).onChange((()=>{He.world.sightManager.moveViewTo(o+He.world.getX()/2,n+He.world.getY()/2),He.world.sightManager.updateShaderViewInfo(),this.logFrame.setY(He.world.getY()),this.position=He.world.getPosition()})).onComplete((()=>{this.slideInfo=null,h.removeFromParent(),He.interface.cursor.unlock(),e&&e()})),l}}isSidePanelOpened(){return!!this.slideInfo}hide(){this.setVisible(!1),this.hudLayer.setVisible(!1),this.logWindowLayer.setVisible(!1)}show(){this.setVisible(!0),this.hudLayer.setVisible(!0),this.logWindowLayer.setVisible(!0)}}je.ttf=new t.OD("msdf_mtcg",12,{yellow:{fill:16776960}}),je.uiTtf=new t.OD("msdf_mtcg_ui",12,{}),je.font=new t.UP("font_bitmap",8),je.LOG_LINE_SPACING=12,je.LOG_MAX_LINE=30;class $e{constructor(e){this.path=e||"savedata_"+t.B7.getShortDate()+".json",this.storage=new t.Ke("saveload"),this.serializer=new t.ei([[me,{dataOnly:!0,white:["turn","dateTimeOrigin","places","clearAutoMap","type","entityManager"]}],[Kt,{dataOnly:!0,white:["itemsByXy","entitiesByXy"]}],[$t,{construct:t=>new $t(t.name,t.tileX,t.tileY),keep:["property"]}],[Ct,{construct:t=>new Ct(t.char,t.tileX,t.tileY),keep:["property"]}],[z,{construct:t=>new z(t.name,t.tileX,t.tileY),keep:["property"]}],[H,{construct:t=>new H(t.name,t.tileX,t.tileY),keep:["property"]}],[U,{construct:t=>new U(t.name,t.tileX,t.tileY),keep:["property"]}],[Yt,{construct:t=>new Yt(t.name,t.tileX,t.tileY),keep:["property"]}],[Wt,{construct:t=>new Wt(t.size)}]])}save(){const e={};e.world=He.world,e.player=He.player,e.worldOptions=He.world.options,e.random=He.world.randomGenerator.save(),e.mapString=He.world.map.getMapString(),e.mapProperty={},e.nextId=h.nextId;for(const t in He.world.map.propertyTable){const i=He.world.map.propertyTable[t],s={};for(const t of Object.getOwnPropertyNames(i))s[t]=i[t];e.mapProperty[t]=s}e.elemental=[];for(const t in He.world.elemental.elementalsByXy){const i=He.world.elemental.elementalsByXy[t];e.elemental.push([i.type,i.tileX,i.tileY,i.life])}const i=this.serializer.getSerializableObject(e);t.wU.setPaused(!0);const s=JSON.stringify(i);console.log(s),this.storage.write(this.path,s).then((()=>{t.wU.setPaused(!1)}))}load(e){He.world.entityManager.forceStopTurnProcessing(),this.path=e||this.path,t.wU.setPaused(!0),this.storage.read(this.path).then((e=>{const i=JSON.parse(e);console.log("ÏÑ∏Ïù¥Î∏åÌååÏùº Î°úÎìú ÏãúÏûë",this.path),He.world.destroy(!0);const s={random:i.random,mapString:i.mapString},n=He.world=new me({loadData:s}),r=this.serializer.parse(i);He.interface.autoMap.clear();for(const t in r.mapProperty){const e=r.mapProperty[t];Object.assign(n.map.propertyTable[t],e),e.revealed&&He.world.sightManager.revealTile(e.x,e.y,!0)}for(const t in r.world.entityManager.entitiesByXy){const e=r.world.entityManager.entitiesByXy[t];n.entityManager.addEntity(e)}He.player=r.player,h.nextId=i.nextId,He.sceneManager.changeScene(He.world,1e3,o.i.circleInOut,t.Ui.linear),He.interface.actionSelector.actions=[],He.interface.actionSelector.select(He.player.selectedAction),He.interface.cursor.lock(),He.interface.cursor.hideAutoAction(),He.world.on("enterEnd",(()=>{He.interface.cursor.unlock(),He.interface.cursor.resetScale(),He.world.showMapInfo(He.player.tileX,He.player.tileY)})),console.log("ÏÑ∏Ïù¥Î∏åÌååÏùº Î°úÎìú ÎÅù",this.path),t.wU.setPaused(!1)}))}}const He=new class{constructor(){this.world=null,this.interface=null,this.stage=null,this.sceneManager=null,this.saveLoad=null,this.player=null}};i(962),t.wU.init(180,320,60,t.Mx.ScaleModes.LETTERBOX),t.wU.setBackgroundColor(0),He.stage=t.mL,t.B7.delayedCall(1e3,(()=>{}));const[ze,Ke,Qe,qe]=[0,0,t.wU.logicalRenderBounds.width,t.wU.logicalRenderBounds.height];He.sceneManager=new t.i$(t.wU,ze,Ke,Qe,qe,t.wU.logicalViewport.width,t.wU.logicalViewport.height),He.stage.addChild(He.sceneManager),He.world=new me({seed:5,type:"dungeon",cave:.1,numOfFloor:{min:10,max:15},numOfCampfire:5,floor:1}),He.sceneManager.changeScene(He.world,1e3,t.i$.circleOutRT,t.Ui.outCubic),He.interface=new je,He.stage.addChild(He.interface),He.saveLoad=null,He.world.on("ready",(function(){He.saveLoad=new $e("save.json");let[e,i]=[He.world.enterX,He.world.enterY];for(null==e&&([e,i]=[100,196]);0!=(He.world.getProperty(e,i).wall&v.BLOCK_PASS);)e=t.cQ.random(1,He.world.map.width),i=t.cQ.random(1,He.world.map.height);He.player=new $t(null,e,i),He.world.entityManager.addEntity(He.player);const s=new U("ÎèÑÎÅº");He.player.inventory.addItem(s),s.equip();const o=new U("ÏàèÎ≥¥Ïö∞");He.player.inventory.addItem(o);const n=new U("ÎÇòÏù¥ÌîÑ");He.player.inventory.addItem(n),o.equip(),He.player.selectAction(o);const r=new U("Í≥°Í¥≠Ïù¥");He.player.inventory.addItem(r),r.equip(),He.player.inventory.addItem(new U("ÌïòÌîÑ")),He.player.inventory.addItem(new U("ÎßåÎèåÎ¶∞")),He.player.inventory.addItem(new U("Î†àÌä∏Î°úMSX")),He.player.inventory.addItem(new U("Î†àÌä∏Î°úAPPLE")),He.player.inventory.addItem(new U("ÏïÖÎ≥¥1")),He.player.inventory.addItem(new U("ÏïÖÎ≥¥2")),He.player.inventory.addItem(new U("ÏïÖÎ≥¥3")),He.player.inventory.addItem(new U("ÏïÖÎ≥¥4")),He.player.inventory.addItem(new U("ÏïÖÎ≥¥5"));const a=new z("Í≥†ÏñëÏù¥");He.world.entityManager.addEntity(a)}))})()})();