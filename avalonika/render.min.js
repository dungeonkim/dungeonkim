/*! For license information please see render.min.js.LICENSE.txt */
(()=>{var e={309:function(e){!function(){"use strict";function t(e,t,n){for(var r,o=e,i=t,a=n,s=o.length>>1,l=o[2*s-3]-a,u=o[2*s-2]-i,c=o[2*s-1]-a,d=0;d<s;d++)if(r=u,l=c,u=o[2*d]-i,l!==(c=o[2*d+1]-a))var f=c>l;var h=0;for(d=0;d<s;d++)if(r=u,l=c,u=o[2*d]-i,c=o[2*d+1]-a,!(l<0&&c<0||l>0&&c>0||r<0&&u<0)){if(l===c&&Math.min(r,u)<=0)return!0;if(l!==c){var p=r+(u-r)*-l/(c-l);if(0===p)return!0;p>0&&h++,0===l&&f&&c>l&&h--,0===l&&!f&&c<l&&h--,f=c>l}}return 1==(1&h)}function n(e,t,n,r,o){var i,a,s=e.x,l=e.y,u=t.x,c=t.y,d=n.x,f=n.y,h=d-u,p=f-c,m=((s-u)*h+(l-c)*p)/(h*h+p*p);m<0||u==d&&c==f?(i=u,a=c):m>1?(i=d,a=f):(i=u+m*h,a=c+m*p);var _=s-i,g=l-a,b=Math.sqrt(_*_+g*g);return b<o.dist&&(o.dist=b,o.edge=r,o.point.x=i,o.point.y=a),o}function r(e,t,n,r,o,i,a,s){var l=f(n,i);if(l<s.dist){var u=1/f(r,o),c=-(o.y-r.y)*u,d=(o.x-r.x)*u,h=2*(e*c+t*d);s.dist=l,s.norm.x=c,s.norm.y=d,s.refl.x=-h*c+e,s.refl.y=-h*d+t,s.edge=a}return s}function o(e,t,n){var r=e.length,o=[];n<t&&(n+=r);for(var i=t;i<=n;i++)o.push(e[i%r]);return o}function i(e,t){for(var n=e.length;;)if(e[t=(t+1)%n].flag)return t}function a(e,t,n,r,o,i,a,s){var l=a-n,u=s-r,c=o-n,d=i-r,f=e-n,h=t-r,p=l*l+u*u,m=l*c+u*d,_=l*f+u*h,g=c*c+d*d,b=c*f+d*h,y=1/(p*g-m*m),v=(g*_-m*b)*y,x=(p*b-m*_)*y;return v>=0&&x>=0&&v+x<1}function s(e,t,n,r,o){var i=e.x-t.x,a=n.x-r.x,s=e.y-t.y,l=n.y-r.y,c=i*l-s*a;if(0==c)return null;var d=e.x*t.y-e.y*t.x,f=n.x*r.y-n.y*r.x,h=o,p=1/c;return h.x=(d*a-i*f)*p,h.y=(d*l-s*f)*p,u(h,n,r)?s>0&&h.y>e.y||s<0&&h.y<e.y||i>0&&h.x>e.x||i<0&&h.x<e.x?null:h:null}function l(e,t,n,r,o){var i=e.x-t.x,a=n.x-r.x,s=e.y-t.y,l=n.y-r.y,c=i*l-s*a;if(0===c)return null;var d=e.x*t.y-e.y*t.x,f=n.x*r.y-n.y*r.x,h=o;return h.x=(d*a-i*f)/c,h.y=(d*l-s*f)/c,u(h,e,t)&&u(h,n,r)?h:null}function u(e,t,n){var r=Math.min(t.x,n.x),o=Math.max(t.x,n.x),i=Math.min(t.y,n.y),a=Math.max(t.y,n.y);return r===o?i<=e.y&&e.y<=a:i===a?r<=e.x&&e.x<=o:r<=e.x+1e-10&&e.x-1e-10<=o&&i<=e.y+1e-10&&e.y-1e-10<=a}function c(e,t,n,r,o,i){return(t-r)*(o-n)+(n-e)*(i-r)>=0}function d(e,t){return{x:e,y:t,flag:!1,toString:function(){return"Point ["+e+", "+t+"]"}}}function f(e,t){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}function h(e){e=e||10;for(var t=[],n=0;n<e;n++)t.push(d(0,0));return t}e.exports.IsSimple=function(e){var t=e,n=t.length>>1;if(n<4)return!0;for(var r=d(),o=d(),i=d(),a=d(),s=d(),u=0;u<n;u++){r.x=t[2*u],r.y=t[2*u+1],u==n-1?(o.x=t[0],o.y=t[1]):(o.x=t[2*u+2],o.y=t[2*u+3]);for(var c=0;c<n;c++)if(!(Math.abs(u-c)<2||c==n-1&&0==u||u==n-1&&0==c||(i.x=t[2*c],i.y=t[2*c+1],c==n-1?(a.x=t[0],a.y=t[1]):(a.x=t[2*c+2],a.y=t[2*c+3]),null==l(r,o,i,a,s))))return!1}return!0},e.exports.IsConvex=function(e){var t=e;if(t.length<6)return!0;for(var n=t.length-4,r=0;r<n;r+=2)if(!c(t[r],t[r+1],t[r+2],t[r+3],t[r+4],t[r+5]))return!1;return!!c(t[n],t[n+1],t[n+2],t[n+3],t[0],t[1])&&!!c(t[n+2],t[n+3],t[0],t[1],t[2],t[3])},e.exports.GetArea=function(e){var t=e;if(t.length<6)return 0;for(var n=t.length-2,r=0,o=0;o<n;o+=2)r+=(t[o+2]-t[o])*(t[o+1]+t[o+3]);return.5*-(r+=(t[0]-t[n])*(t[n+1]+t[1]))},e.exports.GetAABB=function(e){for(var t=e,n=1/0,r=1/0,o=-n,i=-r,a=0;a<t.length;a+=2)n=Math.min(n,t[a]),o=Math.max(o,t[a]),r=Math.min(r,t[a+1]),i=Math.max(i,t[a+1]);return{x:n,y:r,width:o-n,height:i-r}},e.exports.Triangulate=function(e){var t=e,n=t.length>>1;if(n<3)return[];for(var r=[],o=[],i=0;i<n;i++)o.push(i);i=0;for(var s=n;s>3;){var l=o[(i+0)%s],u=o[(i+1)%s],d=o[(i+2)%s],f=t[2*l],h=t[2*l+1],p=t[2*u],m=t[2*u+1],_=t[2*d],g=t[2*d+1],b=!1;if(c(f,h,p,m,_,g)){b=!0;for(var y=0;y<s;y++){var v=o[y];if(v!=l&&v!=u&&v!=d&&a(t[2*v],t[2*v+1],f,h,p,m,_,g)){b=!1;break}}}if(b)r.push(l,u,d),o.splice((i+1)%s,1),s--,i=0;else if(i++>3*s)break}return r.push(o[0],o[1],o[2]),r},e.exports.Slice=function(e,n,r,a,s){var u=e,c=n,h=r,p=a,m=s;if(t(u,c,h)||t(u,p,m))return[u.slice(0)];for(var _=d(c,h),g=d(p,m),b=[],y=[],v=0;v<u.length;v+=2)y.push(d(u[v],u[v+1]));for(v=0;v<y.length;v++){var x=d(0,0);x=l(_,g,y[v],y[(v+1)%y.length],x);var w=b[0],E=b[b.length-1];x&&(null==w||f(x,w)>1e-10)&&(null==E||f(x,E)>1e-10)&&(x.flag=!0,b.push(x),y.splice(v+1,0,x),v++)}if(b.length<2)return[u.slice(0)];b.sort((function(e,t){return f(_,e)-f(_,t)}));for(var A=[],S=0;b.length>0;){var C=b[0],O=b[1],T=y.indexOf(C),F=y.indexOf(O),P=!1;if(i(y,T)===F?P=!0:(C=b[1],O=b[0],T=y.indexOf(C),F=y.indexOf(O),i(y,T)===F&&(P=!0)),P){S--;var I=o(y,T,F);A.push(I),y=o(y,F,T),C.flag=O.flag=!1,b.splice(0,2),0==b.length&&A.push(y)}else S++,b.reverse();if(S>1)break}var M=[];for(v=0;v<A.length;v++){for(var R=A[v],k=[],B=0;B<R.length;B++)k.push(R[B].x,R[B].y);M.push(k)}return M},e.exports.ContainsPoint=t,e.exports.Raycast=function(e,t,n,o,i,a){var l=e,u=t,c=n,d=o,f=i,p=l.length-2,m=h(),_=m[0],g=m[1],b=m[2],y=m[3],v=m[4];_.x=u,_.y=c,g.x=u+d,g.y=c+f,null==a&&(a={dist:0,edge:0,norm:{x:0,y:0},refl:{x:0,y:0}}),a.dist=1/0;for(var x=0;x<p;x+=2)b.x=l[x],b.y=l[x+1],y.x=l[x+2],y.y=l[x+3],s(_,g,b,y,v)&&(a=r(d,f,_,b,y,v,x/2,a));return b.x=y.x,b.y=y.y,y.x=l[0],y.y=l[1],s(_,g,b,y,v)&&(a=r(d,f,_,b,y,v,l.length/2-1,a)),a.dist!==1/0?a:null},e.exports.ClosestEdge=function(e,t,r,o){var i=e,a=i.length-2,s=h(),l=s[0],u=s[2],c=s[3];l.x=t,l.y=r,null==o&&(o={dist:0,edge:0,point:{x:0,y:0},norm:{x:0,y:0}}),o.dist=1/0;for(var d=0;d<a;d+=2)u.x=i[d],u.y=i[d+1],c.x=i[d+2],c.y=i[d+3],o=n(l,u,c,d>>1,o);u.x=c.x,u.y=c.y,c.x=i[0],c.y=i[1];var f=1/(o=n(l,u,c,a>>1,o)).dist;return o.norm.x=(t-o.point.x)*f,o.norm.y=(r-o.point.y)*f,o},e.exports.Reverse=function(e){for(var t=e,n=[],r=t.length-2;r>=0;r-=2)n.push(t[r],t[r+1]);return n}}()}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";class e{constructor(t="@EVENT"+ ++e.nextId,n,r){this.name=t,this.stopped=!1,this.target=void 0,this.component=void 0,this.owner=r,this.forwarded=!1,n&&Object.assign(this,n)}on(t,n){return null==this.owner&&(this.owner=new e.EventDispatcher),this.owner.on(this.name,t,n),this}once(t,n){return null==this.owner&&(this.owner=new e.EventDispatcher),this.owner.once(this.name,t,n),this}onStage(e,t,n){return console.assert(this.owner&&this.owner.addChild,"Sprite가 아니면 onStage를 할 수 없습니다."),this.owner.onStage(this.name,e,t,n),this}remove(t,n){return null==this.owner&&(this.owner=new e.EventDispatcher),this.owner.removeEventListener(this.name,t,n),this}dispatch(t){return null==this.owner&&(this.owner=new e.EventDispatcher),Object.assign(this,t),this.owner.dispatchEvent(this),this}stopPropagation(){this.stopped=!0}getTarget(){return this.target}static isInputEvent(t){const n=e.eventAttribs[t];if(null!=n)return 1==n.isInput}}function t(e){return Array.isArray(e)||e instanceof Float32Array?{x:e[0],y:e[1]}:e}e.STAGE_VISIBLE="stageVisible",e.STAGE_FOCUS="stageFocus",e.ENTER_FRAME="enterFrame",e.RENDER="render",e.ADDED_TO_STAGE="addedToStage",e.REMOVED_FROM_STAGE="removedFromStage",e.POINTER_DOWN="pointerDown",e.POINTER_UP="pointerUp",e.POINTER_MOVE="pointerMove",e.MOUSE_DOWN="mouseDown",e.MOUSE_UP="mouseUp",e.MOUSE_MOVE="mouseMove",e.MOUSE_WHEEL="mouseWheel",e.MOUSE_DOWN="touchesBegin",e.MOUSE_UP="touchesEnd",e.TOUCHES_MOVE="touchesMove",e.MOUSE_UP="touchesCancel",e.KEY_UP="keyUp",e.KEY_DOWN="keyDown",e.TIMER="timer",e.TEXTURE_UPDATE="textureUpdate",e.RESIZE="resize",e.READY="ready",e.COMPLETE="complete",e.ERROR="error",e.BEFORE_UPDATE="beforeUpdate",e.AFTER_UPDATE="afterUpdate",e.LOADED="loaded",e.ALL="*",e.APPLICATION_INIT="APPLICATION_INIT",e.APPLICATION_START="APPLICATION_START",e.eventAttribs={[e.POINTER_DOWN]:{isInput:!0},[e.POINTER_UP]:{isInput:!0},[e.POINTER_MOVE]:{isInput:!0},[e.MOUSE_DOWN]:{isInput:!0,device:"mouse"},[e.MOUSE_UP]:{isInput:!0,device:"mouse"},[e.MOUSE_MOVE]:{isInput:!0,device:"mouse"},[e.MOUSE_WHEEL]:{isInput:!0,device:"mouse"},[e.MOUSE_DOWN]:{isInput:!0,device:"touch"},[e.MOUSE_UP]:{isInput:!0,device:"touch"},[e.TOUCHES_MOVE]:{isInput:!0,device:"touch"},[e.MOUSE_UP]:{isInput:!0,device:"touch"},[e.KEY_UP]:{isInput:!0,device:"keyboard"},[e.KEY_DOWN]:{isInput:!0,device:"keyboard"}},e.EventDispatcher=void 0,e.nextId=0;class r{constructor(e,t,n,r){Array.isArray(e)||e instanceof Float32Array?(this.x=e[0],this.y=e[1],this.width=e[2],this.height=e[3]):"object"==typeof e?(this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height):(this.x=e||0,this.y=t||0,this.width=n||0,this.height=r||0)}clone(){return new r(this)}getCornerPoints(){const{x:e,y:t,width:n,height:r}=this;return[e,t,e+n,t,e,t+r,e+n,t+r]}getArray(){return[this.x,this.y,this.width,this.height]}extendPoint(e,t){null==this.x?(this.x=e,this.y=t,this.width=0,this.height=0):(e<this.x&&(this.width+=this.x-e,this.x=e),t<this.y&&(this.height+=this.y-t,this.y=t),this.width=Math.max(this.right,e)-this.x,this.height=Math.max(this.bottom,t)-this.y)}extendRect(e){this.extendPoint(e.x,e.y),this.extendPoint(e.right,e.y),this.extendPoint(e.x,e.bottom),this.extendPoint(e.right,e.bottom)}get xywh(){return[this.x,this.y,this.width,this.height]}set xywh(e){const t=function(e){return Array.isArray(e)||e instanceof Float32Array?{x:e[0],y:e[1],width:e[2],height:e[3]}:e}(e);this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}contains(e,t){return e>=this.left&&e<this.right&&t>=this.top&&t<this.bottom}}class o{constructor(e,t){Array.isArray(e)||e instanceof Float32Array?(this.x=e[0],this.y=e[1]):"object"==typeof e?(this.x=e.x,this.y=e.y):(this.x=e||0,this.y=t||0)}clone(){return new o(this)}getArray(){return[this.x,this.y]}get xy(){return[this.x,this.y]}set xy(e){const n=t(e);this.x=n.x,this.y=n.y}add(e){const n=t(e);return this.x+=n.x,this.y+=n.y,new o(this)}subtract(e){const n=t(e);return this.x-=n.x,this.y-=n.y,new o(this)}mul(e){const n=t(e);return this.x*=n.x,this.y*=n.y,new o(this)}}class i{static Uint8ToFloat32(e,t=0,n=null){return new Float32Array(e.buffer,e.byteOffset+t,null!=n?Math.ceil(n/4):null)}static Uint16ToFloat32(e,t=0,n=null){return new Float32Array(e.buffer,e.byteOffset+2*t,null!=n?Math.ceil(n/2):null)}static Float32ToUint8(e,t=0,n=null){return new Uint8Array(e.buffer,e.byteOffset+4*t,null!=n?4*n:null)}static Float32ToUint16(e,t=0,n=null){return new Uint16Array(e.buffer,e.byteOffset+4*t,null!=n?2*n:null)}static subarray(e,t=0,n=null){return e.subarray(t,null!=n?t+n:null)}static resize(e,t){const n=new e.constructor(t);return n.set(e,0,Math.min(t,e.length)),n}static memcpy(e,t,n,r,o){if(o<100){const i=e.subarray(t),a=n.subarray(r);for(let e=0;e<o;e++)i[e]=a[e]}else{const i=o*n.BYTES_PER_ELEMENT,a=new Uint8Array(e.buffer,e.byteOffset+t*e.BYTES_PER_ELEMENT),s=new Uint8Array(n.buffer,n.byteOffset+r*n.BYTES_PER_ELEMENT,i);a.set(s)}}}function a(e,t){var n=e.__state.conversionName.toString(),r=Math.round(e.r),o=Math.round(e.g),i=Math.round(e.b),a=e.a,s=Math.round(e.h),l=e.s.toFixed(1),u=e.v.toFixed(1);if(t||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var c=e.hex.toString(16);c.length<6;)c="0"+c;return"#"+c}return"CSS_RGB"===n?"rgb("+r+","+o+","+i+")":"CSS_RGBA"===n?"rgba("+r+","+o+","+i+","+a+")":"HEX"===n?"0x"+e.hex.toString(16):"RGB_ARRAY"===n?"["+r+","+o+","+i+"]":"RGBA_ARRAY"===n?"["+r+","+o+","+i+","+a+"]":"RGB_OBJ"===n?"{r:"+r+",g:"+o+",b:"+i+"}":"RGBA_OBJ"===n?"{r:"+r+",g:"+o+",b:"+i+",a:"+a+"}":"HSV_OBJ"===n?"{h:"+s+",s:"+l+",v:"+u+"}":"HSVA_OBJ"===n?"{h:"+s+",s:"+l+",v:"+u+",a:"+a+"}":"unknown format"}var s=Array.prototype.forEach,l=Array.prototype.slice,u={BREAK:{},extend:function(e){return this.each(l.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(t[n])||(e[n]=t[n])}.bind(this))}),this),e},defaults:function(e){return this.each(l.call(arguments,1),(function(t){(this.isObject(t)?Object.keys(t):[]).forEach(function(n){this.isUndefined(e[n])&&(e[n]=t[n])}.bind(this))}),this),e},compose:function(){var e=l.call(arguments);return function(){for(var t=l.call(arguments),n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},each:function(e,t,n){if(e)if(s&&e.forEach&&e.forEach===s)e.forEach(t,n);else if(e.length===e.length+0){var r,o=void 0;for(o=0,r=e.length;o<r;o++)if(o in e&&t.call(n,e[o],o)===this.BREAK)return}else for(var i in e)if(t.call(n,e[i],i)===this.BREAK)return},defer:function(e){setTimeout(e,0)},debounce:function(e,t,n){var r=void 0;return function(){var o=this,i=arguments;function a(){r=null,n||e.apply(o,i)}var s=n||!r;clearTimeout(r),r=setTimeout(a,t),s&&e.apply(o,i)}},toArray:function(e){return e.toArray?e.toArray():l.call(e)},isUndefined:function(e){return void 0===e},isNull:function(e){return null===e},isNaN:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return isNaN(e)})),isArray:Array.isArray||function(e){return e.constructor===Array},isObject:function(e){return e===Object(e)},isNumber:function(e){return e===e+0},isString:function(e){return e===e+""},isBoolean:function(e){return!1===e||!0===e},isFunction:function(e){return e instanceof Function}},c=[{litmus:u.isString,conversions:{THREE_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString()+t[1].toString()+t[2].toString()+t[2].toString()+t[3].toString()+t[3].toString(),0)}},write:a},SIX_CHAR_HEX:{read:function(e){var t=e.match(/^#([A-F0-9]{6})$/i);return null!==t&&{space:"HEX",hex:parseInt("0x"+t[1].toString(),0)}},write:a},CSS_RGB:{read:function(e){var t=e.match(/^rgb\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3])}},write:a},CSS_RGBA:{read:function(e){var t=e.match(/^rgba\(\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*,\s*(.+)\s*\)/);return null!==t&&{space:"RGB",r:parseFloat(t[1]),g:parseFloat(t[2]),b:parseFloat(t[3]),a:parseFloat(t[4])}},write:a}}},{litmus:u.isNumber,conversions:{HEX:{read:function(e){return{space:"HEX",hex:e,conversionName:"HEX"}},write:function(e){return e.hex}}}},{litmus:u.isArray,conversions:{RGB_ARRAY:{read:function(e){return 3===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2]}},write:function(e){return[e.r,e.g,e.b]}},RGBA_ARRAY:{read:function(e){return 4===e.length&&{space:"RGB",r:e[0],g:e[1],b:e[2],a:e[3]}},write:function(e){return[e.r,e.g,e.b,e.a]}}}},{litmus:u.isObject,conversions:{RGBA_OBJ:{read:function(e){return!!(u.isNumber(e.r)&&u.isNumber(e.g)&&u.isNumber(e.b)&&u.isNumber(e.a))&&{space:"RGB",r:e.r,g:e.g,b:e.b,a:e.a}},write:function(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}},RGB_OBJ:{read:function(e){return!!(u.isNumber(e.r)&&u.isNumber(e.g)&&u.isNumber(e.b))&&{space:"RGB",r:e.r,g:e.g,b:e.b}},write:function(e){return{r:e.r,g:e.g,b:e.b}}},HSVA_OBJ:{read:function(e){return!!(u.isNumber(e.h)&&u.isNumber(e.s)&&u.isNumber(e.v)&&u.isNumber(e.a))&&{space:"HSV",h:e.h,s:e.s,v:e.v,a:e.a}},write:function(e){return{h:e.h,s:e.s,v:e.v,a:e.a}}},HSV_OBJ:{read:function(e){return!!(u.isNumber(e.h)&&u.isNumber(e.s)&&u.isNumber(e.v))&&{space:"HSV",h:e.h,s:e.s,v:e.v}},write:function(e){return{h:e.h,s:e.s,v:e.v}}}}}],d=void 0,f=void 0,h=function(){f=!1;var e=arguments.length>1?u.toArray(arguments):arguments[0];return u.each(c,(function(t){if(t.litmus(e))return u.each(t.conversions,(function(t,n){if(d=t.read(e),!1===f&&!1!==d)return f=d,d.conversionName=n,d.conversion=t,u.BREAK})),u.BREAK})),f},p=void 0,m={hsv_to_rgb:function(e,t,n){var r=Math.floor(e/60)%6,o=e/60-Math.floor(e/60),i=n*(1-t),a=n*(1-o*t),s=n*(1-(1-o)*t),l=[[n,s,i],[a,n,i],[i,n,s],[i,a,n],[s,i,n],[n,i,a]][r];return{r:255*l[0],g:255*l[1],b:255*l[2]}},rgb_to_hsv:function(e,t,n){var r=Math.min(e,t,n),o=Math.max(e,t,n),i=o-r,a=void 0;return 0===o?{h:NaN,s:0,v:0}:(a=e===o?(t-n)/i:t===o?2+(n-e)/i:4+(e-t)/i,(a/=6)<0&&(a+=1),{h:360*a,s:i/o,v:o/255})},rgb_to_hex:function(e,t,n){var r=this.hex_with_component(0,2,e);return r=this.hex_with_component(r,1,t),this.hex_with_component(r,0,n)},component_from_hex:function(e,t){return e>>8*t&255},hex_with_component:function(e,t,n){return n<<(p=8*t)|e&~(255<<p)}},_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},b=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),y=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;return void 0!==a?a.call(r):void 0},v=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},x=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},w=function(){function e(){if(g(this,e),this.__state=h.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return b(e,[{key:"toString",value:function(){return a(this)}},{key:"toHexString",value:function(){return a(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),e}();function E(e,t,n){Object.defineProperty(e,t,{get:function(){return"RGB"===this.__state.space||w.recalculateRGB(this,t,n),this.__state[t]},set:function(e){"RGB"!==this.__state.space&&(w.recalculateRGB(this,t,n),this.__state.space="RGB"),this.__state[t]=e}})}function A(e,t){Object.defineProperty(e,t,{get:function(){return"HSV"===this.__state.space||w.recalculateHSV(this),this.__state[t]},set:function(e){"HSV"!==this.__state.space&&(w.recalculateHSV(this),this.__state.space="HSV"),this.__state[t]=e}})}w.recalculateRGB=function(e,t,n){if("HEX"===e.__state.space)e.__state[t]=m.component_from_hex(e.__state.hex,n);else{if("HSV"!==e.__state.space)throw new Error("Corrupted color state");u.extend(e.__state,m.hsv_to_rgb(e.__state.h,e.__state.s,e.__state.v))}},w.recalculateHSV=function(e){var t=m.rgb_to_hsv(e.r,e.g,e.b);u.extend(e.__state,{s:t.s,v:t.v}),u.isNaN(t.h)?u.isUndefined(e.__state.h)&&(e.__state.h=0):e.__state.h=t.h},w.COMPONENTS=["r","g","b","h","s","v","hex","a"],E(w.prototype,"r",2),E(w.prototype,"g",1),E(w.prototype,"b",0),A(w.prototype,"h"),A(w.prototype,"s"),A(w.prototype,"v"),Object.defineProperty(w.prototype,"a",{get:function(){return this.__state.a},set:function(e){this.__state.a=e}}),Object.defineProperty(w.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=m.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(e){this.__state.space="HEX",this.__state.hex=e}});var S=function(){function e(t,n){g(this,e),this.initialValue=t[n],this.domElement=document.createElement("div"),this.object=t,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return b(e,[{key:"onChange",value:function(e){return this.__onChange=e,this}},{key:"onFinishChange",value:function(e){return this.__onFinishChange=e,this}},{key:"setValue",value:function(e){return this.object[this.property]=e,this.__onChange&&this.__onChange.call(this,e),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),e}(),C={};u.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(e,t){u.each(e,(function(e){C[e]=t}))}));var O=/(\d+(\.\d+)?)px/;function T(e){if("0"===e||u.isUndefined(e))return 0;var t=e.match(O);return u.isNull(t)?0:parseFloat(t[1])}var F={makeSelectable:function(e,t){void 0!==e&&void 0!==e.style&&(e.onselectstart=t?function(){return!1}:function(){},e.style.MozUserSelect=t?"auto":"none",e.style.KhtmlUserSelect=t?"auto":"none",e.unselectable=t?"on":"off")},makeFullscreen:function(e,t,n){var r=n,o=t;u.isUndefined(o)&&(o=!0),u.isUndefined(r)&&(r=!0),e.style.position="absolute",o&&(e.style.left=0,e.style.right=0),r&&(e.style.top=0,e.style.bottom=0)},fakeEvent:function(e,t,n,r){var o=n||{},i=C[t];if(!i)throw new Error("Event type "+t+" not supported.");var a=document.createEvent(i);switch(i){case"MouseEvents":var s=o.x||o.clientX||0,l=o.y||o.clientY||0;a.initMouseEvent(t,o.bubbles||!1,o.cancelable||!0,window,o.clickCount||1,0,0,s,l,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var c=a.initKeyboardEvent||a.initKeyEvent;u.defaults(o,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),c(t,o.bubbles||!1,o.cancelable,window,o.ctrlKey,o.altKey,o.shiftKey,o.metaKey,o.keyCode,o.charCode);break;default:a.initEvent(t,o.bubbles||!1,o.cancelable||!0)}u.defaults(a,r),e.dispatchEvent(a)},bind:function(e,t,n,r){var o=r||!1;return e.addEventListener?e.addEventListener(t,n,o):e.attachEvent&&e.attachEvent("on"+t,n),F},unbind:function(e,t,n,r){var o=r||!1;return e.removeEventListener?e.removeEventListener(t,n,o):e.detachEvent&&e.detachEvent("on"+t,n),F},addClass:function(e,t){if(void 0===e.className)e.className=t;else if(e.className!==t){var n=e.className.split(/ +/);-1===n.indexOf(t)&&(n.push(t),e.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return F},removeClass:function(e,t){if(t)if(e.className===t)e.removeAttribute("class");else{var n=e.className.split(/ +/),r=n.indexOf(t);-1!==r&&(n.splice(r,1),e.className=n.join(" "))}else e.className=void 0;return F},hasClass:function(e,t){return new RegExp("(?:^|\\s+)"+t+"(?:\\s+|$)").test(e.className)||!1},getWidth:function(e){var t=getComputedStyle(e);return T(t["border-left-width"])+T(t["border-right-width"])+T(t["padding-left"])+T(t["padding-right"])+T(t.width)},getHeight:function(e){var t=getComputedStyle(e);return T(t["border-top-width"])+T(t["border-bottom-width"])+T(t["padding-top"])+T(t["padding-bottom"])+T(t.height)},getOffset:function(e){var t=e,n={left:0,top:0};if(t.offsetParent)do{n.left+=t.offsetLeft,n.top+=t.offsetTop,t=t.offsetParent}while(t);return n},isActive:function(e){return e===document.activeElement&&(e.type||e.href)}},P=function(e){function t(e,n){g(this,t);var r=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=r;return r.__prev=r.getValue(),r.__checkbox=document.createElement("input"),r.__checkbox.setAttribute("type","checkbox"),F.bind(r.__checkbox,"change",(function(){o.setValue(!o.__prev)}),!1),r.domElement.appendChild(r.__checkbox),r.updateDisplay(),r}return v(t,e),b(t,[{key:"setValue",value:function(e){var n=y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(S),I=function(e){function t(e,n,r){g(this,t);var o=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=r,a=o;if(o.__select=document.createElement("select"),u.isArray(i)){var s={};u.each(i,(function(e){s[e]=e})),i=s}return u.each(i,(function(e,t){var n=document.createElement("option");n.innerHTML=t,n.setAttribute("value",e),a.__select.appendChild(n)})),o.updateDisplay(),F.bind(o.__select,"change",(function(){var e=this.options[this.selectedIndex].value;a.setValue(e)})),o.domElement.appendChild(o.__select),o}return v(t,e),b(t,[{key:"setValue",value:function(e){var n=y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,e);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return F.isActive(this.__select)?this:(this.__select.value=this.getValue(),y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this))}}]),t}(S),M=function(e){function t(e,n){g(this,t);var r=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),o=r;function i(){o.setValue(o.__input.value)}return r.__input=document.createElement("input"),r.__input.setAttribute("type","text"),F.bind(r.__input,"keyup",i),F.bind(r.__input,"change",i),F.bind(r.__input,"blur",(function(){o.__onFinishChange&&o.__onFinishChange.call(o,o.getValue())})),F.bind(r.__input,"keydown",(function(e){13===e.keyCode&&this.blur()})),r.updateDisplay(),r.domElement.appendChild(r.__input),r}return v(t,e),b(t,[{key:"updateDisplay",value:function(){return F.isActive(this.__input)||(this.__input.value=this.getValue()),y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(S);function R(e){var t=e.toString();return t.indexOf(".")>-1?t.length-t.indexOf(".")-1:0}var k=function(e){function t(e,n,r){g(this,t);var o=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=r||{};return o.__min=i.min,o.__max=i.max,o.__step=i.step,u.isUndefined(o.__step)?0===o.initialValue?o.__impliedStep=1:o.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(o.initialValue))/Math.LN10))/10:o.__impliedStep=o.__step,o.__precision=R(o.__impliedStep),o}return v(t,e),b(t,[{key:"setValue",value:function(e){var n=e;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(e){return this.__min=e,this}},{key:"max",value:function(e){return this.__max=e,this}},{key:"step",value:function(e){return this.__step=e,this.__impliedStep=e,this.__precision=R(e),this}}]),t}(S),B=function(e){function t(e,n,r){g(this,t);var o=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,r));o.__truncationSuspended=!1;var i=o,a=void 0;function s(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())}function l(e){var t=a-e.clientY;i.setValue(i.getValue()+t*i.__impliedStep),a=e.clientY}function c(){F.unbind(window,"mousemove",l),F.unbind(window,"mouseup",c),s()}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),F.bind(o.__input,"change",(function(){var e=parseFloat(i.__input.value);u.isNaN(e)||i.setValue(e)})),F.bind(o.__input,"blur",(function(){s()})),F.bind(o.__input,"mousedown",(function(e){F.bind(window,"mousemove",l),F.bind(window,"mouseup",c),a=e.clientY})),F.bind(o.__input,"keydown",(function(e){13===e.keyCode&&(i.__truncationSuspended=!0,this.blur(),i.__truncationSuspended=!1,s())})),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return v(t,e),b(t,[{key:"updateDisplay",value:function(){var e,n,r;return this.__input.value=this.__truncationSuspended?this.getValue():(e=this.getValue(),n=this.__precision,r=Math.pow(10,n),Math.round(e*r)/r),y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(k);function N(e,t,n,r,o){return r+(e-t)/(n-t)*(o-r)}var L=function(e){function t(e,n,r,o,i){g(this,t);var a=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,{min:r,max:o,step:i})),s=a;function l(e){e.preventDefault();var t=s.__background.getBoundingClientRect();return s.setValue(N(e.clientX,t.left,t.right,s.__min,s.__max)),!1}function u(){F.unbind(window,"mousemove",l),F.unbind(window,"mouseup",u),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}function c(e){var t=e.touches[0].clientX,n=s.__background.getBoundingClientRect();s.setValue(N(t,n.left,n.right,s.__min,s.__max))}function d(){F.unbind(window,"touchmove",c),F.unbind(window,"touchend",d),s.__onFinishChange&&s.__onFinishChange.call(s,s.getValue())}return a.__background=document.createElement("div"),a.__foreground=document.createElement("div"),F.bind(a.__background,"mousedown",(function(e){document.activeElement.blur(),F.bind(window,"mousemove",l),F.bind(window,"mouseup",u),l(e)})),F.bind(a.__background,"touchstart",(function(e){1===e.touches.length&&(F.bind(window,"touchmove",c),F.bind(window,"touchend",d),c(e))})),F.addClass(a.__background,"slider"),F.addClass(a.__foreground,"slider-fg"),a.updateDisplay(),a.__background.appendChild(a.__foreground),a.domElement.appendChild(a.__background),a}return v(t,e),b(t,[{key:"updateDisplay",value:function(){var e=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*e+"%",y(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateDisplay",this).call(this)}}]),t}(k),D=function(e){function t(e,n,r){g(this,t);var o=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n)),i=o;return o.__button=document.createElement("div"),o.__button.innerHTML=void 0===r?"Fire":r,F.bind(o.__button,"click",(function(e){return e.preventDefault(),i.fire(),!1})),F.addClass(o.__button,"button"),o.domElement.appendChild(o.__button),o}return v(t,e),b(t,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),t}(S),U=function(e){function t(e,n){g(this,t);var r=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));r.__color=new w(r.getValue()),r.__temp=new w(0);var o=r;r.domElement=document.createElement("div"),F.makeSelectable(r.domElement,!1),r.__selector=document.createElement("div"),r.__selector.className="selector",r.__saturation_field=document.createElement("div"),r.__saturation_field.className="saturation-field",r.__field_knob=document.createElement("div"),r.__field_knob.className="field-knob",r.__field_knob_border="2px solid ",r.__hue_knob=document.createElement("div"),r.__hue_knob.className="hue-knob",r.__hue_field=document.createElement("div"),r.__hue_field.className="hue-field",r.__input=document.createElement("input"),r.__input.type="text",r.__input_textShadow="0 1px 1px ",F.bind(r.__input,"keydown",(function(e){13===e.keyCode&&f.call(this)})),F.bind(r.__input,"blur",f),F.bind(r.__selector,"mousedown",(function(){F.addClass(this,"drag").bind(window,"mouseup",(function(){F.removeClass(o.__selector,"drag")}))})),F.bind(r.__selector,"touchstart",(function(){F.addClass(this,"drag").bind(window,"touchend",(function(){F.removeClass(o.__selector,"drag")}))}));var i,a=document.createElement("div");function s(e){m(e),F.bind(window,"mousemove",m),F.bind(window,"touchmove",m),F.bind(window,"mouseup",c),F.bind(window,"touchend",c)}function l(e){_(e),F.bind(window,"mousemove",_),F.bind(window,"touchmove",_),F.bind(window,"mouseup",d),F.bind(window,"touchend",d)}function c(){F.unbind(window,"mousemove",m),F.unbind(window,"touchmove",m),F.unbind(window,"mouseup",c),F.unbind(window,"touchend",c),p()}function d(){F.unbind(window,"mousemove",_),F.unbind(window,"touchmove",_),F.unbind(window,"mouseup",d),F.unbind(window,"touchend",d),p()}function f(){var e=h(this.value);!1!==e?(o.__color.__state=e,o.setValue(o.__color.toOriginal())):this.value=o.__color.toString()}function p(){o.__onFinishChange&&o.__onFinishChange.call(o,o.__color.toOriginal())}function m(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__saturation_field.getBoundingClientRect(),n=e.touches&&e.touches[0]||e,r=n.clientX,i=n.clientY,a=(r-t.left)/(t.right-t.left),s=1-(i-t.top)/(t.bottom-t.top);return s>1?s=1:s<0&&(s=0),a>1?a=1:a<0&&(a=0),o.__color.v=s,o.__color.s=a,o.setValue(o.__color.toOriginal()),!1}function _(e){-1===e.type.indexOf("touch")&&e.preventDefault();var t=o.__hue_field.getBoundingClientRect(),n=1-((e.touches&&e.touches[0]||e).clientY-t.top)/(t.bottom-t.top);return n>1?n=1:n<0&&(n=0),o.__color.h=360*n,o.setValue(o.__color.toOriginal()),!1}return u.extend(r.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),u.extend(r.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:r.__field_knob_border+(r.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),u.extend(r.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),u.extend(r.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),u.extend(a.style,{width:"100%",height:"100%",background:"none"}),z(a,"top","rgba(0,0,0,0)","#000"),u.extend(r.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(i=r.__hue_field).style.background="",i.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",i.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",i.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",i.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",i.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",u.extend(r.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:r.__input_textShadow+"rgba(0,0,0,0.7)"}),F.bind(r.__saturation_field,"mousedown",s),F.bind(r.__saturation_field,"touchstart",s),F.bind(r.__field_knob,"mousedown",s),F.bind(r.__field_knob,"touchstart",s),F.bind(r.__hue_field,"mousedown",l),F.bind(r.__hue_field,"touchstart",l),r.__saturation_field.appendChild(a),r.__selector.appendChild(r.__field_knob),r.__selector.appendChild(r.__saturation_field),r.__selector.appendChild(r.__hue_field),r.__hue_field.appendChild(r.__hue_knob),r.domElement.appendChild(r.__input),r.domElement.appendChild(r.__selector),r.updateDisplay(),r}return v(t,e),b(t,[{key:"updateDisplay",value:function(){var e=h(this.getValue());if(!1!==e){var t=!1;u.each(w.COMPONENTS,(function(n){if(!u.isUndefined(e[n])&&!u.isUndefined(this.__color.__state[n])&&e[n]!==this.__color.__state[n])return t=!0,{}}),this),t&&u.extend(this.__color.__state,e)}u.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,r=255-n;u.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,z(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),u.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+r+","+r+","+r+",.7)"})}}]),t}(S),V=["-moz-","-o-","-webkit-","-ms-",""];function z(e,t,n,r){e.style.background="",u.each(V,(function(o){e.style.cssText+="background: "+o+"linear-gradient("+t+", "+n+" 0%, "+r+" 100%); "}))}var j='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',H=function(e,t){var n=e[t];return u.isArray(arguments[2])||u.isObject(arguments[2])?new I(e,t,arguments[2]):u.isNumber(n)?u.isNumber(arguments[2])&&u.isNumber(arguments[3])?u.isNumber(arguments[4])?new L(e,t,arguments[2],arguments[3],arguments[4]):new L(e,t,arguments[2],arguments[3]):u.isNumber(arguments[4])?new B(e,t,{min:arguments[2],max:arguments[3],step:arguments[4]}):new B(e,t,{min:arguments[2],max:arguments[3]}):u.isString(n)?new M(e,t):u.isFunction(n)?new D(e,t,""):u.isBoolean(n)?new P(e,t):null},W=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},G=function(){function e(){g(this,e),this.backgroundElement=document.createElement("div"),u.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),F.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),u.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var t=this;F.bind(this.backgroundElement,"click",(function(){t.hide()}))}return b(e,[{key:"show",value:function(){var e=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),u.defer((function(){e.backgroundElement.style.opacity=1,e.domElement.style.opacity=1,e.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var e=this,t=function t(){e.domElement.style.display="none",e.backgroundElement.style.display="none",F.unbind(e.domElement,"webkitTransitionEnd",t),F.unbind(e.domElement,"transitionend",t),F.unbind(e.domElement,"oTransitionEnd",t)};F.bind(this.domElement,"webkitTransitionEnd",t),F.bind(this.domElement,"transitionend",t),F.bind(this.domElement,"oTransitionEnd",t),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-F.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-F.getHeight(this.domElement)/2+"px"}}]),e}();!function(e,t){var n=t||document,r=document.createElement("style");r.type="text/css",r.innerHTML=e;var o=n.getElementsByTagName("head")[0];try{o.appendChild(r)}catch(e){}}(function(e){if("undefined"!=typeof window){var t=document.createElement("style");return t.setAttribute("type","text/css"),t.innerHTML=e,document.head.appendChild(t),e}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var X="Default",Y=function(){try{return!!window.localStorage}catch(e){return!1}}(),$=void 0,Q=!0,q=void 0,K=!1,J=[],Z=function e(t){var n=this,r=t||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),F.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],r=u.defaults(r,{closeOnTop:!1,autoPlace:!0,width:e.DEFAULT_WIDTH}),r=u.defaults(r,{resizable:r.autoPlace,hideable:r.autoPlace}),u.isUndefined(r.load)?r.load={preset:X}:r.preset&&(r.load.preset=r.preset),u.isUndefined(r.parent)&&r.hideable&&J.push(this),r.resizable=u.isUndefined(r.parent)&&r.resizable,r.autoPlace&&u.isUndefined(r.scrollable)&&(r.scrollable=!0);var o,i=Y&&"true"===localStorage.getItem(ie(0,"isLocal")),a=void 0,s=void 0;if(Object.defineProperties(this,{parent:{get:function(){return r.parent}},scrollable:{get:function(){return r.scrollable}},autoPlace:{get:function(){return r.autoPlace}},closeOnTop:{get:function(){return r.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:r.load.preset},set:function(e){n.parent?n.getRoot().preset=e:r.load.preset=e,function(e){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].value===e.preset&&(e.__preset_select.selectedIndex=t)}(this),n.revert()}},width:{get:function(){return r.width},set:function(e){r.width=e,ce(n,e)}},name:{get:function(){return r.name},set:function(e){r.name=e,s&&(s.innerHTML=r.name)}},closed:{get:function(){return r.closed},set:function(t){r.closed=t,r.closed?F.addClass(n.__ul,e.CLASS_CLOSED):F.removeClass(n.__ul,e.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=t?e.TEXT_OPEN:e.TEXT_CLOSED)}},load:{get:function(){return r.load}},useLocalStorage:{get:function(){return i},set:function(e){Y&&(i=e,e?F.bind(window,"unload",a):F.unbind(window,"unload",a),localStorage.setItem(ie(0,"isLocal"),e))}}}),u.isUndefined(r.parent)){if(this.closed=r.closed||!1,F.addClass(this.domElement,e.CLASS_MAIN),F.makeSelectable(this.domElement,!1),Y&&i){n.useLocalStorage=!0;var l=localStorage.getItem(ie(0,"gui"));l&&(r.load=JSON.parse(l))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=e.TEXT_CLOSED,F.addClass(this.__closeButton,e.CLASS_CLOSE_BUTTON),r.closeOnTop?(F.addClass(this.__closeButton,e.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(F.addClass(this.__closeButton,e.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),F.bind(this.__closeButton,"click",(function(){n.closed=!n.closed}))}else{void 0===r.closed&&(r.closed=!0);var c=document.createTextNode(r.name);F.addClass(c,"controller-name"),s=ee(n,c),F.addClass(this.__ul,e.CLASS_CLOSED),F.addClass(s,"title"),F.bind(s,"click",(function(e){return e.preventDefault(),n.closed=!n.closed,!1})),r.closed||(this.closed=!1)}r.autoPlace&&(u.isUndefined(r.parent)&&(Q&&(q=document.createElement("div"),F.addClass(q,"dg"),F.addClass(q,e.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(q),Q=!1),q.appendChild(this.domElement),F.addClass(this.domElement,e.CLASS_AUTO_PLACE)),this.parent||ce(n,r.width)),this.__resizeHandler=function(){n.onResizeDebounced()},F.bind(window,"resize",this.__resizeHandler),F.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),F.bind(this.__ul,"transitionend",this.__resizeHandler),F.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),r.resizable&&ue(this),a=function(){Y&&"true"===localStorage.getItem(ie(0,"isLocal"))&&localStorage.setItem(ie(0,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=a,r.parent||((o=n.getRoot()).width+=1,u.defer((function(){o.width-=1})))};function ee(e,t,n){var r=document.createElement("li");return t&&r.appendChild(t),n?e.__ul.insertBefore(r,n):e.__ul.appendChild(r),e.onResize(),r}function te(e){F.unbind(window,"resize",e.__resizeHandler),e.saveToLocalStorageIfPossible&&F.unbind(window,"unload",e.saveToLocalStorageIfPossible)}function ne(e,t){var n=e.__preset_select[e.__preset_select.selectedIndex];n.innerHTML=t?n.value+"*":n.value}function re(e,t){var n=e.getRoot(),r=n.__rememberedObjects.indexOf(t.object);if(-1!==r){var o=n.__rememberedObjectIndecesToControllers[r];if(void 0===o&&(o={},n.__rememberedObjectIndecesToControllers[r]=o),o[t.property]=t,n.load&&n.load.remembered){var i=n.load.remembered,a=void 0;if(i[e.preset])a=i[e.preset];else{if(!i.Default)return;a=i.Default}if(a[r]&&void 0!==a[r][t.property]){var s=a[r][t.property];t.initialValue=s,t.setValue(s)}}}}function oe(e,t,n,r){if(void 0===t[n])throw new Error('Object "'+t+'" has no property "'+n+'"');var o=void 0;if(r.color)o=new U(t,n);else{var i=[t,n].concat(r.factoryArgs);o=H.apply(e,i)}r.before instanceof S&&(r.before=r.before.__li),re(e,o),F.addClass(o.domElement,"c");var a=document.createElement("span");F.addClass(a,"property-name"),a.innerHTML=o.property;var s=document.createElement("div");s.appendChild(a),s.appendChild(o.domElement);var l=ee(e,s,r.before);return F.addClass(l,Z.CLASS_CONTROLLER_ROW),o instanceof U?F.addClass(l,"color"):F.addClass(l,_(o.getValue())),function(e,t,n){if(n.__li=t,n.__gui=e,u.extend(n,{options:function(t){if(arguments.length>1){var r=n.__li.nextElementSibling;return n.remove(),oe(e,n.object,n.property,{before:r,factoryArgs:[u.toArray(arguments)]})}if(u.isArray(t)||u.isObject(t)){var o=n.__li.nextElementSibling;return n.remove(),oe(e,n.object,n.property,{before:o,factoryArgs:[t]})}},name:function(e){return n.__li.firstElementChild.firstElementChild.innerHTML=e,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof L){var r=new B(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});u.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(e){var t=n[e],o=r[e];n[e]=r[e]=function(){var e=Array.prototype.slice.call(arguments);return o.apply(r,e),t.apply(n,e)}})),F.addClass(t,"has-slider"),n.domElement.insertBefore(r.domElement,n.domElement.firstElementChild)}else if(n instanceof B){var o=function(t){if(u.isNumber(n.__min)&&u.isNumber(n.__max)){var r=n.__li.firstElementChild.firstElementChild.innerHTML,o=n.__gui.__listening.indexOf(n)>-1;n.remove();var i=oe(e,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return i.name(r),o&&i.listen(),i}return t};n.min=u.compose(o,n.min),n.max=u.compose(o,n.max)}else n instanceof P?(F.bind(t,"click",(function(){F.fakeEvent(n.__checkbox,"click")})),F.bind(n.__checkbox,"click",(function(e){e.stopPropagation()}))):n instanceof D?(F.bind(t,"click",(function(){F.fakeEvent(n.__button,"click")})),F.bind(t,"mouseover",(function(){F.addClass(n.__button,"hover")})),F.bind(t,"mouseout",(function(){F.removeClass(n.__button,"hover")}))):n instanceof U&&(F.addClass(t,"color"),n.updateDisplay=u.compose((function(e){return t.style.borderLeftColor=n.__color.toString(),e}),n.updateDisplay),n.updateDisplay());n.setValue=u.compose((function(t){return e.getRoot().__preset_select&&n.isModified()&&ne(e.getRoot(),!0),t}),n.setValue)}(e,l,o),e.__controllers.push(o),o}function ie(e,t){return document.location.href+"."+t}function ae(e,t,n){var r=document.createElement("option");r.innerHTML=t,r.value=t,e.__preset_select.appendChild(r),n&&(e.__preset_select.selectedIndex=e.__preset_select.length-1)}function se(e,t){t.style.display=e.useLocalStorage?"block":"none"}function le(e){var t=e.__save_row=document.createElement("li");F.addClass(e.domElement,"has-save"),e.__ul.insertBefore(t,e.__ul.firstChild),F.addClass(t,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",F.addClass(n,"button gears");var r=document.createElement("span");r.innerHTML="Save",F.addClass(r,"button"),F.addClass(r,"save");var o=document.createElement("span");o.innerHTML="New",F.addClass(o,"button"),F.addClass(o,"save-as");var i=document.createElement("span");i.innerHTML="Revert",F.addClass(i,"button"),F.addClass(i,"revert");var a=e.__preset_select=document.createElement("select");if(e.load&&e.load.remembered?u.each(e.load.remembered,(function(t,n){ae(e,n,n===e.preset)})):ae(e,X,!1),F.bind(a,"change",(function(){for(var t=0;t<e.__preset_select.length;t++)e.__preset_select[t].innerHTML=e.__preset_select[t].value;e.preset=this.value})),t.appendChild(a),t.appendChild(n),t.appendChild(r),t.appendChild(o),t.appendChild(i),Y){var s=document.getElementById("dg-local-explain"),l=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(ie(0,"isLocal"))&&l.setAttribute("checked","checked"),se(e,s),F.bind(l,"change",(function(){e.useLocalStorage=!e.useLocalStorage,se(e,s)}))}var c=document.getElementById("dg-new-constructor");F.bind(c,"keydown",(function(e){!e.metaKey||67!==e.which&&67!==e.keyCode||$.hide()})),F.bind(n,"click",(function(){c.innerHTML=JSON.stringify(e.getSaveObject(),void 0,2),$.show(),c.focus(),c.select()})),F.bind(r,"click",(function(){e.save()})),F.bind(o,"click",(function(){var t=prompt("Enter a new preset name.");t&&e.saveAs(t)})),F.bind(i,"click",(function(){e.revert()}))}function ue(e){var t=void 0;function n(n){return n.preventDefault(),e.width+=t-n.clientX,e.onResize(),t=n.clientX,!1}function r(){F.removeClass(e.__closeButton,Z.CLASS_DRAG),F.unbind(window,"mousemove",n),F.unbind(window,"mouseup",r)}function o(o){return o.preventDefault(),t=o.clientX,F.addClass(e.__closeButton,Z.CLASS_DRAG),F.bind(window,"mousemove",n),F.bind(window,"mouseup",r),!1}e.__resize_handle=document.createElement("div"),u.extend(e.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),F.bind(e.__resize_handle,"mousedown",o),F.bind(e.__closeButton,"mousedown",o),e.domElement.insertBefore(e.__resize_handle,e.domElement.firstElementChild)}function ce(e,t){e.domElement.style.width=t+"px",e.__save_row&&e.autoPlace&&(e.__save_row.style.width=t+"px"),e.__closeButton&&(e.__closeButton.style.width=t+"px")}function de(e,t){var n={};return u.each(e.__rememberedObjects,(function(r,o){var i={},a=e.__rememberedObjectIndecesToControllers[o];u.each(a,(function(e,n){i[n]=t?e.initialValue:e.getValue()})),n[o]=i})),n}function fe(e){0!==e.length&&W.call(window,(function(){fe(e)})),u.each(e,(function(e){e.updateDisplay()}))}Z.toggleHide=function(){K=!K,u.each(J,(function(e){e.domElement.style.display=K?"none":""}))},Z.CLASS_AUTO_PLACE="a",Z.CLASS_AUTO_PLACE_CONTAINER="ac",Z.CLASS_MAIN="main",Z.CLASS_CONTROLLER_ROW="cr",Z.CLASS_TOO_TALL="taller-than-window",Z.CLASS_CLOSED="closed",Z.CLASS_CLOSE_BUTTON="close-button",Z.CLASS_CLOSE_TOP="close-top",Z.CLASS_CLOSE_BOTTOM="close-bottom",Z.CLASS_DRAG="drag",Z.DEFAULT_WIDTH=245,Z.TEXT_CLOSED="Close Controls",Z.TEXT_OPEN="Open Controls",Z._keydownHandler=function(e){"text"===document.activeElement.type||72!==e.which&&72!==e.keyCode||Z.toggleHide()},F.bind(window,"keydown",Z._keydownHandler,!1),u.extend(Z.prototype,{add:function(e,t){return oe(this,e,t,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(e,t){return oe(this,e,t,{color:!0})},remove:function(e){this.__ul.removeChild(e.__li),this.__controllers.splice(this.__controllers.indexOf(e),1);var t=this;u.defer((function(){t.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&q.removeChild(this.domElement);var e=this;u.each(this.__folders,(function(t){e.removeFolder(t)})),F.unbind(window,"keydown",Z._keydownHandler,!1),te(this)},addFolder:function(e){if(void 0!==this.__folders[e])throw new Error('You already have a folder in this GUI by the name "'+e+'"');var t={name:e,parent:this};t.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[e]&&(t.closed=this.load.folders[e].closed,t.load=this.load.folders[e]);var n=new Z(t);this.__folders[e]=n;var r=ee(this,n.domElement);return F.addClass(r,"folder"),n},removeFolder:function(e){this.__ul.removeChild(e.domElement.parentElement),delete this.__folders[e.name],this.load&&this.load.folders&&this.load.folders[e.name]&&delete this.load.folders[e.name],te(e);var t=this;u.each(e.__folders,(function(t){e.removeFolder(t)})),u.defer((function(){t.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var e=this.getRoot();if(e.scrollable){var t=F.getOffset(e.__ul).top,n=0;u.each(e.__ul.childNodes,(function(t){e.autoPlace&&t===e.__save_row||(n+=F.getHeight(t))})),window.innerHeight-t-20<n?(F.addClass(e.domElement,Z.CLASS_TOO_TALL),e.__ul.style.height=window.innerHeight-t-20+"px"):(F.removeClass(e.domElement,Z.CLASS_TOO_TALL),e.__ul.style.height="auto")}e.__resize_handle&&u.defer((function(){e.__resize_handle.style.height=e.__ul.offsetHeight+"px"})),e.__closeButton&&(e.__closeButton.style.width=e.width+"px")},onResizeDebounced:u.debounce((function(){this.onResize()}),50),remember:function(){if(u.isUndefined($)&&(($=new G).domElement.innerHTML=j),this.parent)throw new Error("You can only call remember on a top level GUI.");var e=this;u.each(Array.prototype.slice.call(arguments),(function(t){0===e.__rememberedObjects.length&&le(e),-1===e.__rememberedObjects.indexOf(t)&&e.__rememberedObjects.push(t)})),this.autoPlace&&ce(this,this.width)},getRoot:function(){for(var e=this;e.parent;)e=e.parent;return e},getSaveObject:function(){var e=this.load;return e.closed=this.closed,this.__rememberedObjects.length>0&&(e.preset=this.preset,e.remembered||(e.remembered={}),e.remembered[this.preset]=de(this)),e.folders={},u.each(this.__folders,(function(t,n){e.folders[n]=t.getSaveObject()})),e},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=de(this),ne(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(e){this.load.remembered||(this.load.remembered={},this.load.remembered.Default=de(this,!0)),this.load.remembered[e]=de(this),this.preset=e,ae(this,e,!0),this.saveToLocalStorageIfPossible()},revert:function(e){u.each(this.__controllers,(function(t){this.getRoot().load.remembered?re(e||this.getRoot(),t):t.setValue(t.initialValue),t.__onFinishChange&&t.__onFinishChange.call(t,t.getValue())}),this),u.each(this.__folders,(function(e){e.revert(e)})),e||ne(this.getRoot(),!1)},listen:function(e){var t=0===this.__listening.length;this.__listening.push(e),t&&fe(this.__listening)},updateDisplay:function(){u.each(this.__controllers,(function(e){e.updateDisplay()})),u.each(this.__folders,(function(e){e.updateDisplay()}))}});let he=Float32Array;function pe(e,t,n){const r=new he(3);return e&&(r[0]=e),t&&(r[1]=t),n&&(r[2]=n),r}function me(e,t,n){return(n=n||new he(3))[0]=e[0]+t[0],n[1]=e[1]+t[1],n[2]=e[2]+t[2],n}function _e(e,t,n){n=n||new he(3);const r=e[2]*t[0]-e[0]*t[2],o=e[0]*t[1]-e[1]*t[0];return n[0]=e[1]*t[2]-e[2]*t[1],n[1]=r,n[2]=o,n}function ge(e,t){t=t||new he(3);const n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=Math.sqrt(n);return r>1e-5?(t[0]=e[0]/r,t[1]=e[1]/r,t[2]=e[2]/r):(t[0]=0,t[1]=0,t[2]=0),t}let be,ye,ve,xe=Float32Array;function we(e,t){return(t=t||new xe(16))[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Ee(e){return(e=e||new xe(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ae(e,t){t=t||new xe(16);const n=e[0],r=e[1],o=e[2],i=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],d=e[9],f=e[10],h=e[11],p=e[12],m=e[13],_=e[14],g=e[15],b=f*g,y=_*h,v=l*g,x=_*u,w=l*h,E=f*u,A=o*g,S=_*i,C=o*h,O=f*i,T=o*u,F=l*i,P=c*m,I=p*d,M=a*m,R=p*s,k=a*d,B=c*s,N=n*m,L=p*r,D=n*d,U=c*r,V=n*s,z=a*r,j=b*s+x*d+w*m-(y*s+v*d+E*m),H=y*r+A*d+O*m-(b*r+S*d+C*m),W=v*r+S*s+T*m-(x*r+A*s+F*m),G=E*r+C*s+F*d-(w*r+O*s+T*d),X=1/(n*j+a*H+c*W+p*G);return t[0]=X*j,t[1]=X*H,t[2]=X*W,t[3]=X*G,t[4]=X*(y*a+v*c+E*p-(b*a+x*c+w*p)),t[5]=X*(b*n+S*c+C*p-(y*n+A*c+O*p)),t[6]=X*(x*n+A*a+F*p-(v*n+S*a+T*p)),t[7]=X*(w*n+O*a+T*c-(E*n+C*a+F*c)),t[8]=X*(P*u+R*h+k*g-(I*u+M*h+B*g)),t[9]=X*(I*i+N*h+U*g-(P*i+L*h+D*g)),t[10]=X*(M*i+L*u+V*g-(R*i+N*u+z*g)),t[11]=X*(B*i+D*u+z*h-(k*i+U*u+V*h)),t[12]=X*(M*f+B*_+I*l-(k*_+P*l+R*f)),t[13]=X*(D*_+P*o+L*f-(N*f+U*_+I*o)),t[14]=X*(N*l+z*_+R*o-(V*_+M*o+L*l)),t[15]=X*(V*f+k*o+U*l-(D*l+z*f+B*o)),t}function Se(e,t,n){n=n||pe();const r=t[0],o=t[1],i=t[2],a=r*e[3]+o*e[7]+i*e[11]+e[15];return n[0]=(r*e[0]+o*e[4]+i*e[8]+e[12])/a,n[1]=(r*e[1]+o*e[5]+i*e[9]+e[13])/a,n[2]=(r*e[2]+o*e[6]+i*e[10]+e[14])/a,n}function Ce(e,t,n){n=n||pe();const r=t[0],o=t[1],i=t[2];return n[0]=r*e[0]+o*e[4]+i*e[8],n[1]=r*e[1]+o*e[5]+i*e[9],n[2]=r*e[2]+o*e[6]+i*e[10],n}var Oe=Object.freeze({__proto__:null,axisRotate:function(e,t,n,r){r=r||new xe(16);let o=t[0],i=t[1],a=t[2];const s=Math.sqrt(o*o+i*i+a*a);o/=s,i/=s,a/=s;const l=o*o,u=i*i,c=a*a,d=Math.cos(n),f=Math.sin(n),h=1-d,p=l+(1-l)*d,m=o*i*h+a*f,_=o*a*h-i*f,g=o*i*h-a*f,b=u+(1-u)*d,y=i*a*h+o*f,v=o*a*h+i*f,x=i*a*h-o*f,w=c+(1-c)*d,E=e[0],A=e[1],S=e[2],C=e[3],O=e[4],T=e[5],F=e[6],P=e[7],I=e[8],M=e[9],R=e[10],k=e[11];return r[0]=p*E+m*O+_*I,r[1]=p*A+m*T+_*M,r[2]=p*S+m*F+_*R,r[3]=p*C+m*P+_*k,r[4]=g*E+b*O+y*I,r[5]=g*A+b*T+y*M,r[6]=g*S+b*F+y*R,r[7]=g*C+b*P+y*k,r[8]=v*E+x*O+w*I,r[9]=v*A+x*T+w*M,r[10]=v*S+x*F+w*R,r[11]=v*C+x*P+w*k,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r},axisRotation:function(e,t,n){n=n||new xe(16);let r=e[0],o=e[1],i=e[2];const a=Math.sqrt(r*r+o*o+i*i);r/=a,o/=a,i/=a;const s=r*r,l=o*o,u=i*i,c=Math.cos(t),d=Math.sin(t),f=1-c;return n[0]=s+(1-s)*c,n[1]=r*o*f+i*d,n[2]=r*i*f-o*d,n[3]=0,n[4]=r*o*f-i*d,n[5]=l+(1-l)*c,n[6]=o*i*f+r*d,n[7]=0,n[8]=r*i*f+o*d,n[9]=o*i*f-r*d,n[10]=u+(1-u)*c,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,n},copy:we,frustum:function(e,t,n,r,o,i,a){const s=t-e,l=r-n,u=o-i;return(a=a||new xe(16))[0]=2*o/s,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*o/l,a[6]=0,a[7]=0,a[8]=(e+t)/s,a[9]=(r+n)/l,a[10]=i/u,a[11]=-1,a[12]=0,a[13]=0,a[14]=o*i/u,a[15]=0,a},getAxis:function(e,t,n){const r=4*t;return(n=n||pe())[0]=e[r+0],n[1]=e[r+1],n[2]=e[r+2],n},getTranslation:function(e,t){return(t=t||pe())[0]=e[12],t[1]=e[13],t[2]=e[14],t},identity:Ee,inverse:Ae,lookAt:function(e,t,n,r){return r=r||new xe(16),be=be||pe(),ye=ye||pe(),ve=ve||pe(),ge(function(e,t,n){return(n=n||new he(3))[0]=e[0]-t[0],n[1]=e[1]-t[1],n[2]=e[2]-t[2],n}(e,t,ve),ve),ge(_e(n,ve,be),be),ge(_e(ve,be,ye),ye),r[0]=be[0],r[1]=be[1],r[2]=be[2],r[3]=0,r[4]=ye[0],r[5]=ye[1],r[6]=ye[2],r[7]=0,r[8]=ve[0],r[9]=ve[1],r[10]=ve[2],r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r},multiply:function(e,t,n){n=n||new xe(16);const r=e[0],o=e[1],i=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],d=e[8],f=e[9],h=e[10],p=e[11],m=e[12],_=e[13],g=e[14],b=e[15],y=t[0],v=t[1],x=t[2],w=t[3],E=t[4],A=t[5],S=t[6],C=t[7],O=t[8],T=t[9],F=t[10],P=t[11],I=t[12],M=t[13],R=t[14],k=t[15];return n[0]=r*y+s*v+d*x+m*w,n[1]=o*y+l*v+f*x+_*w,n[2]=i*y+u*v+h*x+g*w,n[3]=a*y+c*v+p*x+b*w,n[4]=r*E+s*A+d*S+m*C,n[5]=o*E+l*A+f*S+_*C,n[6]=i*E+u*A+h*S+g*C,n[7]=a*E+c*A+p*S+b*C,n[8]=r*O+s*T+d*F+m*P,n[9]=o*O+l*T+f*F+_*P,n[10]=i*O+u*T+h*F+g*P,n[11]=a*O+c*T+p*F+b*P,n[12]=r*I+s*M+d*R+m*k,n[13]=o*I+l*M+f*R+_*k,n[14]=i*I+u*M+h*R+g*k,n[15]=a*I+c*M+p*R+b*k,n},negate:function(e,t){return(t=t||new xe(16))[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=-e[7],t[8]=-e[8],t[9]=-e[9],t[10]=-e[10],t[11]=-e[11],t[12]=-e[12],t[13]=-e[13],t[14]=-e[14],t[15]=-e[15],t},ortho:function(e,t,n,r,o,i,a){return(a=a||new xe(16))[0]=2/(t-e),a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2/(r-n),a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2/(o-i),a[11]=0,a[12]=(t+e)/(e-t),a[13]=(r+n)/(n-r),a[14]=(i+o)/(o-i),a[15]=1,a},perspective:function(e,t,n,r,o){o=o||new xe(16);const i=Math.tan(.5*Math.PI-.5*e),a=1/(n-r);return o[0]=i/t,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=(n+r)*a,o[11]=-1,o[12]=0,o[13]=0,o[14]=n*r*a*2,o[15]=0,o},rotateX:function(e,t,n){n=n||new xe(16);const r=e[4],o=e[5],i=e[6],a=e[7],s=e[8],l=e[9],u=e[10],c=e[11],d=Math.cos(t),f=Math.sin(t);return n[4]=d*r+f*s,n[5]=d*o+f*l,n[6]=d*i+f*u,n[7]=d*a+f*c,n[8]=d*s-f*r,n[9]=d*l-f*o,n[10]=d*u-f*i,n[11]=d*c-f*a,e!==n&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n},rotateY:function(e,t,n){n=n||new xe(16);const r=e[0],o=e[1],i=e[2],a=e[3],s=e[8],l=e[9],u=e[10],c=e[11],d=Math.cos(t),f=Math.sin(t);return n[0]=d*r-f*s,n[1]=d*o-f*l,n[2]=d*i-f*u,n[3]=d*a-f*c,n[8]=d*s+f*r,n[9]=d*l+f*o,n[10]=d*u+f*i,n[11]=d*c+f*a,e!==n&&(n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n},rotateZ:function(e,t,n){n=n||new xe(16);const r=e[0],o=e[1],i=e[2],a=e[3],s=e[4],l=e[5],u=e[6],c=e[7],d=Math.cos(t),f=Math.sin(t);return n[0]=d*r+f*s,n[1]=d*o+f*l,n[2]=d*i+f*u,n[3]=d*a+f*c,n[4]=d*s-f*r,n[5]=d*l-f*o,n[6]=d*u-f*i,n[7]=d*c-f*a,e!==n&&(n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n},rotationX:function(e,t){t=t||new xe(16);const n=Math.cos(e),r=Math.sin(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},rotationY:function(e,t){t=t||new xe(16);const n=Math.cos(e),r=Math.sin(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},rotationZ:function(e,t){t=t||new xe(16);const n=Math.cos(e),r=Math.sin(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},scale:function(e,t,n){n=n||new xe(16);const r=t[0],o=t[1],i=t[2];return n[0]=r*e[0],n[1]=r*e[1],n[2]=r*e[2],n[3]=r*e[3],n[4]=o*e[4],n[5]=o*e[5],n[6]=o*e[6],n[7]=o*e[7],n[8]=i*e[8],n[9]=i*e[9],n[10]=i*e[10],n[11]=i*e[11],e!==n&&(n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15]),n},scaling:function(e,t){return(t=t||new xe(16))[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},setAxis:function(e,t,n,r){r!==e&&(r=we(e,r));const o=4*n;return r[o+0]=t[0],r[o+1]=t[1],r[o+2]=t[2],r},setDefaultType:function(e){const t=xe;return xe=e,t},setTranslation:function(e,t,n){return e!==(n=n||Ee())&&(n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11]),n[12]=t[0],n[13]=t[1],n[14]=t[2],n[15]=1,n},transformDirection:Ce,transformNormal:function(e,t,n){n=n||pe();const r=Ae(e),o=t[0],i=t[1],a=t[2];return n[0]=o*r[0]+i*r[1]+a*r[2],n[1]=o*r[4]+i*r[5]+a*r[6],n[2]=o*r[8]+i*r[9]+a*r[10],n},transformPoint:Se,translate:function(e,t,n){n=n||new xe(16);const r=t[0],o=t[1],i=t[2],a=e[0],s=e[1],l=e[2],u=e[3],c=e[4],d=e[5],f=e[6],h=e[7],p=e[8],m=e[9],_=e[10],g=e[11],b=e[12],y=e[13],v=e[14],x=e[15];return e!==n&&(n[0]=a,n[1]=s,n[2]=l,n[3]=u,n[4]=c,n[5]=d,n[6]=f,n[7]=h,n[8]=p,n[9]=m,n[10]=_,n[11]=g),n[12]=a*r+c*o+p*i+b,n[13]=s*r+d*o+m*i+y,n[14]=l*r+f*o+_*i+v,n[15]=u*r+h*o+g*i+x,n},translation:function(e,t){return(t=t||new xe(16))[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},transpose:function(e,t){if((t=t||new xe(16))===e){let n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,t}const n=e[0],r=e[1],o=e[2],i=e[3],a=e[4],s=e[5],l=e[6],u=e[7],c=e[8],d=e[9],f=e[10],h=e[11],p=e[12],m=e[13],_=e[14],g=e[15];return t[0]=n,t[1]=a,t[2]=c,t[3]=p,t[4]=r,t[5]=s,t[6]=d,t[7]=m,t[8]=o,t[9]=l,t[10]=f,t[11]=_,t[12]=i,t[13]=u,t[14]=h,t[15]=g,t}});const Te=5120,Fe=5121,Pe=5124,Ie={};{const e=Ie;e[Te]=Int8Array,e[5121]=Uint8Array,e[5122]=Int16Array,e[5123]=Uint16Array,e[Pe]=Int32Array,e[5125]=Uint32Array,e[5126]=Float32Array,e[32819]=Uint16Array,e[32820]=Uint16Array,e[33635]=Uint16Array,e[5131]=Uint16Array,e[33640]=Uint32Array,e[35899]=Uint32Array,e[35902]=Uint32Array,e[36269]=Uint32Array,e[34042]=Uint32Array}function Me(e){if(e instanceof Int8Array)return Te;if(e instanceof Uint8Array)return Fe;if(e instanceof Uint8ClampedArray)return Fe;if(e instanceof Int16Array)return 5122;if(e instanceof Uint16Array)return 5123;if(e instanceof Int32Array)return Pe;if(e instanceof Uint32Array)return 5125;if(e instanceof Float32Array)return 5126;throw new Error("unsupported typed array type")}const Re="undefined"!=typeof SharedArrayBuffer?function(e){return e&&e.buffer&&(e.buffer instanceof ArrayBuffer||e.buffer instanceof SharedArrayBuffer)}:function(e){return e&&e.buffer&&e.buffer instanceof ArrayBuffer};function ke(e,t){Object.keys(t).forEach((function(n){t.hasOwnProperty(n)&&e.hasOwnProperty(n)&&(t[n]=e[n])}))}function Be(...e){console.error(...e)}function Ne(...e){console.warn(...e)}function Le(e,t){return"undefined"!=typeof WebGLTexture&&t instanceof WebGLTexture}const De=34962,Ue={attribPrefix:""};function Ve(e,t,n,r){if("undefined"!=typeof WebGLBuffer&&t instanceof WebGLBuffer)return t;n=n||De;const o=e.createBuffer();return function(e,t,n,r,o){e.bindBuffer(t,n),e.bufferData(t,r,o||35044)}(e,n,o,t,r),o}function ze(e){return"indices"===e}function je(e){return e.length?e:e.data}const He=/coord|texture/i,We=/color|colour/i;function Ge(e,t){let n;if(n=He.test(e)?2:We.test(e)?4:3,t%n>0)throw new Error(`Can not guess numComponents for attribute '${e}'. Tried ${n} but ${t} values is not evenly divisible by ${n}. You should specify it.`);return n}function Xe(e,t){return e.numComponents||e.size||Ge(t,je(e).length)}function Ye(e,t){if(Re(e))return e;if(Re(e.data))return e.data;Array.isArray(e)&&(e={data:e});let n=e.type;return n||(n=ze(t)?Uint16Array:Float32Array),new n(e.data)}function $e(e,t){const n={};return Object.keys(t).forEach((function(r){if(!ze(r)){const i=t[r],a=i.attrib||i.name||i.attribName||Ue.attribPrefix+r;if(i.value){if(!Array.isArray(i.value)&&!Re(i.value))throw new Error("array.value is not array or typedarray");n[a]={value:i.value}}else{let t,s,l,u;if(i.buffer&&i.buffer instanceof WebGLBuffer)t=i.buffer,u=i.numComponents||i.size,s=i.type,l=i.normalize;else if("number"==typeof i||"number"==typeof i.data){const n=i.data||i,a=i.type||Float32Array,c=n*a.BYTES_PER_ELEMENT;s=function(e){if(e===Int8Array)return Te;if(e===Uint8Array)return Fe;if(e===Uint8ClampedArray)return Fe;if(e===Int16Array)return 5122;if(e===Uint16Array)return 5123;if(e===Int32Array)return Pe;if(e===Uint32Array)return 5125;if(e===Float32Array)return 5126;throw new Error("unsupported typed array type")}(a),l=void 0!==i.normalize?i.normalize:(o=a)===Int8Array||o===Uint8Array,u=i.numComponents||i.size||Ge(r,n),t=e.createBuffer(),e.bindBuffer(De,t),e.bufferData(De,c,i.drawType||35044)}else{const n=Ye(i,r);t=Ve(e,n,void 0,i.drawType),s=Me(n),l=void 0!==i.normalize?i.normalize:function(e){return e instanceof Int8Array||e instanceof Uint8Array}(n),u=Xe(i,r)}n[a]={buffer:t,numComponents:u,type:s,normalize:l,stride:i.stride||0,offset:i.offset||0,divisor:void 0===i.divisor?void 0:i.divisor,drawType:i.drawType}}}var o})),e.bindBuffer(De,null),n}const Qe=["position","positions","a_position"];function qe(e,t,n){const r=$e(e,t),o=Object.assign({},n||{});o.attribs=Object.assign({},n?n.attribs:{},r);const i=t.indices;if(i){const t=Ye(i,"indices");o.indices=Ve(e,t,34963),o.numElements=t.length,o.elementType=Me(t)}else o.numElements||(o.numElements=function(e,t){let n,r;for(r=0;r<Qe.length&&(n=Qe[r],!(n in t))&&(n=Ue.attribPrefix+n,!(n in t));++r);r===Qe.length&&(n=Object.keys(t)[0]);const o=t[n];e.bindBuffer(De,o.buffer);const i=e.getBufferParameter(De,34660);var a;e.bindBuffer(De,null);const s=i/(5120===(a=o.type)||5121===a?1:5122===a||5123===a?2:5124===a||5125===a||5126===a?4:0),l=o.numComponents||o.size,u=s/l;if(u%1!=0)throw new Error(`numComponents ${l} not correct for length ${length}`);return u}(e,o.attribs));return o}function Ke(e,t){const n={};return Object.keys(t).forEach((function(r){n[r]=function(e,t,n){const r="indices"===n?34963:De;return Ve(e,Ye(t,n),r)}(e,t[r],r)})),t.indices?(n.numElements=t.indices.length,n.elementType=Me(Ye(t.indices))):n.numElements=function(e){let t,n;for(n=0;n<Qe.length&&(t=Qe[n],!(t in e));++n);n===Qe.length&&(t=Object.keys(e)[0]);const r=e[t],o=je(r).length,i=Xe(r,t),a=o/i;if(o%i>0)throw new Error(`numComponents ${i} not correct for length ${o}`);return a}(t),n}function Je(e,t,n){return function(e,t){let n=0;return e.push=function(){for(let t=0;t<arguments.length;++t){const r=arguments[t];if(r instanceof Array||Re(r))for(let t=0;t<r.length;++t)e[n++]=r[t];else e[n++]=r}},e.reset=function(e){n=e||0},e.numComponents=t,Object.defineProperty(e,"numElements",{get:function(){return this.length/this.numComponents|0}}),e}(new(n||Float32Array)(e*t),e)}function Ze(e,t,n){const r=e.length,o=new Float32Array(3);for(let i=0;i<r;i+=3)n(t,[e[i],e[i+1],e[i+2]],o),e[i]=o[0],e[i+1]=o[1],e[i+2]=o[2]}function et(e,t,n){n=n||pe();const r=t[0],o=t[1],i=t[2];return n[0]=r*e[0]+o*e[1]+i*e[2],n[1]=r*e[4]+o*e[5]+i*e[6],n[2]=r*e[8]+o*e[9]+i*e[10],n}function tt(e,t){return Object.keys(e).forEach((function(n){const r=e[n];n.indexOf("pos")>=0?function(e,t){Ze(e,t,Se)}(r,t):n.indexOf("tan")>=0||n.indexOf("binorm")>=0?function(e,t){Ze(e,t,Ce)}(r,t):n.indexOf("norm")>=0&&function(e,t){Ze(e,Ae(t),et)}(r,t)})),e}function nt(e,t,n){return e=e||2,{position:{numComponents:2,data:[(t=t||0)+-1*(e*=.5),(n=n||0)+-1*e,t+1*e,n+-1*e,t+-1*e,n+1*e,t+1*e,n+1*e]},normal:[0,0,1,0,0,1,0,0,1,0,0,1],texcoord:[0,0,1,0,0,1,1,1],indices:[0,1,2,2,1,3]}}function rt(e,t,n,r,o){e=e||1,t=t||1,n=n||1,r=r||1,o=o||Ee();const i=(n+1)*(r+1),a=Je(3,i),s=Je(3,i),l=Je(2,i);for(let o=0;o<=r;o++)for(let i=0;i<=n;i++){const u=i/n,c=o/r;a.push(e*u-.5*e,0,t*c-.5*t),s.push(0,1,0),l.push(u,c)}const u=n+1,c=Je(3,n*r*2,Uint16Array);for(let e=0;e<r;e++)for(let t=0;t<n;t++)c.push((e+0)*u+t,(e+1)*u+t,(e+0)*u+t+1),c.push((e+1)*u+t,(e+1)*u+t+1,(e+0)*u+t+1);return tt({position:a,normal:s,texcoord:l,indices:c},o)}function ot(e,t,n,r,o,i,a){if(t<=0||n<=0)throw new Error("subdivisionAxis and subdivisionHeight must be > 0");r=r||0,i=i||0;const s=(o=o||Math.PI)-r,l=(a=a||2*Math.PI)-i,u=(t+1)*(n+1),c=Je(3,u),d=Je(3,u),f=Je(2,u);for(let o=0;o<=n;o++)for(let a=0;a<=t;a++){const u=a/t,h=o/n,p=l*u+i,m=s*h+r,_=Math.sin(p),g=Math.cos(p),b=Math.sin(m),y=g*b,v=Math.cos(m),x=_*b;c.push(e*y,e*v,e*x),d.push(y,v,x),f.push(1-u,h)}const h=t+1,p=Je(3,t*n*2,Uint16Array);for(let e=0;e<t;e++)for(let t=0;t<n;t++)p.push((t+0)*h+e,(t+0)*h+e+1,(t+1)*h+e),p.push((t+1)*h+e,(t+0)*h+e+1,(t+1)*h+e+1);return{position:c,normal:d,texcoord:f,indices:p}}const it=[[3,7,5,1],[6,2,0,4],[6,7,3,2],[0,1,5,4],[7,6,4,5],[2,3,1,0]];function at(e){const t=(e=e||1)/2,n=[[-t,-t,-t],[+t,-t,-t],[-t,+t,-t],[+t,+t,-t],[-t,-t,+t],[+t,-t,+t],[-t,+t,+t],[+t,+t,+t]],r=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],o=[[1,0],[0,0],[0,1],[1,1]],i=Je(3,24),a=Je(3,24),s=Je(2,24),l=Je(3,12,Uint16Array);for(let e=0;e<6;++e){const t=it[e];for(let l=0;l<4;++l){const u=n[t[l]],c=r[e],d=o[l];i.push(u),a.push(c),s.push(d)}const u=4*e;l.push(u+0,u+1,u+2),l.push(u+0,u+2,u+3)}return{position:i,normal:a,texcoord:s,indices:l}}function st(e,t,n,r,o,i,a){if(r<3)throw new Error("radialSubdivisions must be 3 or greater");if(o<1)throw new Error("verticalSubdivisions must be 1 or greater");const s=void 0===i||i,l=void 0===a||a,u=(s?2:0)+(l?2:0),c=(r+1)*(o+1+u),d=Je(3,c),f=Je(3,c),h=Je(2,c),p=Je(3,r*(o+u/2)*2,Uint16Array),m=r+1,_=Math.atan2(e-t,n),g=Math.cos(_),b=Math.sin(_),y=o+(l?2:0);for(let i=s?-2:0;i<=y;++i){let a,s=i/o,l=n*s;i<0?(l=0,s=1,a=e):i>o?(l=n,s=1,a=t):a=e+i/o*(t-e),-2!==i&&i!==o+2||(a=0,s=0),l-=n/2;for(let e=0;e<m;++e){const t=Math.sin(e*Math.PI*2/r),n=Math.cos(e*Math.PI*2/r);d.push(t*a,l,n*a),i<0?f.push(0,-1,0):i>o?f.push(0,1,0):0===a?f.push(0,0,0):f.push(t*g,b,n*g),h.push(e/r,1-s)}}for(let e=0;e<o+u;++e)if(!(1===e&&s||e===o+u-2&&l))for(let t=0;t<r;++t)p.push(m*(e+0)+0+t,m*(e+0)+1+t,m*(e+1)+1+t),p.push(m*(e+0)+0+t,m*(e+1)+1+t,m*(e+1)+0+t);return{position:d,normal:f,texcoord:h,indices:p}}function lt(e,t){t=t||[];const n=[];for(let r=0;r<e.length;r+=4){const o=e[r],i=e.slice(r+1,r+4);i.push.apply(i,t);for(let e=0;e<o;++e)n.push.apply(n,i)}return n}function ut(){const e=[0,0,0,0,150,0,30,0,0,0,150,0,30,150,0,30,0,0,30,0,0,30,30,0,100,0,0,30,30,0,100,30,0,100,0,0,30,60,0,30,90,0,67,60,0,30,90,0,67,90,0,67,60,0,0,0,30,30,0,30,0,150,30,0,150,30,30,0,30,30,150,30,30,0,30,100,0,30,30,30,30,30,30,30,100,0,30,100,30,30,30,60,30,67,60,30,30,90,30,30,90,30,67,60,30,67,90,30,0,0,0,100,0,0,100,0,30,0,0,0,100,0,30,0,0,30,100,0,0,100,30,0,100,30,30,100,0,0,100,30,30,100,0,30,30,30,0,30,30,30,100,30,30,30,30,0,100,30,30,100,30,0,30,30,0,30,60,30,30,30,30,30,30,0,30,60,0,30,60,30,30,60,0,67,60,30,30,60,30,30,60,0,67,60,0,67,60,30,67,60,0,67,90,30,67,60,30,67,60,0,67,90,0,67,90,30,30,90,0,30,90,30,67,90,30,30,90,0,67,90,30,67,90,0,30,90,0,30,150,30,30,90,30,30,90,0,30,150,0,30,150,30,0,150,0,0,150,30,30,150,30,0,150,0,30,150,30,30,150,0,0,0,0,0,0,30,0,150,30,0,0,0,0,150,30,0,150,0],t=lt([18,0,0,1,18,0,0,-1,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,-1,0,6,-1,0,0]),n=lt([18,200,70,120,18,80,70,200,6,70,200,210,6,200,200,70,6,210,100,70,6,210,160,70,6,70,180,210,6,100,70,210,6,76,210,100,6,140,210,80,6,90,130,110,6,160,160,220],[255]),r=e.length/3,o={position:Je(3,r),texcoord:Je(2,r),normal:Je(3,r),color:Je(4,r,Uint8Array),indices:Je(3,r/3,Uint16Array)};o.position.push(e),o.texcoord.push([.22,.19,.22,.79,.34,.19,.22,.79,.34,.79,.34,.19,.34,.19,.34,.31,.62,.19,.34,.31,.62,.31,.62,.19,.34,.43,.34,.55,.49,.43,.34,.55,.49,.55,.49,.43,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,1,1,1,0,0,1,1,1,0]),o.normal.push(t),o.color.push(n);for(let e=0;e<r;++e)o.indices.push(e);return o}function ct(e,t,n,r,o,i,a){if(o<=0)throw new Error("subdivisionDown must be > 0");const s=(a=a||1)-(i=i||0),l=2*(o+1)*4,u=Je(3,l),c=Je(3,l),d=Je(2,l);function f(e,t,n){return e+(t-e)*n}function h(t,n,a,l,h,p){for(let b=0;b<=o;b++){const y=n/1,v=b/o,x=2*(y-.5),w=(i+v*s)*Math.PI,E=Math.sin(w),A=Math.cos(w),S=f(e,t,E),C=x*r,O=A*e,T=E*S;u.push(C,O,T);const F=me((m=[0,E,A],_=a,(g=(g=void 0)||new he(3))[0]=m[0]*_[0],g[1]=m[1]*_[1],g[2]=m[2]*_[2],g),l);c.push(F),d.push(y*h+p,v)}var m,_,g}for(let e=0;e<2;e++){const r=2*(e/1-.5);h(t,e,[1,1,1],[0,0,0],1,0),h(t,e,[0,0,0],[r,0,0],0,0),h(n,e,[1,1,1],[0,0,0],1,0),h(n,e,[0,0,0],[r,0,0],0,1)}const p=Je(3,2*o*4,Uint16Array);function m(e,t){for(let n=0;n<o;++n)p.push(e+n+0,e+n+1,t+n+0),p.push(e+n+1,t+n+1,t+n+0)}const _=o+1;return m(0*_,4*_),m(5*_,7*_),m(6*_,2*_),m(3*_,1*_),{position:u,normal:c,texcoord:d,indices:p}}function dt(e,t,n,r,o,i){return st(e,e,t,n,r,o,i)}function ft(e,t,n,r,o,i){if(n<3)throw new Error("radialSubdivisions must be 3 or greater");if(r<3)throw new Error("verticalSubdivisions must be 3 or greater");o=o||0;const a=(i=i||2*Math.PI)-o,s=n+1,l=r+1,u=s*l,c=Je(3,u),d=Je(3,u),f=Je(2,u),h=Je(3,n*r*2,Uint16Array);for(let i=0;i<l;++i){const l=i/r,u=l*Math.PI*2,h=Math.sin(u),p=e+h*t,m=Math.cos(u),_=m*t;for(let e=0;e<s;++e){const t=e/n,r=o+t*a,i=Math.sin(r),s=Math.cos(r),u=i*p,g=s*p,b=i*h,y=s*h;c.push(u,_,g),d.push(b,m,y),f.push(t,1-l)}}for(let e=0;e<r;++e)for(let t=0;t<n;++t){const n=1+t,r=1+e;h.push(s*e+t,s*r+t,s*e+n),h.push(s*r+t,s*r+n,s*e+n)}return{position:c,normal:d,texcoord:f,indices:h}}function ht(e,t,n,r,o){if(t<3)throw new Error("divisions must be at least 3");o=o||1,r=r||0;const i=(t+1)*((n=n||1)+1),a=Je(3,i),s=Je(3,i),l=Je(2,i),u=Je(3,n*t*2,Uint16Array);let c=0;const d=e-r,f=t+1;for(let e=0;e<=n;++e){const i=r+d*Math.pow(e/n,o);for(let r=0;r<=t;++r){const o=2*Math.PI*r/t,d=i*Math.cos(o),h=i*Math.sin(o);if(a.push(d,0,h),s.push(0,1,0),l.push(1-r/t,e/n),e>0&&r!==t){const e=c+(r+1),t=c+r,n=c+r-f,o=c+(r+1)-f;u.push(e,t,n),u.push(e,n,o)}}c+=t+1}return{position:a,normal:s,texcoord:l,indices:u}}function pt(e){return function(t){const n=e.apply(this,Array.prototype.slice.call(arguments,1));return Ke(t,n)}}function mt(e){return function(t){const n=e.apply(null,Array.prototype.slice.call(arguments,1));return qe(t,n)}}function _t(e){return!!e.texStorage2D}mt(ut),pt(ut),mt(at),pt(at),mt(rt),pt(rt),mt(ot),pt(ot),mt(st),pt(st),mt(nt),pt(nt),mt(ct),pt(ct),mt(dt),pt(dt),mt(ft),pt(ft),mt(ht),pt(ht);const gt=function(){const e={},t={};return function(n,r){return function(n){const r=n.constructor.name;if(!e[r]){for(const e in n)if("number"==typeof n[e]){const r=t[n[e]];t[n[e]]=r?`${r} | ${e}`:e}e[r]=!0}}(n),t[r]||("number"==typeof r?`0x${r.toString(16)}`:r)}}(),bt={textureColor:new Uint8Array([128,192,255,255]),textureOptions:{},crossOrigin:void 0},yt=Re,vt=function(){let e;return function(){return e=e||("undefined"!=typeof document&&document.createElement?document.createElement("canvas").getContext("2d"):null),e}}(),xt=6407,wt=6408,Et=6402,At=33071,St=3553,Ct=34067,Ot=32879,Tt=35866,Ft=34069,Pt=10241,It=10240,Mt=10242,Rt=10243,kt=3317,Bt=5120,Nt=5121,Lt=5122,Dt=5123,Ut=5124,Vt=5125,zt=5126,jt=5131,Ht=36193,Wt=33640,Gt=33319,Xt=33320,Yt=6403,$t=36244,Qt=36248,qt=36249;{const e={};e[6406]={numColorComponents:1},e[6409]={numColorComponents:1},e[6410]={numColorComponents:2},e[xt]={numColorComponents:3},e[wt]={numColorComponents:4},e[Yt]={numColorComponents:1},e[36244]={numColorComponents:1},e[Gt]={numColorComponents:2},e[33320]={numColorComponents:2},e[xt]={numColorComponents:3},e[36248]={numColorComponents:3},e[wt]={numColorComponents:4},e[36249]={numColorComponents:4},e[6402]={numColorComponents:1},e[34041]={numColorComponents:2}}let Kt;function Jt(e){if(!Kt){const e={};e[6406]={textureFormat:6406,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[Nt,jt,Ht,zt]},e[6409]={textureFormat:6409,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1,2,2,4],type:[Nt,jt,Ht,zt]},e[6410]={textureFormat:6410,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2,4,4,8],type:[Nt,jt,Ht,zt]},e[xt]={textureFormat:xt,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,6,6,12,2],type:[Nt,jt,Ht,zt,33635]},e[wt]={textureFormat:wt,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,8,8,16,2,2],type:[Nt,jt,Ht,zt,32819,32820]},e[6402]={textureFormat:Et,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[Vt,Dt]},e[33321]={textureFormat:Yt,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[1],type:[Nt]},e[36756]={textureFormat:Yt,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[1],type:[Bt]},e[33325]={textureFormat:Yt,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4,2],type:[zt,jt]},e[33326]={textureFormat:Yt,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[4],type:[zt]},e[33330]={textureFormat:$t,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[Nt]},e[33329]={textureFormat:$t,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[1],type:[Bt]},e[33332]={textureFormat:$t,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[Dt]},e[33331]={textureFormat:$t,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[Lt]},e[33334]={textureFormat:$t,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Vt]},e[33333]={textureFormat:$t,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Ut]},e[33323]={textureFormat:Gt,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[2],type:[Nt]},e[36757]={textureFormat:Gt,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[2],type:[Bt]},e[33327]={textureFormat:Gt,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[8,4],type:[zt,jt]},e[33328]={textureFormat:Gt,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[8],type:[zt]},e[33336]={textureFormat:Xt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[Nt]},e[33335]={textureFormat:Xt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2],type:[Bt]},e[33338]={textureFormat:Xt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Dt]},e[33337]={textureFormat:Xt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Lt]},e[33340]={textureFormat:Xt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[Vt]},e[33339]={textureFormat:Xt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[Ut]},e[32849]={textureFormat:xt,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3],type:[Nt]},e[35905]={textureFormat:xt,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[Nt]},e[36194]={textureFormat:xt,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[3,2],type:[Nt,33635]},e[36758]={textureFormat:xt,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[3],type:[Bt]},e[35898]={textureFormat:xt,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[zt,jt,35899]},e[35901]={textureFormat:xt,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6,4],type:[zt,jt,35902]},e[34843]={textureFormat:xt,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[12,6],type:[zt,jt]},e[34837]={textureFormat:xt,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[zt]},e[36221]={textureFormat:Qt,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[Nt]},e[36239]={textureFormat:Qt,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[3],type:[Bt]},e[36215]={textureFormat:Qt,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[Dt]},e[36233]={textureFormat:Qt,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[6],type:[Lt]},e[36209]={textureFormat:Qt,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[Vt]},e[36227]={textureFormat:Qt,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[12],type:[Ut]},e[32856]={textureFormat:wt,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[Nt]},e[35907]={textureFormat:wt,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[Nt]},e[36759]={textureFormat:wt,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[4],type:[Bt]},e[32855]={textureFormat:wt,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2,4],type:[Nt,32820,Wt]},e[32854]={textureFormat:wt,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4,2],type:[Nt,32819]},e[32857]={textureFormat:wt,colorRenderable:!0,textureFilterable:!0,bytesPerElement:[4],type:[Wt]},e[34842]={textureFormat:wt,colorRenderable:!1,textureFilterable:!0,bytesPerElement:[16,8],type:[zt,jt]},e[34836]={textureFormat:wt,colorRenderable:!1,textureFilterable:!1,bytesPerElement:[16],type:[zt]},e[36220]={textureFormat:qt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Nt]},e[36238]={textureFormat:qt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Bt]},e[36975]={textureFormat:qt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Wt]},e[36214]={textureFormat:qt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[Dt]},e[36232]={textureFormat:qt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[8],type:[Lt]},e[36226]={textureFormat:qt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[Ut]},e[36208]={textureFormat:qt,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[16],type:[Vt]},e[33189]={textureFormat:Et,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[2,4],type:[Dt,Vt]},e[33190]={textureFormat:Et,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[Vt]},e[36012]={textureFormat:Et,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[zt]},e[35056]={textureFormat:34041,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[34042]},e[36013]={textureFormat:34041,colorRenderable:!0,textureFilterable:!1,bytesPerElement:[4],type:[36269]},Object.keys(e).forEach((function(t){const n=e[t];n.bytesPerElementMap={},n.bytesPerElement.forEach((function(e,t){const r=n.type[t];n.bytesPerElementMap[r]=e}))})),Kt=e}return Kt[e]}function Zt(e){const t=Jt(e);if(!t)throw"unknown internal format";return{format:t.textureFormat,type:t.type[0]}}function en(e){return 0==(e&e-1)}function tn(e,t,n,r,o){if(o%1!=0)throw"can't guess dimensions";if(n||r){if(r){if(!n&&(n=o/r)%1)throw"can't guess dimensions"}else if((r=o/n)%1)throw"can't guess dimensions"}else{const e=Math.sqrt(o/(t===Ct?6:1));e%1==0?(n=e,r=e):(n=o,r=1)}return{width:n,height:r}}function nn(e){var t;ke(e,bt),e.textureColor&&(t=e.textureColor,bt.textureColor=new Uint8Array([255*t[0],255*t[1],255*t[2],255*t[3]]))}function rn(e,t){void 0!==t.colorspaceConversion&&e.pixelStorei(37443,t.colorspaceConversion),void 0!==t.premultiplyAlpha&&e.pixelStorei(37441,t.premultiplyAlpha),void 0!==t.flipY&&e.pixelStorei(37440,t.flipY)}function on(e){e.pixelStorei(kt,4),_t(e)&&(e.pixelStorei(3314,0),e.pixelStorei(32878,0),e.pixelStorei(3316,0),e.pixelStorei(3315,0),e.pixelStorei(32877,0))}function an(e,t,n){const r=n.target||St;e.bindTexture(r,t),function(e,t,n,r){r.minMag&&(n.call(e,t,Pt,r.minMag),n.call(e,t,It,r.minMag)),r.min&&n.call(e,t,Pt,r.min),r.mag&&n.call(e,t,It,r.mag),r.wrap&&(n.call(e,t,Mt,r.wrap),n.call(e,t,Rt,r.wrap),(t===Ot||"undefined"!=typeof WebGLSampler&&t instanceof WebGLSampler)&&n.call(e,t,32882,r.wrap)),r.wrapR&&n.call(e,t,32882,r.wrapR),r.wrapS&&n.call(e,t,Mt,r.wrapS),r.wrapT&&n.call(e,t,Rt,r.wrapT),r.minLod&&n.call(e,t,33082,r.minLod),r.maxLod&&n.call(e,t,33083,r.maxLod),r.baseLevel&&n.call(e,t,33084,r.baseLevel),r.maxLevel&&n.call(e,t,33085,r.maxLevel)}(e,r,e.texParameteri,n)}function sn(e,t,n,r,o,i){n=n||bt.textureOptions,i=i||wt;const a=n.target||St;if(r=r||n.width,o=o||n.height,e.bindTexture(a,t),function(e,t,n,r){if(!_t(e))return en(t)&&en(n);const o=Jt(r);if(!o)throw"unknown internal format";return o.colorRenderable&&o.textureFilterable}(e,r,o,i))e.generateMipmap(a);else{const t=function(e){const t=Jt(e);if(!t)throw"unknown internal format";return t.textureFilterable}(i)?9729:9728;e.texParameteri(a,Pt,t),e.texParameteri(a,It,t),e.texParameteri(a,Mt,At),e.texParameteri(a,Rt,At)}}function ln(e){return!0===e.auto||void 0===e.auto&&void 0===e.level}function un(e,t){return(t=t||{}).cubeFaceOrder||[Ft,34070,34071,34072,34073,34074]}function cn(e,t){const n=un(0,t).map((function(e,t){return{face:e,ndx:t}}));return n.sort((function(e,t){return e.face-t.face})),n}function dn(e,t,n,r){const o=(r=r||bt.textureOptions).target||St,i=r.level||0;let a=n.width,s=n.height;const l=r.internalFormat||r.format||wt,u=Zt(l),c=r.format||u.format,d=r.type||u.type;if(rn(e,r),e.bindTexture(o,t),o===Ct){const u=n.width,f=n.height;let h,p;if(u/6===f)h=f,p=[0,0,1,0,2,0,3,0,4,0,5,0];else if(f/6===u)h=u,p=[0,0,0,1,0,2,0,3,0,4,0,5];else if(u/3==f/2)h=u/3,p=[0,0,1,0,2,0,0,1,1,1,2,1];else{if(u/2!=f/3)throw"can't figure out cube map from element: "+(n.src?n.src:n.nodeName);h=u/2,p=[0,0,1,0,0,1,1,1,0,2,1,2]}const m=vt();m?(m.canvas.width=h,m.canvas.height=h,a=h,s=h,cn(0,r).forEach((function(t){const r=p[2*t.ndx+0]*h,o=p[2*t.ndx+1]*h;m.drawImage(n,r,o,h,h,0,0,h,h),e.texImage2D(t.face,i,l,c,d,m.canvas)})),m.canvas.width=1,m.canvas.height=1):"undefined"!=typeof createImageBitmap&&(a=h,s=h,cn(0,r).forEach((function(u){const f=p[2*u.ndx+0]*h,m=p[2*u.ndx+1]*h;e.texImage2D(u.face,i,l,h,h,0,c,d,null),createImageBitmap(n,f,m,h,h,{premultiplyAlpha:"none",colorSpaceConversion:"none"}).then((function(n){rn(e,r),e.bindTexture(o,t),e.texImage2D(u.face,i,l,c,d,n),ln(r)&&sn(e,t,r,a,s,l)}))})))}else if(o===Ot||o===Tt){const t=Math.min(n.width,n.height),r=Math.max(n.width,n.height),a=r/t;if(a%1!=0)throw"can not compute 3D dimensions of element";const s=n.width===r?1:0,u=n.height===r?1:0;e.pixelStorei(kt,1),e.pixelStorei(3314,n.width),e.pixelStorei(32878,0),e.pixelStorei(32877,0),e.texImage3D(o,i,l,t,t,t,0,c,d,null);for(let r=0;r<a;++r){const a=r*t*s,l=r*t*u;e.pixelStorei(3316,a),e.pixelStorei(3315,l),e.texSubImage3D(o,i,0,0,r,t,t,1,c,d,n)}on(e)}else e.texImage2D(o,i,l,c,d,n);ln(r)&&sn(e,t,r,a,s,l),an(e,t,r)}function fn(){}function hn(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof ImageData&&e instanceof ImageData||"undefined"!=typeof HTMLElement&&e instanceof HTMLElement}function pn(e,t,n){return hn(e)?(setTimeout((function(){n(null,e)})),e):function(e,t,n){let r;if(n=n||fn,t=void 0!==t?t:bt.crossOrigin,t=function(e,t){return void 0!==t||function(e){if("undefined"!=typeof document){const t=document.createElement("a");return t.href=e,t.hostname===location.hostname&&t.port===location.port&&t.protocol===location.protocol}{const t=new URL(location.href).origin;return new URL(e,location.href).origin===t}}(e)?t:"anonymous"}(e,t),"undefined"!=typeof Image){r=new Image,void 0!==t&&(r.crossOrigin=t);const o=function(){r.removeEventListener("error",i),r.removeEventListener("load",a),r=null},i=function(){const t="couldn't load image: "+e;Be(t),n(t,r),o()},a=function(){n(null,r),o()};return r.addEventListener("error",i),r.addEventListener("load",a),r.src=e,r}if("undefined"!=typeof ImageBitmap){let o,i;const a=function(){n(o,i)},s={};t&&(s.mode="cors"),fetch(e,s).then((function(e){if(!e.ok)throw e;return e.blob()})).then((function(e){return createImageBitmap(e,{premultiplyAlpha:"none",colorSpaceConversion:"none"})})).then((function(e){i=e,setTimeout(a)})).catch((function(e){o=e,setTimeout(a)})),r=null}return r}(e,t,n)}function mn(e,t,n){const r=(n=n||bt.textureOptions).target||St;if(e.bindTexture(r,t),!1===n.color)return;const o=function(e){return e=e||bt.textureColor,yt(e)?e:new Uint8Array([255*e[0],255*e[1],255*e[2],255*e[3]])}(n.color);if(r===Ct)for(let t=0;t<6;++t)e.texImage2D(Ft+t,0,wt,1,1,0,wt,Nt,o);else r===Ot||r===Tt?e.texImage3D(r,0,wt,1,1,1,0,wt,Nt,o):e.texImage2D(r,0,wt,1,1,0,wt,Nt,o)}function _n(e,t,n,r){const o=(r=r||bt.textureOptions).target||St;e.bindTexture(o,t);let i=r.width,a=r.height,s=r.depth;const l=r.level||0,u=r.internalFormat||r.format||wt,c=Zt(u),d=r.format||c.format,f=r.type||function(e,t,n){return yt(t)?Me(t):n||Nt}(0,n,c.type);if(yt(n))n instanceof Uint8ClampedArray&&(n=new Uint8Array(n.buffer));else{const e=function(e){const t=Ie[e];if(!t)throw new Error("unknown gl type");return t}(f);n=new e(n)}const h=function(e,t){const n=Jt(e);if(!n)throw"unknown internal format";const r=n.bytesPerElementMap[t];if(void 0===r)throw"unknown internal format";return r}(u,f),p=n.byteLength/h;if(p%1)throw"length wrong size for format: "+gt(e,d);let m;if(o===Ot||o===Tt)if(i||a||s)!i||a&&s?!a||i&&s?(m=tn(0,o,i,a,p/s),i=m.width,a=m.height):(m=tn(0,o,i,s,p/a),i=m.width,s=m.height):(m=tn(0,o,a,s,p/i),a=m.width,s=m.height);else{const e=Math.cbrt(p);if(e%1!=0)throw"can't guess cube size of array of numElements: "+p;i=e,a=e,s=e}else m=tn(0,o,i,a,p),i=m.width,a=m.height;if(on(e),e.pixelStorei(kt,r.unpackAlignment||1),rn(e,r),o===Ct){const t=p/6*(h/n.BYTES_PER_ELEMENT);cn(0,r).forEach((r=>{const o=t*r.ndx,s=n.subarray(o,o+t);e.texImage2D(r.face,l,u,i,a,0,d,f,s)}))}else o===Ot||o===Tt?e.texImage3D(o,l,u,i,a,s,0,d,f,n):e.texImage2D(o,l,u,i,a,0,d,f,n);return{width:i,height:a,depth:s,type:f}}function gn(e,t,n){n=n||fn,t=t||bt.textureOptions;const r=e.createTexture(),o=t.target||St;let i=t.width||1,a=t.height||1;const s=t.internalFormat||wt;e.bindTexture(o,r),o===Ct&&(e.texParameteri(o,Mt,At),e.texParameteri(o,Rt,At));let l=t.src;if(l)if("function"==typeof l&&(l=l(e,t)),"string"==typeof l)!function(e,t,n,r){r=r||fn,n=n||bt.textureOptions,mn(e,t,n),pn((n=Object.assign({},n)).src,n.crossOrigin,(function(o,i){o?r(o,t,i):(dn(e,t,i,n),r(null,t,i))}))}(e,r,t,n);else if(yt(l)||Array.isArray(l)&&("number"==typeof l[0]||Array.isArray(l[0])||yt(l[0]))){const n=_n(e,r,l,t);i=n.width,a=n.height}else Array.isArray(l)&&("string"==typeof l[0]||hn(l[0]))?o===Ct?function(e,t,n,r){r=r||fn;const o=n.src;if(6!==o.length)throw"there must be 6 urls for a cubemap";const i=n.level||0,a=n.internalFormat||n.format||wt,s=Zt(a),l=n.format||s.format,u=n.type||Nt,c=n.target||St;if(c!==Ct)throw"target must be TEXTURE_CUBE_MAP";mn(e,t,n),n=Object.assign({},n);let d=6;const f=[],h=un(0,n);let p;p=o.map((function(o,s){return pn(o,n.crossOrigin,(m=h[s],function(o,s){--d,o?f.push(o):s.width!==s.height?f.push("cubemap face img is not a square: "+s.src):(rn(e,n),e.bindTexture(c,t),5===d?un().forEach((function(t){e.texImage2D(t,i,a,l,u,s)})):e.texImage2D(m,i,a,l,u,s),ln(n)&&e.generateMipmap(c)),0===d&&r(f.length?f:void 0,t,p)}));var m}))}(e,r,t,n):function(e,t,n,r){r=r||fn;const o=n.src,i=n.internalFormat||n.format||wt,a=Zt(i),s=n.format||a.format,l=n.type||Nt,u=n.target||Tt;if(u!==Ot&&u!==Tt)throw"target must be TEXTURE_3D or TEXTURE_2D_ARRAY";mn(e,t,n),n=Object.assign({},n);let c=o.length;const d=[];let f;const h=n.level||0;let p=n.width,m=n.height;const _=o.length;let g=!0;f=o.map((function(o,a){return pn(o,n.crossOrigin,(b=a,function(o,a){if(--c,o)d.push(o);else{if(rn(e,n),e.bindTexture(u,t),g){g=!1,p=n.width||a.width,m=n.height||a.height,e.texImage3D(u,h,i,p,m,_,0,s,l,null);for(let t=0;t<_;++t)e.texSubImage3D(u,h,0,0,t,p,m,1,s,l,a)}else{let t,n=a;a.width===p&&a.height===m||(t=vt(),n=t.canvas,t.canvas.width=p,t.canvas.height=m,t.drawImage(a,0,0,p,m)),e.texSubImage3D(u,h,0,0,b,p,m,1,s,l,n),t&&n===t.canvas&&(t.canvas.width=0,t.canvas.height=0)}ln(n)&&e.generateMipmap(u)}0===c&&r(d.length?d:void 0,t,f)}));var b}))}(e,r,t,n):(dn(e,r,l,t),i=l.width,a=l.height);else!function(e,t,n){const r=n.target||St;e.bindTexture(r,t);const o=n.level||0,i=n.internalFormat||n.format||wt,a=Zt(i),s=n.format||a.format,l=n.type||a.type;if(rn(e,n),r===Ct)for(let t=0;t<6;++t)e.texImage2D(Ft+t,o,i,n.width,n.height,0,s,l,null);else r===Ot||r===Tt?e.texImage3D(r,o,i,n.width,n.height,n.depth,0,s,l,null):e.texImage2D(r,o,i,n.width,n.height,0,s,l,null)}(e,r,t);return ln(t)&&sn(e,r,t,i,a,s),an(e,r,t),r}const bn=Be;function yn(e){return"undefined"!=typeof document&&document.getElementById?document.getElementById(e):null}const vn=33984,xn=34962,wn=3553,En=34067,An=32879,Sn=35866,Cn={};function On(e,t){return Cn[t].bindPoint}function Tn(e,t){return function(n){e.uniform1i(t,n)}}function Fn(e,t){return function(n){e.uniform1iv(t,n)}}function Pn(e,t){return function(n){e.uniform2iv(t,n)}}function In(e,t){return function(n){e.uniform3iv(t,n)}}function Mn(e,t){return function(n){e.uniform4iv(t,n)}}function Rn(e,t,n,r){const o=On(0,t);return _t(e)?function(t){let i,a;Le(0,t)?(i=t,a=null):(i=t.texture,a=t.sampler),e.uniform1i(r,n),e.activeTexture(vn+n),e.bindTexture(o,i),e.bindSampler(n,a)}:function(t){e.uniform1i(r,n),e.activeTexture(vn+n),e.bindTexture(o,t)}}function kn(e,t,n,r,o){const i=On(0,t),a=new Int32Array(o);for(let e=0;e<o;++e)a[e]=n+e;return _t(e)?function(t){e.uniform1iv(r,a),t.forEach((function(t,r){let o,s;e.activeTexture(vn+a[r]),Le(0,t)?(o=t,s=null):(o=t.texture,s=t.sampler),e.bindSampler(n,s),e.bindTexture(i,o)}))}:function(t){e.uniform1iv(r,a),t.forEach((function(t,n){e.activeTexture(vn+a[n]),e.bindTexture(i,t)}))}}function Bn(e,t){return function(n){if(n.value)switch(e.disableVertexAttribArray(t),n.value.length){case 4:e.vertexAttrib4fv(t,n.value);break;case 3:e.vertexAttrib3fv(t,n.value);break;case 2:e.vertexAttrib2fv(t,n.value);break;case 1:e.vertexAttrib1fv(t,n.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else e.bindBuffer(xn,n.buffer),e.enableVertexAttribArray(t),e.vertexAttribPointer(t,n.numComponents||n.size,n.type||5126,n.normalize||!1,n.stride||0,n.offset||0),void 0!==n.divisor&&e.vertexAttribDivisor(t,n.divisor)}}function Nn(e,t){return function(n){if(n.value){if(e.disableVertexAttribArray(t),4!==n.value.length)throw new Error("The length of an integer constant value must be 4!");e.vertexAttrib4iv(t,n.value)}else e.bindBuffer(xn,n.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,n.numComponents||n.size,n.type||5124,n.stride||0,n.offset||0),void 0!==n.divisor&&e.vertexAttribDivisor(t,n.divisor)}}function Ln(e,t){return function(n){if(n.value){if(e.disableVertexAttribArray(t),4!==n.value.length)throw new Error("The length of an unsigned integer constant value must be 4!");e.vertexAttrib4uiv(t,n.value)}else e.bindBuffer(xn,n.buffer),e.enableVertexAttribArray(t),e.vertexAttribIPointer(t,n.numComponents||n.size,n.type||5125,n.stride||0,n.offset||0),void 0!==n.divisor&&e.vertexAttribDivisor(t,n.divisor)}}function Dn(e,t,n){const r=n.size,o=n.count;return function(n){e.bindBuffer(xn,n.buffer);const i=n.size||n.numComponents||r,a=i/o,s=n.type||5126,l=Cn[s].size*i,u=n.normalize||!1,c=n.offset||0,d=l/o;for(let r=0;r<o;++r)e.enableVertexAttribArray(t+r),e.vertexAttribPointer(t+r,a,s,u,l,c+d*r),void 0!==n.divisor&&e.vertexAttribDivisor(t+r,n.divisor)}}Cn[5126]={Type:Float32Array,size:4,setter:function(e,t){return function(n){e.uniform1f(t,n)}},arraySetter:function(e,t){return function(n){e.uniform1fv(t,n)}}},Cn[35664]={Type:Float32Array,size:8,setter:function(e,t){return function(n){e.uniform2fv(t,n)}},cols:2},Cn[35665]={Type:Float32Array,size:12,setter:function(e,t){return function(n){e.uniform3fv(t,n)}},cols:3},Cn[35666]={Type:Float32Array,size:16,setter:function(e,t){return function(n){e.uniform4fv(t,n)}},cols:4},Cn[5124]={Type:Int32Array,size:4,setter:Tn,arraySetter:Fn},Cn[35667]={Type:Int32Array,size:8,setter:Pn,cols:2},Cn[35668]={Type:Int32Array,size:12,setter:In,cols:3},Cn[35669]={Type:Int32Array,size:16,setter:Mn,cols:4},Cn[5125]={Type:Uint32Array,size:4,setter:function(e,t){return function(n){e.uniform1ui(t,n)}},arraySetter:function(e,t){return function(n){e.uniform1uiv(t,n)}}},Cn[36294]={Type:Uint32Array,size:8,setter:function(e,t){return function(n){e.uniform2uiv(t,n)}},cols:2},Cn[36295]={Type:Uint32Array,size:12,setter:function(e,t){return function(n){e.uniform3uiv(t,n)}},cols:3},Cn[36296]={Type:Uint32Array,size:16,setter:function(e,t){return function(n){e.uniform4uiv(t,n)}},cols:4},Cn[35670]={Type:Uint32Array,size:4,setter:Tn,arraySetter:Fn},Cn[35671]={Type:Uint32Array,size:8,setter:Pn,cols:2},Cn[35672]={Type:Uint32Array,size:12,setter:In,cols:3},Cn[35673]={Type:Uint32Array,size:16,setter:Mn,cols:4},Cn[35674]={Type:Float32Array,size:32,setter:function(e,t){return function(n){e.uniformMatrix2fv(t,!1,n)}},rows:2,cols:2},Cn[35675]={Type:Float32Array,size:48,setter:function(e,t){return function(n){e.uniformMatrix3fv(t,!1,n)}},rows:3,cols:3},Cn[35676]={Type:Float32Array,size:64,setter:function(e,t){return function(n){e.uniformMatrix4fv(t,!1,n)}},rows:4,cols:4},Cn[35685]={Type:Float32Array,size:32,setter:function(e,t){return function(n){e.uniformMatrix2x3fv(t,!1,n)}},rows:2,cols:3},Cn[35686]={Type:Float32Array,size:32,setter:function(e,t){return function(n){e.uniformMatrix2x4fv(t,!1,n)}},rows:2,cols:4},Cn[35687]={Type:Float32Array,size:48,setter:function(e,t){return function(n){e.uniformMatrix3x2fv(t,!1,n)}},rows:3,cols:2},Cn[35688]={Type:Float32Array,size:48,setter:function(e,t){return function(n){e.uniformMatrix3x4fv(t,!1,n)}},rows:3,cols:4},Cn[35689]={Type:Float32Array,size:64,setter:function(e,t){return function(n){e.uniformMatrix4x2fv(t,!1,n)}},rows:4,cols:2},Cn[35690]={Type:Float32Array,size:64,setter:function(e,t){return function(n){e.uniformMatrix4x3fv(t,!1,n)}},rows:4,cols:3},Cn[35678]={Type:null,size:0,setter:Rn,arraySetter:kn,bindPoint:wn},Cn[35680]={Type:null,size:0,setter:Rn,arraySetter:kn,bindPoint:En},Cn[35679]={Type:null,size:0,setter:Rn,arraySetter:kn,bindPoint:An},Cn[35682]={Type:null,size:0,setter:Rn,arraySetter:kn,bindPoint:wn},Cn[36289]={Type:null,size:0,setter:Rn,arraySetter:kn,bindPoint:Sn},Cn[36292]={Type:null,size:0,setter:Rn,arraySetter:kn,bindPoint:Sn},Cn[36293]={Type:null,size:0,setter:Rn,arraySetter:kn,bindPoint:En},Cn[36298]={Type:null,size:0,setter:Rn,arraySetter:kn,bindPoint:wn},Cn[36299]={Type:null,size:0,setter:Rn,arraySetter:kn,bindPoint:An},Cn[36300]={Type:null,size:0,setter:Rn,arraySetter:kn,bindPoint:En},Cn[36303]={Type:null,size:0,setter:Rn,arraySetter:kn,bindPoint:Sn},Cn[36306]={Type:null,size:0,setter:Rn,arraySetter:kn,bindPoint:wn},Cn[36307]={Type:null,size:0,setter:Rn,arraySetter:kn,bindPoint:An},Cn[36308]={Type:null,size:0,setter:Rn,arraySetter:kn,bindPoint:En},Cn[36311]={Type:null,size:0,setter:Rn,arraySetter:kn,bindPoint:Sn};const Un={};Un[5126]={size:4,setter:Bn},Un[35664]={size:8,setter:Bn},Un[35665]={size:12,setter:Bn},Un[35666]={size:16,setter:Bn},Un[5124]={size:4,setter:Nn},Un[35667]={size:8,setter:Nn},Un[35668]={size:12,setter:Nn},Un[35669]={size:16,setter:Nn},Un[5125]={size:4,setter:Ln},Un[36294]={size:8,setter:Ln},Un[36295]={size:12,setter:Ln},Un[36296]={size:16,setter:Ln},Un[35670]={size:4,setter:Nn},Un[35671]={size:8,setter:Nn},Un[35672]={size:12,setter:Nn},Un[35673]={size:16,setter:Nn},Un[35674]={size:4,setter:Dn,count:2},Un[35675]={size:9,setter:Dn,count:3},Un[35676]={size:16,setter:Dn,count:4};const Vn=/ERROR:\s*\d+:(\d+)/gi;function zn(e,t="",n=0){const r=[...t.matchAll(Vn)],o=new Map(r.map(((e,n)=>{const o=parseInt(e[1]),i=r[n+1],a=i?i.index:t.length;return[o-1,t.substring(e.index,a)]})));return e.split("\n").map(((e,t)=>{const r=o.get(t);return`${t+1+n}: ${e}${r?`\n\n^^^ ${r}`:""}`})).join("\n")}const jn=/^[ \t]*\n/;function Hn(e,t,n,r){const o=r||bn,i=e.createShader(n);let a=0;if(jn.test(t)&&(a=1,t=t.replace(jn,"")),e.shaderSource(i,t),e.compileShader(i),!e.getShaderParameter(i,35713)){const r=e.getShaderInfoLog(i);return o(`${zn(t,r,a)}\nError compiling ${gt(e,n)}: ${r}`),e.deleteShader(i),null}return i}function Wn(e,t,n){let r,o;if("function"==typeof t&&(n=t,t=void 0),"function"==typeof e)n=e,e=void 0;else if(e&&!Array.isArray(e)){if(e.errorCallback)return e;const t=e;n=t.errorCallback,e=t.attribLocations,r=t.transformFeedbackVaryings,o=t.transformFeedbackMode}const i={errorCallback:n||bn,transformFeedbackVaryings:r,transformFeedbackMode:o};if(e){let n={};Array.isArray(e)?e.forEach((function(e,r){n[e]=t?t[r]:r})):n=e,i.attribLocations=n}return i}const Gn=["VERTEX_SHADER","FRAGMENT_SHADER"];function Xn(e,t){t.forEach((function(t){e.deleteShader(t)}))}function Yn(e,t,n,r,o){const i=Wn(n,r,o),a=[];for(let n=0;n<t.length;++n){const r=Hn(e,t[n],e[Gn[n]],i.errorCallback);if(!r)return null;a.push(r)}return function(e,t,n,r,o){const i=Wn(n,r,o),a=[],s=[];for(let n=0;n<t.length;++n){let r=t[n];if("string"==typeof r){const t=yn(r),o=t?t.text:r;let a=e[Gn[n]];t&&t.type&&(a=((l=t.type).indexOf("frag")>=0?35632:l.indexOf("vert")>=0?35633:void 0)||a),r=Hn(e,o,a,i.errorCallback),s.push(r)}"undefined"!=typeof WebGLShader&&r instanceof WebGLShader&&a.push(r)}var l;if(a.length!==t.length)return i.errorCallback("not enough shaders for program"),Xn(e,s),null;const u=e.createProgram();a.forEach((function(t){e.attachShader(u,t)})),i.attribLocations&&Object.keys(i.attribLocations).forEach((function(t){e.bindAttribLocation(u,i.attribLocations[t],t)}));let c=i.transformFeedbackVaryings;if(c&&(c.attribs&&(c=c.attribs),Array.isArray(c)||(c=Object.keys(c)),e.transformFeedbackVaryings(u,c,i.transformFeedbackMode||35981)),e.linkProgram(u),!e.getProgramParameter(u,35714)){const t=e.getProgramInfoLog(u);return i.errorCallback(`${a.map((t=>{const n=zn(e.getShaderSource(t),"",0),r=e.getShaderParameter(t,e.SHADER_TYPE);return`${gt(e,r)}\n${n}}`})).join("\n")}\nError in program linking: ${t}`),e.deleteProgram(u),Xn(e,s),null}return u}(e,a,i)}function $n(e){const t=e.name;return t.startsWith("gl_")||t.startsWith("webgl_")}const Qn=/(\.|\[|]|\w+)/g;function qn(e,t,n,r){const o=e.split(Qn).filter((e=>""!==e));let i=0,a="";for(;;){const e=o[i++];a+=e;const l=(s=e[0])>="0"&&s<="9",u=l?parseInt(e):e;if(l&&(a+=o[i++]),i===o.length){n[u]=t;break}{const e=o[i++],t="["===e,s=n[u]||(t?[]:{});n[u]=s,n=s,r[a]=r[a]||function(e){return function(t){Jn(e,t)}}(s),a+=e}}var s}function Kn(e,t){let n=0;function r(t,r,o){const i=r.name.endsWith("[0]"),a=r.type,s=Cn[a];if(!s)throw new Error(`unknown type: 0x${a.toString(16)}`);let l;if(s.bindPoint){const t=n;n+=r.size,l=i?s.arraySetter(e,a,t,o,r.size):s.setter(e,a,t,o,r.size)}else l=s.arraySetter&&i?s.arraySetter(e,o):s.setter(e,o);return l.location=o,l}const o={},i={},a=e.getProgramParameter(t,35718);for(let n=0;n<a;++n){const a=e.getActiveUniform(t,n);if($n(a))continue;let s=a.name;s.endsWith("[0]")&&(s=s.substr(0,s.length-3));const l=e.getUniformLocation(t,a.name);if(l){const e=r(0,a,l);o[s]=e,qn(s,e,i,o)}}return o}function Jn(e,t){for(const n in t){const r=e[n];"function"==typeof r?r(t[n]):Jn(e[n],t[n])}}function Zn(e,...t){const n=e.uniformSetters||e,r=t.length;for(let e=0;e<r;++e){const r=t[e];if(Array.isArray(r)){const e=r.length;for(let t=0;t<e;++t)Zn(n,r[t])}else for(const e in r){const t=n[e];t&&t(r[e])}}}function er(e,t){const n={},r=e.getProgramParameter(t,35721);for(let o=0;o<r;++o){const r=e.getActiveAttrib(t,o);if($n(r))continue;const i=e.getAttribLocation(t,r.name),a=Un[r.type],s=a.setter(e,i,a);s.location=i,n[r.name]=s}return n}function tr(e,t,n){n.vertexArrayObject?e.bindVertexArray(n.vertexArrayObject):(function(e,t){for(const n in t){const r=e[n];r&&r(t[n])}}(t.attribSetters||t,n.attribs),n.indices&&e.bindBuffer(34963,n.indices))}function nr(e,t,n,r,o){const i=Wn(n,r,o);let a=!0;if(t=t.map((function(e){if(e.indexOf("\n")<0){const t=yn(e);t?e=t.text:(i.errorCallback("no element with id: "+e),a=!1)}return e})),!a)return null;const s=Yn(e,t,i);return s?function(e,t){const n={program:t,uniformSetters:Kn(e,t),attribSetters:er(e,t)};return _t(e)&&(n.uniformBlockSpec=function(e,t){const n=e.getProgramParameter(t,35718),r=[],o=[];for(let i=0;i<n;++i){o.push(i),r.push({});const n=e.getActiveUniform(t,i);r[i].name=n.name}[["UNIFORM_TYPE","type"],["UNIFORM_SIZE","size"],["UNIFORM_BLOCK_INDEX","blockNdx"],["UNIFORM_OFFSET","offset"]].forEach((function(n){const i=n[0],a=n[1];e.getActiveUniforms(t,o,e[i]).forEach((function(e,t){r[t][a]=e}))}));const i={},a=e.getProgramParameter(t,35382);for(let n=0;n<a;++n){const r=e.getActiveUniformBlockName(t,n),o={index:e.getUniformBlockIndex(t,r),usedByVertexShader:e.getActiveUniformBlockParameter(t,n,35396),usedByFragmentShader:e.getActiveUniformBlockParameter(t,n,35398),size:e.getActiveUniformBlockParameter(t,n,35392),uniformIndices:e.getActiveUniformBlockParameter(t,n,35395)};o.used=o.usedByVertexShader||o.usedByFragmentShader,i[r]=o}return{blockSpecs:i,uniformData:r}}(e,t),n.transformFeedbackInfo=function(e,t){const n={},r=e.getProgramParameter(t,35971);for(let o=0;o<r;++o){const r=e.getTransformFeedbackVarying(t,o);n[r.name]={index:o,type:r.type,size:r.size}}return n}(e,t)),n}(e,s):null}function rr(e,t,n,r,o,i){n=void 0===n?4:n;const a=t.indices,s=t.elementType,l=void 0===r?t.numElements:r;o=void 0===o?0:o,s||a?void 0!==i?e.drawElementsInstanced(n,l,void 0===s?5123:t.elementType,o,i):e.drawElements(n,l,void 0===s?5123:t.elementType,o):void 0!==i?e.drawArraysInstanced(n,o,l,i):e.drawArrays(n,o,l)}const or=36161,ir=36096,ar=33306,sr=33071,lr=9729,ur=[{format:6408,type:5121,min:lr,wrap:sr},{format:34041}],cr={};cr[34041]=ar,cr[6401]=36128,cr[36168]=36128,cr[6402]=ir,cr[33189]=ir,cr[33190]=ir,cr[36012]=ir,cr[35056]=ar,cr[36013]=ar;const dr={};function fr(e,t,n,r){const o=36160,i=e.createFramebuffer();e.bindFramebuffer(o,i),n=n||e.drawingBufferWidth,r=r||e.drawingBufferHeight;let a=0;const s={framebuffer:i,attachments:[],width:n,height:r};return(t=t||ur).forEach((function(t){let i=t.attachment;const l=t.format;let u=t.attachmentPoint||function(e,t){return cr[e]||cr[t]}(l,t.internalFormat);if(u||(u=36064+a++),!i)if(function(e){return dr[e]}(l))i=e.createRenderbuffer(),e.bindRenderbuffer(or,i),e.renderbufferStorage(or,l,n,r);else{const o=Object.assign({},t);o.width=n,o.height=r,void 0===o.auto&&(o.auto=!1,o.min=o.min||o.minMag||lr,o.mag=o.mag||o.minMag||lr,o.wrapS=o.wrapS||o.wrap||sr,o.wrapT=o.wrapT||o.wrap||sr),i=gn(e,o)}if(c=i,"undefined"!=typeof WebGLRenderbuffer&&c instanceof WebGLRenderbuffer)e.framebufferRenderbuffer(o,u,or,i);else{if(!Le(0,i))throw new Error("unknown attachment type");void 0!==t.layer?e.framebufferTextureLayer(o,u,i,t.level||0,t.layer):e.framebufferTexture2D(o,u,t.target||3553,i,t.level||0)}var c;s.attachments.push(i)})),s}function hr(e,t,n){n=n||36160,t?(e.bindFramebuffer(n,t.framebuffer),e.viewport(0,0,t.width,t.height)):(e.bindFramebuffer(n,null),e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight))}dr[32854]=!0,dr[32855]=!0,dr[36194]=!0,dr[34041]=!0,dr[33189]=!0,dr[6401]=!0,dr[36168]=!0;const pr={addExtensionsToContext:!0},mr=/^(.*?)_/;function _r(e,t){gt(e,0);const n=e.getExtension(t);if(n){const r={},o=mr.exec(t)[1],i="_"+o;for(const t in n){const a=n[t],s="function"==typeof a,l=s?o:i;let u=t;t.endsWith(l)&&(u=t.substring(0,t.length-l.length)),void 0!==e[u]?s||e[u]===a||Ne(u,e[u],a,t):s?e[u]=function(e){return function(){return e.apply(n,arguments)}}(a):(e[u]=a,r[u]=a)}r.constructor={name:n.constructor.name},gt(r,0)}return n}const gr=["ANGLE_instanced_arrays","EXT_blend_minmax","EXT_color_buffer_float","EXT_color_buffer_half_float","EXT_disjoint_timer_query","EXT_disjoint_timer_query_webgl2","EXT_frag_depth","EXT_sRGB","EXT_shader_texture_lod","EXT_texture_filter_anisotropic","OES_element_index_uint","OES_standard_derivatives","OES_texture_float","OES_texture_float_linear","OES_texture_half_float","OES_texture_half_float_linear","OES_vertex_array_object","WEBGL_color_buffer_float","WEBGL_compressed_texture_atc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb","WEBGL_depth_texture","WEBGL_draw_buffers"];var br=n(309),yr=n.n(br);function vr(e,t,n,r,o){let i=n-e,a=r-t,s=o/(2*Math.sqrt(i*i+a*a));return[s*a,-s*i]}function xr(e,t,n,r,o,i,a,s){if(e===n&&t===r)return[e,t];if(o===a&&i===s)return[o,i];const l=(s-i)*(n-e)-(a-o)*(r-t);if(0===l)return[o,i];let u=((a-o)*(t-i)-(s-i)*(e-o))/l;return[e+u*(n-e),t+u*(r-t)]}function wr(e,t){return Math.abs(e-t)<Number.EPSILON}class Er{static build(e,t){const n=[],r=[];if(e.length<4)return[n,r];let o,i,a,s,l,u,c;const d=wr(e[0],e[e.length-2])&&wr(e[1],e[e.length-1]);for(let f=0;f<e.length;f+=2){const h=0==f,p=f+2>=e.length,[m,_]=[e[f],e[f+1]],[g,b]=[e[f+2],e[f+3]];if(wr(m,g)&&wr(_,b))continue;const[y,v]=vr(m,_,g,b,t),x=[m+y,_+v],w=[m-y,_-v],E=[g+y,b+v],A=[g-y,b-v];if(p){d?(n.push(...u),n.push(...c)):(n.push(...a),n.push(...s)),r.push(l,f,l+1,l+2,l+3,l+1);break}if(h)if(d){const[r,l]=vr(e[e.length-4],e[e.length-3],e[e.length-2],e[e.length-1],t);o=[e[e.length-4]+r,e[e.length-3]+l],i=[e[e.length-4]-r,e[e.length-3]-l],a=[e[e.length-2]+r,e[e.length-1]+l],s=[e[e.length-2]-r,e[e.length-1]-l],u=xr(...o,...a,...x,...E),c=xr(...i,...s,...w,...A),n.push(...u),n.push(...c)}else n.push(...x),n.push(...w);else{const e=xr(...o,...a,...x,...E),t=xr(...i,...s,...w,...A);n.push(...e),n.push(...t),r.push(l,f,l+1,l+2,l+3,l+1)}o=x,i=w,a=E,s=A,l=f}return[n,r]}}!function(e,t,n){function r(e){e&&(e.setTargetAtTime||(e.setTargetAtTime=e.setTargetValueAtTime))}window.hasOwnProperty("webkitAudioContext")&&!window.hasOwnProperty("AudioContext")&&(window.AudioContext=webkitAudioContext,AudioContext.prototype.hasOwnProperty("createGain")||(AudioContext.prototype.createGain=AudioContext.prototype.createGainNode),AudioContext.prototype.hasOwnProperty("createDelay")||(AudioContext.prototype.createDelay=AudioContext.prototype.createDelayNode),AudioContext.prototype.hasOwnProperty("createScriptProcessor")||(AudioContext.prototype.createScriptProcessor=AudioContext.prototype.createJavaScriptNode),AudioContext.prototype.hasOwnProperty("createPeriodicWave")||(AudioContext.prototype.createPeriodicWave=AudioContext.prototype.createWaveTable),AudioContext.prototype.internal_createGain=AudioContext.prototype.createGain,AudioContext.prototype.createGain=function(){var e=this.internal_createGain();return r(e.gain),e},AudioContext.prototype.internal_createDelay=AudioContext.prototype.createDelay,AudioContext.prototype.createDelay=function(e){var t=e?this.internal_createDelay(e):this.internal_createDelay();return r(t.delayTime),t},AudioContext.prototype.internal_createBufferSource=AudioContext.prototype.createBufferSource,AudioContext.prototype.createBufferSource=function(){var e=this.internal_createBufferSource();return e.start?(e.internal_start=e.start,e.start=function(t,n,r){void 0!==r?e.internal_start(t||0,n,r):e.internal_start(t||0,n||0)}):e.start=function(e,t,n){t||n?this.noteGrainOn(e||0,t,n):this.noteOn(e||0)},e.stop?(e.internal_stop=e.stop,e.stop=function(t){e.internal_stop(t||0)}):e.stop=function(e){this.noteOff(e||0)},r(e.playbackRate),e},AudioContext.prototype.internal_createDynamicsCompressor=AudioContext.prototype.createDynamicsCompressor,AudioContext.prototype.createDynamicsCompressor=function(){var e=this.internal_createDynamicsCompressor();return r(e.threshold),r(e.knee),r(e.ratio),r(e.reduction),r(e.attack),r(e.release),e},AudioContext.prototype.internal_createBiquadFilter=AudioContext.prototype.createBiquadFilter,AudioContext.prototype.createBiquadFilter=function(){var e=this.internal_createBiquadFilter();return r(e.frequency),r(e.detune),r(e.Q),r(e.gain),e},AudioContext.prototype.hasOwnProperty("createOscillator")&&(AudioContext.prototype.internal_createOscillator=AudioContext.prototype.createOscillator,AudioContext.prototype.createOscillator=function(){var e=this.internal_createOscillator();return e.start?(e.internal_start=e.start,e.start=function(t){e.internal_start(t||0)}):e.start=function(e){this.noteOn(e||0)},e.stop?(e.internal_stop=e.stop,e.stop=function(t){e.internal_stop(t||0)}):e.stop=function(e){this.noteOff(e||0)},e.setPeriodicWave||(e.setPeriodicWave=e.setWaveTable),r(e.frequency),r(e.detune),e})),window.hasOwnProperty("webkitOfflineAudioContext")&&!window.hasOwnProperty("OfflineAudioContext")&&(window.OfflineAudioContext=webkitOfflineAudioContext)}(window);var Ar=new AudioContext;function Sr(e,t,n,r,o){var i={};return i.volumeNode=Ar.createGain(),Ar.createStereoPanner?i.panNode=Ar.createStereoPanner():i.panNode=Ar.createPanner(),i.delayNode=Ar.createDelay(),i.feedbackNode=Ar.createGain(),i.filterNode=Ar.createBiquadFilter(),i.convolverNode=Ar.createConvolver(),i.soundNode=null,i.buffer=null,i.source=e,i.loop=!1,i.playing=!1,i.loadHandler=void 0,i.panValue=0,i.volumeValue=1,i.startTime=0,i.startOffset=0,i.playbackRate=1,i.echo=!1,i.delayValue=.3,i.feebackValue=.3,i.filterValue=0,i.reverb=!1,i.reverbImpulse=null,i.play=function(){i.startTime=Ar.currentTime,i.soundNode=Ar.createBufferSource(),i.soundNode.buffer=i.buffer,i.soundNode.playbackRate.value=this.playbackRate,i.soundNode.connect(i.volumeNode),!1===i.reverb?i.volumeNode.connect(i.panNode):(i.volumeNode.connect(i.convolverNode),i.convolverNode.connect(i.panNode),i.convolverNode.buffer=i.reverbImpulse),i.panNode.connect(Ar.destination),i.echo&&(i.feedbackNode.gain.value=i.feebackValue,i.delayNode.delayTime.value=i.delayValue,i.filterNode.frequency.value=i.filterValue,i.delayNode.connect(i.feedbackNode),i.filterValue>0?(i.feedbackNode.connect(i.filterNode),i.filterNode.connect(i.delayNode)):i.feedbackNode.connect(i.delayNode),i.volumeNode.connect(i.delayNode),i.delayNode.connect(i.panNode)),i.soundNode.loop=i.loop,i.soundNode.start(0,i.startOffset%i.buffer.duration),i.playing=!0},i.pause=function(){i.playing&&(i.soundNode.stop(0),i.startOffset+=Ar.currentTime-i.startTime,i.playing=!1)},i.restart=function(){i.playing&&i.soundNode.stop(0),i.startOffset=0,i.play()},i.playFrom=function(e){i.playing&&i.soundNode.stop(0),i.startOffset=e,i.play()},i.setEcho=function(e,t,n){void 0===e&&(e=.3),void 0===t&&(t=.3),void 0===n&&(n=0),i.delayValue=e,i.feebackValue=t,i.filterValue=n,i.echo=!0},i.setReverb=function(e,t,n){void 0===e&&(e=2),void 0===t&&(t=2),void 0===n&&(n=!1),i.reverbImpulse=function(e,t,n,r){for(var o=r.sampleRate*e,i=r.createBuffer(2,o,r.sampleRate),a=i.getChannelData(0),s=i.getChannelData(1),l=0;l<o;l++){var u;u=n?o-l:l,a[l]=(2*Math.random()-1)*Math.pow(1-u/o,t),s[l]=(2*Math.random()-1)*Math.pow(1-u/o,t)}return i}(e,t,n,Ar),i.reverb=!0},i.fade=function(e,t){i.playing&&(i.volumeNode.gain.linearRampToValueAtTime(i.volumeNode.gain.value,Ar.currentTime),i.volumeNode.gain.linearRampToValueAtTime(e,Ar.currentTime+t))},i.fadeIn=function(e){i.volumeNode.gain.value=0,i.fade(1,e)},i.fadeOut=function(e){i.fade(0,e)},Object.defineProperties(i,{volume:{get:function(){return i.volumeValue},set:function(e){i.volumeNode.gain.value=e,i.volumeValue=e},enumerable:!0,configurable:!0},pan:{get:function(){return Ar.createStereoPanner?i.panNode.pan.value:i.panValue},set:function(e){if(Ar.createStereoPanner)i.panNode.pan.value=e;else{var t=e,n=1-Math.abs(t);i.panNode.setPosition(t,0,n),i.panValue=e}},enumerable:!0,configurable:!0}}),n&&function(e,t,n,r){var o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer",o.addEventListener("load",Cr.bind(this,e,o,n,r)),o.send()}(i,e,t,o),r&&Cr(i,r,t,o),i}function Cr(e,t,n,r){Ar.decodeAudioData(t.response,(function(t){e.buffer=t,e.hasLoaded=!0,n&&n(e.source)}),(function(t){r&&r(e.source,t)}))}const Or={},Tr={};class Fr{constructor(e,t){null!=Tr[e]?(this.onLoaded=void 0,this.__sound=Sr(`asset/${e}`,null,!1,null,null),this.__sound.buffer=Tr[e].__sound.buffer,this.__name=e):(this.onLoaded=void 0,this.__sound=Sr(`asset/${e}`,(()=>{Tr[this.__name]=this,this.onLoaded&&this.onLoaded(),t&&t()}),!0),this.__name=e)}play(e,t,n){if(0!=Fr.initialized)return this.__sound.buffer?(this.__sound.loop=t,null!=e?this.__sound.playFrom(e/1e3):this.__sound.play()):this.onLoaded=()=>{this.play(e,t,n),this.onLoaded=void 0},this}setVolume(e){this.__sound.volume=e}setPitch(e){this.__sound.playbackRate=e}isPlaying(){return this.__sound.playing}setPaused(e){e?this.__sound.pause():this.play()}setPosition(e){this.__sound.playing?(this.__sound.soundNode.stop(0),this.__sound.startOffset=e,this.__sound.play()):this.__sound.startOffset=e}stop(){this.__sound.pause(),this.__sound.startOffset=0}getLength(){throw new Error("Not implemented")}static playSound(e){return new Fr(e).play()}static playSingleSound(e,t,n,r=e){null==Or[r]?Or[r]=new Fr(e):Or[r].__name!=e&&(Or[r].stop(),Or[r]=new Fr(e)),1!=Or[r].isPlaying()&&(Or[r].setVolume(t),Or[r].play(0,n))}static stopAllSingleSound(){for(const e in Or)Or[e].stop()}static init(){let e=Ar.createOscillator();e.start(0),e.stop(0),Fr.initialized=!0,console.log("Sound initialized.")}}Fr.initialized=!1;class Pr{constructor(e,t,n){this.id=e,this.type=n,this.name=t,this.shared={},this.instanced={}}release(){Ir.release(this.id)}}Pr.AssetTypes={Texture:"Texture",RenderTarget:"RenderTarget",Sound:"Sound",Shader:"Shader",TrueTypeFont:"TrueTypeFont",MsdfFont:"MsdfFont",BitmapFont:"BitmapFont",PostProcessFilter:"PostProcessFilter"};null==self._assetManager&&(self._assetManager=new class{constructor(){this.assetsById=new Map,this.assetsByName=new Map,this.releaseQueue=[]}get(e){return this.assetsById.get(e)}readShared(e,t){const n=this.assetsById.get(e);return null!=n?n.shared[t]:null}readInstanced(e,t){const n=this.assetsById.get(e);return null!=n?n.instanced[t]:null}_loadRenderTarget(e,t,n){t.worldMatrix;const o=t.filter?t.gl.LINEAR:t.gl.NEAREST;if(e.shared.renderTarget={frameBufferInfo:fr(t.gl,[{format:t.gl.RGBA,minMag:o}],1*t.width,1*t.height),renderingQueue:[],viewMatrix:Oe.translate(Oe.scaling([1/t.width*2,1/t.height*2,1,1]),[-t.width/2,-t.height/2,0,0])},e.shared.texture=e.shared.renderTarget.frameBufferInfo.attachments[0],e.shared.width=t.width,e.shared.height=t.height,t.worldMatrix){const n=t.x,o=t.y,i=t.width,a=t.height,s=new r(0,0,i,a);e.shared.renderTarget.viewMatrix=Oe.multiply(e.shared.renderTarget.viewMatrix,Oe.inverse(Oe.multiply(t.worldMatrix,Oe.translation([n,o,0])))),e.shared.bufferInfo=qe(t.gl,{a_position:{divisor:0,numComponents:2,data:new Float32Array([n,o,n+i,o,n,o+a,n+i,o+a])},a_texCoord:{divisor:0,numComponents:2,data:s.getCornerPoints()},a_color:{divisor:0,numComponents:4,data:new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255])},indices:{divisor:0,numComponents:3,data:new Uint16Array([0,1,2,1,3,2])}})}return e}_loadTexture(e,t,n){if(e.shared.texture)return e;const r=t.filter?t.gl.LINEAR:t.gl.NEAREST;return e.shared.texture=gn(t.gl,{src:"asset/"+e.name,minMag:r},t.callback),e.shared.width=t.width,e.shared.height=t.height,e}_loadShader(e,t,n){if(null!=t.copyFrom&&(e.shared=this.assetsById.get(t.copyFrom).shared),null!=t.vertexSrc||null!=t.fragmentSrc?e.shared.programInfo=nr(t.gl,[t.vertexSrc||ao.defaultVertexShader,t.fragmentSrc||ao.defaultFragmentShader]):n&&(e.instanced=n.instanced),e.instanced.uniforms=e.instanced.uniforms||{},Object.assign(e.instanced.uniforms,t.constants),t.textures){const n={};for(let e in t.textures){const r=this.assetsById.get(t.textures[e]);n[e]=r.shared.texture}Object.assign(e.instanced.uniforms,n)}return e}_loadSound(e,t,n){return this.assetsById.has(e.id)&&Ir.release(e.id),e.instanced.sound=new Fr(e.name,t.callback),e}_prepareStyles(e,t,n,r){if(e.shared.styles={default:{fontFamily:t,fontSize:n,lineHeight:n,fill:16777215}},null!=r&&"object"==typeof r){Object.assign(e.shared.styles,r);for(let t in e.shared.styles)if("default"!=t){const n=Object.assign({},e.shared.styles.default);Object.assign(n,e.shared.styles[t]),e.shared.styles[t]=n}}}_loadTrueTypeFont(e,t,n){const r=e.name.replace("/","_").replace(".","_");if(!e.shared.fontFamily){const n=new FontFace(r,`url(asset/${e.name})`);console.log(`Font loading... ${e.name}`),n.load().then((n=>{document.fonts.add(n),t.callback(),console.log(`Font loaded ${e.name}`)}),(e=>{console.log(e)}))}return this._prepareStyles(e,r,t.referenceSize,t.styles),e}_loadBitmapFont(e,t,n){if(e.shared.texture)return e;const r=t.filter?t.gl.LINEAR:t.gl.NEAREST;e.shared.texture=gn(t.gl,{src:"asset/"+t.bitmap,minMag:r},t.callback),e.shared.fontInfo=t.fontInfo,e.shared.width=t.width,e.shared.height=t.height;const o=e.name.replace("/","_").replace(".","_");return this._prepareStyles(e,o,t.referenceSize,t.styles),e}_loadMsdfFont(e,t,n){if(e.shared.texture)return e;e.shared.texture=gn(t.gl,{src:"asset/"+t.bitmap,minMag:t.gl.LINEAR},t.callback),e.shared.fontInfo=t.fontInfo,e.shared.width=t.width,e.shared.height=t.height;const r=e.name.replace("/","_").replace(".","_");return this._prepareStyles(e,r,t.referenceSize,t.styles),e}load(e,t,n){const r=this.assetsByName.get(e.name);r&&(e.shared=r.shared,e.instanced=Object.assign({},r.instanced)),e.type==Pr.AssetTypes.RenderTarget?e=this._loadRenderTarget(e,t,r):e.type==Pr.AssetTypes.Texture?e=this._loadTexture(e,t,r):e.type==Pr.AssetTypes.Shader?e=this._loadShader(e,t,r):e.type==Pr.AssetTypes.Sound?e=this._loadSound(e,t,r):e.type==Pr.AssetTypes.TrueTypeFont?e=this._loadTrueTypeFont(e,t,r):e.type==Pr.AssetTypes.MsdfFont?e=this._loadMsdfFont(e,t,r):e.type==Pr.AssetTypes.BitmapFont&&(e=this._loadBitmapFont(e,t,r)),this.assetsById.set(e.id,e),this.assetsByName.set(e.name,e)}release(e){const t=this.assetsById.get(e);this.assetsByName.delete(t.name),this.assetsById.delete(e)}});const Ir=self._assetManager,Mr={AsyncValue:class{constructor(){this.value=void 0,this.promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t}))}resolve(e){this.value=e,this._resolve(e),delete this.promise,delete this._resolve,delete this._reject}reject(e){this._reject(e),delete this.promise,delete this._resolve,delete this._reject}},nullReplace:(e,t)=>null!=e?e:t,random:(e,t)=>(console.assert(null==e&&null==t||null!=e&&null!=t,`random(${e},${t}) 구문은 허용되지 않음. random(1,a) 혹은 random(0,a)를 명확히 쓸 것`),null==t?Math.floor(Math.random()*e+1):null==e?Math.random():Math.floor(Math.random()*(t-e+1)+e)),precision:(e,t)=>parseFloat(e).toPrecision(t),idiv:(e,t)=>e/t>>0,lerp:(e,t,n)=>e+(t-e)*n,clamp:(e,t,n)=>Math.min(Math.max(e,t),n),distance:(e,t,n,r)=>Math.sqrt((n-e)*(n-e)+(r-t)*(r-t)),frac:e=>e%1,legacy(e=""){},notImplements(e=""){},getEmbeddedFile:e=>(console.assert(null!=self._embeddedFiles[e.toLowerCase()]),self._embeddedFiles[e]),getEmbeddedBinaryFile(e){console.assert(null!=self._embeddedFiles[e.toLowerCase()]);const t=self._embeddedFiles[e.toLowerCase()],n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r=[];for(let e=0;e<t.length;){const o=n.indexOf(t.charAt(e++)),i=n.indexOf(t.charAt(e++)),a=n.indexOf(t.charAt(e++)),s=n.indexOf(t.charAt(e++)),l=o<<2|i>>4,u=(15&i)<<4|a>>2,c=(3&a)<<6|s;r.push(l),64!=a&&r.push(u),64!=s&&r.push(c)}return new Uint8Array(r)},embeddedFileExist:e=>null!=self._embeddedFiles[e],getEmbeddedXmlFile:e=>(new window.DOMParser).parseFromString(Mr.getEmbeddedFile(e),"text/xml"),getImageSize:e=>self._imageSizes[e.toLowerCase()]||{width:0,height:0},splitStringWithTag(e){const t=/<([^>]+)>/g,n=["default"],r=[];let o=0;for(;;){const i=t.exec(e),a=n[n.length-1];if(null==i)return o<e.length&&r.push([a,e.substring(o)]),r;{const s=i[1],l=i.index;"/"!=s[0]?n.push(s):a==s.substring(1)&&n.length--,o!=l&&r.push([a,e.substring(o,l)]),o=t.lastIndex}}},hex2rgba(e,t){const n=[];return n[0]=((16711680&e)>>16)/255,n[1]=((65280&e)>>8)/255,n[2]=(255&e)/255,n[3]=null!=t?t:((4278190080&e)>>24)/255,n},rgba2hex(e,t){const n=t||0;return 255*e[n]<<16|255*e[n+1]<<8|255*e[n+2]|255*e[n+3]<<24},angleToDir(e){let t;return t=-135<e&&e<=-45?1:-45<e&&e<=45?2:45<e&&e<=135?3:4,t},dirToOffset(e){let t,n;return 1==e?[t,n]=[0,-1]:2==e?[t,n]=[1,0]:3==e?[t,n]=[0,1]:4==e&&([t,n]=[-1,0]),[t,n]},filterAttrib(e,t,n){const r=null!=t?Array.isArray(t)?","+t.join(",")+",":","+t+",":",*,",o=null!=n?Array.isArray(n)?","+n.join(",")+",":","+n+",":"",i=null!=e?Array.isArray(e)?e:e.split(","):[];let a;if(o.indexOf(",*,")>=0)return!1;if(r.indexOf(",*,")>=0)a=!0;else{if(!(i.length>0))return!1;for(const e of i)if(r.indexOf(","+e+",")>=0){a=!0;break}}if(a){for(const e of i)if(o.indexOf(","+e+",")>=0)return!1;return!0}return!1},format(e,...t){let n;if(t.length>0){let r=0;n=e.replace(/%[s|d]/g,(function(e){return"%"+r++}));for(let e=0;e<t.length;e++)n=n.replace(`%${e}`,t[e])}else n=e;return n},isNode:()=>"object"==typeof{env:{}}&&"object"==typeof{env:{}}.versions&&void 0!=={env:{}}.versions.node,isWebWorker(){return!this.isNode()&&"undefined"!=typeof WorkerGlobalScope&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator},clearObject(e){const t=Object.keys(e);for(let n=0,r=t.length;n<r;n++)delete e[t[n]]}},Rr={1:"BitmapDecoder",2:"MeshDecoder",3:"TextFieldDecoder",4:"PixelDecoder",5:"ShapeDecoder"},kr={decode(e){let t=e[0],n=e[1],r=e[2],o=e[3],a=e[4];const s=t[0],l=t[1],u=t[2],c=t.subarray(3,7),d=t.subarray(7,11),f=t.subarray(11,13),h=t[13],p=t.subarray(14,30),m={spriteType:l,updateCode:u,clipRegion:t.subarray(30,34),cacheBitmapSrcId:t[34],cacheBitmapDstId:t[35],blendMode:t[36],motionBlur:t[37]};if(m.uniforms={u_anchor:f,u_colorOverride:c,u_colorAdd:d,u_worldMatrix:p},0!=l&&1&u&&(console.assert(null!=Rr[l],`정의되지 않은 스프라이트 타입(${l})`),kr[Rr[l]].call(this,s,n,r,a,m)),4&u&&(m.customPrev={u_colorOverride:i.subarray(o,0,4),u_anchor:i.subarray(o,4,2),u_worldMatrix:i.subarray(o,6,16)}),h>0){const e=Ir.get(h);m.programInfo=e.shared.programInfo,Object.assign(m.uniforms,e.instanced.uniforms)}return[s,m]},BitmapDecoder(e,t,n,r,o){const i=t[0],a=Ir.readShared(i,"texture"),s=Ir.readShared(i,"width")||0,l=Ir.readShared(i,"height")||0,u=t.subarray(1,9),c=u[2]-u[0],d=u[5]-u[1];o.bufferInfo={a_position:{divisor:0,numComponents:2,data:new Float32Array([0,0,c,0,0,d,c,d])},a_texCoord:{divisor:0,numComponents:2,data:u},a_color:{divisor:0,numComponents:4,data:new Uint8Array([255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255])},indices:{divisor:0,numComponents:3,data:new Uint16Array([0,1,2,1,3,2])}},o.uniforms.u_texture=a,o.uniforms.u_textureSize=[s,l]},MeshDecoder(e,t,n,r,o){const[a,s,l,u,c,d,f,h,p,m,_,g,b,y]=t,v=Ir.readShared(a,"texture"),x=Ir.readShared(a,"width")||0,w=Ir.readShared(a,"height")||0;o.bufferInfo={};let E=14;if(l>0&&(o.bufferInfo.a_position={divisor:0,numComponents:2,data:i.subarray(t,E,l)},o.bufferInfo.a_position._offset=s,o.bufferInfo.a_position._keepBuffer=!_,E+=l),c>0&&(o.bufferInfo.a_texCoord={divisor:0,numComponents:2,data:i.subarray(t,E,c)},o.bufferInfo.a_texCoord._offset=u,o.bufferInfo.a_texCoord._keepBuffer=!g,E+=c),f>0&&(o.bufferInfo.a_color={divisor:0,numComponents:4,data:i.Float32ToUint8(t,E,Math.ceil(f/4))},o.bufferInfo.a_color._offset=d,o.bufferInfo.a_color._keepBuffer=!b,E+=f/4),p>0&&(o.bufferInfo.indices={divisor:0,numComponents:3,data:i.Float32ToUint16(t,E,Math.ceil(p/2))},o.bufferInfo.indices._offset=h,o.bufferInfo.indices._keepBuffer=!y),r)for(let e in r){const t=r[e];t.divisor=0,o.bufferInfo[e]=t}v?(o.uniforms.u_texture=v,o.uniforms.u_textureSize=[x,w],o.programInfo=this.shaders.default):o.programInfo=this.shaders.withoutTexture},PixelDecoder(e,t,n,r,o){const i=t[0],a=t[1],s=t.subarray(2,6).map((e=>255*e)),l=new Uint8Array(16);l.set(s,0),l.set(s,4),l.set(s,8),l.set(s,12),o.bufferInfo={a_position:{divisor:0,numComponents:2,data:[0,0,i,0,0,a,i,a]},a_color:{divisor:0,numComponents:4,data:l},indices:{divisor:0,numComponents:3,data:new Uint16Array([0,1,2,1,3,2])}},o.programInfo=this.shaders.withoutTexture},ShapeDecoder(e,t,n,r,o){const i=t[0],a=t.subarray(1,5),s=t.subarray(5,9),l=t[9],u=[],c=[],d=[];if(s[3]>0)for(let e=0,n=10;e<l;e++){const e=t[n],r=t.subarray(n+1,n+1+e),o=yr().Triangulate(Array.from(r)),i=new Float32Array(4*r.length/2);for(let e=0;e<r.length/2;e++)i[4*e]=255*s[0],i[4*e+1]=255*s[1],i[4*e+2]=255*s[2],i[4*e+3]=255*s[3];c.push(...o),u.push(...r),d.push(...i),n+=e}if(a[3]>0&&i>0)for(let e=0,n=10;e<l;e++){const e=t[n],[r,o]=Er.build(t.subarray(n+1,n+1+e),i),s=[];for(let e=0;e<r.length/2;e++)s[4*e]=255*a[0],s[4*e+1]=255*a[1],s[4*e+2]=255*a[2],s[4*e+3]=255*a[3];c.push(...o.map((e=>e+u.length/2))),u.push(...r),d.push(...s),n+=e}o.bufferInfo={a_position:{divisor:0,numComponents:2,data:u},a_color:{divisor:0,numComponents:4,data:new Uint8Array(d)},indices:{divisor:0,numComponents:3,data:new Uint16Array(c)}},o.programInfo=this.shaders.withoutTexture},TextFieldDecoder(e,t,n,r,o){const i=this.logicalViewportScale.x,a=t[0],s=0!=t[1],l=Ir.get(a);if(l.type==Pr.AssetTypes.BitmapFont||l.type==Pr.AssetTypes.MsdfFont){const e=Mr.splitStringWithTag(n[0]),t=l.shared.texture,r=l.shared.width,i=l.shared.height,a=[],s=[],u=[],c=[],d=l.shared.fontInfo;let f=0,h=0,p=0;for(let[t,n]of e){const e=l.shared.styles[t],r=e.fontSize/d.info.size,o=null==e.fill?16777215:e.fill,i=255&o,m=o>>8&255,_=o>>16&255,g=255;for(let e=0;e<n.length;e++){const t=n.charCodeAt(e),o=d.chars[t];a.push(f+o.xoffset*r,h+o.yoffset*r,f+(o.xoffset+o.width)*r,h+o.yoffset*r,f+o.xoffset*r,h+(o.yoffset+o.height)*r,f+(o.xoffset+o.width)*r,h+(o.yoffset+o.height)*r),s.push(o.x,o.y,o.x+o.width,o.y,o.x,o.y+o.height,o.x+o.width,o.y+o.height),u.push(_,m,i,g,_,m,i,g,_,m,i,g,_,m,i,g),c.push(p,p+1,p+2,p+1,p+3,p+2),f+=o.xadvance*r,p+=4}}o.bufferInfo={a_position:{divisor:0,numComponents:2,data:a},a_texCoord:{divisor:0,numComponents:2,data:s},a_color:{divisor:0,numComponents:4,data:new Uint8Array(u)},indices:{divisor:0,numComponents:3,data:new Uint16Array(c)}},o.uniforms.u_texture=t,o.uniforms.u_textureSize=[r,i],l.type==Pr.AssetTypes.MsdfFont&&(o.programInfo=this.shaders.msdf)}else{const e=document.createElement("canvas").getContext("2d"),t=Mr.splitStringWithTag(n[0]),r=[],a=[],u=[],c=[];let d=0,f=0,h=0;for(let[n,r]of t){const t=l.shared.styles[n],o=`${t.fontSize*i}px ${t.fontFamily}`;e.font=o;const a=e.measureText(r);console.log(n,r),d+=a.width,f=Math.max(f,Math.ceil(a.actualBoundingBoxAscent+a.actualBoundingBoxDescent))}e.canvas.width=d,e.canvas.height=f;for(let[n,o]of t){const t=l.shared.styles[n],d=`${t.fontSize*i}px ${t.fontFamily}`;e.font=d;const p=e.measureText(o);e.font=d,e.fillStyle="white",e.textAlign="left",e.textBaseline="alphabetic",e.fillText(o,h,p.actualBoundingBoxAscent);const m=p.width,_=f,g=s?-p.actualBoundingBoxAscent/i:t.lineHeight-p.actualBoundingBoxAscent/i,b=r.length/2,y=null==t.fill?16777215:t.fill,v=255&y,x=y>>8&255,w=y>>16&255,E=255;console.log(w,x,v,E,b,o),r.push(h/i,g,(h+m)/i,g,h/i,g+_/i,(h+m)/i,g+_/i),a.push(h,0,h+m,0,h,_,h+m,_),u.push(w,x,v,E,w,x,v,E,w,x,v,E,w,x,v,E),c.push(b,b+1,b+2,b+1,b+2,b+3),h+=p.width}let p=gn(this.gl,{src:e.canvas,format:this.gl.ALPHA,color:[1,1,1,1],mag:this.gl.LINEAR});o.bufferInfo={a_position:{divisor:0,numComponents:2,data:r},a_texCoord:{divisor:0,numComponents:2,data:a},a_color:{divisor:0,numComponents:4,data:new Uint8Array(u)},indices:{divisor:0,numComponents:3,data:new Uint16Array(c)}},o.uniforms.u_texture=p,o.uniforms.u_textureSize=[d,f]}}};class Br{constructor(...e){this.Renderer=new Lr(...e),this.Application=new Dr(...e),this.RenderTarget=new Ur(...e),this.Asset=new Vr(...e),this.Sound=new jr(...e),this.Sprite=new zr(...e)}}class Nr{constructor(e){this.renderer=e}}class Lr extends Nr{drawStage(e){this.renderer.drawStage(e)}}class Dr extends Nr{setBackgroundColor(e){this.renderer.setBackgroundColor(e)}setLogicalViewport(e,t){this.renderer.setLogicalViewport(e,t)}setUpdateFPS(e){this.renderer.setUpdateFPS(e)}}class Ur extends Nr{draw(e,t){const n=Ir.get(e).shared.renderTarget;n.renderingQueue.splice(0,n.renderingQueue.length),null!=t&&(this.renderer.decodeReceivedRenderingInfo(t,n.renderingQueue,this.renderer.renderingInfos),this.renderer.render(n.renderingQueue,n.frameBufferInfo,n.viewMatrix,!1,1))}clear(e,t){const n=this.renderer.gl;hr(n,Ir.get(e).shared.renderTarget.frameBufferInfo),n.clearColor(t[0],t[1],t[2],t[3]),n.clear(n.COLOR_BUFFER_BIT)}}class Vr extends Nr{load(e){e.extraData=e.extraData||{},e.extraData.gl=this.renderer.gl,e.extraData.renderer=this.renderer,e.extraData.callback=()=>{this.renderer.appLoader.gameWorker.postMessage({msg:"Asset_loadCompleted",id:e.id})},Ir.load(new Pr(e.id,e.name,e.type),e.extraData,this.renderer.logicFrame)}release(e){Ir.release(e)}}class zr extends Nr{release(e){let t=this.renderer.renderingInfos[e];if(t){let e=t.bufferInfo;if(e){this.renderer.gl.deleteBuffer(e.indices);for(let t in e.attribs)this.renderer.gl.deleteBuffer(e.attribs[t].buffer)}}delete this.renderer.renderingInfos[e]}}class jr extends Nr{play(e,t,n,r){Ir.get(e).instanced.sound.play(t,n,r)}setVolume(e,t){Ir.get(e).instanced.sound.setVolume(t)}setPitch(e,t){Ir.get(e).instanced.sound.setPitch(t)}setPaused(e,t){Ir.get(e).instanced.sound.setPaused(t)}setPosition(e,t){Ir.get(e).instanced.sound.setPosition(t)}stop(e){Ir.get(e).instanced.sound.stop()}playSingleSound(e,t,n,r){Fr.playSingleSound(e,t,n,r)}stopAllSingleSound(){Fr.stopAllSingleSound()}}const Hr="precision mediump float;\r\n\r\n#define PI 3.1415926535897932384626433832795\r\n#define MOTION_BLUR_THRESHOLD 1.0\r\n\r\n\r\nconst bool useDiscard = true;\r\n\r\n#ifndef NO_TEXTURE\r\n    attribute vec2 a_texCoord;\r\n    varying vec2 v_texCoord;\r\n#endif\r\n\r\n\r\n    uniform mat4 u_viewMatrix;\r\n    uniform mat4 u_worldMatrixPrev;\r\n    uniform mat4 u_worldMatrix;\r\n    uniform vec2 u_anchorPrev;\r\n    uniform vec2 u_anchor;\r\n    uniform vec4 u_colorOverridePrev;\r\n    uniform vec4 u_colorOverride;\r\n    uniform float u_alphaMod;\r\n    uniform float u_alphaMod2;\r\n    uniform float u_logicPerRenderFrame;\r\n    uniform float u_subRenderFrame;\r\n\r\n    attribute vec2 a_position;\r\n    attribute vec4 a_color;\r\n    attribute float a_blendFactor;\r\n\r\n    varying float v_discardAll;\r\n    varying vec4 v_colorOverride;\r\n\r\n    varying float v_alphaCorrection;\r\n    uniform float u_alphaCorrection;\r\n\r\n\r\n//decomposing code from\r\n//https://github.com/deoxxa/transformation-matrix-js/blob/master/src/matrix.js\r\n\r\n\r\nstruct Transform {\r\n    vec2 position;\r\n    vec2 scale;\r\n    vec2 skew;\r\n    float rotation;\r\n};\r\n\r\nTransform decompose(mat4 mat) {\r\n    Transform result;\r\n\tfloat a = mat[0].x;\r\n    float b = mat[0].y;\r\n    float c = mat[1].x;\r\n    float d = mat[1].y;\r\n\r\n    float rotation = 0.0;\r\n    vec2 scale = vec2(1.0, 1.0);\r\n    vec2 skew = vec2(0.0, 0.0);\r\n\r\n    float determ = a * d - b * c;\t// determinant(), skip DRY here...\r\n\r\n    if(a != 0.0 || b != 0.0) {\r\n        float r = sqrt(a * a + b * b);\r\n        rotation = b > 0.0 ? acos(a / r) : -acos(a / r);\r\n        scale = vec2(r, determ / r);\r\n        skew.x = atan((a * c + b * d), (r * r));\r\n    } else if(c != 0.0 || d != 0.0) {\r\n        float s = sqrt(c * c + d * d);\r\n        rotation = PI * 0.5 - (d > 0.0 ? acos(-c / s) : -acos(c / s));\r\n        scale = vec2(determ / s, s);\r\n        skew.y = atan((a * c + b * d), (s * s));\r\n    } else { // a = b = c = d = 0\r\n        scale = vec2(0.0, 0.0);\t\t// = invalid matrix\r\n    } \r\n    result.scale = scale;\r\n    result.rotation = rotation;\r\n    result.skew = skew;\r\n    result.position = mat[3].xy;\r\n    return result;\r\n}\r\n\r\n\r\nvoid main() {\r\n\r\n    vec4 pos = vec4(a_position.xy,1,1);\r\n    float abf = a_blendFactor;\r\n    float bf = (a_blendFactor+u_subRenderFrame) / max(1.0,u_logicPerRenderFrame);\r\n    mat4 matrix1 = u_worldMatrixPrev;\r\n    mat4 matrix2 = u_worldMatrix;\r\n\r\n#ifndef NO_TEXTURE\r\n    v_texCoord = a_texCoord;\r\n#endif\r\n\r\n    Transform t1 = decompose(matrix1);\r\n    Transform t2 = decompose(matrix2);\r\n    Transform t;\r\n\r\n    float dist = length(matrix1[3].xy - matrix2[3].xy);\r\n    bool isNotMoved = bf>=1.0 || (dist<=MOTION_BLUR_THRESHOLD && t1.scale == t2.scale && t1.rotation == t2.rotation);\r\n\r\n\r\n    if(isNotMoved) {\r\n        if (useDiscard && abf!=0.5) {\r\n            v_discardAll = 1.0;\r\n            gl_Position = vec4(0);\r\n            return;\r\n        } else {\r\n            v_colorOverride = u_colorOverride;\r\n            t.position = t2.position;\r\n            t.rotation = t2.rotation;\r\n            t.scale = t2.scale;\r\n            t.skew = t2.skew;\r\n            v_alphaCorrection = 0.0;\r\n        }\r\n    } else {\r\n        float alpha = 1.0 - abs(abf - 0.5) * 2.0;\r\n        v_colorOverride = mix(u_colorOverridePrev, u_colorOverride, bf);\r\n        t.position = mix(t1.position, t2.position, bf);\r\n        t.rotation = mix(t1.rotation, t2.rotation, bf);\r\n        t.scale = mix(t1.scale, t2.scale, bf);\r\n        t.skew = mix(t1.skew, t2.skew, bf);\r\n        v_alphaCorrection = u_alphaCorrection;\r\n    }\r\n    v_colorOverride *= a_color;\r\n    v_discardAll = 0.0;\r\n\r\n    mat4 posMat = mat4(1);\r\n    mat4 scaleMat = mat4(1);\r\n    mat4 rotMat = mat4(1);\r\n    mat4 shearMat = mat4(1);\r\n    mat4 anchorMat = mat4(1);\r\n\r\n    anchorMat[3].xy = -mix(u_anchorPrev,u_anchor,bf);\r\n    posMat[3].xy = t.position;\r\n    shearMat[0].y = -t.skew.x;\r\n    shearMat[1].x = t.skew.y;\r\n    scaleMat[0].x = t.scale.x;\r\n    scaleMat[1].y = t.scale.y;    \r\n    rotMat[0].x = cos(t.rotation);\r\n    rotMat[0].y = sin(t.rotation);\r\n    rotMat[1].x = -sin(t.rotation);\r\n    rotMat[1].y = cos(t.rotation);\r\n\r\n    gl_Position = u_viewMatrix * posMat * shearMat * scaleMat * rotMat * anchorMat * pos;\r\n\r\n}\r\n",Wr="precision mediump float;\r\n\r\n#define PI 3.1415926535897932384626433832795\r\n\r\n#ifndef NO_TEXTURE\r\n\r\n    uniform sampler2D u_texture;\r\n    uniform vec2 u_textureSize;\r\n    varying vec2 v_texCoord;\r\n\r\n#endif\r\n\r\n    uniform vec4 u_colorAdd;\r\n\r\n    varying float v_discardAll;\r\n    varying vec4 v_colorOverride;\r\n    varying float v_alphaCorrection;\r\n\r\nvoid main() {\r\n    if(v_discardAll != 0.0) discard;\r\n\r\n#ifndef NO_TEXTURE\r\n    vec4 c = texture2D(u_texture,v_texCoord / u_textureSize);\r\n#else\r\n    vec4 c = vec4(1.0,1.0,1.0,1.0);\r\n#endif\r\n    c += u_colorAdd;\r\n    c *= v_colorOverride;\r\n    \r\n    // 모션블러된 값을 보정하는 식\r\n    // 정확한 값을 구하는 것은 어렵고 근사치를 사용한다.\r\n    // 모션블러 9개 그리는 것을 기준으로 구한 값\r\n    // c.a *= 1.0 + (0.23/(1.18 - c.a) - 1.0)*v_alphaCorrection;\r\n    // 모션블러 15개 기준\r\n    // https://www.wolframalpha.com/input/?i=0.09%2F%281.5-X%29-1.0\r\n\r\n    c.a *= 1.0 + (0.09 / (1.5 - c.a) - 1.0) * v_alphaCorrection;\r\n    c.rgb *= c.a;\r\n    gl_FragColor = c;\r\n}\r\n",Gr=15,Xr=new Float32Array(Gr);Xr[0]=.5;for(let e=0;e<7;e++)Xr[2*(7-e)-1]=(e+.5)/Gr,Xr[2*(7-e)]=(Gr-e-.5)/Gr;const Yr={default:null,withoutTexture:null,msdf:null},[$r,Qr,qr,Kr,Jr,Zr,eo,to,no,ro]=[0,1,768,769,770,771,772,773,774,775],oo={0:[1,[Qr,Zr,Qr,Zr]],1:[1,[no,Zr,no,Zr]],2:[1.025,[Qr,eo,Qr,eo]],3:[1,[Qr,Kr,Qr,Kr]],4:[1,[Jr,to,Qr,Zr]],5:[1,[Jr,eo,Qr,eo]],6:[1,[Jr,Kr,Qr,Kr]]};function io(e,t){e.blendEquation(e.FUNC_ADD),e.blendFuncSeparate(...oo[t][1])}class ao{constructor(e,t){var n;console.log("🎨 Renderer start."),this.appLoader=e,this.canvas=t,this.gl=t.getContext("webgl",{alpha:!1,depth:!1,antialias:!0,premultipliedAlpha:!1}),this.m4=Oe,function(e){for(let t=0;t<gr.length;++t)_r(e,gr[t])}(this.gl),this.multiplier=1,this.motionBlurBlendFactors=Xr,this.maxBufferedRenderingFrame=1,this.renderFPS=0,this.subRenderFrame=0,this.renderedFrame=0,this.logicFrame=0,this.lastLogicUpdateFrame=10,this.renderingQueue=[],this.renderingInfos={},this.compileBasicShaders(),this.shaders=Yr,this.renderTargets={},ke(n={textureColor:[0,0,0,0]},pr),function(e){ke(e,Ue)}(n),nn(n),this.logicalViewport=new r(0,0,0,0),this.logicalViewportOffset=new o(0,0),this.logicalViewportScale=new o(1,1),this.logicalRenderBounds=new r(0,0,0,0),this.scaleMode="NO_SCALE",this.viewMatrix=Oe.identity(),this.clearColor=[0,0,0,0],this.renderViewportScale=1,this.rendererPaused=!1,this.running=!1,this.engineDelegate=new Br(this),this.commandBuffer=[],this.commandQueue=[]}sendDeviceInfo(){this.appLoader.gameWorker.postMessage({msg:"deviceInfo",info:{deviceViewport:[0,0,this.deviceViewport.width,this.deviceViewport.height],logicalViewportOffset:this.logicalViewportOffset.xy,logicalViewportScale:this.logicalViewportScale.xy}})}get deviceViewport(){return new r(0,0,this.canvas.clientWidth,this.canvas.clientHeight)}calculateViewMatrix(){this.canvas;let e,t,n,r,o,i=this.deviceViewport.width,a=this.deviceViewport.height;switch(this.scaleMode){case"STRETCH":t=i/this.logicalViewport.width,n=a/this.logicalViewport.height,r=0,o=0;break;case"CENTER":case"NO_SCALE":t=1,n=1,"CENTER"==this.scaleMode?(r=.5*(i-this.logicalViewport.width*t),o=.5*(a-this.logicalViewport.height*n)):(r=0,o=0);break;case"CROP":case"LETTERBOX":{let e=i/a,s=this.logicalViewport.width/this.logicalViewport.height;"CROP"==this.scaleMode&&e<s||"LETTERBOX"==this.scaleMode&&e>s?(t=i/this.logicalViewport.width/e*s,n=a/this.logicalViewport.height,r=.5*(i-this.logicalViewport.width*t),o=0):(t=i/this.logicalViewport.width,n=a/this.logicalViewport.height*e/s,r=0,o=.5*(a-this.logicalViewport.height*n))}break;case"FIT_WIDTH":case"FIT_HEIGHT":{let e=i/a,s=this.logicalViewport.width/this.logicalViewport.height;"FIT_HEIGHT"==this.scaleMode?(t=i/this.logicalViewport.width/e*s,n=a/this.logicalViewport.height,r=.5*(i-this.logicalViewport.width*t),o=0):(t=i/this.logicalViewport.width,n=a/this.logicalViewport.height*e/s,r=0,o=.5*(a-this.logicalViewport.height*n))}}return this.logicalViewportScale.x=t,this.logicalViewportScale.y=n,this.logicalViewportOffset.x=r/t,this.logicalViewportOffset.y=o/n,this.logicalRenderBounds.x=-this.logicalViewportOffset.x,this.logicalRenderBounds.y=-this.logicalViewportOffset.y,this.logicalRenderBounds.width=this.logicalViewport.width+2*this.logicalViewportOffset.x,this.logicalRenderBounds.height=this.logicalViewport.height+2*this.logicalViewportOffset.y,e=Oe.translate(Oe.scaling([1/i*2*t,1/a*-2*n,1,1]),[(-i/2+r)/t,(-a/2+o)/n,0,0]),e}compileBasicShaders(){Yr.default||(Yr.default=nr(this.gl,[Hr,Wr]),Yr.withoutTexture=nr(this.gl,["#define NO_TEXTURE\n"+Hr,"#define NO_TEXTURE\n"+Wr]),Yr.msdf=nr(this.gl,[Hr,"#extension GL_OES_standard_derivatives : enable\r\n\r\nprecision mediump float;\r\n\r\n#define PI 3.1415926535897932384626433832795\r\n\r\nuniform sampler2D u_texture;\r\nuniform vec2 u_textureSize;\r\nvarying vec2 v_texCoord;\r\n\r\nuniform vec4 u_colorAdd;\r\n\r\nvarying float v_discardAll;\r\nvarying vec4 v_colorOverride;\r\nvarying float v_alphaCorrection;\r\n\r\nconst float distanceRange = 3.0;\r\n\r\nfloat median(float r, float g, float b) {\r\n    return max(min(r, g), min(max(r, g), b));\r\n}\r\n\r\nfloat getDistance(vec4 c) {\r\n    vec3 msdf = c.rgb;\r\n    return median(msdf.r, msdf.g, msdf.b);\r\n}\r\n\r\nfloat getOpacity(vec4 c) {\r\n    // 굵기\r\n    float v_weight=0.0;\r\n    float dist = getDistance(c) + min(v_weight, 0.5-1.0/distanceRange)-0.5;\r\n    float opacity = clamp(dist*distanceRange/length(fwidth(v_texCoord))+0.5,0.0,1.0);\r\n    return opacity;\r\n}\r\n\r\n\r\nvoid main() {\r\n    if(v_discardAll != 0.0) discard;\r\n\r\n    vec4 c = vec4(1.0,1.0,1.0,getOpacity( texture2D(u_texture,v_texCoord / u_textureSize) ));\r\n    // if (c.a<0.01) discard;\r\n    c += u_colorAdd;\r\n    c *= v_colorOverride;\r\n    \r\n    // 모션블러된 값을 보정하는 식\r\n    // 정확한 값을 구하는 것은 어렵고 근사치를 사용한다.\r\n    // 모션블러 9개 그리는 것을 기준으로 구한 값\r\n    // c.a *= 1.0 + (0.23/(1.18 - c.a) - 1.0)*v_alphaCorrection;\r\n    // 모션블러 15개 기준\r\n    c.a *= 1.0 + (0.09 / (1.5 - c.a) - 1.0) * v_alphaCorrection;\r\n    c.rgb *= c.a;\r\n    gl_FragColor = c;\r\n}\r\n"]))}setUpdateFPS(e){this.updateFPS=e}setLogicalViewport(e,t){this.logicalViewport=new r(e),this.scaleMode=t,this.calculateViewMatrix(),this.sendDeviceInfo()}get width(){return this.canvas.width}get height(){return this.canvas.height}run(){const e=[];let t=performance.now();this.running=!0;const n=()=>{const r=performance.now();this.running&&(this.lastLogicUpdateFrame>this.renderedFrame-10?(this.rendererPaused&&(console.log("😎 Renderer resumed."),this.rendererPaused=!1),this.appLoader.gameWorker.postMessage({msg:"render"})):this.lastLogicUpdateFrame==this.renderedFrame-10&&(console.log("😪 Renderer paused."),this.rendererPaused=!0)),e.push(r-t)>10&&e.shift(),t=r;const o=e.reduce(((e,t)=>e+t));this.renderFPS=Math.round(1e3/(o/e.length)),function(e,t){t=t||1,t=Math.max(0,t);const n=e.clientWidth*t|0,r=e.clientHeight*t|0;(e.width!==n||e.height!==r)&&(e.width=n,e.height=r)}(this.canvas,this.multiplier),this.viewMatrix=this.calculateViewMatrix(),this.executeCommandQueue(),this.render(this.renderingQueue,null,this.viewMatrix,!0,null),this.renderingQueue.length>0&&this.renderedFrame++,this.subRenderFrame<this.renderFPS/this.updateFPS-1&&this.subRenderFrame++,this.running&&requestAnimationFrame(n)};requestAnimationFrame(n)}flushRenderingInfo(){for(let e in this.renderingInfos){let t=this.renderingInfos[e];if(t.renderedFrame!=this.renderedFrame){let e=t.bufferInfo;if(e){this.gl.deleteBuffer(e.indices);for(let t in e.attribs)this.gl.deleteBuffer(e.attribs[t].buffer)}}}this.renderingInfos=this.renderedInfos,this.renderedInfos={}}decodeReceivedRenderingInfo(e,t,n){const r=performance.now(),o=[];for(let r in e){const i=e[r],[a,s]=kr.decode.call(this,i);o.push(performance.now()),t.push(a),null==n[a]&&(n[a]={renderedFrame:-1/0,programInfo:null,uniforms:{}});const l=n[a];if(s.bufferInfo)if(l.bufferInfo){const e=(e,t,n,r)=>{let o;return o=r.data.buffer?r.data:new t(r.data),1==r._keepBuffer?(this.gl.bindBuffer(e,n),this.gl.bufferSubData(e,r._offset*t.BYTES_PER_ELEMENT,o)):(n&&this.gl.deleteBuffer(n),n=this.gl.createBuffer(),this.gl.bindBuffer(e,n),this.gl.bufferData(e,o,this.gl.STATIC_DRAW)),n};s.bufferInfo.a_position&&(l.bufferInfo.attribs.a_position.buffer=e(this.gl.ARRAY_BUFFER,Float32Array,l.bufferInfo.attribs.a_position.buffer,s.bufferInfo.a_position)),s.bufferInfo.a_texCoord&&(l.bufferInfo.attribs.a_texCoord.buffer=e(this.gl.ARRAY_BUFFER,Float32Array,l.bufferInfo.attribs.a_texCoord.buffer,s.bufferInfo.a_texCoord)),s.bufferInfo.a_color&&(l.bufferInfo.attribs.a_color.buffer=e(this.gl.ARRAY_BUFFER,Uint8Array,l.bufferInfo.attribs.a_color.buffer,s.bufferInfo.a_color)),s.bufferInfo.indices&&(l.bufferInfo.indices=e(this.gl.ELEMENT_ARRAY_BUFFER,Uint16Array,l.bufferInfo.indices,s.bufferInfo.indices),1==s.bufferInfo.indices._keepBuffer&&(l.bufferInfo.numElements=s.bufferInfo.indices.data.length)),delete s.bufferInfo}else s.bufferInfo.a_blendFactor={divisor:1,numComponents:1,data:this.motionBlurBlendFactors},s.bufferInfo=qe(this.gl,s.bufferInfo);o.push(performance.now()),l.uniforms.u_worldMatrixPrev=l.uniforms.u_worldMatrix,l.uniforms.u_anchorPrev=l.uniforms.u_anchor,l.uniforms.u_colorOverridePrev=l.uniforms.u_colorOverride;const u=Object.assign(l.uniforms,s.uniforms);Object.assign(l,s),l.uniforms=u,0!=(4&l.updateCode)?(l.uniforms.u_worldMatrixPrev=l.customPrev.u_worldMatrix,l.uniforms.u_anchorPrev=l.customPrev.u_anchor,l.uniforms.u_colorOverridePrev=l.customPrev.u_colorOverride,console.assert(l.uniforms.u_worldMatrixPrev)):0!=(2&l.updateCode)?(l.uniforms.u_worldMatrixPrev=l.uniforms.u_worldMatrix,l.uniforms.u_anchorPrev=l.uniforms.u_anchor,l.uniforms.u_colorOverridePrev=l.uniforms.u_colorOverride):(l.uniforms.u_worldMatrixPrev=l.uniforms.u_worldMatrixPrev||l.uniforms.u_worldMatrix,l.uniforms.u_anchorPrev=l.uniforms.u_anchorPrev||l.uniforms.u_anchor,l.uniforms.u_colorOverridePrev=l.uniforms.u_colorOverridePrev||l.uniforms.u_colorOverride),null==l.programInfo&&(l.programInfo=this.shaders.default),o.push(performance.now())}const i=performance.now();i-r>5&&console.log("디코드 오래걸림 "+(i-r))}drawStage(e){this.renderingQueue.splice(0,this.renderingQueue.length),e&&this.decodeReceivedRenderingInfo(e,this.renderingQueue,this.renderingInfos)}setBackgroundColor(e){this.clearColor=e}executeCommand(e,t,n){this.engineDelegate[e][t](...n)}addCommand(e,t,n){this.commandBuffer.push([e,t,n])}updateLogic(e){this.commandBuffer.push(["Renderer","drawStage",[e]]),this.enqueueCommands(),this.logicFrame++}addRenderingPhaseCommand(e,t,n){}enqueueCommands(){this.commandQueue.push(this.commandBuffer),this.commandBuffer=[]}executeCommandQueue(){do{const e=this.commandQueue.shift();if(!e||0==e.length)return;for(let t in e){const[n,r,o]=e[t];this.engineDelegate[n][r](...o)}this.lastLogicUpdateFrame=this.renderedFrame,this.subRenderFrame=0}while(this.commandQueue.length>this.maxBufferedRenderingFrame)}render(e,t,n,r,o){const i=this.gl;hr(i,t),r&&(i.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),i.clear(i.COLOR_BUFFER_BIT)),i.disable(i.DEPTH_TEST),i.enable(i.BLEND);let a=n,s=0;for(let r of e){const e=this.renderingInfos[r];let l,u;e.renderedFrame=this.renderedFrame,e.cacheBitmapDstId>0?s!=e.cacheBitmapDstId&&(s=e.cacheBitmapDstId,l=Ir.get(e.cacheBitmapDstId).shared.renderTarget,hr(i,l.frameBufferInfo),a=l.viewMatrix):(s=0,hr(i,t),a=n),(e.cacheBitmapSrcId>0||null!=e.bufferInfo)&&(io(i,e.blendMode),e.uniforms.u_alphaCorrection=oo[e.blendMode][0]+0-0,e.motionBlur?(e.uniforms.u_logicPerRenderFrame=o||this.renderFPS/this.updateFPS,e.uniforms.u_subRenderFrame=o||this.subRenderFrame):(e.uniforms.u_logicPerRenderFrame=1,e.uniforms.u_subRenderFrame=1),e.uniforms.u_viewMatrix=a,Number.isNaN(e.clipRegion[0])?i.disable(i.SCISSOR_TEST):0==s&&(i.enable(i.SCISSOR_TEST),i.scissor((e.clipRegion[0]+this.logicalViewportOffset.x)*this.logicalViewportScale.x,this.deviceViewport.height-(e.clipRegion[1]+e.clipRegion[3]+this.logicalViewportOffset.y)*this.logicalViewportScale.y,e.clipRegion[2]*this.logicalViewportScale.x,e.clipRegion[3]*this.logicalViewportScale.y)),e.cacheBitmapSrcId>0?Ir.get(e.cacheBitmapSrcId)?(u=Ir.get(e.cacheBitmapSrcId).shared,i.useProgram(e.programInfo.program),e.uniforms.u_texture=u.texture,e.uniforms.u_textureSize=[u.width,u.height],Zn(e.programInfo,e.uniforms),tr(i,e.programInfo,u.bufferInfo),e.motionBlur?rr(i,u.bufferInfo,i.TRIANGLES,u.bufferInfo.numElements,0,Gr):rr(i,u.bufferInfo)):console.log(`Invalid texture ID ${e.cacheBitmapSrcId} : frame ${this.logicFrame}`):(i.useProgram(e.programInfo.program),Zn(e.programInfo,e.uniforms),tr(i,e.programInfo,e.bufferInfo),e.motionBlur?rr(i,e.bufferInfo,i.TRIANGLES,e.bufferInfo.numElements,0,Gr):rr(i,e.bufferInfo))),i.disable(i.SCISSOR_TEST)}}}ao.defaultVertexShader=Hr,ao.defaultFragmentShader=Wr;const so=Math.floor(1e3/60);class lo{constructor(t,n){console.log("🚙 AppLoader start."),lo.instances.set(n,this);const r=n,o=r.getAttribute("target"),i=r.getAttribute("width"),a=r.getAttribute("height"),s=document.getElementsByName(o)[0];this.canvas=s,"*"==i?s.clientWidth:null!=i&&parseInt(i),"*"==a?s.clientHeight:null!=a&&parseInt(a),this.renderer=new ao(this,s),this.gameWorker=t,this.renderer.sendDeviceInfo(),t.addEventListener("message",this.onMessage.bind(this)),window.addEventListener("resize",this.onResize.bind(this)),this.updateFPS=60,this.renderer.run(),this.input={button:{}},this.__eventMap={keydown:[!0,this.onKeyEvent.bind(this,e.KEY_DOWN)],keyup:[!0,this.onKeyEvent.bind(this,e.KEY_UP)],mousedown:[!1,this.onMouseEvent.bind(this,e.MOUSE_DOWN)],mouseup:[!1,this.onMouseEvent.bind(this,e.MOUSE_UP)],mousemove:[!1,this.onMouseEvent.bind(this,e.MOUSE_MOVE)],touchstart:[!1,this.onTouchEvent.bind(this,e.MOUSE_DOWN)],touchend:[!1,this.onTouchEvent.bind(this,e.MOUSE_UP)],touchmove:[!1,this.onTouchEvent.bind(this,e.TOUCHES_MOVE)],touchcancel:[!1,this.onTouchEvent.bind(this,e.MOUSE_UP)],["onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll"]:[!1,this.onMouseEvent.bind(this,e.MOUSE_WHEEL)]},this.enableInput(!0)}enableInput(e){for(const t in this.__eventMap){const[n,r]=this.__eventMap[t],o=n?window:this.renderer.canvas;(e?o.addEventListener:o.removeEventListener).call(o,t,r)}}static get currentInstance(){return lo.instances.get(document.currentScript)}onMessage(e){const t=e.data;switch(t.msg){case"update":this.renderer.updateLogic(t.renderingInfo);break;case"executeCommand":this.renderer.executeCommand(t.class,t.method,t.args);break;case"addCommand":this.renderer.addCommand(t.class,t.method,t.args);break;case"addRenderingPhaseCommand":this.renderer.addRenderingPhaseCommand(t.class,t.method,t.args);break;default:console.assert(`잘못된 메시지 수신 ${t}`)}}onResize(e){this.renderer.calculateViewMatrix(),this.renderer.sendDeviceInfo()}onTouchEvent(t,n){let r;switch(0==Fr.initialized&&Fr.init(),t){case e.MOUSE_DOWN:r=e.POINTER_DOWN;break;case e.MOUSE_UP:r=e.POINTER_UP;break;case e.TOUCHES_MOVE:r=e.POINTER_MOVE}n.preventDefault(),n.stopPropagation();const o=this.renderer.deviceViewport,i=[];for(let e=0;e<n.touches.length;e++){const t=n.touches[e];i[e]={id:t.identifier,x:(t.clientX-o.left)/this.renderer.renderViewportScale/this.renderer.logicalViewportScale.x-this.renderer.logicalViewportOffset.x,y:(t.clientY-o.top)/this.renderer.renderViewportScale/this.renderer.logicalViewportScale.y-this.renderer.logicalViewportOffset.y,force:t.force,rotationAngle:t.rotationAngle}}const a=[];for(let e=0;e<n.changedTouches.length;e++){const t=n.changedTouches[e];a[e]={id:t.identifier,x:(t.clientX-o.left)/this.renderer.renderViewportScale/this.renderer.logicalViewportScale.x-this.renderer.logicalViewportOffset.x,y:(t.clientY-o.top)/this.renderer.renderViewportScale/this.renderer.logicalViewportScale.y-this.renderer.logicalViewportOffset.y,force:t.force,rotationAngle:t.rotationAngle}}const s={type:t,touches:i,changedTouches:a};a.length>0&&(s.id=a[0].id,s.x=a[0].x,s.y=a[0].y,s.force=a[0].force,s.rotationAngle=a[0].rotationAngle),this.dispatchInputEvent(t,r,s)}onMouseEvent(t,n){0==Fr.initialized&&Fr.init(),this.canvas.getBoundingClientRect();const r=this.canvas.offsetLeft+this.canvas.clientLeft,i=this.canvas.offsetTop+this.canvas.clientTop;let a,s;switch(t){case e.MOUSE_DOWN:{a=e.POINTER_DOWN,this.renderer.canvas.setPointerCapture(n.pointerId||1),this.input.button[n.button]=!0,this.input.buttonBit=this.input.buttonBit|1<<n.button;const t=new o(n.clientX-r,n.clientY-i);s={clientX:t.x,clientY:t.y,button:n.button,id:n.button,touches:[{x:t.x,y:t.y}]};break}case e.MOUSE_UP:a=e.POINTER_UP,this.canvas.releasePointerCapture(n.pointerId||1),this.input.button[n.button]=!0,this.input.buttonBit=this.input.buttonBit&~(1<<n.button),s={clientX:n.clientX-r,clientY:n.clientY-i,button:n.button,id:n.button,touches:[{x:n.clientX-r,y:n.clientY-i}]};break;case e.MOUSE_MOVE:{a=e.POINTER_MOVE;const t=+new Date;if(t-this.lastMouseMoveTime<so)return;this.lastMouseMoveTime=t,s={clientX:n.clientX-r,clientY:n.clientY-i,button:this.input.buttonBit,id:n.button,touches:[{x:n.clientX-r,y:n.clientY-i}]};break}case e.MOUSE_WHEEL:s={clientX:n.clientX-r,clientY:n.clientY-i,wheel:n.wheelDelta}}n.preventDefault(),n.stopPropagation();const l={type:t,x:s.clientX/this.renderer.renderViewportScale/this.renderer.logicalViewportScale.x-this.renderer.logicalViewportOffset.x,y:s.clientY/this.renderer.renderViewportScale/this.renderer.logicalViewportScale.y-this.renderer.logicalViewportOffset.y,button:s.button,id:s.id,wheel:s.wheel,touches:s.touches};this.dispatchInputEvent(t,a,l)}onKeyEvent(e,t){if(0==Fr.initialized&&Fr.init(),!t.repeat){const n={type:e,keyCode:t.code};this.dispatchInputEvent(e,null,n)}}dispatchInputEvent(e,t,n){this.gameWorker.postMessage({msg:"input",inputType:e,secondlyInputType:t,inputData:n})}}lo.instances=new WeakMap;const uo=new Worker("gameLoader.js"),co=document.currentScript;new lo(uo,co)})()})();