(()=>{"use strict";var t={729:t=>{var e=Object.prototype.hasOwnProperty,i="~";function s(){}function n(t,e,i){this.fn=t,this.context=e,this.once=i||!1}function o(t,e,s,o,r){if("function"!=typeof s)throw new TypeError("The listener must be a function");var a=new n(s,o||t,r),l=i?i+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],a]:t._events[l].push(a):(t._events[l]=a,t._eventsCount++),t}function r(t,e){0==--t._eventsCount?t._events=new s:delete t._events[e]}function a(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(i=!1)),a.prototype.eventNames=function(){var t,s,n=[];if(0===this._eventsCount)return n;for(s in t=this._events)e.call(t,s)&&n.push(i?s.slice(1):s);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},a.prototype.listeners=function(t){var e=i?i+t:t,s=this._events[e];if(!s)return[];if(s.fn)return[s.fn];for(var n=0,o=s.length,r=new Array(o);n<o;n++)r[n]=s[n].fn;return r},a.prototype.listenerCount=function(t){var e=i?i+t:t,s=this._events[e];return s?s.fn?1:s.length:0},a.prototype.emit=function(t,e,s,n,o,r){var a=i?i+t:t;if(!this._events[a])return!1;var l,h,c=this._events[a],d=arguments.length;if(c.fn){switch(c.once&&this.removeListener(t,c.fn,void 0,!0),d){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,e),!0;case 3:return c.fn.call(c.context,e,s),!0;case 4:return c.fn.call(c.context,e,s,n),!0;case 5:return c.fn.call(c.context,e,s,n,o),!0;case 6:return c.fn.call(c.context,e,s,n,o,r),!0}for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];c.fn.apply(c.context,l)}else{var u,p=c.length;for(h=0;h<p;h++)switch(c[h].once&&this.removeListener(t,c[h].fn,void 0,!0),d){case 1:c[h].fn.call(c[h].context);break;case 2:c[h].fn.call(c[h].context,e);break;case 3:c[h].fn.call(c[h].context,e,s);break;case 4:c[h].fn.call(c[h].context,e,s,n);break;default:if(!l)for(u=1,l=new Array(d-1);u<d;u++)l[u-1]=arguments[u];c[h].fn.apply(c[h].context,l)}}return!0},a.prototype.on=function(t,e,i){return o(this,t,e,i,!1)},a.prototype.once=function(t,e,i){return o(this,t,e,i,!0)},a.prototype.removeListener=function(t,e,s,n){var o=i?i+t:t;if(!this._events[o])return this;if(!e)return r(this,o),this;var a=this._events[o];if(a.fn)a.fn!==e||n&&!a.once||s&&a.context!==s||r(this,o);else{for(var l=0,h=[],c=a.length;l<c;l++)(a[l].fn!==e||n&&!a[l].once||s&&a[l].context!==s)&&h.push(a[l]);h.length?this._events[o]=1===h.length?h[0]:h:r(this,o)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&r(this,e)):(this._events=new s,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=i,a.EventEmitter=a,t.exports=a}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var o=e[s]={exports:{}};return t[s](o,o.exports,i),o.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t=i(729),e=i.n(t);class s{constructor(t="@EVENT"+ ++s.nextId,e,i){this.name=t,this.stopped=!1,this.target=void 0,this.component=void 0,this.owner=i,this.forwarded=!1,e&&Object.assign(this,e)}on(t,e){return null==this.owner&&(this.owner=new s.EventDispatcher),this.owner.on(this.name,t,e),this}once(t,e){return null==this.owner&&(this.owner=new s.EventDispatcher),this.owner.once(this.name,t,e),this}onStage(t,e,i){return console.assert(this.owner&&this.owner.addChild,"Sprite가 아니면 onStage를 할 수 없습니다."),this.owner.onStage(this.name,t,e,i),this}remove(t,e){return null==this.owner&&(this.owner=new s.EventDispatcher),this.owner.removeEventListener(this.name,t,e),this}dispatch(t){return null==this.owner&&(this.owner=new s.EventDispatcher),Object.assign(this,t),this.owner.dispatchEvent(this),this}stopPropagation(){this.stopped=!0}getTarget(){return this.target}static isInputEvent(t){const e=s.eventAttribs[t];if(null!=e)return 1==e.isInput}}s.STAGE_VISIBLE="stageVisible",s.STAGE_FOCUS="stageFocus",s.ENTER_FRAME="enterFrame",s.RENDER="render",s.ADDED_TO_STAGE="addedToStage",s.REMOVED_FROM_STAGE="removedFromStage",s.POINTER_DOWN="pointerDown",s.POINTER_UP="pointerUp",s.POINTER_MOVE="pointerMove",s.MOUSE_DOWN="mouseDown",s.MOUSE_UP="mouseUp",s.MOUSE_MOVE="mouseMove",s.MOUSE_WHEEL="mouseWheel",s.MOUSE_DOWN="touchesBegin",s.MOUSE_UP="touchesEnd",s.TOUCHES_MOVE="touchesMove",s.MOUSE_UP="touchesCancel",s.KEY_UP="keyUp",s.KEY_DOWN="keyDown",s.TIMER="timer",s.TEXTURE_UPDATE="textureUpdate",s.RESIZE="resize",s.READY="ready",s.COMPLETE="complete",s.ERROR="error",s.BEFORE_UPDATE="beforeUpdate",s.AFTER_UPDATE="afterUpdate",s.LOADED="loaded",s.ALL="*",s.APPLICATION_INIT="APPLICATION_INIT",s.APPLICATION_START="APPLICATION_START",s.eventAttribs={[s.POINTER_DOWN]:{isInput:!0},[s.POINTER_UP]:{isInput:!0},[s.POINTER_MOVE]:{isInput:!0},[s.MOUSE_DOWN]:{isInput:!0,device:"mouse"},[s.MOUSE_UP]:{isInput:!0,device:"mouse"},[s.MOUSE_MOVE]:{isInput:!0,device:"mouse"},[s.MOUSE_WHEEL]:{isInput:!0,device:"mouse"},[s.MOUSE_DOWN]:{isInput:!0,device:"touch"},[s.MOUSE_UP]:{isInput:!0,device:"touch"},[s.TOUCHES_MOVE]:{isInput:!0,device:"touch"},[s.MOUSE_UP]:{isInput:!0,device:"touch"},[s.KEY_UP]:{isInput:!0,device:"keyboard"},[s.KEY_DOWN]:{isInput:!0,device:"keyboard"}},s.EventDispatcher=void 0,s.nextId=0;class n{constructor(){this.eventEmitter=new(e())}triggerable(){return this.__triggers={},new Proxy(this,{set(t,e,i,s){const n=Reflect.set(t,e,i,s),o=t.__triggers[e];if(o)for(const[i,s]of o)(null==s||s(t,e))&&t.dispatchEvent(i,{key:e});return n}})}newEvent(t,e){return new s(e,t,this)}newTrigger(t,e,i){console.assert(null!=this.__triggers,"이 개체는 triggerable이 아닙니다.");const n=new s(i);for(const i in t)t[i]?(this.__triggers[i]=null!=this.__triggers[i]?this.__triggers[i]:[],this.__triggers[i].push([n.name,e])):delete this.__triggers[i];return n}hasEventListener(t){return this.eventEmitter.listeners(t).length>0}addEventListener(t,e,i=null,o=!1){return o?this.eventEmitter.once(t,e,i||this):this.eventEmitter.on(t,e,i||this),t==s.ENTER_FRAME||t==s.RENDER?(this.addEventListener(s.ADDED_TO_STAGE,(()=>{n.enterFrameList.set(this,null!=this.eventEmitter._events[t]?this.eventEmitter._events[t].length:1)})),this.addEventListener(s.REMOVED_FROM_STAGE,(()=>{n.enterFrameList.delete(this)})),this.isOnStage()&&n.enterFrameList.set(this,null!=this.eventEmitter._events[t]?this.eventEmitter._events[t].length:1)):s.isInputEvent(t)&&(this.hasInputEvents=!0),this}addUniqueEventListener(t,e,i,s=!1){return this.removeEventListener(t,e,i),this.addEventListener(t,e,i,s),this}dispatchEvent(t,e){let i;return i="string"==typeof t?new s(t):t,i.target=this,Object.assign(i,e),i.forwarded||this.eventEmitter.emit("*",i),this.eventEmitter.emit(i.name,i)}removeEventListener(t,e,i){if(this.eventEmitter.removeListener(t,e,i||this),t!=s.ENTER_FRAME&&t!=s.RENDER||null!=this.eventEmitter._events[t]&&0!=this.eventEmitter._events[t].length||n.enterFrameList.delete(this),s.isInputEvent(t))for(const t in this.eventEmitter._events)if(s.isInputEvent(t)){this.hasInputEvents=!0;break}}removeAllEventListeners(t){if(this.eventEmitter.removeAllListeners(t),t!=s.ENTER_FRAME&&t!=s.RENDER||!(t&&null==this.eventEmitter._events[t]||0==this.eventEmitter._events[t].length)||n.enterFrameList.delete(this),t&&s.isInputEvent(t))for(const t in this.eventEmitter._events)if(s.isInputEvent(t)){this.hasInputEvents=!0;break}}addEventListenerOnStage(t,e,i,n=this,o=!1){const r=this;return n.addEventListener(s.ADDED_TO_STAGE,(()=>{r.addEventListener(t,e,i,o)}),this),n.addEventListener(s.REMOVED_FROM_STAGE,(()=>{r.removeEventListener(t,e,i)}),this),this}on(t,e,i){return this.addEventListener(t,e,i)}once(t,e,i){return this.addEventListener(t,e,i,!0)}onStage(t,e,i,s=this){return this.addEventListenerOnStage(t,e,i,s)}beforeRender(t,e,i=!0){i&&this.removeEventListener(s.RENDER,t,e),this.addEventListener(s.RENDER,t,e,!0)}startForwardEvents(t,e){for(let i=0;i<t.length;i++){const s=t[i];this.addEventListener(s,e.dispatchEvent.bind(e,[s]))}}stopForwardEvents(t,e){for(let i=0;i<t.length;i++){const s=t[i];this.removeEventListener(s,e.dispatchEvent.bind(e,[s]))}}waitEvents(t,e,i){const s=[];let n;const o=()=>{let e=0;for(const i in t){let s,o=this;Array.isArray(t[i])?[s,o]=t[i]:s=t[i],o.removeEventListener(s,n,e),e++}};n=function(){s[this-1]++;for(let t=0;t<s.length;t++)if(0==s[t])return;o(),e.call(i)};for(const e in t){let i,o=this;Array.isArray(t[e])?[i,o]=t[e]:i=t[e];const r=s.length+1;o.addEventListener(i,n,r),s.push(0)}}addCombinedEvents(t,e){return this.waitEvents(e,(()=>{this.dispatchEvent(t)})),this}eventToPromise(t){return new Promise(((e,i)=>{this.addEventListener(t,e)}))}static doEnterFrame(){if(n.enterFramePaused)return 0;let t=0;for(const[e,i]of n.enterFrameList.entries())e.dispatchEvent(s.ENTER_FRAME),e.dispatchEvent(s.RENDER),t+=i;return t}}n.prototype.tween=void 0,n.prototype.move=void 0,n.prototype.wait=void 0,n.prototype.getTweens=void 0,n.prototype.stopAllTweens=void 0,n.enterFramePaused=!1,s.EventDispatcher=n,n.enterFrameList=new Map;const o={AsyncValue:class{constructor(){this.value=void 0,this.promise=new Promise(((t,e)=>{this._resolve=t,this._reject=e}))}resolve(t){this.value=t,this._resolve(t),delete this.promise,delete this._resolve,delete this._reject}reject(t){this._reject(t),delete this.promise,delete this._resolve,delete this._reject}},nullReplace:(t,e)=>null!=t?t:e,random:(t,e)=>(console.assert(null==t&&null==e||null!=t&&null!=e,`random(${t},${e}) 구문은 허용되지 않음. random(1,a) 혹은 random(0,a)를 명확히 쓸 것`),null==e?Math.floor(Math.random()*t+1):null==t?Math.random():Math.floor(Math.random()*(e-t+1)+t)),precision:(t,e)=>parseFloat(t).toPrecision(e),idiv:(t,e)=>t/e>>0,lerp:(t,e,i)=>t+(e-t)*i,clamp:(t,e,i)=>Math.min(Math.max(t,e),i),distance:(t,e,i,s)=>Math.sqrt((i-t)*(i-t)+(s-e)*(s-e)),frac:t=>t%1,legacy(t=""){},notImplements(t=""){},getEmbeddedFile:t=>(console.assert(null!=self._embeddedFiles[t.toLowerCase()]),self._embeddedFiles[t]),getEmbeddedBinaryFile(t){console.assert(null!=self._embeddedFiles[t.toLowerCase()]);const e=self._embeddedFiles[t.toLowerCase()],i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s=[];for(let t=0;t<e.length;){const n=i.indexOf(e.charAt(t++)),o=i.indexOf(e.charAt(t++)),r=i.indexOf(e.charAt(t++)),a=i.indexOf(e.charAt(t++)),l=n<<2|o>>4,h=(15&o)<<4|r>>2,c=(3&r)<<6|a;s.push(l),64!=r&&s.push(h),64!=a&&s.push(c)}return new Uint8Array(s)},embeddedFileExist:t=>null!=self._embeddedFiles[t],getEmbeddedXmlFile:t=>(new window.DOMParser).parseFromString(o.getEmbeddedFile(t),"text/xml"),getImageSize(t){const e=self._imageSizes[t.toLowerCase()];return e||{width:0,height:0}},splitStringWithTag(t){const e=/<([^>]+)>/g,i=["default"],s=[];let n=0;for(;;){const o=e.exec(t),r=i[i.length-1];if(null==o)return n<t.length&&s.push([r,t.substring(n)]),s;{const a=o[1],l=o.index;"/"!=a[0]?i.push(a):r==a.substring(1)&&i.length--,n!=l&&s.push([r,t.substring(n,l)]),n=e.lastIndex}}},hex2rgba(t,e){const i=[];return i[0]=((16711680&t)>>16)/255,i[1]=((65280&t)>>8)/255,i[2]=(255&t)/255,i[3]=null!=e?e:((4278190080&t)>>24)/255,i},rgba2hex(t,e){const i=e||0;return 255*t[i]<<16|255*t[i+1]<<8|255*t[i+2]|255*t[i+3]<<24},angleToDir(t){let e;return e=-135<t&&t<=-45?1:-45<t&&t<=45?2:45<t&&t<=135?3:4,e},dirToOffset(t){let e,i;return 1==t?[e,i]=[0,-1]:2==t?[e,i]=[1,0]:3==t?[e,i]=[0,1]:4==t&&([e,i]=[-1,0]),[e,i]},filterAttrib(t,e,i){const s=null!=e?Array.isArray(e)?","+e.join(",")+",":","+e+",":",*,",n=null!=i?Array.isArray(i)?","+i.join(",")+",":","+i+",":"",o=null!=t?Array.isArray(t)?t:t.split(","):[];let r;if(n.indexOf(",*,")>=0)return!1;if(s.indexOf(",*,")>=0)r=!0;else{if(!(o.length>0))return!1;for(const t of o)if(s.indexOf(","+t+",")>=0){r=!0;break}}if(r){for(const t of o)if(n.indexOf(","+t+",")>=0)return!1;return!0}return!1},format(t,...e){let i;if(e.length>0){let s=0;i=t.replace(/%[s|d]/g,(function(t){return"%"+s++}));for(let t=0;t<e.length;t++)i=i.replace(`%${t}`,e[t])}else i=t;return i},isNode:()=>"object"==typeof{env:{}}&&"object"==typeof{env:{}}.versions&&void 0!=={env:{}}.versions.node,isWebWorker(){return!this.isNode()&&"undefined"!=typeof WorkerGlobalScope&&"function"==typeof importScripts&&navigator instanceof WorkerNavigator},clearObject(t){const e=Object.keys(t);for(let i=0,s=e.length;i<s;i++)delete t[e[i]]}},r={};class a extends n{constructor(t,e){super(),this.id=a.lastId++,null!=t&&t.indexOf("*")>=0?this.name=t.replace("*",this.id.toString()):this.name=null==t?"":t,this.type=null==e?a.guessType(this.name):e,a.finalizationRegistry.register(this,{thisObjId:this.id,thisType:this.type}),this.loaded=void 0,this.onLoadedHandler=this.onLoaded.bind(this,[this.id]),this.type!=a.AssetTypes.TrueTypeFont&&this.type!=a.AssetTypes.BitmapFont&&this.type!=a.AssetTypes.Sound&&this.type!=a.AssetTypes.Texture||a.loadedEventDispatcher.addEventListener(s.LOADED,this.onLoadedHandler),this.loadFontInfo(t)}loadFontInfo(t){if(this.type==a.AssetTypes.TrueTypeFont)r[t]?(this.fontInfo=r[t],console.log(`폰트 ${this.name} 로드 완료.(캐시)`),this.loaded=!0,this.dispatchEvent(s.LOADED)):fetch(`asset/${t}.json`).then((e=>(console.assert(e.ok,`asset/${t}.json 로드하지 못했음.`),e.json()))).then((t=>{this.fontInfo=t,this.fontLoaded&&(r[this.name]=this.fontInfo,console.log(`폰트 ${this.name} 로드 완료.(json을 늦게 로딩)`),this.loaded=!0,this.dispatchEvent(s.LOADED))}));else if(this.type==a.AssetTypes.BitmapFont||this.type==a.AssetTypes.MsdfFont){const e=o.getEmbeddedFile(t+".json");this.fontInfo=JSON.parse(e),this.loaded=!0}}addEventListener(t,e,i=null,s=!1){return super.addEventListener(t,e,i,s)}release(){me.postMessageToRender({msg:"addCommand",class:"Asset",method:"release",args:[this.id]})}load(t){me.postMessageToRender({msg:"executeCommand",class:"Asset",method:"load",args:[{id:this.id,type:this.type,name:this.name,extraData:t}]})}update(t){me.postMessageToRender({msg:"addCommand",class:"Asset",method:"load",args:[{id:this.id,type:this.type,name:this.name,extraData:t}]})}onLoaded(t,e){t==e.id&&(a.loadedEventDispatcher.removeEventListener(s.LOADED,this.onLoadedHandler),this.type==a.AssetTypes.TrueTypeFont?(this.fontLoaded=!0,this.fontInfo&&(r[this.name]=this.fontInfo,console.log(`폰트 ${this.name} 로드 완료.(ttf늦게 로딩)`),this.loaded=!0,this.dispatchEvent(s.LOADED))):(this.loaded=!0,this.dispatchEvent(s.LOADED)))}static finalizeHandler(t){me.postMessageToRender({msg:"addCommand",class:"Asset",method:"release",args:[t.thisObjId]})}static dispatchLoadedEvent(t){a.loadedEventDispatcher.dispatchEvent(s.LOADED,{id:t})}static guessType(t){const e=/\.[^.]+$/.exec(t),i=null!=e?e[0].toLowerCase():"";return".png"==i||".jpg"==i?a.AssetTypes.Texture:".wav"==i||".mp3"==i?a.AssetTypes.Sound:".ttf"==i?a.AssetTypes.TrueTypeFont:null}static findPreloadedAsset(t){for(let e of a.preloadAssets)if(e.name==t)return e;return null}static preload(t,e){return new Promise(((e,i)=>{for(let e of t){const t=new a(e);t.load(),a.preloadAssets.push(t),a.preloadAssetPromises.push(t.eventToPromise(s.LOADED))}Promise.all(a.preloadAssetPromises).then(e)}))}}a.AssetTypes={Texture:"Texture",RenderTarget:"RenderTarget",Sound:"Sound",Shader:"Shader",TrueTypeFont:"TrueTypeFont",MsdfFont:"MsdfFont",BitmapFont:"BitmapFont",PostProcessFilter:"PostProcessFilter"},a.lastId=1,a.finalizationRegistry=new FinalizationRegistry(a.finalizeHandler),a.loadedEventDispatcher=new n,a.preloadAssets=[],a.preloadAssetPromises=[];let l=Float32Array;function h(t,e,i){const s=new l(3);return t&&(s[0]=t),e&&(s[1]=e),i&&(s[2]=i),s}function c(t,e,i){return(i=i||new l(3))[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i}function d(t,e,i){return(i=i||new l(3))[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i}function u(t,e,i){i=i||new l(3);const s=t[2]*e[0]-t[0]*e[2],n=t[0]*e[1]-t[1]*e[0];return i[0]=t[1]*e[2]-t[2]*e[1],i[1]=s,i[2]=n,i}function p(t,e){e=e||new l(3);const i=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=Math.sqrt(i);return s>1e-5?(e[0]=t[0]/s,e[1]=t[1]/s,e[2]=t[2]/s):(e[0]=0,e[1]=0,e[2]=0),e}function f(t,e,i){return(i=i||new l(3))[0]=t[0]*e[0],i[1]=t[1]*e[1],i[2]=t[2]*e[2],i}let y,m,g,v=Float32Array;function _(t,e){return(e=e||new v(16))[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function x(t){return(t=t||new v(16))[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function w(t,e){e=e||new v(16);const i=t[0],s=t[1],n=t[2],o=t[3],r=t[4],a=t[5],l=t[6],h=t[7],c=t[8],d=t[9],u=t[10],p=t[11],f=t[12],y=t[13],m=t[14],g=t[15],_=u*g,x=m*p,w=l*g,b=m*h,C=l*p,E=u*h,A=n*g,T=m*o,P=n*p,M=u*o,S=n*h,O=l*o,R=c*y,I=f*d,k=r*y,B=f*a,D=r*d,L=c*a,F=i*y,N=f*s,U=i*d,V=c*s,X=i*a,z=r*s,$=_*a+b*d+C*y-(x*a+w*d+E*y),W=x*s+A*d+M*y-(_*s+T*d+P*y),Y=w*s+T*a+S*y-(b*s+A*a+O*y),H=E*s+P*a+O*d-(C*s+M*a+S*d),j=1/(i*$+r*W+c*Y+f*H);return e[0]=j*$,e[1]=j*W,e[2]=j*Y,e[3]=j*H,e[4]=j*(x*r+w*c+E*f-(_*r+b*c+C*f)),e[5]=j*(_*i+T*c+P*f-(x*i+A*c+M*f)),e[6]=j*(b*i+A*r+O*f-(w*i+T*r+S*f)),e[7]=j*(C*i+M*r+S*c-(E*i+P*r+O*c)),e[8]=j*(R*h+B*p+D*g-(I*h+k*p+L*g)),e[9]=j*(I*o+F*p+V*g-(R*o+N*p+U*g)),e[10]=j*(k*o+N*h+X*g-(B*o+F*h+z*g)),e[11]=j*(L*o+U*h+z*p-(D*o+V*h+X*p)),e[12]=j*(k*u+L*m+I*l-(D*m+R*l+B*u)),e[13]=j*(U*m+R*n+N*u-(F*u+V*m+I*n)),e[14]=j*(F*l+z*m+B*n-(X*m+k*n+N*l)),e[15]=j*(X*u+D*n+V*l-(U*l+z*u+L*n)),e}function b(t,e,i){i=i||h();const s=e[0],n=e[1],o=e[2],r=s*t[3]+n*t[7]+o*t[11]+t[15];return i[0]=(s*t[0]+n*t[4]+o*t[8]+t[12])/r,i[1]=(s*t[1]+n*t[5]+o*t[9]+t[13])/r,i[2]=(s*t[2]+n*t[6]+o*t[10]+t[14])/r,i}function C(t,e,i){i=i||h();const s=e[0],n=e[1],o=e[2];return i[0]=s*t[0]+n*t[4]+o*t[8],i[1]=s*t[1]+n*t[5]+o*t[9],i[2]=s*t[2]+n*t[6]+o*t[10],i}var E=Object.freeze({__proto__:null,axisRotate:function(t,e,i,s){s=s||new v(16);let n=e[0],o=e[1],r=e[2];const a=Math.sqrt(n*n+o*o+r*r);n/=a,o/=a,r/=a;const l=n*n,h=o*o,c=r*r,d=Math.cos(i),u=Math.sin(i),p=1-d,f=l+(1-l)*d,y=n*o*p+r*u,m=n*r*p-o*u,g=n*o*p-r*u,_=h+(1-h)*d,x=o*r*p+n*u,w=n*r*p+o*u,b=o*r*p-n*u,C=c+(1-c)*d,E=t[0],A=t[1],T=t[2],P=t[3],M=t[4],S=t[5],O=t[6],R=t[7],I=t[8],k=t[9],B=t[10],D=t[11];return s[0]=f*E+y*M+m*I,s[1]=f*A+y*S+m*k,s[2]=f*T+y*O+m*B,s[3]=f*P+y*R+m*D,s[4]=g*E+_*M+x*I,s[5]=g*A+_*S+x*k,s[6]=g*T+_*O+x*B,s[7]=g*P+_*R+x*D,s[8]=w*E+b*M+C*I,s[9]=w*A+b*S+C*k,s[10]=w*T+b*O+C*B,s[11]=w*P+b*R+C*D,t!==s&&(s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s},axisRotation:function(t,e,i){i=i||new v(16);let s=t[0],n=t[1],o=t[2];const r=Math.sqrt(s*s+n*n+o*o);s/=r,n/=r,o/=r;const a=s*s,l=n*n,h=o*o,c=Math.cos(e),d=Math.sin(e),u=1-c;return i[0]=a+(1-a)*c,i[1]=s*n*u+o*d,i[2]=s*o*u-n*d,i[3]=0,i[4]=s*n*u-o*d,i[5]=l+(1-l)*c,i[6]=n*o*u+s*d,i[7]=0,i[8]=s*o*u+n*d,i[9]=n*o*u-s*d,i[10]=h+(1-h)*c,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},copy:_,frustum:function(t,e,i,s,n,o,r){const a=e-t,l=s-i,h=n-o;return(r=r||new v(16))[0]=2*n/a,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2*n/l,r[6]=0,r[7]=0,r[8]=(t+e)/a,r[9]=(s+i)/l,r[10]=o/h,r[11]=-1,r[12]=0,r[13]=0,r[14]=n*o/h,r[15]=0,r},getAxis:function(t,e,i){const s=4*e;return(i=i||h())[0]=t[s+0],i[1]=t[s+1],i[2]=t[s+2],i},getTranslation:function(t,e){return(e=e||h())[0]=t[12],e[1]=t[13],e[2]=t[14],e},identity:x,inverse:w,lookAt:function(t,e,i,s){return s=s||new v(16),y=y||h(),m=m||h(),g=g||h(),p(d(t,e,g),g),p(u(i,g,y),y),p(u(g,y,m),m),s[0]=y[0],s[1]=y[1],s[2]=y[2],s[3]=0,s[4]=m[0],s[5]=m[1],s[6]=m[2],s[7]=0,s[8]=g[0],s[9]=g[1],s[10]=g[2],s[11]=0,s[12]=t[0],s[13]=t[1],s[14]=t[2],s[15]=1,s},multiply:function(t,e,i){i=i||new v(16);const s=t[0],n=t[1],o=t[2],r=t[3],a=t[4],l=t[5],h=t[6],c=t[7],d=t[8],u=t[9],p=t[10],f=t[11],y=t[12],m=t[13],g=t[14],_=t[15],x=e[0],w=e[1],b=e[2],C=e[3],E=e[4],A=e[5],T=e[6],P=e[7],M=e[8],S=e[9],O=e[10],R=e[11],I=e[12],k=e[13],B=e[14],D=e[15];return i[0]=s*x+a*w+d*b+y*C,i[1]=n*x+l*w+u*b+m*C,i[2]=o*x+h*w+p*b+g*C,i[3]=r*x+c*w+f*b+_*C,i[4]=s*E+a*A+d*T+y*P,i[5]=n*E+l*A+u*T+m*P,i[6]=o*E+h*A+p*T+g*P,i[7]=r*E+c*A+f*T+_*P,i[8]=s*M+a*S+d*O+y*R,i[9]=n*M+l*S+u*O+m*R,i[10]=o*M+h*S+p*O+g*R,i[11]=r*M+c*S+f*O+_*R,i[12]=s*I+a*k+d*B+y*D,i[13]=n*I+l*k+u*B+m*D,i[14]=o*I+h*k+p*B+g*D,i[15]=r*I+c*k+f*B+_*D,i},negate:function(t,e){return(e=e||new v(16))[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=-t[7],e[8]=-t[8],e[9]=-t[9],e[10]=-t[10],e[11]=-t[11],e[12]=-t[12],e[13]=-t[13],e[14]=-t[14],e[15]=-t[15],e},ortho:function(t,e,i,s,n,o,r){return(r=r||new v(16))[0]=2/(e-t),r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2/(s-i),r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2/(n-o),r[11]=0,r[12]=(e+t)/(t-e),r[13]=(s+i)/(i-s),r[14]=(o+n)/(n-o),r[15]=1,r},perspective:function(t,e,i,s,n){n=n||new v(16);const o=Math.tan(.5*Math.PI-.5*t),r=1/(i-s);return n[0]=o/e,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=o,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(i+s)*r,n[11]=-1,n[12]=0,n[13]=0,n[14]=i*s*r*2,n[15]=0,n},rotateX:function(t,e,i){i=i||new v(16);const s=t[4],n=t[5],o=t[6],r=t[7],a=t[8],l=t[9],h=t[10],c=t[11],d=Math.cos(e),u=Math.sin(e);return i[4]=d*s+u*a,i[5]=d*n+u*l,i[6]=d*o+u*h,i[7]=d*r+u*c,i[8]=d*a-u*s,i[9]=d*l-u*n,i[10]=d*h-u*o,i[11]=d*c-u*r,t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i},rotateY:function(t,e,i){i=i||new v(16);const s=t[0],n=t[1],o=t[2],r=t[3],a=t[8],l=t[9],h=t[10],c=t[11],d=Math.cos(e),u=Math.sin(e);return i[0]=d*s-u*a,i[1]=d*n-u*l,i[2]=d*o-u*h,i[3]=d*r-u*c,i[8]=d*a+u*s,i[9]=d*l+u*n,i[10]=d*h+u*o,i[11]=d*c+u*r,t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i},rotateZ:function(t,e,i){i=i||new v(16);const s=t[0],n=t[1],o=t[2],r=t[3],a=t[4],l=t[5],h=t[6],c=t[7],d=Math.cos(e),u=Math.sin(e);return i[0]=d*s+u*a,i[1]=d*n+u*l,i[2]=d*o+u*h,i[3]=d*r+u*c,i[4]=d*a-u*s,i[5]=d*l-u*n,i[6]=d*h-u*o,i[7]=d*c-u*r,t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i},rotationX:function(t,e){e=e||new v(16);const i=Math.cos(t),s=Math.sin(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=s,e[7]=0,e[8]=0,e[9]=-s,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},rotationY:function(t,e){e=e||new v(16);const i=Math.cos(t),s=Math.sin(t);return e[0]=i,e[1]=0,e[2]=-s,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=s,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},rotationZ:function(t,e){e=e||new v(16);const i=Math.cos(t),s=Math.sin(t);return e[0]=i,e[1]=s,e[2]=0,e[3]=0,e[4]=-s,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},scale:function(t,e,i){i=i||new v(16);const s=e[0],n=e[1],o=e[2];return i[0]=s*t[0],i[1]=s*t[1],i[2]=s*t[2],i[3]=s*t[3],i[4]=n*t[4],i[5]=n*t[5],i[6]=n*t[6],i[7]=n*t[7],i[8]=o*t[8],i[9]=o*t[9],i[10]=o*t[10],i[11]=o*t[11],t!==i&&(i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i},scaling:function(t,e){return(e=e||new v(16))[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},setAxis:function(t,e,i,s){s!==t&&(s=_(t,s));const n=4*i;return s[n+0]=e[0],s[n+1]=e[1],s[n+2]=e[2],s},setDefaultType:function(t){const e=v;return v=t,e},setTranslation:function(t,e,i){return t!==(i=i||x())&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11]),i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i},transformDirection:C,transformNormal:function(t,e,i){i=i||h();const s=w(t),n=e[0],o=e[1],r=e[2];return i[0]=n*s[0]+o*s[1]+r*s[2],i[1]=n*s[4]+o*s[5]+r*s[6],i[2]=n*s[8]+o*s[9]+r*s[10],i},transformPoint:b,translate:function(t,e,i){i=i||new v(16);const s=e[0],n=e[1],o=e[2],r=t[0],a=t[1],l=t[2],h=t[3],c=t[4],d=t[5],u=t[6],p=t[7],f=t[8],y=t[9],m=t[10],g=t[11],_=t[12],x=t[13],w=t[14],b=t[15];return t!==i&&(i[0]=r,i[1]=a,i[2]=l,i[3]=h,i[4]=c,i[5]=d,i[6]=u,i[7]=p,i[8]=f,i[9]=y,i[10]=m,i[11]=g),i[12]=r*s+c*n+f*o+_,i[13]=a*s+d*n+y*o+x,i[14]=l*s+u*n+m*o+w,i[15]=h*s+p*n+g*o+b,i},translation:function(t,e){return(e=e||new v(16))[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e},transpose:function(t,e){if((e=e||new v(16))===t){let i;return i=t[1],t[1]=t[4],t[4]=i,i=t[2],t[2]=t[8],t[8]=i,i=t[3],t[3]=t[12],t[12]=i,i=t[6],t[6]=t[9],t[9]=i,i=t[7],t[7]=t[13],t[13]=i,i=t[11],t[11]=t[14],t[14]=i,e}const i=t[0],s=t[1],n=t[2],o=t[3],r=t[4],a=t[5],l=t[6],h=t[7],c=t[8],d=t[9],u=t[10],p=t[11],f=t[12],y=t[13],m=t[14],g=t[15];return e[0]=i,e[1]=r,e[2]=c,e[3]=f,e[4]=s,e[5]=a,e[6]=d,e[7]=y,e[8]=n,e[9]=l,e[10]=u,e[11]=m,e[12]=o,e[13]=h,e[14]=p,e[15]=g,e}});const A=5120,T=5121,P=5122,M=5123,S=5124,O=5125,R=5126,I={};{const t=I;t[A]=Int8Array,t[5121]=Uint8Array,t[5122]=Int16Array,t[5123]=Uint16Array,t[S]=Int32Array,t[5125]=Uint32Array,t[5126]=Float32Array,t[32819]=Uint16Array,t[32820]=Uint16Array,t[33635]=Uint16Array,t[5131]=Uint16Array,t[33640]=Uint32Array,t[35899]=Uint32Array,t[35902]=Uint32Array,t[36269]=Uint32Array,t[34042]=Uint32Array}function k(t){if(t instanceof Int8Array)return A;if(t instanceof Uint8Array)return T;if(t instanceof Uint8ClampedArray)return T;if(t instanceof Int16Array)return P;if(t instanceof Uint16Array)return M;if(t instanceof Int32Array)return S;if(t instanceof Uint32Array)return O;if(t instanceof Float32Array)return R;throw new Error("unsupported typed array type")}function B(t){if(t===Int8Array)return A;if(t===Uint8Array)return T;if(t===Uint8ClampedArray)return T;if(t===Int16Array)return P;if(t===Uint16Array)return M;if(t===Int32Array)return S;if(t===Uint32Array)return O;if(t===Float32Array)return R;throw new Error("unsupported typed array type")}const D="undefined"!=typeof SharedArrayBuffer?function(t){return t&&t.buffer&&(t.buffer instanceof ArrayBuffer||t.buffer instanceof SharedArrayBuffer)}:function(t){return t&&t.buffer&&t.buffer instanceof ArrayBuffer};function L(t,e){return"undefined"!=typeof WebGLTexture&&e instanceof WebGLTexture}const F=34962,N={attribPrefix:""};function U(t,e,i,s,n){t.bindBuffer(e,i),t.bufferData(e,s,n||35044)}function V(t,e,i,s){if(n=e,"undefined"!=typeof WebGLBuffer&&n instanceof WebGLBuffer)return e;var n;i=i||F;const o=t.createBuffer();return U(t,i,o,e,s),o}function X(t){return"indices"===t}function z(t){return t.length?t:t.data}const $=/coord|texture/i,W=/color|colour/i;function Y(t,e){let i;if(i=$.test(t)?2:W.test(t)?4:3,e%i>0)throw new Error(`Can not guess numComponents for attribute '${t}'. Tried ${i} but ${e} values is not evenly divisible by ${i}. You should specify it.`);return i}function H(t,e){return t.numComponents||t.size||Y(e,z(t).length)}function j(t,e){if(D(t))return t;if(D(t.data))return t.data;Array.isArray(t)&&(t={data:t});let i=t.type;return i||(i=X(e)?Uint16Array:Float32Array),new i(t.data)}function G(t,e){const i={};return Object.keys(e).forEach((function(s){if(!X(s)){const o=e[s],r=o.attrib||o.name||o.attribName||N.attribPrefix+s;if(o.value){if(!Array.isArray(o.value)&&!D(o.value))throw new Error("array.value is not array or typedarray");i[r]={value:o.value}}else{let e,a,l,h;if(o.buffer&&o.buffer instanceof WebGLBuffer)e=o.buffer,h=o.numComponents||o.size,a=o.type,l=o.normalize;else if("number"==typeof o||"number"==typeof o.data){const i=o.data||o,r=o.type||Float32Array,c=i*r.BYTES_PER_ELEMENT;a=B(r),l=void 0!==o.normalize?o.normalize:(n=r)===Int8Array||n===Uint8Array,h=o.numComponents||o.size||Y(s,i),e=t.createBuffer(),t.bindBuffer(F,e),t.bufferData(F,c,o.drawType||35044)}else{const i=j(o,s);e=V(t,i,void 0,o.drawType),a=k(i),l=void 0!==o.normalize?o.normalize:function(t){return t instanceof Int8Array||t instanceof Uint8Array}(i),h=H(o,s)}i[r]={buffer:e,numComponents:h,type:a,normalize:l,stride:o.stride||0,offset:o.offset||0,divisor:void 0===o.divisor?void 0:o.divisor,drawType:o.drawType}}}var n})),t.bindBuffer(F,null),i}const K=["position","positions","a_position"];function q(t,e,i){const s=G(t,e),n=Object.assign({},i||{});n.attribs=Object.assign({},i?i.attribs:{},s);const o=e.indices;if(o){const e=j(o,"indices");n.indices=V(t,e,34963),n.numElements=e.length,n.elementType=k(e)}else n.numElements||(n.numElements=function(t,e){let i,s;for(s=0;s<K.length&&(i=K[s],!(i in e))&&(i=N.attribPrefix+i,!(i in e));++s);s===K.length&&(i=Object.keys(e)[0]);const n=e[i];t.bindBuffer(F,n.buffer);const o=t.getBufferParameter(F,34660);var r;t.bindBuffer(F,null);const a=o/(5120===(r=n.type)||5121===r?1:5122===r||5123===r?2:5124===r||5125===r||5126===r?4:0),l=n.numComponents||n.size,h=a/l;if(h%1!=0)throw new Error(`numComponents ${l} not correct for length ${length}`);return h}(t,n.attribs));return n}function J(t,e,i){const s="indices"===i?34963:F;return V(t,j(e,i),s)}function Z(t,e){const i={};return Object.keys(e).forEach((function(s){i[s]=J(t,e[s],s)})),e.indices?(i.numElements=e.indices.length,i.elementType=k(j(e.indices))):i.numElements=function(t){let e,i;for(i=0;i<K.length&&(e=K[i],!(e in t));++i);i===K.length&&(e=Object.keys(t)[0]);const s=t[e],n=z(s).length,o=H(s,e),r=n/o;if(n%o>0)throw new Error(`numComponents ${o} not correct for length ${n}`);return r}(e),i}function Q(t,e){let i=0;return t.push=function(){for(let e=0;e<arguments.length;++e){const s=arguments[e];if(s instanceof Array||D(s))for(let e=0;e<s.length;++e)t[i++]=s[e];else t[i++]=s}},t.reset=function(t){i=t||0},t.numComponents=e,Object.defineProperty(t,"numElements",{get:function(){return this.length/this.numComponents|0}}),t}function tt(t,e,i){return Q(new(i||Float32Array)(t*e),t)}function et(t,e,i){const s=t.length,n=new Float32Array(3);for(let o=0;o<s;o+=3)i(e,[t[o],t[o+1],t[o+2]],n),t[o]=n[0],t[o+1]=n[1],t[o+2]=n[2]}function it(t,e,i){i=i||h();const s=e[0],n=e[1],o=e[2];return i[0]=s*t[0]+n*t[1]+o*t[2],i[1]=s*t[4]+n*t[5]+o*t[6],i[2]=s*t[8]+n*t[9]+o*t[10],i}function st(t,e){return et(t,e,C),t}function nt(t,e){return et(t,w(e),it),t}function ot(t,e){return et(t,e,b),t}function rt(t,e){return Object.keys(t).forEach((function(i){const s=t[i];i.indexOf("pos")>=0?ot(s,e):i.indexOf("tan")>=0||i.indexOf("binorm")>=0?st(s,e):i.indexOf("norm")>=0&&nt(s,e)})),t}function at(t,e,i){return t=t||2,{position:{numComponents:2,data:[(e=e||0)+-1*(t*=.5),(i=i||0)+-1*t,e+1*t,i+-1*t,e+-1*t,i+1*t,e+1*t,i+1*t]},normal:[0,0,1,0,0,1,0,0,1,0,0,1],texcoord:[0,0,1,0,0,1,1,1],indices:[0,1,2,2,1,3]}}function lt(t,e,i,s,n){t=t||1,e=e||1,i=i||1,s=s||1,n=n||x();const o=(i+1)*(s+1),r=tt(3,o),a=tt(3,o),l=tt(2,o);for(let n=0;n<=s;n++)for(let o=0;o<=i;o++){const h=o/i,c=n/s;r.push(t*h-.5*t,0,e*c-.5*e),a.push(0,1,0),l.push(h,c)}const h=i+1,c=tt(3,i*s*2,Uint16Array);for(let t=0;t<s;t++)for(let e=0;e<i;e++)c.push((t+0)*h+e,(t+1)*h+e,(t+0)*h+e+1),c.push((t+1)*h+e,(t+1)*h+e+1,(t+0)*h+e+1);return rt({position:r,normal:a,texcoord:l,indices:c},n)}function ht(t,e,i,s,n,o,r){if(e<=0||i<=0)throw new Error("subdivisionAxis and subdivisionHeight must be > 0");s=s||0,o=o||0;const a=(n=n||Math.PI)-s,l=(r=r||2*Math.PI)-o,h=(e+1)*(i+1),c=tt(3,h),d=tt(3,h),u=tt(2,h);for(let n=0;n<=i;n++)for(let r=0;r<=e;r++){const h=r/e,p=n/i,f=l*h+o,y=a*p+s,m=Math.sin(f),g=Math.cos(f),v=Math.sin(y),_=g*v,x=Math.cos(y),w=m*v;c.push(t*_,t*x,t*w),d.push(_,x,w),u.push(1-h,p)}const p=e+1,f=tt(3,e*i*2,Uint16Array);for(let t=0;t<e;t++)for(let e=0;e<i;e++)f.push((e+0)*p+t,(e+0)*p+t+1,(e+1)*p+t),f.push((e+1)*p+t,(e+0)*p+t+1,(e+1)*p+t+1);return{position:c,normal:d,texcoord:u,indices:f}}const ct=[[3,7,5,1],[6,2,0,4],[6,7,3,2],[0,1,5,4],[7,6,4,5],[2,3,1,0]];function dt(t){const e=(t=t||1)/2,i=[[-e,-e,-e],[+e,-e,-e],[-e,+e,-e],[+e,+e,-e],[-e,-e,+e],[+e,-e,+e],[-e,+e,+e],[+e,+e,+e]],s=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],n=[[1,0],[0,0],[0,1],[1,1]],o=tt(3,24),r=tt(3,24),a=tt(2,24),l=tt(3,12,Uint16Array);for(let t=0;t<6;++t){const e=ct[t];for(let l=0;l<4;++l){const h=i[e[l]],c=s[t],d=n[l];o.push(h),r.push(c),a.push(d)}const h=4*t;l.push(h+0,h+1,h+2),l.push(h+0,h+2,h+3)}return{position:o,normal:r,texcoord:a,indices:l}}function ut(t,e,i,s,n,o,r){if(s<3)throw new Error("radialSubdivisions must be 3 or greater");if(n<1)throw new Error("verticalSubdivisions must be 1 or greater");const a=void 0===o||o,l=void 0===r||r,h=(a?2:0)+(l?2:0),c=(s+1)*(n+1+h),d=tt(3,c),u=tt(3,c),p=tt(2,c),f=tt(3,s*(n+h/2)*2,Uint16Array),y=s+1,m=Math.atan2(t-e,i),g=Math.cos(m),v=Math.sin(m),_=n+(l?2:0);for(let o=a?-2:0;o<=_;++o){let r,a=o/n,l=i*a;o<0?(l=0,a=1,r=t):o>n?(l=i,a=1,r=e):r=t+o/n*(e-t),-2!==o&&o!==n+2||(r=0,a=0),l-=i/2;for(let t=0;t<y;++t){const e=Math.sin(t*Math.PI*2/s),i=Math.cos(t*Math.PI*2/s);d.push(e*r,l,i*r),o<0?u.push(0,-1,0):o>n?u.push(0,1,0):0===r?u.push(0,0,0):u.push(e*g,v,i*g),p.push(t/s,1-a)}}for(let t=0;t<n+h;++t)if(!(1===t&&a||t===n+h-2&&l))for(let e=0;e<s;++e)f.push(y*(t+0)+0+e,y*(t+0)+1+e,y*(t+1)+1+e),f.push(y*(t+0)+0+e,y*(t+1)+1+e,y*(t+1)+0+e);return{position:d,normal:u,texcoord:p,indices:f}}function pt(t,e){e=e||[];const i=[];for(let s=0;s<t.length;s+=4){const n=t[s],o=t.slice(s+1,s+4);o.push.apply(o,e);for(let t=0;t<n;++t)i.push.apply(i,o)}return i}function ft(){const t=[0,0,0,0,150,0,30,0,0,0,150,0,30,150,0,30,0,0,30,0,0,30,30,0,100,0,0,30,30,0,100,30,0,100,0,0,30,60,0,30,90,0,67,60,0,30,90,0,67,90,0,67,60,0,0,0,30,30,0,30,0,150,30,0,150,30,30,0,30,30,150,30,30,0,30,100,0,30,30,30,30,30,30,30,100,0,30,100,30,30,30,60,30,67,60,30,30,90,30,30,90,30,67,60,30,67,90,30,0,0,0,100,0,0,100,0,30,0,0,0,100,0,30,0,0,30,100,0,0,100,30,0,100,30,30,100,0,0,100,30,30,100,0,30,30,30,0,30,30,30,100,30,30,30,30,0,100,30,30,100,30,0,30,30,0,30,60,30,30,30,30,30,30,0,30,60,0,30,60,30,30,60,0,67,60,30,30,60,30,30,60,0,67,60,0,67,60,30,67,60,0,67,90,30,67,60,30,67,60,0,67,90,0,67,90,30,30,90,0,30,90,30,67,90,30,30,90,0,67,90,30,67,90,0,30,90,0,30,150,30,30,90,30,30,90,0,30,150,0,30,150,30,0,150,0,0,150,30,30,150,30,0,150,0,30,150,30,30,150,0,0,0,0,0,0,30,0,150,30,0,0,0,0,150,30,0,150,0],e=pt([18,0,0,1,18,0,0,-1,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,1,0,6,1,0,0,6,0,-1,0,6,1,0,0,6,0,-1,0,6,-1,0,0]),i=pt([18,200,70,120,18,80,70,200,6,70,200,210,6,200,200,70,6,210,100,70,6,210,160,70,6,70,180,210,6,100,70,210,6,76,210,100,6,140,210,80,6,90,130,110,6,160,160,220],[255]),s=t.length/3,n={position:tt(3,s),texcoord:tt(2,s),normal:tt(3,s),color:tt(4,s,Uint8Array),indices:tt(3,s/3,Uint16Array)};n.position.push(t),n.texcoord.push([.22,.19,.22,.79,.34,.19,.22,.79,.34,.79,.34,.19,.34,.19,.34,.31,.62,.19,.34,.31,.62,.31,.62,.19,.34,.43,.34,.55,.49,.43,.34,.55,.49,.55,.49,.43,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,0,1,0,1,1,0,1,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,1,1,0,1,0,0,1,0,1,1,0,0,0,1,1,1,0,0,1,1,1,0,0,0,0,1,1,1,0,0,1,1,1,0]),n.normal.push(e),n.color.push(i);for(let t=0;t<s;++t)n.indices.push(t);return n}function yt(t,e,i,s,n,o,r){if(n<=0)throw new Error("subdivisionDown must be > 0");const a=(r=r||1)-(o=o||0),l=2*(n+1)*4,h=tt(3,l),d=tt(3,l),u=tt(2,l);function p(t,e,i){return t+(e-t)*i}function y(e,i,r,l,y,m){for(let g=0;g<=n;g++){const v=i/1,_=g/n,x=2*(v-.5),w=(o+_*a)*Math.PI,b=Math.sin(w),C=Math.cos(w),E=p(t,e,b),A=x*s,T=C*t,P=b*E;h.push(A,T,P);const M=c(f([0,b,C],r),l);d.push(M),u.push(v*y+m,_)}}for(let t=0;t<2;t++){const s=2*(t/1-.5);y(e,t,[1,1,1],[0,0,0],1,0),y(e,t,[0,0,0],[s,0,0],0,0),y(i,t,[1,1,1],[0,0,0],1,0),y(i,t,[0,0,0],[s,0,0],0,1)}const m=tt(3,2*n*4,Uint16Array);function g(t,e){for(let i=0;i<n;++i)m.push(t+i+0,t+i+1,e+i+0),m.push(t+i+1,e+i+1,e+i+0)}const v=n+1;return g(0*v,4*v),g(5*v,7*v),g(6*v,2*v),g(3*v,1*v),{position:h,normal:d,texcoord:u,indices:m}}function mt(t,e,i,s,n,o){return ut(t,t,e,i,s,n,o)}function gt(t,e,i,s,n,o){if(i<3)throw new Error("radialSubdivisions must be 3 or greater");if(s<3)throw new Error("verticalSubdivisions must be 3 or greater");n=n||0;const r=(o=o||2*Math.PI)-n,a=i+1,l=s+1,h=a*l,c=tt(3,h),d=tt(3,h),u=tt(2,h),p=tt(3,i*s*2,Uint16Array);for(let o=0;o<l;++o){const l=o/s,h=l*Math.PI*2,p=Math.sin(h),f=t+p*e,y=Math.cos(h),m=y*e;for(let t=0;t<a;++t){const e=t/i,s=n+e*r,o=Math.sin(s),a=Math.cos(s),h=o*f,g=a*f,v=o*p,_=a*p;c.push(h,m,g),d.push(v,y,_),u.push(e,1-l)}}for(let t=0;t<s;++t)for(let e=0;e<i;++e){const i=1+e,s=1+t;p.push(a*t+e,a*s+e,a*t+i),p.push(a*s+e,a*s+i,a*t+i)}return{position:c,normal:d,texcoord:u,indices:p}}function vt(t,e,i,s,n){if(e<3)throw new Error("divisions must be at least 3");n=n||1,s=s||0;const o=(e+1)*((i=i||1)+1),r=tt(3,o),a=tt(3,o),l=tt(2,o),h=tt(3,i*e*2,Uint16Array);let c=0;const d=t-s,u=e+1;for(let t=0;t<=i;++t){const o=s+d*Math.pow(t/i,n);for(let s=0;s<=e;++s){const n=2*Math.PI*s/e,d=o*Math.cos(n),p=o*Math.sin(n);if(r.push(d,0,p),a.push(0,1,0),l.push(1-s/e,t/i),t>0&&s!==e){const t=c+(s+1),e=c+s,i=c+s-u,n=c+(s+1)-u;h.push(t,e,i),h.push(t,i,n)}}c+=e+1}return{position:r,normal:a,texcoord:l,indices:h}}function _t(t){return function(e){const i=t.apply(this,Array.prototype.slice.call(arguments,1));return Z(e,i)}}function xt(t){return function(e){const i=t.apply(null,Array.prototype.slice.call(arguments,1));return q(e,i)}}xt(ft),_t(ft),xt(dt),_t(dt),xt(lt),_t(lt),xt(ht),_t(ht),xt(ut),_t(ut),xt(at),_t(at),xt(yt),_t(yt),xt(mt),_t(mt),xt(gt),_t(gt),xt(vt),_t(vt);function wt(t){return!!t.texStorage2D}!function(){const t={},e={}}();new Uint8Array([128,192,255,255]),function(){let t}();const bt=6407,Ct=6408,Et=33319,At=6403,Tt={};{const t=Tt;t[6406]={numColorComponents:1},t[6409]={numColorComponents:1},t[6410]={numColorComponents:2},t[bt]={numColorComponents:3},t[Ct]={numColorComponents:4},t[At]={numColorComponents:1},t[36244]={numColorComponents:1},t[Et]={numColorComponents:2},t[33320]={numColorComponents:2},t[bt]={numColorComponents:3},t[36248]={numColorComponents:3},t[Ct]={numColorComponents:4},t[36249]={numColorComponents:4},t[6402]={numColorComponents:1},t[34041]={numColorComponents:2}}const Pt=33984,Mt=34962,St=5126,Ot=5124,Rt=5125,It=3553,kt=34067,Bt=32879,Dt=35866,Lt={};function Ft(t,e){return Lt[e].bindPoint}function Nt(t,e){return function(i){t.uniform1i(e,i)}}function Ut(t,e){return function(i){t.uniform1iv(e,i)}}function Vt(t,e){return function(i){t.uniform2iv(e,i)}}function Xt(t,e){return function(i){t.uniform3iv(e,i)}}function zt(t,e){return function(i){t.uniform4iv(e,i)}}function $t(t,e,i,s){const n=Ft(0,e);return wt(t)?function(e){let o,r;L(0,e)?(o=e,r=null):(o=e.texture,r=e.sampler),t.uniform1i(s,i),t.activeTexture(Pt+i),t.bindTexture(n,o),t.bindSampler(i,r)}:function(e){t.uniform1i(s,i),t.activeTexture(Pt+i),t.bindTexture(n,e)}}function Wt(t,e,i,s,n){const o=Ft(0,e),r=new Int32Array(n);for(let t=0;t<n;++t)r[t]=i+t;return wt(t)?function(e){t.uniform1iv(s,r),e.forEach((function(e,s){let n,a;t.activeTexture(Pt+r[s]),L(0,e)?(n=e,a=null):(n=e.texture,a=e.sampler),t.bindSampler(i,a),t.bindTexture(o,n)}))}:function(e){t.uniform1iv(s,r),e.forEach((function(e,i){t.activeTexture(Pt+r[i]),t.bindTexture(o,e)}))}}function Yt(t,e){return function(i){if(i.value)switch(t.disableVertexAttribArray(e),i.value.length){case 4:t.vertexAttrib4fv(e,i.value);break;case 3:t.vertexAttrib3fv(e,i.value);break;case 2:t.vertexAttrib2fv(e,i.value);break;case 1:t.vertexAttrib1fv(e,i.value);break;default:throw new Error("the length of a float constant value must be between 1 and 4!")}else t.bindBuffer(Mt,i.buffer),t.enableVertexAttribArray(e),t.vertexAttribPointer(e,i.numComponents||i.size,i.type||St,i.normalize||!1,i.stride||0,i.offset||0),void 0!==i.divisor&&t.vertexAttribDivisor(e,i.divisor)}}function Ht(t,e){return function(i){if(i.value){if(t.disableVertexAttribArray(e),4!==i.value.length)throw new Error("The length of an integer constant value must be 4!");t.vertexAttrib4iv(e,i.value)}else t.bindBuffer(Mt,i.buffer),t.enableVertexAttribArray(e),t.vertexAttribIPointer(e,i.numComponents||i.size,i.type||Ot,i.stride||0,i.offset||0),void 0!==i.divisor&&t.vertexAttribDivisor(e,i.divisor)}}function jt(t,e){return function(i){if(i.value){if(t.disableVertexAttribArray(e),4!==i.value.length)throw new Error("The length of an unsigned integer constant value must be 4!");t.vertexAttrib4uiv(e,i.value)}else t.bindBuffer(Mt,i.buffer),t.enableVertexAttribArray(e),t.vertexAttribIPointer(e,i.numComponents||i.size,i.type||Rt,i.stride||0,i.offset||0),void 0!==i.divisor&&t.vertexAttribDivisor(e,i.divisor)}}function Gt(t,e,i){const s=i.size,n=i.count;return function(i){t.bindBuffer(Mt,i.buffer);const o=i.size||i.numComponents||s,r=o/n,a=i.type||St,l=Lt[a].size*o,h=i.normalize||!1,c=i.offset||0,d=l/n;for(let s=0;s<n;++s)t.enableVertexAttribArray(e+s),t.vertexAttribPointer(e+s,r,a,h,l,c+d*s),void 0!==i.divisor&&t.vertexAttribDivisor(e+s,i.divisor)}}Lt[5126]={Type:Float32Array,size:4,setter:function(t,e){return function(i){t.uniform1f(e,i)}},arraySetter:function(t,e){return function(i){t.uniform1fv(e,i)}}},Lt[35664]={Type:Float32Array,size:8,setter:function(t,e){return function(i){t.uniform2fv(e,i)}},cols:2},Lt[35665]={Type:Float32Array,size:12,setter:function(t,e){return function(i){t.uniform3fv(e,i)}},cols:3},Lt[35666]={Type:Float32Array,size:16,setter:function(t,e){return function(i){t.uniform4fv(e,i)}},cols:4},Lt[5124]={Type:Int32Array,size:4,setter:Nt,arraySetter:Ut},Lt[35667]={Type:Int32Array,size:8,setter:Vt,cols:2},Lt[35668]={Type:Int32Array,size:12,setter:Xt,cols:3},Lt[35669]={Type:Int32Array,size:16,setter:zt,cols:4},Lt[5125]={Type:Uint32Array,size:4,setter:function(t,e){return function(i){t.uniform1ui(e,i)}},arraySetter:function(t,e){return function(i){t.uniform1uiv(e,i)}}},Lt[36294]={Type:Uint32Array,size:8,setter:function(t,e){return function(i){t.uniform2uiv(e,i)}},cols:2},Lt[36295]={Type:Uint32Array,size:12,setter:function(t,e){return function(i){t.uniform3uiv(e,i)}},cols:3},Lt[36296]={Type:Uint32Array,size:16,setter:function(t,e){return function(i){t.uniform4uiv(e,i)}},cols:4},Lt[35670]={Type:Uint32Array,size:4,setter:Nt,arraySetter:Ut},Lt[35671]={Type:Uint32Array,size:8,setter:Vt,cols:2},Lt[35672]={Type:Uint32Array,size:12,setter:Xt,cols:3},Lt[35673]={Type:Uint32Array,size:16,setter:zt,cols:4},Lt[35674]={Type:Float32Array,size:32,setter:function(t,e){return function(i){t.uniformMatrix2fv(e,!1,i)}},rows:2,cols:2},Lt[35675]={Type:Float32Array,size:48,setter:function(t,e){return function(i){t.uniformMatrix3fv(e,!1,i)}},rows:3,cols:3},Lt[35676]={Type:Float32Array,size:64,setter:function(t,e){return function(i){t.uniformMatrix4fv(e,!1,i)}},rows:4,cols:4},Lt[35685]={Type:Float32Array,size:32,setter:function(t,e){return function(i){t.uniformMatrix2x3fv(e,!1,i)}},rows:2,cols:3},Lt[35686]={Type:Float32Array,size:32,setter:function(t,e){return function(i){t.uniformMatrix2x4fv(e,!1,i)}},rows:2,cols:4},Lt[35687]={Type:Float32Array,size:48,setter:function(t,e){return function(i){t.uniformMatrix3x2fv(e,!1,i)}},rows:3,cols:2},Lt[35688]={Type:Float32Array,size:48,setter:function(t,e){return function(i){t.uniformMatrix3x4fv(e,!1,i)}},rows:3,cols:4},Lt[35689]={Type:Float32Array,size:64,setter:function(t,e){return function(i){t.uniformMatrix4x2fv(e,!1,i)}},rows:4,cols:2},Lt[35690]={Type:Float32Array,size:64,setter:function(t,e){return function(i){t.uniformMatrix4x3fv(e,!1,i)}},rows:4,cols:3},Lt[35678]={Type:null,size:0,setter:$t,arraySetter:Wt,bindPoint:It},Lt[35680]={Type:null,size:0,setter:$t,arraySetter:Wt,bindPoint:kt},Lt[35679]={Type:null,size:0,setter:$t,arraySetter:Wt,bindPoint:Bt},Lt[35682]={Type:null,size:0,setter:$t,arraySetter:Wt,bindPoint:It},Lt[36289]={Type:null,size:0,setter:$t,arraySetter:Wt,bindPoint:Dt},Lt[36292]={Type:null,size:0,setter:$t,arraySetter:Wt,bindPoint:Dt},Lt[36293]={Type:null,size:0,setter:$t,arraySetter:Wt,bindPoint:kt},Lt[36298]={Type:null,size:0,setter:$t,arraySetter:Wt,bindPoint:It},Lt[36299]={Type:null,size:0,setter:$t,arraySetter:Wt,bindPoint:Bt},Lt[36300]={Type:null,size:0,setter:$t,arraySetter:Wt,bindPoint:kt},Lt[36303]={Type:null,size:0,setter:$t,arraySetter:Wt,bindPoint:Dt},Lt[36306]={Type:null,size:0,setter:$t,arraySetter:Wt,bindPoint:It},Lt[36307]={Type:null,size:0,setter:$t,arraySetter:Wt,bindPoint:Bt},Lt[36308]={Type:null,size:0,setter:$t,arraySetter:Wt,bindPoint:kt},Lt[36311]={Type:null,size:0,setter:$t,arraySetter:Wt,bindPoint:Dt};const Kt={};Kt[5126]={size:4,setter:Yt},Kt[35664]={size:8,setter:Yt},Kt[35665]={size:12,setter:Yt},Kt[35666]={size:16,setter:Yt},Kt[5124]={size:4,setter:Ht},Kt[35667]={size:8,setter:Ht},Kt[35668]={size:12,setter:Ht},Kt[35669]={size:16,setter:Ht},Kt[5125]={size:4,setter:jt},Kt[36294]={size:8,setter:jt},Kt[36295]={size:12,setter:jt},Kt[36296]={size:16,setter:jt},Kt[35670]={size:4,setter:Ht},Kt[35671]={size:8,setter:Ht},Kt[35672]={size:12,setter:Ht},Kt[35673]={size:16,setter:Ht},Kt[35674]={size:4,setter:Gt,count:2},Kt[35675]={size:9,setter:Gt,count:3},Kt[35676]={size:16,setter:Gt,count:4};const qt=36096,Jt=33306,Zt={};Zt[34041]=Jt,Zt[6401]=36128,Zt[36168]=36128,Zt[6402]=qt,Zt[33189]=qt,Zt[33190]=qt,Zt[36012]=qt,Zt[35056]=Jt,Zt[36013]=Jt;const Qt={};Qt[32854]=!0,Qt[32855]=!0,Qt[36194]=!0,Qt[34041]=!0,Qt[33189]=!0,Qt[6401]=!0,Qt[36168]=!0;const te=new WeakMap;class ee extends n{constructor(){super(),this.__components={}}addComponent(t){const e=t.getName();null!=t.holder&&t.removeFromHolder(),null!=this.__components[e]&&this.__components[e].removeFromHolder(),this.__components[e]=t;const i=te.get(t.constructor)||[];return i.includes(t)||(i.push(t),te.set(t.constructor,i)),t.holder=new Proxy(this,{get:(e,i)=>"addEventListener"==i?function(i,s,n,o){t.__savedHandlers=t.__savedHandlers||{},t.__savedHandlers[i]=t.__savedHandlers[i]||[],t.__savedHandlers[i].push([s,n]),e.addEventListener(...arguments)}:e[i]}),t.onAdded?t.onAdded.call(t,t.holder):Object.getPrototypeOf(t).onAdded&&Object.getPrototypeOf(t).onAdded.call(t,t.holder),t}createComponent(t,e){const i=new t;return this.addComponent(Object.assign(i,e)),i}removeComponent(t){if("function"==typeof t&&null!=t.prototype){for(const e in this.__components)t.getName()==e&&this.removeComponent(this.__components[e]);return}const e=t.getName();if(t.onRemoved?t.onRemoved.call(t,t.holder):Object.getPrototypeOf(t).onRemoved&&Object.getPrototypeOf(t).onRemoved.call(t,t.holder),delete this.__components[e],t.__savedHandlers){console.log(`${e}의 이벤트 핸들러를 정리한다`);for(const e in t.__savedHandlers)for(const[i,s]of t.__savedHandlers[e])console.log(`${e} 이벤트 핸들러 삭제`),this.removeEventListener(e,i,s)}const i=te.get(t.constructor);console.assert(Array.isArray(i));const s=i.indexOf(t);s>=0&&(i.splice(s,1),i.length>0?te.set(t.constructor,i):te.delete(t.constructor))}hasComponent(t){return null!=this.__components[t.name]}get components(){return this.__components}getComponent(t){return this.__components["string"==typeof t?t:t.name]}getCompatibleComponents(t){const e=[];for(const i in this.__components){const s=this.__components[i];s instanceof t&&e.push(s)}return e}static getAllComponents(t){return te.get(t)}static getAllComponentHolders(...t){let e;e=this.getAllComponents(t[0]);for(let i=1;i<t.length;i++){const s=this.getAllComponents(t[i]);e=s.filter(((t,i,s)=>e.includes(t)))}const i=[];for(const t of e)i.push(t.holder);return i}hasAllComponents(...t){for(const e of t)if(!this.hasComponent(e))return!1;return!0}}function ie(t){return Array.isArray(t)||t instanceof Float32Array?{x:t[0],y:t[1]}:t}ee.registeredHolders={};class se{constructor(t,e,i,s){Array.isArray(t)||t instanceof Float32Array?(this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3]):"object"==typeof t?(this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height):(this.x=t||0,this.y=e||0,this.width=i||0,this.height=s||0)}clone(){return new se(this)}getCornerPoints(){const{x:t,y:e,width:i,height:s}=this;return[t,e,t+i,e,t,e+s,t+i,e+s]}getArray(){return[this.x,this.y,this.width,this.height]}extendPoint(t,e){null==this.x?(this.x=t,this.y=e,this.width=0,this.height=0):(t<this.x&&(this.width+=this.x-t,this.x=t),e<this.y&&(this.height+=this.y-e,this.y=e),this.width=Math.max(this.right,t)-this.x,this.height=Math.max(this.bottom,e)-this.y)}extendRect(t){this.extendPoint(t.x,t.y),this.extendPoint(t.right,t.y),this.extendPoint(t.x,t.bottom),this.extendPoint(t.right,t.bottom)}get xywh(){return[this.x,this.y,this.width,this.height]}set xywh(t){const e=function(t){return Array.isArray(t)||t instanceof Float32Array?{x:t[0],y:t[1],width:t[2],height:t[3]}:t}(t);this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}contains(t,e){return t>=this.left&&t<this.right&&e>=this.top&&e<this.bottom}}class ne{constructor(t,e){Array.isArray(t)||t instanceof Float32Array?(this.x=t[0],this.y=t[1]):"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=e||0)}clone(){return new ne(this)}getArray(){return[this.x,this.y]}get xy(){return[this.x,this.y]}set xy(t){const e=ie(t);this.x=e.x,this.y=e.y}add(t){const e=ie(t);return this.x+=e.x,this.y+=e.y,new ne(this)}subtract(t){const e=ie(t);return this.x-=e.x,this.y-=e.y,new ne(this)}mul(t){const e=ie(t);return this.x*=e.x,this.y*=e.y,new ne(this)}}class oe{static Uint8ToFloat32(t,e=0,i=null){return new Float32Array(t.buffer,t.byteOffset+e,null!=i?Math.ceil(i/4):null)}static Uint16ToFloat32(t,e=0,i=null){return new Float32Array(t.buffer,t.byteOffset+2*e,null!=i?Math.ceil(i/2):null)}static Float32ToUint8(t,e=0,i=null){return new Uint8Array(t.buffer,t.byteOffset+4*e,null!=i?4*i:null)}static Float32ToUint16(t,e=0,i=null){return new Uint16Array(t.buffer,t.byteOffset+4*e,null!=i?2*i:null)}static subarray(t,e=0,i=null){return t.subarray(e,null!=i?e+i:null)}static resize(t,e){const i=new t.constructor(e);return i.set(t,0,Math.min(e,t.length)),i}static memcpy(t,e,i,s,n){if(n<100){const o=t.subarray(e),r=i.subarray(s);for(let t=0;t<n;t++)o[t]=r[t]}else{const o=n*i.BYTES_PER_ELEMENT,r=new Uint8Array(t.buffer,t.byteOffset+e*t.BYTES_PER_ELEMENT),a=new Uint8Array(i.buffer,i.byteOffset+s*i.BYTES_PER_ELEMENT,o);r.set(a)}}}const re={},ae=1.70158;re.inBack=function(t){return t*t*(2.70158*t-ae)},re.outBack=function(t){return(t-=1)*t*(2.70158*t+ae)+1},re.inOutBack=function(t){return(t*=2)<1?t*t*(3.5949095*t-2.5949095)*.5:.5*((t-=2)*t*(3.5949095*t+2.5949095)+2)},re.inBounce=function(t){return 1-re.outBounce(1-t)},re.outBounce=function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},re.inOutBounce=function(t){return(t*=2)<1?.5*re.inBounce(t):.5*re.outBounce(t-1)+.5},re.inCircular=function(t){return-(Math.sqrt(1-t*t)-1)},re.outCircular=function(t){return Math.sqrt(1-(t-1)*(t-1))},re.inOutCircular=function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):(t-=2,.5*(Math.sqrt(1-t*t)+1))},re.inCubic=function(t){return t*t*t},re.outCubic=function(t){return(t-=1)*t*t+1},re.inOutCubic=function(t){return t<.5?4*t*t*t:4*(t-=1)*t*t+1};var le=.3,he=.075;re.inElastic=function(t){return 0==t||1==t?t:(t-=1,-1*Math.pow(2,10*t)*Math.sin((t-he)*(2*Math.PI)/le))},re.outElastic=function(t){return 0==t||1==t?t:1*Math.pow(2,-10*t)*Math.sin((t-he)*(2*Math.PI)/le)+1},re.inOutElastic=function(t){return 0==t||1==t?t:(t=2*t-1)<0?1*Math.pow(2,10*t)*Math.sin((t-1.5*he)*(2*Math.PI)/(1.5*le))*-.5:.5*Math.pow(2,-10*t)*Math.sin((t-1.5*he)*(2*Math.PI)/(1.5*le))+1},re.inExponential=function(t){return 0==t?0:Math.pow(2,10*(t-1))},re.outExponential=function(t){return 1==t?1:1-Math.pow(2,-10*t)},re.inOutExponential=function(t){return 0==t||1==t?t:(t=2*t-1)<0?.5*Math.pow(2,10*t):1-.5*Math.pow(2,-10*t)},re.linear=function(t){return t},re.inQuadratic=function(t){return t*t},re.outQuadratic=function(t){return-t*(t-2)},re.inOutQuadratic=function(t){return t<.5?2*t*t:-2*t*(t-2)-1},re.inQuartic=function(t){return t*t*t*t},re.outQuartic=function(t){return 1-(t-=1)*t*t*t},re.inOutQuartic=function(t){return t<.5?8*t*t*t*t:-8*(t-=1)*t*t*t+1},re.inQuintic=function(t){return t*t*t*t*t},re.outQuintic=function(t){return 1+(t-=1)*t*t*t*t},re.inOutQuintic=function(t){return t<.5?16*t*t*t*t*t:16*(t-=1)*t*t*t*t+1},re.inSine=function(t){return 1-Math.cos(t*(Math.PI/2))},re.outSine=function(t){return Math.sin(t*(Math.PI/2))},re.inOutSine=function(t){return-.5*(Math.cos(t*Math.PI)-1)},re.outElasticSmooth=function(t){if(0==t||1==t)return t;return 1*Math.pow(2.5,-10*t)*Math.sin((t-.095)*(2*Math.PI)/.38)+1},re.inElasticSmooth2=function(t){if(0==t||1==t)return t;t-=1;return-1*Math.pow(2.6,10*t)*Math.sin((t-.1425)*(2*Math.PI)/.57)},re.outElasticSmooth2=function(t){if(0==t||1==t)return t;return 1*Math.pow(2.6,-10*t)*Math.sin((t-.1425)*(2*Math.PI)/.57)+1},re.outElasticWave=function(t){if(0==t||1==t)return t;var e=Math.pow(t,4);return(Math.pow(220,-.7*Math.pow(t,.4))*Math.sin((Math.pow(t,.95)-.0475)*(2*Math.PI)/.19)+1)*(1-e)+e};class ce{constructor(){this._x=0,this._y=0,this._anchorX=0,this._anchorY=0,this._scaleX=1,this._scaleY=1,this._rotation=0,this._matrixDirty=!1,this._matrix=E.identity(),this.invalidateCallback=null}get x(){return this._x}get y(){return this._y}get anchorX(){return this._anchorX}get anchorY(){return this._anchorY}get scaleX(){return this._scaleX}get scaleY(){return this._scaleY}get rotation(){return this._rotation}set x(t){this.setDirty(this._x!=t),this._x=t}set y(t){this.setDirty(this._y!=t),this._y=t}set anchorX(t){this.setDirty(this._anchorX!=t),this._anchorX=t}set anchorY(t){this.setDirty(this._anchorY!=t),this._anchorY=t}set scaleX(t){this.setDirty(this._scaleX!=t),this._scaleX=t}set scaleY(t){this.setDirty(this._scaleY!=t),this._scaleY=t}set rotation(t){this.setDirty(this._rotation!=t),this._rotation=t}get matrix(){if(this._matrixDirty){const t=E.translation([this._x,this._y,0]);E.scale(t,[this._scaleX,this._scaleY,1],t),E.rotateZ(t,this._rotation*Math.PI/180,t),this._matrix=t,this._matrixDirty=!1}return this._matrix}setDirty(t){this.invalidateCallback&&t&&this.invalidateCallback(),this._matrixDirty=this._matrixDirty||t}clone(){const t={};return Object.assign(t,this),Object.setPrototypeOf(t,this.constructor.prototype),t}}class de extends n{constructor(){super(),this.width=0,this.height=0,this.asset=void 0,this.uvRect=void 0}get size(){return[this.width,this.height]}}class ue{constructor(t,e,i,s){this.asset=new a("<Shader:*>",a.AssetTypes.Shader),this.textures=null!=i?i:{},this.constants=null!=s?s:{},this.dirty=!1,this.asset.load({vertexSrc:t,fragmentSrc:e,textures:this._getTextureIds(),constants:this.constants})}_getTextureIds(){const t={};for(let e in this.textures)t[e]=this.textures[e].asset.id;return t}_update(){this.dirty=!0}forceUpdate(){this.dirty&&(this.asset.update({textures:this._getTextureIds(),constants:this.constants}),this.dirty=!1)}release(){this.asset.release()}setConstant(t,e){return this.constants[t]=e,this._update(),this}setConstants(t){return Object.assign(this.constants,t),this._update(),this}setTexture(t,e){return this.textures[t]=e,this._update(),this}clone(){const t={textures:{},constants:{}};return t.asset=new a("<Shader:*>",a.AssetTypes.Shader),Object.assign(t.textures,this.textures),Object.assign(t.constants,this.constants),Object.setPrototypeOf(t,ue.prototype),t.asset.load({copyFrom:this.asset.id,textures:t._getTextureIds(),constants:t.constants}),t}}ue.lastId=0;class pe extends ee{constructor(){super(),this._$$id=pe.lastId++,pe.finalizationRegistry.register(this,{thisObjId:this._$$id}),this._$$spriteType=pe.SpriteTypes.SPRITE,this._$$updateCode=pe.UpdateCodes.UPDATE_NOTHING,this.transform=new ce,this.transform.invalidateCallback=this.onInvalidateTransform.bind(this),this._$$localBounds=new se(0,0,0,0),this._$$boundsDirty=!0,this._$$bounds=new se(0,0,0,0),this.customBounds=void 0,this.useCustomLocalBounds=!1,this.worldMatrix=void 0,this.colorOverride=[1,1,1,1],this.colorAdd=[0,0,0,0],this.clipRegion=null,this.children=[],this.parent=null,this._$$visible=!0,this.customPrev,this.asset,this.cacheBitmapMode=pe.CacheBitmapModes.NO_CACHE,this.cacheBitmapDstId=0,this.cacheBitmapAsset,this.blendMode=pe.BlendModes.NORMAL,this.motionBlur=!0,this.shader}static finalizeHandler(t){me.postMessageToRender({msg:"addCommand",class:"Sprite",method:"release",args:[t.thisObjId]})}release(){null!=this.asset&&this.asset.release();for(let t in this)delete this[t];me.postMessageToRender({msg:"addCommand",executionTiming:2,class:"Sprite",method:"release",args:[this._$$id]})}clone(){const t={};return Object.assign(t,this),Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t._$$id=pe.lastId++,t.transform=t.transform.clone(),t.transform.invalidateCallback=t.onInvalidateTransform.bind(t),t._$$localBounds=t._$$localBounds.clone(),t._$$bounds=t._$$bounds.clone(),t.worldMatrix=null!=t.worldMatrix?E.copy(t.worldMatrix):null,t.colorOverride=[...t.colorOverride],t.colorAdd=[...t.colorAdd],t.clipRegion=null!=t.clipRegion?t.clipRegion.clone():null,t.children=[...t.children],t.customPrev=null!=t.customPrev?Object.assign({},t.customPrev):null,t._$$updateCode|=pe.UpdateCodes.UPDATE_EXTRA,t}onInvalidateTransform(){let t=this;do{t._$$boundsDirty=!0,t=t.parent}while(null!=t);return t}getPath(t){const e=[];let i=this;for(;null!=i.parent;)t?e.unshift(i.parent.children.indexOf(i)+":"+i.constructor.name):e.unshift(i.parent.children.indexOf(i)),i=i.parent;return i.isStage?"//"+e.join("/"):"?/"+e.join("/")}get position(){return new ne(this.transform.x,this.transform.y)}set position(t){this.transform.x=t.x,this.transform.y=t.y}setPosition(t,e){this.transform.x=t,this.transform.y=e}getPosition(){return this.position}get x(){return this.transform.x}set x(t){this.transform.x=t}getX(){return this.transform.x}setX(t){this.transform.x=t}get y(){return this.transform.y}set y(t){this.transform.y=t}getY(){return this.transform.y}setY(t){this.transform.y=t}get xy(){return[this.x,this.y]}set xy(t){Array.isArray(t)?(this.x=t[0],this.y=t[1]):(this.x=t.x,this.y=t.y)}getRotation(){return this.transform.rotation}setRotation(t){this.transform.rotation=t}get anchorX(){return this.transform.anchorX/(this.bounds.width||1)}get anchorPosition(){return new ne(this.transform.anchorX,this.transform.anchorY)}set anchorPosition(t){this.transform.anchorX=t.x,this.transform.anchorY=t.y}get anchorPositionX(){return this.transform.anchorX}set anchorPositionX(t){this.transform.anchorX=t}get anchorPositionY(){return this.transform.anchorY}set anchorPositionY(t){this.transform.anchorY=t}set anchorX(t){this.transform.anchorX=t*this.bounds.width}get anchorY(){return this.transform.anchorY/(this.bounds.height||1)}set anchorY(t){this.transform.anchorY=t*this.bounds.height}getAnchorPoint(){return new ne(this.anchorX,this.anchorY)}setAnchorPoint(t,e){this.anchorX=t,this.anchorY=e}get scaleX(){return this.transform.scaleX}set scaleX(t){this.transform.scaleX=t}getScaleX(){return this.transform.scaleX}setScaleX(t){this.transform.scaleX=t}get scaleY(){return this.transform.scaleY}set scaleY(t){this.transform.scaleY=t}getScaleY(){return this.transform.scaleY}setScaleY(t){this.transform.scaleY=t}get scale(){return new ne(this.transform.scaleX,this.transform.scaleY)}set scale(t){if("number"==typeof t)this.transform.scaleX=t,this.transform.scaleY=t;else{const e=new ne(t);this.transform.scaleX=e.x,this.transform.scaleY=e.y}}getScale(){return this.scale}setScale(t,e){this.scaleX=t,this.scaleY=null==e?t:e}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get localBounds(){const t=new se(this._$$localBounds);return t.x-=this.transform.anchorX,t.y-=this.transform.anchorY,t}get bounds(){if(this.customBounds)return this.customBounds;if(!this._$$boundsDirty)return this._$$bounds;let t=E.identity(),e=new se,i=[];const s=(t,e)=>{if(t._$$boundsDirty){if(0!=t.spriteType){const[s,n,o,r,a,l,h,c]=t.localBounds.getCornerPoints();let d,u;[d,u]=E.transformPoint(e,[s,n,0]),i.push(d,u),[d,u]=E.transformPoint(e,[o,r,0]),i.push(d,u),[d,u]=E.transformPoint(e,[a,l,0]),i.push(d,u),[d,u]=E.transformPoint(e,[h,c,0]),i.push(d,u)}for(let i of t.children)i.visible&&s(i,E.multiply(e,i.transform.matrix))}else i.push(...t._$$boundsPoints)};s(this,t);for(let t=0;t<i.length;t+=2)e.extendPoint(i[t],i[t+1]);return this._$$bounds=e,this._$$boundsDirty=!1,this._$$boundsPoints=i,e}getBounds(){return this.bounds}updateLocalBounds(){}get visible(){return this._$$visible}set visible(t){!this._$$visible&&t&&this._updateChildren(pe.UpdateCodes.UPDATE_CLEAR_PREV),this._$$visible=t}isVisible(){return this.visible}setVisible(t){this.visible=t}isVisibleDeeply(){let t;for(t=this;null!=t&&!t.isStage;t=t.parent)if(!t.visible)return!1;return null!=t}get redMultiplier(){return this.colorOverride[0]}set redMultiplier(t){this.colorOverride[0]=t}get greenMultiplier(){return this.colorOverride[1]}set greenMultiplier(t){this.colorOverride[1]=t}get blueMultiplier(){return this.colorOverride[2]}set blueMultiplier(t){this.colorOverride[2]=t}get alpha(){return this.colorOverride[3]}set alpha(t){this.colorOverride[3]=t}setAlpha(t){this.colorOverride[3]=t}getAlpha(t){return this.colorOverride[3]}setColorMultiplier(t,e,i,s){this.colorOverride[0]=t,this.colorOverride[1]=e,this.colorOverride[2]=i,null!=s&&(this.colorOverride[3]=s)}setOverrideColor(t,e){const i=o.hex2rgba(t,e);this.colorOverride[0]=i[0],this.colorOverride[1]=i[1],this.colorOverride[2]=i[2],null!=e&&(this.colorOverride[3]=i[3])}get width(){return this.bounds.width}set width(t){this.customBounds=this.customBounds||this.bounds,this.customBounds.width=t}get height(){return this.bounds.height}set height(t){this.customBounds=this.customBounds||this.bounds,this.customBounds.height=t}setCustomBounds(t,e,i,s){this.customBounds.x=t,this.customBounds.y=e,this.customBounds.width=i,this.customBounds.height=s}getWidth(){return this.width}getHeight(){return this.height}localToGlobal(t,e){let i=[];for(let t=this;i.unshift(t.transform.matrix),null!=t.parent;t=t.parent);let s=E.identity();i.forEach((t=>{E.multiply(s,t,s)}));let n=E.transformPoint(s,[t,e,0]);return new ne(n[0],n[1])}globalToLocal(t,e){if(null==this.parent||this.isStage)return new ne(t,e);let i=[];for(let t=this;i.push(E.inverse(t.transform.matrix)),null!=t.parent;t=t.parent);let s=E.identity();i.forEach((t=>{E.multiply(s,t,s)}));let n=E.transformPoint(s,[t,e,0]);return new ne(n[0],n[1])}setBlendMode(t){this.blendMode=t}_updateChildren(t){for(const e of this.searchChildren())e.updateCode|=t}addChildAt(t,e){null==e&&(e=this.children.length);const i=this.children.indexOf(t);this.children.splice(e,0,t),i>=0&&(i>e?this.children.splice(i+1,1):i<e&&this.children.splice(i,1)),t.parent=this,this.isOnStage()&&(t._updateChildren(pe.UpdateCodes.UPDATE_CLEAR_PREV),t.dispatchEventWithChildren(new s(s.ADDED_TO_STAGE))),this.onInvalidateTransform()}addChild(...t){for(const e of t)this.addChildAt(e)}removeChildAt(t){const e=this.children[t];e.parent=null,this.children.splice(t,1),this.isOnStage()&&e.dispatchEventWithChildren(new s(s.REMOVED_FROM_STAGE)),this.onInvalidateTransform()}removeChild(t){let e=this.children.indexOf(t);-1!=e&&this.removeChildAt(e)}removeFromParent(){this.parent&&this.parent.removeChild(this)}clearChildren(){for(let t=this.children.length-1;t>=0;t--)this.removeChildAt(t)}getChildIndex(t){return this.children.indexOf(t)}getChildAt(t){return this.children[t]}getStage(){let t;for(t=this;null!=t&&!t.isStage;t=t.parent);return t}isOnStage(){return null!=this.getStage()}dispatchEventWithChildren(t,e){let i;i="string"==typeof t?new s(t):t,Object.assign(i,e);for(const t of this.searchChildren(!0)){if(i.stopped)return;t.dispatchEvent(i)}}*searchChildren(t){yield*pe.searchChildren(this,t)}static*searchChildren(t,e=!1){const i=function*(t){if(e){if(t.children.length>0)for(let e=t.children.length-1;e>=0;e--){const s=t.children[e];s&&(yield*i(s))}yield t}else if(yield t,t.children.length>0)for(let e=0;e<t.children.length;e++){const s=t.children[e];s&&(yield*i(s))}};yield*i(t)}findChildById(t){for(let e of this.searchChildren())if(e.id==t)return e}getNumChildren(){return this.children.length}getParent(){return this.parent}contains(t){return this.children.includes(t)}hitTestPoint(t,e){const i=this.globalToLocal(t,e);return this.bounds.contains(i.x,i.y)}setClip(t,e,i,s){this.clipRegion=new se(t,e,i,s)}setShader(t){this.shader=t}getShader(){return this.shader}setInteractive(t=null){this.__interactive=this.__interactive||{};const e=this.__interactive,i=t&&null!=t.clickRadius?t.clickRadius:10,n=i=>{this.hitTestPoint(i.x,i.y)&&(e.downPointerPosition=new ne(i.x,i.y),e.downThisPosition=this.getPosition().clone(),e.downOffset=new ne(i.x-this.x,i.y-this.y),e.downButton=i.button,e.pushed=!0,e.clickCanceled=!1,e.state="down",t.disableBasicAnimation?t.pressAnimation&&(e.tween&&e.tween.stop(),e.tween=t.pressAnimation.call(this,i,e),i.stopPropagation()):(e.tween&&e.tween.stop(),e.tween=this.move(e.downThisPosition.x,e.downThisPosition.y+(null!=t.pressOffsetY?t.pressOffsetY:3),300,re.outBack),i.stopPropagation()),null!=t.down&&t.down.call(this,i,e))},r=s=>{"down"!=e.state&&"move"!=e.state||(e.state="move",e.moveDeltaPosition=new ne(s.x-e.downPointerPosition.x,s.y-e.downPointerPosition.y),e.moveThisPosition=new ne(t.dragX?e.downThisPosition.x+e.moveDeltaPosition.x:e.downThisPosition.x,t.dragY?e.downThisPosition.y+e.moveDeltaPosition.y:e.downThisPosition.y),t.allowDragOutside||(e.moveThisPosition.x=o.clamp(e.moveThisPosition.x,me.logicalRenderBounds.left-e.downOffset.x,me.logicalRenderBounds.right-e.downOffset.x),e.moveThisPosition.y=o.clamp(e.moveThisPosition.y,me.logicalRenderBounds.top-e.downOffset.y,me.logicalRenderBounds.bottom-e.downOffset.y)),(t.dragX||t.dragY)&&e.tween&&e.tween.cancel(),t.dragX&&(this.x=e.moveThisPosition.x),t.dragY&&(this.y=e.moveThisPosition.y),0==e.clickCanceled&&Math.sqrt(e.moveDeltaPosition.x**2+e.moveDeltaPosition.y**2)>i&&(e.clickCanceled=!0),s.stopPropagation(),null!=t.move&&t.move.call(this,s,e),e.pushed&&!this.hitTestPoint(s.x,s.y)?(e.pushed=!1,t.disableBasicAnimation?t.releaseAnimation&&(e.tween&&e.tween.stop(),e.tween=t.releaseAnimation.call(this,s,e),s.stopPropagation()):(e.tween&&e.tween.stop(),e.tween=this.move(e.moveThisPosition.x,e.moveThisPosition.y,200,re.outCubic),s.stopPropagation())):!e.pushed&&this.hitTestPoint(s.x,s.y)&&(e.pushed=!0,t.disableBasicAnimation?t.pressAnimation&&(e.tween&&e.tween.stop(),e.tween=t.pressAnimation.call(this,s,e),s.stopPropagation()):(e.tween&&e.tween.stop(),e.tween=this.move(e.moveThisPosition.x,e.moveThisPosition.y+(null!=t.pressOffsetY?t.pressOffsetY:3),100,re.outCubic),s.stopPropagation())))},a=s=>{"down"!=e.state&&"move"!=e.state||(e.state="up",e.moveDeltaPosition=new ne(s.x-e.downPointerPosition.x,s.y-e.downPointerPosition.y),e.moveThisPosition=new ne(t.dragX?e.downThisPosition.x+e.moveDeltaPosition.x:e.downThisPosition.x,t.dragY?e.downThisPosition.y+e.moveDeltaPosition.y:e.downThisPosition.y),t.dragX&&(this.x=e.moveThisPosition.x),t.dragY&&(this.y=e.moveThisPosition.y),t.allowDragOutside||(e.moveThisPosition.x=o.clamp(e.moveThisPosition.x,me.logicalRenderBounds.left-e.downOffset.x,me.logicalRenderBounds.right-e.downOffset.x),e.moveThisPosition.y=o.clamp(e.moveThisPosition.y,me.logicalRenderBounds.top-e.downOffset.y,me.logicalRenderBounds.bottom-e.downOffset.y)),0==e.clickCanceled&&Math.sqrt(e.moveDeltaPosition.x**2+e.moveDeltaPosition.y**2)<i&&null!=t.click&&t.click.call(this,s,e),this.hitTestPoint(s.x,s.y)&&(e.pushed=!0,null!=t.press&&t.press.call(this,s,e)),t.preventRelease||(t.disableBasicAnimation?t.releaseAnimation&&(e.tween&&e.tween.stop(),e.tween=t.releaseAnimation.call(this,s,e),s.stopPropagation()):(e.tween&&e.tween.stop(),e.tween=this.move(e.moveThisPosition.x,e.moveThisPosition.y,300,re.outBounce),s.stopPropagation())),null!=t.up&&t.up.call(this,s,e))};null!=t?(this.on(s.POINTER_DOWN,n),this.on(s.POINTER_MOVE,r),this.on(s.POINTER_UP,a)):(this.removeEventListener(s.POINTER_DOWN,n),this.removeEventListener(s.POINTER_MOVE,r),this.removeEventListener(s.POINTER_UP,a),delete this.__interactive)}encodeRenderingInfo(){const t=new Float32Array(38);return t.set([this._$$id,this._$$spriteType,this._$$updateCode,this.colorOverride[0],this.colorOverride[1],this.colorOverride[2],this.colorOverride[3],this.colorAdd[0],this.colorAdd[1],this.colorAdd[2],this.colorAdd[3],this.transform.anchorX,this.transform.anchorY]),null!=this.shader?(this.shader.forceUpdate(),t[13]=this.shader.asset.id):t[13]=0,oe.memcpy(t,14,this.transform.matrix,0,16),t.set(null!=this.clipRegion?this.clipRegion.xywh:[NaN,NaN,NaN,NaN],30),t[34]=null!=this.cacheBitmapAsset?this.cacheBitmapAsset.id:0,t[35]=this.cacheBitmapDstId,t[36]=this.blendMode,t[37]=+this.motionBlur,t}encodeCustomPrev(){const t=new Float32Array(22);return t.set([this.customPrev.colorOverride[0],this.customPrev.colorOverride[1],this.customPrev.colorOverride[2],this.customPrev.colorOverride[3],this.customPrev.anchorPositionX,this.customPrev.anchorPositionY]),oe.memcpy(t,6,this.customPrev.worldMatrix,0,16),t}sortChildren(t="y"){this.children.sort(((e,i)=>e[t]-i[t]))}setCustomPrev(t,e,i,s){this.customPrev={worldMatrix:t,colorOverride:e,anchorPositionX:i,anchorPositionY:s},this._$$updateCode|=pe.UpdateCodes.UPDATE_CUSTOM_PREV}setCacheMode(t){if(this.cacheBitmapMode==pe.CacheBitmapModes.SNAPSHOT&&this._updateChildren(pe.UpdateCodes.UPDATE_CLEAR_PREV),this.cacheBitmapAsset){this.cacheBitmapAsset.release();const t=e=>{if(e.cacheBitmapMode==pe.CacheBitmapModes.NO_CACHE){this.cacheBitmapAsset=null,e.cacheBitmapDstId=0;for(let i of e.children)t(i)}};this.cacheBitmapMode=pe.CacheBitmapModes.NO_CACHE,t(this)}this.cacheBitmapMode=t}encodeRenderingInfoWithChildren(){const t=[],e=[];if(this.visible){!function i(s,n,o,r,l){const h=s.encodeRenderingInfo(),c=h.subarray(14,30),d=h.subarray(3,7),u=h.subarray(30,34);let p,f,y,m,g=0,v=!1;if(!Number.isNaN(u[0])){let t=E.transformPoint(n,[u[0],u[1],0]);u[0]=t[0]+s.x,u[1]=t[1]+s.y}if(E.multiply(n,c,c),s.worldMatrix=E.copy(c),s.cacheBitmapMode!=pe.CacheBitmapModes.NO_CACHE&&(null==s.cacheBitmapAsset?v=!0:s.cacheBitmapMode==pe.CacheBitmapModes.FILTER&&(s.cacheBitmapAsset.release(),v=!0)),v){const t=s.bounds,e=new a("<RT:*>",a.AssetTypes.RenderTarget);e.load({x:t.x,y:t.y,width:Math.min(2048,t.width),height:Math.min(2048,t.height),worldMatrix:s.worldMatrix}),s.cacheBitmapAsset=e,g=e.id,s.cacheBitmapDstId=g,l=g}else s.cacheBitmapDstId=l||s.cacheBitmapDstId;if(h[35]=s.cacheBitmapDstId,d[0]=d[0]*o[0],d[1]=d[1]*o[1],d[2]=d[2]*o[2],d[3]=d[3]*o[3],Number.isNaN(u[0])&&!Number.isNaN(r[0])&&u.set(r),0!=s._$$spriteType){if(s._$$updateCode&pe.UpdateCodes.UPDATE_EXTRA&&null!=s.encodeExtraRenderingInfo){let t;[p,f,y,t]=s.encodeExtraRenderingInfo(),t&&e.push(...t)}s._$$updateCode&pe.UpdateCodes.UPDATE_CUSTOM_PREV&&(m=s.encodeCustomPrev()),h[34]=0,t.push([h,p,f,m,y])}if(s.cacheBitmapMode==pe.CacheBitmapModes.SNAPSHOT&&0==s.cacheBitmapDstId||(s.children.forEach((t=>{t.visible&&(i(t,c,d,u,l),s.cacheBitmapMode==pe.CacheBitmapModes.SNAPSHOT&&(t.cacheBitmapDstId=0))})),s.cacheBitmapMode==pe.CacheBitmapModes.SNAPSHOT&&(s.cacheBitmapDstId=0)),s.cacheBitmapAsset){const e=new Float32Array(h);e[34]=g,e[35]=0,t.push([e,null,null,m,null])}s._$$updateCode=pe.UpdateCodes.UPDATE_NOTHING}(this,E.identity(),[1,1,1,1],[NaN,NaN,NaN,NaN],0);for(let i=0;i<t.length;i++)e.push(t[i][0].buffer),t[i][1]&&e.push(t[i][1].buffer),t[i][3]&&e.push(t[i][3].buffer);return[t,e]}return[null,null]}}pe.lastId=1,pe.finalizationRegistry=new FinalizationRegistry(pe.finalizeHandler),pe.loadedEventDispatcher=new n,pe.SpriteTypes={SPRITE:0,BITMAP:1,MESH:2,TEXTFIELD:3,PIXEL:4,SHAPE:5},pe.UpdateCodes={UPDATE_NOTHING:0,UPDATE_EXTRA:1,UPDATE_CLEAR_PREV:2,UPDATE_CUSTOM_PREV:4},pe.CacheBitmapModes={NO_CACHE:0,SNAPSHOT:1,FILTER:2},pe.BlendModes={NORMAL:0,MULTIPLY:1,ADD:2,SCREEN:3,NORMAL_NPM:4,ADD_NPM:5,SCREEN_NPM:6};class fe extends pe{constructor(){super(),this.isStage=!0}}class ye extends n{constructor(){super(),console.log("🎮 Application start."),this.stage=new fe,this.lastUpdate=performance.now(),onmessage=this.onRenderMessage.bind(this),this.paused=!1,this.inputEnabled=!0,this.physicsReady=!1,this.physicsWorker=new Worker("physics.js"),this.physicsWorker.onmessage=this.onPhysicsMessage.bind(this),this.physicsWorker.postMessage({msg:"setStageBound",args:[640,480,!0,!0,!0,!0]}),this.touchEnabled=self._deviceInfo.touchEnabled,this.logicalViewport=new se(0,0,0,0),this.logicalViewportOffset=new ne(self._deviceInfo.logicalViewportOffset),this.logicalViewportScale=new ne(self._deviceInfo.logicalViewportScale),this.deviceViewport=new se(self._deviceInfo.deviceViewport),this.init(640,480,60,ye.ScaleModes.LETTERBOX)}init(t,e,i=60,s=ye.ScaleModes.LETTERBOX){this.logicalViewport=new se(0,0,t,e),this.setUpdateFPS(i),this.postMessageToRender({msg:"addCommand",class:"Application",method:"setLogicalViewport",args:[this.logicalViewport.xywh,s]})}onPhysicsMessage(t){const e=t.data;"ready"==e.msg?(console.log("👍 Physics ready."),this.physicsReady=!0):"deviceInfo"==e.msg&&(self._deviceInfo=t.data.info,this.dispatchEvent(s.RESIZE))}onRenderMessage(t){const e=t.data;"render"==e.msg?this.renderTick():"deviceInfo"==e.msg?(this.deviceViewport=new se(e.info.deviceViewport),this.logicalViewportOffset=new ne(e.info.logicalViewportOffset),this.logicalViewportScale=new ne(e.info.logicalViewportScale),this.dispatchEvent(s.RESIZE)):"Asset_loadCompleted"==e.msg?a.dispatchLoadedEvent(e.id):"input"==e.msg&&this.enableInput?this.onInputMessage(e.inputType,e.secondlyInputType,e.inputData):console.log("onRenderMessage",t)}get logicalRenderBounds(){return new se(-this.logicalViewportOffset.x,-this.logicalViewportOffset.y,this.logicalViewport.width+2*this.logicalViewportOffset.x,this.logicalViewport.height+2*this.logicalViewportOffset.y)}onInputMessage(t,e,i){const n=new s(t);Object.assign(n,i),this.stage.dispatchEventWithChildren(n),!n.stopped&&e&&(n.name=e,this.stage.dispatchEventWithChildren(n))}renderTick(){const t=(performance.now()-this.lastUpdate)/(1e3/this.updateFPS),e=Math.round(t);if(!this.paused)for(let t=0;t<Math.min(5,e);t++)this.update();this.lastUpdate+=1e3/this.updateFPS*e}update(){this.dispatchEvent(s.BEFORE_UPDATE),n.doEnterFrame();let[t,e]=this.stage.encodeRenderingInfoWithChildren();this.physicsReady&&this.physicsWorker.postMessage({msg:"update"}),this.postMessageToRender({msg:"update",renderingInfo:t},e),this.dispatchEvent(s.AFTER_UPDATE)}setUpdateFPS(t){this.updateFPS=t,this.postMessageToRender({msg:"addCommand",class:"Application",method:"setUpdateFPS",args:[this.updateFPS]})}setPaused(t){this.paused=t,this.enableInput(!t)}enableInput(t){this.inputEnabled=t}setBackgroundColor(t){this.postMessageToRender({msg:"addCommand",class:"Application",method:"setBackgroundColor",args:[o.hex2rgba(t)]})}postMessageToRender(t,e){postMessage(t,e)}preload(t,e){return a.preload(t,e)}}ye.ScaleModes={NO_SCALE:"NO_SCALE",CENTER:"CENTER",CROP:"CROP",LETTERBOX:"LETTERBOX",STRETCH:"STRETCH",FIT_WIDTH:"FIT_WIDTH",FIT_HEIGHT:"FIT_HEIGHT"},null==self.application&&(self.application=new ye);const me=self.application,ge=self.application.stage;console.assert(o.isWebWorker(),"Application을 메인쓰레드에 만들려고 하고 있음");class ve extends pe{constructor(t){super(),this._$$spriteType=pe.SpriteTypes.BITMAP,this._$$updateCode=pe.UpdateCodes.UPDATE_EXTRA,this.texture=t,this._$$localBounds.x=0,this._$$localBounds.y=0,this._$$localBounds.width=t.width,this._$$localBounds.height=t.height}encodeExtraRenderingInfo(){let t=new Float32Array(9);return t[0]=this.texture.asset.id,t.set(this.texture.uvRect.getCornerPoints(),1),[t]}setTexture(t){this.texture=t,this._$$updateCode|=pe.UpdateCodes.UPDATE_EXTRA}}class _e extends de{constructor(t,e=!1,i={}){super(),this.asset=new a(t,a.AssetTypes.Texture);const s=o.getImageSize(t);this.uvRect=i.rect||new se(0,0,s.width,s.height),this.width=this.uvRect.width,this.height=this.uvRect.height,this.asset.load({width:s.width,height:s.height,uvRect:this.uvRect,filter:e})}addEventListener(t,e,i=null,n=!1){return t==s.LOADED&&this.asset.addEventListener(t,this.dispatchEvent.bind(this,s.LOADED),null,n),super.addEventListener(t,e,i,n)}}class xe extends n{constructor(t,e,i){super(),this.name=t,this.referenceSize=e||1,this.styles=i,this.asset}addEventListener(t,e,i=null,n=!1){return t==s.LOADED&&this.asset.addEventListener(t,this.dispatchEvent.bind(this,s.LOADED),null,n),super.addEventListener(t,e,i,n)}getAscender(t){if(!this.asset.loaded)return console.log(`로딩이 안된 상태로 사이즈를 구하려고 한다. ${this.asset.name}`),0;const e=this.asset.fontInfo;return e.ascender/e.unitsPerEm*(t||this.referenceSize)}measureTextWidth(t,e){if(!this.asset.loaded)return console.log(`로딩이 안된 상태로 사이즈를 구하려고 한다. ${this.asset.name}`),0}}class we extends xe{constructor(t,e,i){super(t,e,i),this.asset=new a(t,a.AssetTypes.TrueTypeFont),this.asset.load({referenceSize:this.referenceSize,styles:this.styles}),this.fontLoaded=!1}measureTextWidth(t,e){super.measureTextWidth(t,e);const i=this.asset.fontInfo;let s=0;for(let e=0;e<t.length;e++){const n=t.charCodeAt(e),o=i.chars[n];if(Array.isArray(o)?s+=o[0]:null!=o&&(s+=o),e<t.length-1&&i.kerningPairs){const o=t.charCodeAt(e+1),r=i.kerningPairs[n+","+o];r&&(s+=r)}}return s/i.unitsPerEm*(e||this.referenceSize)}}const be="Escape",Ce="Enter",Ee="Space",Ae="ArrowLeft",Te="ArrowRight",Pe="ArrowUp",Me="ArrowDown",Se="ControlLeft",Oe="KeyA",Re="KeyD",Ie="KeyI",ke="KeyJ",Be="KeyK",De="KeyL",Le="KeyM",Fe="KeyN",Ne="KeyO",Ue="KeyS",Ve="KeyW",Xe="KeyX",ze="KeyZ";class $e extends pe{constructor(){super(),this._$$spriteType=pe.SpriteTypes.MESH,this._$$updateCode=pe.UpdateCodes.UPDATE_NOTHING,this.dirty={positionOffset:0,positionLength:0,texCoordOffset:0,texCoordLength:0,colorOffset:0,colorLength:0,indexOffset:0,indexLength:0,textureReset:!1,positionReset:!1,texCoordReset:!1,colorReset:!1,indexReset:!1},this.a_position=void 0,this.a_texCoord=void 0,this.a_color=void 0,this.indices=void 0,this.a_genericArray=void 0}setTexture(t){this.texture=t,this._$$updateCode|=pe.UpdateCodes.UPDATE_EXTRA,this.dirty.textureReset=!0}setTextureCoordinateArray(t){this.dirty.texCoordReset=!(this.a_texCoord&&this.a_texCoord.length>=t.length),this.a_texCoord=new Float32Array(t),this._$$updateCode|=pe.UpdateCodes.UPDATE_EXTRA,this.dirty.texCoordOffset=0,this.dirty.texCoordLength=this.a_texCoord.length}setTextureCoordinates(...t){let e=1/0,i=-1/0;for(let s=0;s<t.length;s+=3){const n=t[s],o=t[s+1],r=t[s+2];this.a_texCoord[2*n]=o,this.a_texCoord[2*n+1]=r,e=Math.min(e,n),i=Math.max(i,n)}this._$$updateCode|=pe.UpdateCodes.UPDATE_EXTRA,this.dirty.texCoordOffset=2*Math.min(this.dirty.texCoordOffset/2,e),this.dirty.texCoordLength=2*Math.max((this.dirty.texCoordOffset+this.dirty.texCoordLength)/2,i)}setTextureCoordinate(t,e,i){this.a_texCoord[2*t]=e,this.a_texCoord[2*t+1]=i}getTextureCoordinate(t){return new ne(this.a_texCoord[2*t],this.a_texCoord[2*t+1])}_calculateLocalBounds(t=0,e=this.a_position.length/2){let i=1/0,s=-1/0,n=1/0,o=-1/0;for(let r=t;r<2*e;r+=2){const t=this.a_position[r],e=this.a_position[r+1];i=Math.min(t,i),s=Math.max(t,s),n=Math.min(e,n),o=Math.max(e,o)}this._$$localBounds.x=i,this._$$localBounds.y=n,this._$$localBounds.width=s-i,this._$$localBounds.height=o-n}setVertexArray(t){this.dirty.positionReset=!(this.a_position&&this.a_position.length>=t.length),this.a_position=new Float32Array(t),this._$$updateCode|=pe.UpdateCodes.UPDATE_EXTRA,this.useCustomLocalBounds||this._calculateLocalBounds(),this.dirty.positionOffset=0,this.dirty.positionLength=this.a_position.length}setVertices(...t){let e=1/0,i=-1/0,s=this._$$localBounds.left,n=this._$$localBounds.right,o=this._$$localBounds.top,r=this._$$localBounds.bottom;for(let a=0;a<t.length;a+=3){const l=t[a],h=t[a+1],c=t[a+2];this.a_position[2*l]=h,this.a_position[2*l+1]=c,s=Math.min(h,s),n=Math.max(h,n),o=Math.min(c,o),r=Math.min(c,r),e=Math.min(e,l),i=Math.max(i,l)}this._$$updateCode|=pe.UpdateCodes.UPDATE_EXTRA,this.useCustomLocalBounds||(this._$$localBounds.x=s,this._$$localBounds.y=o,this._$$localBounds.width=n-s,this._$$localBounds.height=r-o),this.dirty.positionOffset=2*Math.min(this.dirty.positionOffset/2,e),this.dirty.positionLength=2*Math.max((this.dirty.positionOffset+this.dirty.positionLength)/2,i)}setVertex(t,e,i){this.a_position[2*t]=e,this.a_position[2*t+1]=i}getVertex(t){return new ne(this.a_position[2*t],this.a_position[2*t+1])}setColorArray(t){this.dirty.colorReset=!(this.a_color&&this.a_color.length>=2*t.length),this.a_color=new Uint8Array(2*t.length);for(let e=0;e<t.length;e+=2)this.a_color[2*e+0]=t[e]>>16&255,this.a_color[2*e+1]=t[e]>>8&255,this.a_color[2*e+2]=255&t[e],this.a_color[2*e+3]=255*t[e+1];this._$$updateCode|=pe.UpdateCodes.UPDATE_EXTRA,this.dirty.colorOffset=0,this.dirty.colorLength=this.a_color.length}setColors(...t){let e=1/0,i=-1/0;for(let s=0;s<t.length;s+=3){const n=t[s],o=t[s+1],r=t[s+2];this.a_color[4*n]=o>>16&255,this.a_color[4*n+1]=o>>8&255,this.a_color[4*n+2]=255&o,this.a_color[4*n+3]=255*r,e=Math.min(e,n),i=Math.max(i,n)}this._$$updateCode|=pe.UpdateCodes.UPDATE_EXTRA,this.dirty.colorOffset=4*Math.min(this.dirty.colorOffset/4,e),this.dirty.colorLength=4*Math.max((this.dirty.colorOffset+this.dirty.colorLength)/4,i)}getColorArraySize(){return this.a_color.length/4}setRgbaColorArray(t){this.dirty.colorReset=!(this.a_color&&this.a_color.length>=t.length),this.a_color=new Uint8Array(t.map((t=>255*t))),this._$$updateCode|=pe.UpdateCodes.UPDATE_EXTRA,this.dirty.colorOffset=0,this.dirty.colorLength=this.a_color.length}setColor(t,e,i){const s=o.hex2rgba(e,i);this.a_color[4*t]=s[0],this.a_color[4*t+1]=s[1],this.a_color[4*t+2]=s[2],this.a_color[4*t+3]=s[3]}getColor(t){return{color:16777215&o.rgba2hex(this.a_color,4*t),alpha:this.a_color[4*t+3]}}setIndexArray(t){this.dirty.indexReset=!0,this.indices=new Uint16Array(2*Math.ceil(t.length/2)),this.indices.set(t),this._$$updateCode|=pe.UpdateCodes.UPDATE_EXTRA,this.dirty.indexOffset=0,this.dirty.indexLength=this.indices.length}setIndices(...t){let e=1/0,i=-1/0;for(let s=0;s<t.length;s+=2){const n=t[s],o=t[s+1];this.indices[n]=o,e=Math.min(e,n),i=Math.max(i,n)}this._$$updateCode|=pe.UpdateCodes.UPDATE_EXTRA,this.dirty.indexOffset=Math.min(this.dirty.indexOffset,e),this.dirty.indexLength=Math.max(this.dirty.indexOffset+this.dirty.indexLength,i)}getIndex(t){return this.indices[t]}setIndex(t,e){this.indices[t]=e}setGenericArray(t,e,i=$e.ArrayTypes.FLOAT32,s=1,n=!1){this.a_genericArray=this.a_genericArray||{},this.a_genericArray[t]={data:new i(e),numComponents:s,normalize:n},this._$$updateCode|=pe.UpdateCodes.UPDATE_EXTRA}static createBox(t,e,i,s,n=16777215,o=1){const r=new $e;return r.setVertexArray([t,e,t+i,e,t,e+s,t+i,e+s]),r.setColorArray([n,o,n,o,n,o,n,o]),r.setIndexArray([0,1,2,1,3,2]),r}encodeExtraRenderingInfo(){const t=new Float32Array(14+this.dirty.positionLength+this.dirty.texCoordLength+Math.ceil(this.dirty.colorLength/4)+Math.ceil(this.dirty.indexLength/2));t.set([null!=this.texture?this.texture.asset.id:0,this.dirty.positionOffset,this.dirty.positionLength,this.dirty.texCoordOffset,this.dirty.texCoordLength,this.dirty.colorOffset,this.dirty.colorLength,this.dirty.indexOffset,this.dirty.indexLength,+this.dirty.textureReset,+this.dirty.positionReset,+this.dirty.texCoordReset,+this.dirty.colorReset,+this.dirty.indexReset]);let e,i,s=14;if(this.dirty.positionLength>0&&(t.set(oe.subarray(this.a_position,this.dirty.positionOffset,this.dirty.positionLength),s),s+=this.dirty.positionLength),this.dirty.texCoordLength>0&&(t.set(oe.subarray(this.a_texCoord,this.dirty.texCoordOffset,this.dirty.texCoordLength),s),s+=this.dirty.texCoordLength),this.dirty.colorLength>0&&(t.set(oe.Uint8ToFloat32(this.a_color,this.dirty.colorOffset,this.dirty.colorLength),s),s+=this.dirty.colorLength/4),this.dirty.indexLength>0&&t.set(oe.Uint16ToFloat32(this.indices,this.dirty.indexOffset,this.dirty.indexLength),s),this.dirty.textureReset=!1,this.dirty.positionReset=!1,this.dirty.texCoordReset=!1,this.dirty.colorReset=!1,this.dirty.indexReset=!1,this.a_genericArray){e=this.a_genericArray,i=[];for(let t in this.a_genericArray)i.push(this.a_genericArray[t].data.buffer)}return[t,null,e,i]}}$e.ArrayTypes={UINT32:Uint32Array,UINT16:Uint16Array,UINT8:Uint8Array,FLOAT32:Float32Array};class We extends pe{constructor(t=16777215,e=1,i=1,s=1){super(),this._$$spriteType=pe.SpriteTypes.PIXEL,this._$$updateCode=pe.UpdateCodes.UPDATE_EXTRA,this.pixelColor=o.hex2rgba(t,e),this.pixelWidth=i,this.pixelHeight=s,this._$$localBounds.x=0,this._$$localBounds.y=0,this._$$localBounds.width=i,this._$$localBounds.height=s}setColor(t=16777215,e=1){this.pixelColor=o.hex2rgba(t,e),this._$$updateCode=pe.UpdateCodes.UPDATE_EXTRA}encodeExtraRenderingInfo(){let t=new Float32Array(6);return t[0]=this.pixelWidth,t[1]=this.pixelHeight,t.set(this.pixelColor,2),[t]}}class Ye extends de{constructor(t,e,i=!1){super(),this.asset=new a("<RT:*>",a.AssetTypes.RenderTarget),this.width=t,this.height=e,this.uvRect=new se(0,0,this.width,this.height),this.asset.load({width:this.width,height:this.height,filter:i})}clear(t=0,e=0){me.postMessageToRender({msg:"addCommand",class:"RenderTarget",method:"clear",args:[this.asset.id,o.hex2rgba(t,e)]})}draw(t){let[e,i]=t.encodeRenderingInfoWithChildren();me.postMessageToRender({msg:"addCommand",class:"RenderTarget",method:"draw",args:[this.asset.id,e]},i)}}class He extends n{constructor(t,e=0){super(),this.delay=t,this.repeatCount=e,this.count=0}start(){this.stop(),this.__timer=setInterval((()=>{this.count++;const t=new s(s.TIMER);t.timer=this,this.dispatchEvent(t),0!=this.repeatCount&&this.count>=this.repeatCount&&this.stop()}),this.delay)}stop(){this.__timer&&(clearInterval(this.__timer),this.__timer=null)}getCurrentCount(){return this.count}getDelay(){return this.delay}static delayedCall(t,e,i){console.assert(null!=e);const n=new He(t,1);return n.addEventListener(s.TIMER,e,i),n.start(),n}static now(){return+new Date}static getPerformaceTimer(){return performance.now()}static getShortDate(t=new Date){return t.toISOString()}static wait(t){return new Promise(((e,i)=>{this.delayedCall(t,e)}))}static waitFrame(t){return new Promise(((e,i)=>{this.delayedCall(1e3/60*t,e)}))}}function je(t){return t*Math.PI/180}let Ge;function Ke(t){return t}class qe extends pe{constructor(t,e,i,s,n,o,r){super(),this.application=t,this.stage=t.stage,this.x1=e,this.y1=i,this.x2=e+s,this.y2=i+n,this.lw=o,this.lh=r,this.tweening=!1,this.transitionEventCatcher=new pe,this._blackMesh=null,this._RT=null}static accordionLeft(t,e,i,s,n){const o=t.lw,r=1-s,a=s;e.setScaleX(r),i.setX(o*r),i.setScaleX(a)}static accordionRight(t,e,i,s,n){const o=t.lw,r=1-s,a=s;e.setX(o*a),e.setScaleX(r),i.setScaleX(a)}static zoomOut(t,e,i,s,n){const o=t.lw,r=t.lh,a=s+1,l=s,h=1-1.2*s;e.setAlpha(h),h<=0&&e.setVisible(!1),e.setScale(a),e.setPosition(-(o*a-o)/2,-(r*a-r)/2),i.setAlpha(s),i.setScale(l),i.setPosition(-(o*l-o)/2,-(r*l-r)/2)}static zoomIn(t,e,i,s,n){const o=t.lw,r=t.lh,a=s+1,l=s;e.setAlpha(1-s),e.setScale(a),e.setPosition(-(o*a-o)/2,-(r*a-r)/2),i.setAlpha(s),i.setScale(l),i.setPosition(-(o*l-o)/2,-(r*l-r)/2)}static zoomOutCross(t,e,i,s,n){const o=t.lw,r=t.lh,a=s+1,l=1-s+1,h=1-1.2*s;e.setAlpha(h),h<=0&&e.setVisible(!1),e.setScale(a),e.setPosition(-(o*a-o)/2,-(r*a-r)/2),i.setAlpha(s),i.setScale(l),i.setPosition(-(o*l-o)/2,-(r*l-r)/2)}static zoomInCross(t,e,i,s,n){const o=t.lw,r=t.lh,a=1-s,l=s;e.setAlpha(1-s),e.setScale(a),e.setPosition(-(o*a-o)/2,-(r*a-r)/2),i.setAlpha(s),i.setScale(l),i.setPosition(-(o*l-o)/2,-(r*l-r)/2)}static spinCW(t,e,i,s,n){const o=t.lw,r=t.lh,a=180*s,l=180+180*s,[h,c]=[Math.cos(je(a))*o/2-Math.sin(je(a))*r/2-o/2,Math.sin(je(a))*o/2+Math.cos(je(a))*r/2-r/2],[d,u]=[Math.cos(je(l))*o/2-Math.sin(je(l))*r/2-o/2,Math.sin(je(l))*o/2+Math.cos(je(l))*r/2-r/2];e.setAlpha(1-s),i.setAlpha(s),e.setRotation(a),i.setRotation(l),e.setPosition(-h,-c),i.setPosition(-d,-u)}static spinCCW(t,e,i,s,n){const o=t.lw,r=t.lh,a=180+180*(1-s),l=180*(1-s),[h,c]=[Math.cos(je(a))*o/2-Math.sin(je(a))*r/2-o/2,Math.sin(je(a))*o/2+Math.cos(je(a))*r/2-r/2],[d,u]=[Math.cos(je(l))*o/2-Math.sin(je(l))*r/2-o/2,Math.sin(je(l))*o/2+Math.cos(je(l))*r/2-r/2];e.setAlpha(1-s),i.setAlpha(s),e.setRotation(a),i.setRotation(l),e.setPosition(-h,-c),i.setPosition(-d,-u)}static spinCrossCW(t,e,i,s,n){const o=t.lw,r=t.lh,a=180*-s,l=180+180*s,[h,c]=[Math.cos(je(a))*o/2-Math.sin(je(a))*r/2-o/2,Math.sin(je(a))*o/2+Math.cos(je(a))*r/2-r/2],[d,u]=[Math.cos(je(l))*o/2-Math.sin(je(l))*r/2-o/2,Math.sin(je(l))*o/2+Math.cos(je(l))*r/2-r/2];e.setAlpha(1-s),i.setAlpha(s),e.setRotation(a),i.setRotation(l),e.setPosition(-h,-c),i.setPosition(-d,-u)}static spinCrossCCW(t,e,i,s,n){const o=t.lw,r=t.lh,a=180*s,l=180+180*-s,[h,c]=[Math.cos(je(a))*o/2-Math.sin(je(a))*r/2-o/2,Math.sin(je(a))*o/2+Math.cos(je(a))*r/2-r/2],[d,u]=[Math.cos(je(l))*o/2-Math.sin(je(l))*r/2-o/2,Math.sin(je(l))*o/2+Math.cos(je(l))*r/2-r/2];e.setAlpha(1-s),i.setAlpha(s),e.setRotation(a),i.setRotation(l),e.setPosition(-h,-c),i.setPosition(-d,-u)}static balloon(t,e,i,s,n){const o=t.lw,r=t.lh,a=s+1,l=1-s+1,h=1-s,c=s;e.setAlpha(1-s),e.setScale(a,h),e.setPosition(-(o*a-o)/2,-(r*h-r)/2),i.setAlpha(s),i.setScale(l,c),i.setPosition(-(o*l-o)/2,-(r*c-r)/2)}static tv(t,e,i,s,n){const o=t.lw,r=t.lh,a=3*s+1,l=.2*s+.8,h=1-s,c=s;e.setAlpha(1-s),e.setScale(a,h),e.setPosition(-(o*a-o)/2,-(r*h-r)/2),i.setAlpha(s),i.setScale(l,c),i.setPosition(-(o*l-o)/2,-(r*c-r)/2)}static getWiperV2(t,e,i){const s=new $e;return s.setVertexArray([0,0,e,0,0,1.2*i,e,i,0,1.4*i,e,1.2*i]),s.setColorArray([0,1,0,1,0,1,0,1,0,0,0,0]),s.setIndexArray([0,1,2,1,3,2,2,3,4,3,4,5]),s.setColorMultiplier(0,0,0),s}static getWiperV(t,e,i){const s=new $e;return s.setVertexArray([0,0,e,0,0,i,e,i,0,1.2*i,e,1.2*i]),s.setColorArray([0,1,0,1,0,1,0,1,0,0,0,0]),s.setIndexArray([0,1,2,1,3,2,2,3,4,3,4,5]),s.setColorMultiplier(0,0,0),s}static getWiperH(t,e,i){const s=new $e;return s.setVertexArray([0,0,e,0,0,i,e,i,1.2*e,0,1.2*e,i]),s.setColorArray([0,1,0,1,0,1,0,1,0,0,0,0]),s.setIndexArray([0,1,2,1,3,2,1,4,3,4,5,3]),s.setColorMultiplier(0,0,0),s}static wipeUp2(t,e,i,s,n){const o=-t.x1,r=-t.y1,a=t.x2-t.x1,l=t.y2-t.y1;if(t._blackMesh&&t._blackMesh.removeFromParent(),s<.5){e.setVisible(!0),i.setVisible(!1);const n=qe.getWiperV2(t,a,l);t._blackMesh=n,t.addChild(n),n.setScaleY(-1),n.setX(-o),n.setY(l*(1+1.4*(1-2*s))-r)}else{const n=2*(s-.5);e.setVisible(!1),i.setVisible(!0);const h=qe.getWiperV2(t,a,l);t._blackMesh=h,h.setScaleX(-1),t.addChild(h),h.setX(a-o),h.setY(l*(1.4*-n)-r)}}static wipeDown(t,e,i,s,n){const o=-t.x1,r=-t.y1,a=t.x2-t.x1,l=t.y2-t.y1;if(t._blackMesh&&t._blackMesh.removeFromParent(),s<.5){const n=2*s;e.setVisible(!0),i.setVisible(!1);const h=qe.getWiperV(t,a,l);t._blackMesh=h,t.addChild(h),h.setX(-o),h.setY(-l*(1-n)*1.2-r)}else{const n=2*(s-.5);e.setVisible(!1),i.setVisible(!0);const h=qe.getWiperV(t,a,l);t._blackMesh=h,t.addChild(h),h.setScaleY(-1),h.setX(-o),h.setY(l*(1+1.2*n)-r)}}static wipeUp(t,e,i,s,n){const o=-t.x1,r=-t.y1,a=t.x2-t.x1,l=t.y2-t.y1;if(t._blackMesh&&t._blackMesh.removeFromParent(),s<.5){e.setVisible(!0),i.setVisible(!1);const n=qe.getWiperV(t,a,l);t._blackMesh=n,t.addChild(n),n.setScaleY(-1),n.setX(-o),n.setY(l*(1+1.2*(1-2*s))-r)}else{const n=2*(s-.5);e.setVisible(!1),i.setVisible(!0);const h=qe.getWiperV(t,a,l);t._blackMesh=h,t.addChild(h),h.setX(-o),h.setY(l*(1.2*-n)-r)}}static wipeRight(t,e,i,s,n){const o=-t.x1,r=-t.y1,a=t.x2-t.x1,l=t.y2-t.y1;if(t._blackMesh&&t._blackMesh.removeFromParent(),s<.5){const n=2*s;e.setVisible(!0),i.setVisible(!1);const h=qe.getWiperH(t,a,l);t._blackMesh=h,t.addChild(h),h.setX(-a*(1-n)*1.2-o),h.setY(-r)}else{const n=2*(s-.5);e.setVisible(!1),i.setVisible(!0);const h=qe.getWiperH(t,a,l);t._blackMesh=h,t.addChild(h),h.setScaleX(-1),h.setX(a*(1+1.2*n)-o),h.setY(-r)}}static wipeLeft(t,e,i,s,n){const o=-t.x1,r=-t.y1,a=t.x2-t.x1,l=t.y2-t.y1;if(t._blackMesh&&t._blackMesh.removeFromParent(),s<.5){e.setVisible(!0),i.setVisible(!1);const n=qe.getWiperH(t,a,l);t._blackMesh=n,t.addChild(n),n.setScaleX(-1),n.setX(a*(1+1.2*(1-2*s))-o),n.setY(-r)}else{const n=2*(s-.5);e.setVisible(!1),i.setVisible(!0);const h=qe.getWiperH(t,a,l);t._blackMesh=h,t.addChild(h),h.setX(a*(1.2*-n)-o),h.setY(-r)}}static getClockMesh(t,e,i,s){s<0&&(s=0),s>1&&(s=1);const n=360*s,o=Math.floor(8*s)+1,r=n%45,a=Math.sin(je(r));let l=[],h=[];1==s?(l=[0*e,0*i,1*e,0*i,1*e,1*i,0*e,1*i],h=[0,1,2,2,3,0]):1==o?(l=[.5*e,0*i,(.5+a)*e,0*i,.5*e,.5*i],h=[0,1,2]):2==o?(l=[1*e,0*i,1*e,a*i,.5*e,.5*i,.5*e,0*i],h=[0,1,2,3,0,2]):3==o?(l=[1*e,.5*i,1*e,(.5+a)*i,.5*e,.5*i,.5*e,0*i,1*e,0*i],h=[0,1,2,3,4,2,4,0,2]):4==o?(l=[1*e,1*i,(1-a)*e,1*i,.5*e,.5*i,.5*e,0*i,1*e,0*i],h=[0,1,2,3,4,2,4,0,2]):5==o?(l=[.5*e,1*i,(.5-a)*e,1*i,.5*e,.5*i,.5*e,0*i,1*e,0*i,1*e,1*i],h=[0,1,2,3,4,0,4,5,0]):6==o?(l=[0*e,1*i,0*e,(1-a)*i,.5*e,.5*i,.5*e,0*i,1*e,0*i,1*e,1*i],h=[0,1,2,3,4,2,4,5,0]):7==o?(l=[0*e,.5*i,0*e,(.5-a)*i,.5*e,.5*i,.5*e,0*i,1*e,0*i,1*e,1*i,0*e,1*i],h=[0,1,2,3,4,2,4,5,6,0,2,6]):(l=[0*e,0*i,a*e,0*i,.5*e,.5*i,.5*e,0*i,1*e,0*i,1*e,1*i,0*e,1*i],h=[0,1,2,3,4,2,4,5,6,0,2,6]);const c=new $e;return c.setVertexArray(l),c.setIndexArray(h),c.setColorMultiplier(0,0,0),c}static getCircleMesh(t,e){const i=[0,0],s=[],n=[0,1];for(let t=0;t<64;t++){const o=t/64*2*Math.PI;i[2+4*t]=Math.cos(o)*e,i[2+4*t+1]=Math.sin(o)*e,i[2+4*t+2]=Math.cos(o)*e*1.2,i[2+4*t+3]=Math.sin(o)*e*1.2,n[2+4*t]=0,n[2+4*t+1]=1,n[2+4*t+2]=0,n[2+4*t+3]=0,s[9*t]=0,s[9*t+1]=2*t+1,s[9*t+2]=2*t+3,s[9*t+3]=2*t+1,s[9*t+4]=2*t+2,s[9*t+5]=2*t+4,s[9*t+6]=2*t+1,s[9*t+7]=2*t+4,s[9*t+8]=2*t+3,63==t&&(s[9*t+2]=1,s[9*t+5]=2,s[9*t+7]=2,s[9*t+8]=1)}const o=new $e;return o.setVertexArray(i),o.setIndexArray(s),o.setColorArray(n),o}static getCircleHoleMesh(t,e,i){const s=[],n=[],o=[];for(let t=0;t<32;t++){const r=t/32*2*Math.PI;s[6*t]=Math.cos(r)*e/1.2,s[6*t+1]=Math.sin(r)*e/1.2,s[6*t+2]=Math.cos(r)*e,s[6*t+3]=Math.sin(r)*e,s[6*t+4]=Math.cos(r)*i,s[6*t+5]=Math.sin(r)*i,o[6*t]=0,o[6*t+1]=0,o[6*t+2]=0,o[6*t+3]=1,o[6*t+4]=0,o[6*t+5]=1,n[12*t]=3*t+0,n[12*t+1]=3*t+4,n[12*t+2]=3*t+3,n[12*t+3]=3*t+0,n[12*t+4]=3*t+1,n[12*t+5]=3*t+4,n[12*t+6]=3*t+1,n[12*t+7]=3*t+2,n[12*t+8]=3*t+5,n[12*t+9]=3*t+1,n[12*t+10]=3*t+5,n[12*t+11]=3*t+4,31==t&&(n[12*t+1]=1,n[12*t+2]=0,n[12*t+5]=1,n[12*t+8]=2,n[12*t+10]=2,n[12*t+11]=1)}const r=new $e;return r.setVertexArray(s),r.setIndexArray(n),r.setColorArray(o),r}static circleInOut(t,e,i,s,n){const o=t.x2-t.x1,r=t.y2-t.y1,a=Math.sqrt((o/2)**2+(r/2)**2);if(t._blackMesh&&t._blackMesh.removeFromParent(),s<.5){const n=2*s;e.setVisible(!0),i.setVisible(!1);const o=qe.getCircleHoleMesh(t,a*(1-n)*1.2,1.2*a);t._blackMesh=o,t.addChild(o),o.setX(t.lw/2),o.setY(t.lh/2)}else{const n=2*(s-.5);e.setVisible(!1),i.setVisible(!0);const o=qe.getCircleHoleMesh(t,a*n*1.2,1.2*a);t._blackMesh=o,t.addChild(o),o.setX(t.lw/2),o.setY(t.lh/2)}}static circleOut(t,e,i,s,n){const o=t.x2-t.x1,r=t.y2-t.y1,a=Math.sqrt((o/2)**2+(r/2)**2);if(t._blackMesh&&t._blackMesh.removeFromParent(),s<.5){const n=2*s;e.setVisible(!0),i.setVisible(!1);const o=qe.getCircleMesh(t,1.2*a);t._blackMesh=o,t.addChild(o),o.setScale(n),o.setX(t.lw/2),o.setY(t.lh/2)}else{const n=2*(s-.5);e.setVisible(!1),i.setVisible(!0);const o=qe.getCircleHoleMesh(t,a*n*1.2,1.2*a);t._blackMesh=o,t.addChild(o),o.setX(t.lw/2),o.setY(t.lh/2)}}static circleIn(t,e,i,s,n){const o=t.x2-t.x1,r=t.y2-t.y1,a=Math.sqrt((o/2)**2+(r/2)**2);if(t._blackMesh&&t._blackMesh.removeFromParent(),s<.5){const n=2*s;e.setVisible(!0),i.setVisible(!1);const o=qe.getCircleHoleMesh(t,a*(1-n)*1.2,1.2*a);t._blackMesh=o,t.addChild(o),o.setX(t.lw/2),o.setY(t.lh/2)}else{const n=2*(s-.5);e.setVisible(!1),i.setVisible(!0);const o=qe.getCircleMesh(t,1.2*a);t._blackMesh=o,t.addChild(o),o.setScale(1-n),o.setX(t.lw/2),o.setY(t.lh/2)}}static clock(t,e,i,s,n){const o=-t.x1,r=-t.y1,a=t.x2-t.x1,l=t.y2-t.y1;if(t._blackMesh&&t._blackMesh.removeFromParent(),s<.5){e.setVisible(!0),i.setVisible(!1);const n=qe.getClockMesh(t,a,l,2*s);n.setX(-o),n.setY(-r),t._blackMesh=n,t.addChild(n)}else{e.setVisible(!1),i.setVisible(!0);const n=qe.getClockMesh(t,a,l,1-2*(s-.5));n.setScaleX(-1),n.setX(a-o),n.setY(-r),t._blackMesh=n,t.addChild(n)}}static getCircleMeshRT(t,e){const i=[0,0],s=[(t.x2-t.x1)/2,(t.y2-t.y1)/2],n=[],o=[16777215,1];for(let t=0;t<64;t++){const r=t/64*2*Math.PI;i[2+4*t]=Math.cos(r)*e,i[2+4*t+1]=Math.sin(r)*e,i[2+4*t+2]=Math.cos(r)*e*1.2,i[2+4*t+3]=Math.sin(r)*e*1.2,s[2+4*t]=s[1]+i[2+4*t],s[2+4*t+1]=s[2]+i[2+4*t+1],s[2+4*t+2]=s[1]+i[2+4*t+2],s[2+4*t+3]=s[2]+i[2+4*t+3],o[2+4*t]=16777215,o[2+4*t+1]=1,o[2+4*t+2]=16777215,o[2+4*t+3]=0,n[9*t]=0,n[9*t+1]=2*t+1,n[9*t+2]=2*t+3,n[9*t+3]=2*t+1,n[9*t+4]=2*t+2,n[9*t+5]=2*t+4,n[9*t+6]=2*t+1,n[9*t+7]=2*t+4,n[9*t+8]=2*t+3,63==t&&(n[9*t+2]=1,n[9*t+5]=2,n[9*t+7]=2,n[9*t+8]=1)}const r=new $e;return r.setVertexArray(i),r.setIndexArray(n),r.setColorArray(o),r.setTextureCoordinateArray(s),r.setTexture(t._RT),r}static getCircleHoleMeshRT(t,e,i){const[s,n]=[(t.x2-t.x1)/2,(t.y2-t.y1)/2],o=[],r=[],a=[],l=[];for(let t=0;t<32;t++){const h=t/32*2*Math.PI;o.push(Math.cos(h)*e/1.2,Math.sin(h)*e/1.2,Math.cos(h)*e,Math.sin(h)*e,Math.cos(h)*i,Math.sin(h)*i),r.push(s+o[6*t],n+o[6*t+1],s+o[6*t+2],n+o[6*t+3],s+o[6*t+4],n+o[6*t+5]),l.push(16777215,0,16777215,1,16777215,1),a.push(3*t+0,3*t+4,3*t+3,3*t+0,3*t+1,3*t+4,3*t+1,3*t+2,3*t+5,3*t+1,3*t+5,3*t+4),31==t&&(a[12*t+1]=1,a[12*t+2]=0,a[12*t+5]=1,a[12*t+8]=2,a[12*t+10]=2,a[12*t+11]=1)}const h=new $e;return h.setVertexArray(o),h.setIndexArray(a),h.setColorArray(l),h.setTextureCoordinateArray(r),h.setTexture(t._RT),h}static circleOutRT(t,e,i,s,n){const o=t.x2-t.x1,r=t.y2-t.y1;null!=t._blackMesh&&t._blackMesh.removeFromParent();const a=Math.sqrt((o/2)**2+(r/2)**2);e.setVisible(!1),i.setVisible(!0);const l=qe.getCircleHoleMeshRT(t,a*s*1.2,1.2*a);t._blackMesh=l,t.addChild(l),l.setX(t.lw/2),l.setY(t.lh/2)}static circleInRT(t,e,i,s,n){const o=t.x2-t.x1,r=t.y2-t.y1;t._blackMesh&&t._blackMesh.removeFromParent();const a=Math.sqrt((o/2)**2+(r/2)**2);e.setVisible(!1),i.setVisible(!0);const l=qe.getCircleMeshRT(t,a*(1-s)*1.2);t._blackMesh=l,t.addChild(l),l.setX(t.lw/2),l.setY(t.lh/2)}static getPaperMeshRT(t,e,i){const s=[t.x1,t.y1,t.x2-e-i,t.y1,t.x1,t.y2,t.x2-e-i,t.y2],n=[0+e,0,t.x2-t.x1-i,0,0+e,t.y2-t.y1,t.x2-t.x1-i,t.y2-t.y1],o=new $e;return o.setVertexArray(s),o.setIndexArray([0,1,2,1,3,2]),o.setTextureCoordinateArray(n),o.setTexture(t._RT),o}static paperDownRT(t,e,i,s,n){t._blackMesh&&t._blackMesh.removeFromParent(),e.setVisible(!1),i.setVisible(!0);const o=Math.sin(je(180*s))*(t.x2-t.x1)/2,r=s<.5?0:(1-Math.cos(je(180*(s-.5))))*(t.x2-t.x1),a=qe.getPaperMeshRT(t,o,r);i.setX(Math.sin(je(180*s))*(t.x2-t.x1)/2),a.setX(0);const l=1-.5*s,h=Math.max(0,2*s-1);i.setColorMultiplier(h,h,h),a.setColorMultiplier(l,l,l),t._blackMesh=a,t.addChild(a)}static paperUpRT(t,e,i,s,n){t._blackMesh&&t._blackMesh.removeFromParent(),e.setVisible(!1),i.setVisible(!0),i.setX(-Math.sin(je(180*s))*(t.x2-t.x1)/2);const o=s<.5?Math.sin(je(180*s))*(t.x2-t.x1)/2:i.getX()+(t.x2-t.x1),r=s<.5?0:o-(t.x2-t.x1)/2-Math.cos(je(180*(s-90)))*(t.x2-t.x1)/2,a=o-r,l=qe.getPaperMeshRT(t,r,a);l.setX(o);const h=1-.5*s,c=Math.max(0,2*s-1);i.setColorMultiplier(c,c,c),l.setColorMultiplier(h,h,h),t._blackMesh=l,t.addChild(l)}static moveFromRight(t,e,i,s,n){const o=t.lw+2*-t.x1;e.setX(-s*o),i.setX((1-s)*o)}static moveFromLeft(t,e,i,s,n){const o=t.lw+2*-t.x1;e.setX(s*o),i.setX((s-1)*o)}static overFromRight(t,e,i,s,n){const o=t.lw+2*-t.x1;i.setX((1-s)*o)}static overFromLeft(t,e,i,s,n){const o=t.lw+2*-t.x1;i.setX((s-1)*o)}static moveFromRightWithFade(t,e,i,s,n){const o=t.lw+2*-t.x1;e.setAlpha(1-s),e.setX(-s*o),i.setX((1-s)*o)}static moveFromLeftWithFade(t,e,i,s,n){const o=t.lw+2*-t.x1;e.setAlpha(1-s),e.setX(s*o),i.setX((s-1)*o)}static overFromRightWithFade(t,e,i,s,n){const o=t.lw+2*-t.x1;e.setAlpha(1-s),i.setX((1-s)*o)}static overFromLeftWithFade(t,e,i,s,n){const o=t.lw+2*-t.x1;e.setAlpha(1-s),i.setX((s-1)*o)}static moveFromBottom(t,e,i,s,n){const o=t.lh;e.setY(-s*o),i.setY((1-s)*o)}static moveFromTop(t,e,i,s,n){const o=t.lh;e.setY(s*o),i.setY((s-1)*o)}static overFromBottom(t,e,i,s,n){const o=t.lh;i.setY((1-s)*o)}static overFromTop(t,e,i,s,n){const o=t.lh;i.setY((s-1)*o)}static moveFromBottomWithFade(t,e,i,s,n){const o=t.lh;e.setAlpha(1-s),e.setY(-s*o),i.setY((1-s)*o)}static moveFromTopWithFade(t,e,i,s,n){const o=t.lh;e.setAlpha(1-s),e.setY(s*o),i.setY((s-1)*o)}static overFromBottomWithFade(t,e,i,s,n){const o=t.lh;e.setAlpha(1-s),i.setY((1-s)*o)}static overFromTopWithFade(t,e,i,s,n){const o=t.lh;e.setAlpha(1-s),i.setY((s-1)*o)}static fade(t,e,i,s,n){s<.5?e.setAlpha(2*(.5-s)):e.setAlpha(0),s<.5?i.setAlpha(0):i.setAlpha(2*(s-.5))}static crossfade(t,e,i,s,n){e.setAlpha(1-s),i.setAlpha(s)}static flip(t,e,i,s,n){const o=t.lw;if(s<.5){const t=2*(.5-s);e.setScaleX(t),e.setX((1-t)*o*.5)}else e.setScaleX(0),e.setX(.5*o);if(s<.5)i.setScaleX(0),i.setX(.5*o);else{const t=2*(s-.5);i.setScaleX(t),i.setX((1-t)*o*.5)}}static flipWithFade(t,e,i,s,n){const o=t.lw;if(s<.5){const t=2*(.5-s);e.setScaleX(t),e.setX((1-t)*o*.5),e.setAlpha(t)}else e.setScaleX(0),e.setX(.5*o),e.setAlpha(0);if(s<.5)i.setScaleX(0),i.setX(.5*o),i.setAlpha(0);else{const t=2*(s-.5);i.setScaleX(t),i.setX((1-t)*o*.5),i.setAlpha(t)}}static flipWithShade(t,e,i,s,n){const o=t.lw;if(s<.5){const t=2*(.5-s);e.setScaleX(t),e.setX((1-t)*o*.5),e.setColorMultiplier(1-s,1-s,1-s,1)}else e.setScaleX(0),e.setX(.5*o),e.setColorMultiplier(.5,.5,.5,1);if(s<.5)i.setScaleX(0),i.setX(.5*o),i.setColorMultiplier(.5,.5,.5,1);else{const t=2*(s-.5);i.setScaleX(t),i.setX((1-t)*o*.5),i.setColorMultiplier(s,s,s,1)}}getCurrentSceneName(){return this.currentScene}getCurrentScene(){return this.scene2?this.scene2:this.scene1}isChanging(){return this.changingScene}changeScene(t,e,i,n,o){let r;if(r="function"==typeof t?t():t,this.active||(this.addEventListener(s.ENTER_FRAME,this.onEnterFrame,this),this.active=!0),this.changingScene=!0,this.eventFilter=null!=o?o.eventFilter:null,this.currentScene=r,this.tweening&&(0!=this.time?(this.dispatchEvent("transitionEnd"),this.scene1.dispatchEvent("exitEnd"),this.scene2.dispatchEvent("enterEnd"),this.onTransitionEnd(),this.scene1.removeFromParent(),this.scene1=this.scene2,this.scene2=null,this.tweening=!1,this.changingScene=!1):this.scene2&&(this.scene2.removeFromParent(),this.scene2=null)),null==this.scene1&&(this.scene1=new pe),this.duration=e,this.transition=i,this.ease=n||Ke,this.scene2=r,this.scene2.setVisible(!1),this.addChild(this.scene2),this.time=0,this.currentTimer=He.now(),this.tweening=!0,Ge.get(i)){const t=this.stage.getScale(),e=this.x2-this.x1,i=this.y2-this.y1,s=this.stage.getX();this.stage.setScale(1);const n=new Ye(e,i,!0);n.clear(0,1),this.stage.setPosition(-this.x1,-this.y1),n.draw(this.stage),this.stage.setX(s),this.stage.setScale(t.x,t.y),this._RT=n}return this.scene2}resetCurrentScene(t){this.scene1=t,this.addChild(this.scene1)}filterTransitionEvents(t){t.stopPropagation()}onTransitionBegin(){if(this.eventFilter){this.stage.addChild(this.transitionEventCatcher);for(const t in this.eventFilter){const e=this.eventFilter[t];this.transitionEventCatcher.addEventListener(e,this.filterTransitionEvents,this)}}}onTransitionEnd(){if(this.eventFilter){for(const t in this.eventFilter){const e=this.eventFilter[t];this.transitionEventCatcher.removeEventListener(e,this.filterTransitionEvents,this)}this.transitionEventCatcher.removeFromParent()}}onEnterFrame(t){if(this.stage.addChild(this.transitionEventCatcher),!this.tweening)return this.removeEventListener(s.ENTER_FRAME,this.onEnterFrame,this),this.scene1.removeFromParent(),this.scene1=this.scene2,this.scene2=null,this.active=null,this.changingScene=!1,this._blackMesh&&(this._blackMesh.removeFromParent(),this._blackMesh=null),void(this._RT&&(this._RT=null));0==this.time&&(this.onTransitionBegin(),this.scene2.setVisible(!0),this.dispatchEvent("transitionBegin"),this.scene1.dispatchEvent("exitBegin"),this.scene2.dispatchEvent("enterBegin"));const e=He.now();this.currentTimer=e;const i=0==this.duration?1:this.time/this.duration;this.transition(this,this.scene1,this.scene2,this.ease(i),i),this.time==this.duration&&(this.dispatchEvent("transitionEnd"),this.scene1.dispatchEvent("exitEnd"),this.scene2.dispatchEvent("enterEnd"),this.onTransitionEnd(),this.tweening=!1),this.time=this.time+1e3/60,this.duration<this.time&&(this.time=this.duration)}}Ge=new Map([[qe.circleInRT,!0],[qe.circleOutRT,!0],[qe.paperDownRT,!0],[qe.paperUpRT,!0]]);class Je extends pe{constructor(t){super(),this._$$spriteType=pe.SpriteTypes.SHAPE,this._$$updateCode=pe.UpdateCodes.UPDATE_EXTRA,this.beginPath(),this.setLineStyle(0,0,0),this.setFillStyle(Je.SOLID,0,0)}get currentSubPathPoints(){return this.subPaths[this.subPaths.length-1]}setLineStyle(t,e,i){this.lineWidth=t,this.lineColor=o.hex2rgba(e,i)}setFillStyle(t,...e){if(t==Je.SOLID){const[t,i]=e;this.fillColor=o.hex2rgba(t,i)}}beginPath(t){this.startX=0,this.startY=0,this.lastX=0,this.lastY=0,this.subPaths=[[]]}clear(){this.subPaths=[]}moveTo(t,e){this.endPath(),0==this.currentSubPathPoints.length&&(this.startX=t,this.startY=e),this.currentSubPathPoints.push(t,e),this.lastX=t,this.lastY=e,this._$$localBounds.extendPoint(t,e)}lineTo(t,e){if(0==this.currentSubPathPoints.length)return this.moveTo(t,e);this.currentSubPathPoints.push(t,e),this.lastX=t,this.lastY=e,this._$$localBounds.extendPoint(t,e)}endPath(){}closePath(){this.currentSubPathPoints.length>0&&(this.currentSubPathPoints.push(this.startX,this.startY),this.subPaths.push([])),this._$$updateCode|=pe.UpdateCodes.UPDATE_EXTRA}makeBox(t,e,i,s,n,o){this.beginPath(),this.setFillStyle(Je.SOLID,n,o),this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+s),this.lineTo(t,e+s),this.closePath()}static makeBox(t,e,i,s,n,o){const r=new Je;return r.makeBox(t,e,i,s,n,o),r}encodeExtraRenderingInfo(){let t=(()=>{const t=[];return t.push(this.subPaths.length-(0==this.currentSubPathPoints.length?1:0)),this.subPaths.forEach((e=>{t.push(e.length),t.push(...e)})),t})(),e=new Float32Array(9+t.length);return e[0]=this.lineWidth,e.set(this.lineColor,1),e.set(this.fillColor,5),e.set(t,9),[e]}}Je.NONE="none",Je.SOLID="solid",Je.TEXTURE="texture",Je.LINEAR_GRADIENT="linearGradient",Je.RADIAL_GRADIENT="radialGradient",Je.NON_ZERO="noneZero";class Ze extends n{constructor(t){super(),this.asset=new a(t,a.AssetTypes.Sound),this.asset.load(),this.playing=!1}addEventListener(t,e,i=null,n=!1){return t==s.LOADED&&this.asset.addEventListener(t,this.dispatchEvent.bind(this,s.LOADED),null,n),super.addEventListener(t,e,i,n)}play(t,e,i){me.postMessageToRender({msg:"addCommand",class:"Sound",method:"play",args:[this.asset.id,t,e,i]}),this.playing=!0}setVolume(t){me.postMessageToRender({msg:"addCommand",class:"Sound",method:"setVolume",args:[this.asset.id,t]})}setPitch(t){me.postMessageToRender({msg:"addCommand",class:"Sound",method:"setPitch",args:[this.asset.id,t]})}isPlaying(){return this.playing}setPaused(t){t?me.postMessageToRender({msg:"addCommand",class:"Sound",method:"setPaused",args:[this.asset.id,t]}):this.play(),this.playing=!t}setPosition(t){me.postMessageToRender({msg:"addCommand",class:"Sound",method:"setPosition",args:[this.asset.id,t]})}stop(){me.postMessageToRender({msg:"addCommand",class:"Sound",method:"stop",args:[this.asset.id]}),this.playing=!1}getLength(){throw new Error("Not implemented")}static playSound(t){return new Ze(t).play()}static playSingleSound(t,e,i,s=t){me.postMessageToRender({msg:"addCommand",class:"Sound",method:"playSingleSound",args:[t,e,i,s]})}static stopAllSingleSound(){me.postMessageToRender({msg:"addCommand",class:"Sound",method:"stopAllSingleSound",args:[]})}}class Qe extends pe{constructor(t,e,i){super(),this.font=t,this.styles=i,this.useBaseline=!1,this._$$spriteType=pe.SpriteTypes.TEXTFIELD,this._$$updateCode=pe.UpdateCodes.UPDATE_EXTRA,this.colorAdd=t instanceof we?[1,1,1,0]:[0,0,0,0],this.customBounds=new se,this.text=e}get text(){return this._text}set text(t){t!=this._text&&(this.customBounds.width=this.font.measureTextWidth(t,this.fontSize),this.customBounds.height=this.fontSize),this._text=t}get fontSize(){return this.font.referenceSize}getTextWidth(){return this.width}setTextColor(t,e){this.setOverrideColor(t,e)}static fromTextWrap(t,e,i,s,n,o,r){const a=new Qe(n,t,{align:null!=o?o:"left",lineHeight:s,wordWrap:null!=e&&!r,whiteSpate:"normal",trim:!0,breakWord:null!=e&&!r,wordWrapWidth:e});return a.anchorX="center"==o?.5:"right"==o?1:0,null!=e&&(a.x+=e*a.anchorPosition.x),a}encodeExtraRenderingInfo(){let t=new Float32Array(2);return t[0]=this.font.asset.id,t[1]=+this.useBaseline,[t,[this.text]]}}class ti extends pe{constructor(t){super(),this.loader=new SpinePixi.AssetManager,this.loader.loadText(t+".json"),this.loader.loadText("Spines/Spine_Player_3.atlas"),this.loader.loadTexture("Spines/Spine_Player_3.png"),this.spineFilename=t,requestAnimationFrame((()=>this.load()))}load(){if(this.loader.isLoadingComplete()){console.log("완료");let t=this.loadSkeleton(this.spineFilename);this.skeleton=t.skeleton,this.state=t.state,this.bounds=t.bounds,this.skeletonData=t,this.renderer=new SpinePixi.SkeletonRenderer(this.__pixi),this.onStage(s.ENTER_FRAME,(()=>{this.state.update(1/60),this.state.apply(this.skeleton),this.renderer.draw(this.skeleton)})),this.__pixi.emit(s.READY)}else requestAnimationFrame((()=>this.load()))}loadSkeleton(t){let e=t.substr(0,t.lastIndexOf("/")),i=new SpinePixi.core.TextureAtlas(this.loader.get("Spines/Spine_Player_3.atlas"),(t=>this.loader.get(e+"/"+t))),s=new SpinePixi.core.AtlasAttachmentLoader(i),n=new SpinePixi.core.SkeletonJson(s).readSkeletonData(this.loader.get(t+".json")),o=new SpinePixi.core.Skeleton(n);o.flipY=!0;let r=this.calculateBounds(o);o.setSkinByName("runner");var a=new SpinePixi.core.AnimationState(new SpinePixi.core.AnimationStateData(o.data));return a.setAnimation(0,"standing",!0),a.addListener({event:function(t,e){},complete:function(t,e){},start:function(t){},end:function(t){}}),{skeleton:o,state:a,bounds:r}}calculateBounds(t){t.data;t.setToSetupPose(),t.updateWorldTransform();var e=new SpinePixi.core.Vector2,i=new SpinePixi.core.Vector2;return t.getBounds(e,i,[]),{offset:e,size:i}}}ti.prototype.getChildAt=Qe.prototype.getChildAt,ti.prototype.getNumChildren=Qe.prototype.getNumChildren,ti.prototype.sortChildren=Qe.prototype.sortChildren,ti.prototype.refreshColor=Qe.prototype.refreshColor;function ei(t,e){const i=t*(this.__tileWidth+this.__spacingX)+this.__marginX,s=e*(this.__tileHeight+this.__spacingY)+this.__marginY;return[i,s,i+this.__tileWidth,s+this.__tileHeight]}class ii extends pe{constructor(t,e,i,s,n,o=0,r=0,a=0,l=0,h=s,c=n){super(),this.__mapWidth=t,this.__mapHeight=e,this.__texture=i,this.__tileWidth=s,this.__tileHeight=n,this.__spacingX=o,this.__spacingY=r,this.__marginX=a,this.__marginY=l,this.__displayWidth=h||s,this.__displayHeight=c||n;const d=new $e;d.setTexture(i),this.__mesh=d,this.useCustomLocalBounds=!0,this._$$localBounds.width=t*s,this._$$localBounds.height=e*n,this.clearAllTiles(),this.addChild(d)}clearAllTiles(){const[t,e,i,s]=[[],[],[],[]];for(let n=0;n<this.__mapHeight;n++)for(let o=0;o<this.__mapWidth;o++){const[r,a,l,h]=[o*this.__displayWidth,n*this.__displayHeight,(o+1)*this.__displayWidth,(n+1)*this.__displayHeight];t.push(r,a,l,a,r,h,l,h),i.push(0,0,0,0,0,0,0,0),s.push(0,0,0,0,0,0,0,0),e.push(0,0,0,0,0,0)}let n=this.__mesh;n.setVertexArray(t),n.setIndexArray(e),n.setTextureCoordinateArray(i),n.setColorArray(s),this.__map=[]}setTile(t,e,i,s,n=!1,o=16777215,r=1,a=o,l=r,h=o,c=r,d=o,u=r){null!=i&&null!=s||this.clearTile(t,e);this.__mapWidth;const[p,f,y,m]=[t*this.__displayWidth,e*this.__displayHeight,(t+1)*this.__displayWidth,(e+1)*this.__displayHeight],g=this.__mesh,[v,_,x,w]=ei.call(this,i,s);let b=this.__map[e*this.__mapWidth+t];!function(t,e,i,s,n,o,r,a,l,h,c,d,u,p,f,y,m,g){const[v,_,x,w]=[4*e,4*e,4*e,6*e];t.setVertices(v+0,i,s,v+1,n,s,v+2,i,o,v+3,n,o),t.setTextureCoordinates(_+0,r,a,_+1,l,a,_+2,r,h,_+3,l,h),t.setColors(x+0,c,d,x+1,u,p,x+2,f,y,x+3,m,g),t.setIndices(w+0,v+0,w+1,v+1,w+2,v+2,w+3,v+1,w+4,v+3,w+5,v+2)}(g,t+e*this.__mapWidth,p,f,y,m,v,_,x,w,o,l,a,l,h,c,d,u),b=[i,s,n,o,r,a,l,h,c,d,u,t+e*this.__mapWidth],this.__map[e*this.__mapWidth+t]=b}getTile(t,e){const i=this.__map[e*this.__mapWidth+t];if(null!=i)return i}getArray(t,e){const i=this.__map[e*this.__mapWidth+t];if(null==i)return;const s=i[11],[n,o]=[4*s,6*s],r=this.__mesh,a=[],l=[],h=[],c=[];for(let t=0;t<4;t++){const{x:e,y:i}=r.getVertex(n+t);a.push(e,i);const{x:s,y:o}=r.getTextureCoordinate(n+t);l.push(s,o);const{color:c,alpha:d}=r.getColor(n+t);h.push(c,d)}for(let t=0;t<6;t++){const e=r.getIndex(o+t);c.push(e)}return[a,l,h,c]}clearTile(t,e){const i=this.__map[e*this.__mapWidth+t];if(null!=i){const t=6*i[11];this.__mesh.setIndices(t+0,0,t+1,0,t+2,0,t+3,0,t+4,0,t+5,0)}this.__map[e*this.__mapWidth+t]=null}setTexture(t){this.__mesh.setTexture(t)}setShader(t){this.__mesh.setShader(t)}setTileColor(t,e,i,s,n){this.__mapWidth;if(n){const n=this.__map[e*this.__mapWidth+t],o=e>0&&t>0?this.__map[(e-1)*this.__mapWidth+t-1]:null,r=e>0?this.__map[(e-1)*this.__mapWidth+t]:null,a=t>0?this.__map[e*this.__mapWidth+t-1]:null;n&&this.__mesh.setColor(4*n[11]+0,i,s),o&&this.__mesh.setColor(4*o[11]+3,i,s),r&&this.__mesh.setColor(4*r[11]+2,i,s),a&&this.__mesh.setColor(4*a[11]+1,i,s)}else{const n=this.__map[e*this.__mapWidth+t];if(n){const t=4*n[11];this.__mesh.setColors(t+0,i,s,t+1,i,s,t+2,i,s,t+3,i,s)}}}}function si(t){return[(t>>16)/255,(t>>8&255)/255,(255&t)/255]}ii.FLIP_DIAGONAL="flipDiagonal",ii.FLIP_HORIZONTAL="flipHorizontal",ii.FLIP_VERTICAL="flipVertical";const ni=[];class oi extends n{constructor(t,e,i,n){super(),this._delay=0,this._paused=!0,this._position=Number.NaN,this._isEnd=!1,this.autoPlay=!0,this.repeatCount=1,this.timeScale=1,this.ease=oi.defaultEase,this.dispatchEvents=oi.defaultDispatchEvents,this.target=t,this.duration=e,this.reflect=void 0,this.nextTween=void 0;let o=null;"function"!=typeof n&&"string"!=typeof n||(n={ease:n}),null!=n&&(o=n.swapValues,n.swapValues=null,Object.assign(this,n)),"string"==typeof this.ease&&(this.ease=re[this.ease]),console.assert(null!=this.ease),this.resetValues(i),o&&this.swapValues(),0==this.duration&&0==this.getDelay()&&this.autoPlay&&(this.calculatedPosition=null,this.setPosition(0)),oi.active||(me.stage.addEventListener(s.ENTER_FRAME,oi.onTick),oi.active=!0)}isPaused(){return this._paused}isEnd(){return this._isEnd}stop(){this.setPaused(!0)}setPaused(t){t!=this._paused&&(this._paused=t,this._paused?oi.activeTweenList.delete(this):((Number.isNaN(this._position)||0!=this.repeatCount&&this._position>=this.repeatCount*this.duration)&&(this._inited=!1,this.calculatedPosition=0,this.calculatedPositionOld=0,this.ratio=0,this.ratioOld=0,this.positionOld=0,this._position=-this.getDelay()),oi.activeTweenList.set(this,!0)))}stopAll(){for(const[t]of oi.activeTweenList)t.stop()}getPosition(){return this._position}setPosition(t){this.positionOld=this._position,this.ratioOld=this.ratio,this.calculatedPositionOld=this.calculatedPosition;const e=this.repeatCount*this.duration,i=t>=e&&this.repeatCount>0;if(i){if(this.calculatedPositionOld==e)return;this._position=e,this.calculatedPosition=(this.reflect&&this.repeatCount,this.duration)}else this._position=t,this.calculatedPosition=this._position<0?0:this._position%this.duration,this.reflect&&Math.floor(this.getPosition()/this.duration)%2!=0&&(this.calculatedPosition=this.duration-this.calculatedPosition);if(this.ratio=0==this.duration&&this._position>=0?1:this.ease(this.calculatedPosition/this.duration,0,1,1),this.target&&(this._position>=0||this.positionOld>=0)&&this.calculatedPosition!=this.calculatedPositionOld){this._inited||this.init();for(const t in this._endValues){let e,i,s;if("color"==t){e=this._initValues[t],i=this._rangeValues[t];const s=e[0]+i[0]*this.ratio,n=e[1]+i[1]*this.ratio,o=e[2]+i[2]*this.ratio;this.target.setColorMultiplier(s,n,o)}else e=this._initValues[t],i=this._rangeValues[t],s=e+i*this.ratio,console.assert(null!=this.target[t]),this.target[t]=s}}return this.dispatchEvents&&this.dispatchEvent("change"),i&&(this._isEnd=!0,this.setPaused(!0),this.nextTween&&this.nextTween.setPaused(!1),this.dispatchEvents&&this.dispatchEvent("complete")),this}getDelay(){return this._delay}setDelay(t){return this._position<=0&&(this._position=-t),this._delay=t,this}setValue(t,e){return this._endValues[t]=e,this.invalidate(),this}getValue(t){return this._endValues[t]}deleteValue(t){this._rangeValues[t]=null,this._initValues[t]=null;const e=null!=this._endValues[t];return this._endValues[t]=null,e}setValues(t){return Object.assign(this._endValues,t),this.invalidate(),this}resetValues(t){return this._endValues={},this.setValues(t),this}getValues(){return Object.assign({},this._endValues)}getInitValue(t){return this._initValues[t]}swapValues(){this._inited||this.init();const t=this._endValues;this._endValues=this._initValues,this._initValues=t;for(const t in this._rangeValues){const e=this._rangeValues[t];this._rangeValues[t]=-e}if(this.calculatedPosition=null,this._position<0){const t=this.positionOld;this.setPosition(0),this._position=this.positionOld,this.positionOld=t}else this.setPosition(this._position)}init(){this._inited=!0,this._initValues={},this._rangeValues={};for(const t in this._endValues)if("color"==t){let e;this._initValues[t]=si(this.target.colorMultiplier),e=si(this._endValues[t]),this._rangeValues[t]=[e[0]-parseFloat(this._initValues[t][0]),e[1]-parseFloat(this._initValues[t][1]),e[2]-parseFloat(this._initValues[t][2])]}else console.assert(null!=this.target[t],"트윈으로 조작하려는 값이 null이다."),this._initValues[t]=this.target[t],this._rangeValues[t]=this._endValues[t]-this._initValues[t];this.dispatchEvents&&this.dispatchEvent("init")}toStart(){this.setPosition(0)}cancel(){this.setPosition(0),this.stop()}toEnd(){this.setPosition(this.repeatCount>0&&this.repeatCount*this.duration||this.duration)}invalidate(){this._inited=!1,this._position>0&&(this._position=0),this.autoPlay&&this.setPaused(!1)}onCompleteRemoveFromParent(){return this.addEventListener("complete",(()=>{this.target.removeFromParent(),this.target=null}),this),this}onComplete(t,e){return this.addEventListener("complete",t,e),this}onChange(t,e){return this.addEventListener("change",t,e),this}setNextTween(t){return this.nextTween=t,this}tween(t,e,i){const s=new oi(this.target,t,e,i);return this.isEnd()||(s.setPaused(!0),this.setNextTween(s)),s}move(t,e,i=0,s){const n=new oi(this.target,i,{x:t,y:e},s);return this.isEnd()||(n.setPaused(!0),this.setNextTween(n)),n}wait(t=0,e,i){const s=new oi(this.target,t);return e&&this.onComplete(e,i),this.isEnd()||(s.setPaused(!0),this.setNextTween(s)),s}stopTweenChain(){oi.stopTarget(this.target)}static linearEase(t,e,i,s){return t}static onTick(){if(oi.pauseAll)return;const t=1/60*oi.timeScaleAll*1e3;for(const[t]of oi.activeTweenList)ni.push(t);for(let e=0;e<ni.length;e++){const i=ni[e];i.setPosition(i._position+(i.useFrames&&oi.timeScaleAll||t)*i.timeScale)}0==ni.length&&(me.stage.removeEventListener(s.ENTER_FRAME,oi.onTick),oi.active=null),ni.length=0}static stopTarget(t){for(const[e]of oi.activeTweenList)e.target==t&&e.stop()}}n.prototype.tween=function(t,e,i){return new oi(this,t,e,i)},n.prototype.move=function(t,e,i=0,s){return new oi(this,i,{x:t,y:e},s)},n.prototype.wait=function(t=0,e,i){return new oi(this,t).onComplete(e,i)},n.prototype.getTweens=function(t){const e=[];for(const[i]of oi.activeTweenList)i.target==this&&(t&&!i.paused||e.push(i));return e.length>0?e:null},n.prototype.stopAllTweens=function(){oi.stopTarget(this)},oi.active=!1,oi.defaultDispatchEvents=!0,oi.defaultEase=oi.linearEase,oi.pauseAll=!1,oi.timeScaleAll=1,oi.activeTweenList=new Map;const ri=["ㄱ","ㄲ","ㄴ","ㄷ","ㄸ","ㄹ","ㅁ","ㅂ","ㅃ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"],ai=["ㅏ","ㅐ","ㅑ","ㅒ","ㅓ","ㅔ","ㅕ","ㅖ","ㅗ","ㅘ","ㅙ","ㅚ","ㅛ","ㅜ","ㅝ","ㅞ","ㅟ","ㅠ","ㅡ","ㅢ","ㅣ"],li=[" ","ㄱ","ㄲ","ㄳ","ㄴ","ㄵ","ㄶ","ㄷ","ㄹ","ㄺ","ㄻ","ㄼ","ㄽ","ㄾ","ㄿ","ㅀ","ㅁ","ㅂ","ㅄ","ㅅ","ㅆ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"],hi={},ci={ㅏㅣ:1,ㅣㅏ:2,ㅑㅣ:3,ㅓㅣ:5,ㅣㅓ:6,ㅕㅣ:7,ㅗㅏ:9,ㅗㅐ:10,ㅗㅏㅣ:10,ㅗㅣ:11,ㅣㅗ:12,ㅜㅓ:14,ㅜㅔ:15,ㅜㅓㅣ:15,ㅜㅣ:16,ㅡㅜ:17,ㅡㅣ:19},di={};for(let t=0;t<ri.length;t++){hi[ri[t]]=t}for(let t=0;t<ai.length;t++){ci[ai[t]]=t}for(let t=0;t<li.length;t++){di[li[t]]=t}const ui=44032,pi={};function fi(t){return t.charCodeAt(0)}const yi=[fi("가"),fi("힣")];pi.isValidUnicode=function(t){const e=fi(t);return e>=yi[0]&&e<=yi[1]};const mi=[fi("ㄱ"),fi("ㅎ")],gi=[fi("ㅏ"),fi("ㅣ")];pi.isJamo=function(t){const e=fi(t);return e>=mi[0]&&e<=mi[1]||e>=gi[0]&&e<=gi[1]},pi.isJongSung=function(t){const e=t.substr(t.length-1),i=e.charCodeAt(0);if(i<ui||i>55199){return!!hi[e]||"bcdfghjklmnpqrstvwxz136780".indexOf(e)>=0}let s=i-ui;s%=588,s%=28;return s>0},pi.replaceJoSa=function(t){if(null==t||""==t)return t;const e=/}?([^}]*){([^/}]*)}/g;let i=e.exec(t),s=0,n="";for(;null!=i;){s=e.lastIndex;const[o,r,a]=[RegExp.$1,RegExp.$2,RegExp.$1.match(/.['"`^()[\]]?$/)[0].substr(0,1)],l=pi.isJongSung(a),h=l?pi.divideJaSo(a)[2]:null;let c;"을"==r||"를"==r?c=l?"을":"를":"이"==r||"가"==r?c=l?"이":"가":"과"==r||"와"==r?c=l?"과":"와":"은"==r||"는"==r?c=l?"은":"는":"이는"==r?c=l?"이는":"는":"이와"==r?c=l?"이와":"와":"여"==r||"이여"==r?c=l?"이여":"여":"으로"==r||"로"==r?c=l&&"ㄹ"!=h?"으로":"로":"이네"==r||"네"==r?c=l?"이네":"네":"이랑"==r||"랑"==r?c=l?"이랑":"랑":"라"==r&&(c=l?"이라":"라"),n=n+o+c,i=e.exec(t)}return n+t.substr(s)},pi.format=function(t,...e){let i;if(e.length>0){let s=0;i=t.replace(/%[s|d]/g,(function(t){return"%"+s++}));for(let t=0;t<e.length;t++)i=i.replace(`%${t}`,e[t])}else i=t;return pi.replaceJoSa(i)},pi.mergeJaSo=function(t,e,i){const s=hi[t],n=ci[e],o=i?di[i]:0,r=ui+28*(21*s+n)+o;return String.fromCharCode(r)},pi.divideJaSo=function(t){const e=t.charCodeAt(0);if(e<ui||e>55199){const e=hi[t];if(e)return[ri[e]];const i=ci[t];return i?[null,ai[i]]:[]}let i=e-ui;const s=Math.floor(i/588);i%=588;const n=Math.floor(i/28);i%=28;return[ri[s],ai[n],i>0&&li[i]||null]},pi.getTypeOfJaSo=function(t){let[e,i,s]=[!1,!1,!1];hi[t]&&(e=!0);ci[t]&&(i=!0);return di[t]&&(s=!0),[e,i,s]};class vi extends pe{constructor(t){super();const e=JSON.parse(o.getEmbeddedFile(`map_${t}.json`)),i=`pat_${t}.png`;this.mapWidth=e[0].length,this.mapHeight=e.length,this.tileMap=new ii(this.mapWidth,this.mapHeight,new _e(i),16,16,2,2,1,1),this.setPalette(xi.instance.palette);let n=JSON.parse(o.getEmbeddedFile(`evn_${t}.json`));this.mapBase=new ne(n.mapBaseX,n.mapBaseY),this.eventData=n;for(let t=0;t<256;t++)this.eventData.eventVars[t].flag=0;let r=JSON.parse(o.getEmbeddedFile(`pat_${t}.json`));this.tileAttribs=new Uint8Array(r),this.mapData=[];for(let t=0;t<this.mapHeight;t++){this.mapData[t]=new Uint16Array(this.mapWidth);for(let i=0;i<this.mapWidth;i++){let s=e[t][i];this.tileMap.setTile(i,t,s%14,Math.floor(s/14)),this.mapData[t][i]=s}}this.layer0=new pe,this.layer1=new pe,this.layer2=new pe,this.layer3=new pe,this.layer4=new pe,this.layer5=new pe,this.addChild(this.layer0),this.addChild(this.tileMap),this.addChild(this.layer1),this.addChild(this.layer2),this.addChild(this.layer3),this.addChild(this.layer4),this.addChild(this.layer5),this.scrollTargetPosition=new ne(0,0),this.currentScrollPosition=new ne(0,0),this.scrollRect=new se(-1,-1,2,2),this.scrollTarget=null,this.eventTarget=null,this.safeBorder=0,this.gravity=new ne(0,0),this.constantVelocity=new ne(0,0),this.onStage(s.ENTER_FRAME,this.processScroll)}setPalette(t){let e=t.createShader(this.tileMap.__texture);this.tileMap.setShader(e)}setSafeBorder(t){this.safeBorder=t}setScrollTarget(t){this.scrollTarget=t}processScroll(){this.scrollTarget&&(this.scrollTargetPosition=this.scrollTarget.position);let t=this.currentScrollPosition.x,e=this.currentScrollPosition.y,i=this.scrollTargetPosition.x,s=this.scrollTargetPosition.y,n=this.getWorldCoordinate(this.scrollRect.left,this.scrollRect.top),o=this.getWorldCoordinate(this.scrollRect.right,this.scrollRect.bottom);(i<n.x||i>=o.x)&&(t=i),(s<n.y||s>=o.y)&&(e=s),this.setScroll(t,e),this.currentScrollPosition.x=t,this.currentScrollPosition.y=e}getMap(t,e){return t<0||t>=this.mapWidth||e<0||e>=this.mapHeight?0:this.mapData[e][t]}setMap(t,e,i){t<0||t>=this.mapWidth||e<0||e>=this.mapHeight||(this.tileMap.setTile(t,e,i%14,Math.floor(i/14)),this.mapData[e][t]=i)}getMapAttrib(t,e){if(t<0||t>=this.mapWidth||e<0||e>=this.mapHeight)return 0;const i=this.mapData[e][t];return this.tileAttribs[i]}setScroll(t,e){this.x=128-t,this.y=100-e}getMapEventNumber(t,e){let i=o.clamp(Math.floor(t/16),0,this.mapWidth-1),s=o.clamp(Math.floor(e/16),0,this.mapHeight-1);return this.eventData.eventMap[s][i]}getWorldCoordinate(t,e){return new ne(t-this.x,e-this.y)}getStageCoordinate(t,e){return new ne(t+this.x,e+this.y)}getWorldX(t){return t-this.x}getWorldY(t){return t-this.y}getStageX(t){return t+this.x}getStageY(t){return t+this.y}}vi.TILEATTRIB_FLOOR=128,vi.TILEATTRIB_CEIL=64,vi.TILEATTRIB_LWALL=32,vi.TILEATTRIB_RWALL=16,vi.TILEATTRIB_LSLOPE=8,vi.TILEATTRIB_RSLOPE=4;class _i extends pe{constructor(t,e){if(super(),null!=t){const e=`spr_${t}.png`,i=JSON.parse(o.getEmbeddedFile(`spr_${t}.json`));this._meshes=[],this.texture=new _e(e);for(let t=0;t<i.images.length;t++){let e=i.images[t],s=e.source,n=e.x,o=e.y;this._meshes[t]=new $e,this._meshes[t].setVertexArray([n,o,n+s.width,o,n,o+s.height,n+s.width,o+s.height]),e.inflip?(this._meshes[t].setTextureCoordinateArray([s.x+s.width,s.y,s.x,s.y,s.x+s.width,s.y+s.height,s.x,s.y+s.height]),this._meshes[t].visibleRect=new se(n,o,s.width,s.height)):(this._meshes[t].setTextureCoordinateArray([s.x,s.y,s.x+s.width,s.y,s.x,s.y+s.height,s.x+s.width,s.y+s.height]),this._meshes[t].visibleRect=new se(n,o,s.width,s.height)),this._meshes[t].setColorArray([16777215,1,16777215,1,16777215,1,16777215,1]),this._meshes[t].setIndexArray([0,1,2,1,3,2]),this._meshes[t].setTexture(this.texture),this._meshes[t].flipX=e.flipX,this._meshes[t].flipY=e.flipY,this._meshes[t].ranges=e.ranges}const s={};for(let t=0;t<i.actions.length;t++){let e=[],n=i.actions[t];for(let i=0;i<n.length;i++){let s=n[i].image;if(-1==s){e.push([-1,-1==n[i].x?t:n[i].x,n[i].y]);break}e.push([s,n[i].x,n[i].y])}s[t]=e}this._actions=s}else this._meshes=null,this._action=null,this.texture=null;this._init(e),this.updateVisual(),xi.instance.palette?this.setPalette(xi.instance.palette):this.once(s.ADDED_TO_STAGE,(()=>{this.setPalette(xi.instance.palette)}))}_init(t){this._white=0,this._flicker=0,this._currentAction=0,this._currentFrame=0,this.autoRemoveTimer=0,this.animationStopCounter=0,this.animationSpeed=1,this.attrib=Object.assign({},_i.defaultAttrib),this.updateCallback=null,this.mapCollisionCallback=null,this.collisionCallback=null,this.removeCallback=null,this.flipX=!1,this.flipY=!1,this.velocity=new ne(0,0),this.acceleration=new ne(0,0),Object.assign(this,t)}createVsSprite(t){const e=new pe;return Object.setPrototypeOf(e,_i.prototype),Object.assign(e,{_meshes:this._meshes.map((t=>{let e=t.clone();return e.visibleRect=t.visibleRect,e.flipX=t.flipX,e.flipY=t.flipY,e.ranges=t.ranges,e})),_actions:this._actions,texture:this.texture}),e.setPalette(xi.instance.palette),e._init(t),e.updateVisual(),e}getMesh(t){let e=this._meshes[t].getShader(),i=this._meshes[t].clone();return i.setShader(e),i}get action(){return this._currentAction}set action(t){this._currentAction=t,this._currentFrame=0,this.updateVisual()}get frame(){return this._currentFrame}set frame(t){this._currentFrame=t,this.updateVisual()}setPalette(t){console.assert(t instanceof Ai,"팔레트가 제대로 세팅되어있지 않습니다");let e=t.createShader(this.texture);if(null!=this._meshes)for(let t of Object.values(this._meshes))t.setShader(e)}get white(){return this._white}set white(t){this._white=t,this._currentMesh.getShader().setConstant("white",t)}setAction(t,e){null==t||this._currentAction==t?this._currentFrame=null==e?this._currentFrame:e:(this._currentAction=t,this._currentFrame=null==e?0:e),this.updateVisual()}updateVisual(){if(null==this._actions)return new ne(0,0);let t=this._actions[this._currentAction][this._currentFrame];const e=this._oldImageFrame;if(-1==t[0]){if(-2==t[1])return this.remove("endOfAnimation"),new ne(0,0);-1!=t[1]&&(this._currentAction=t[1]),this._currentFrame=t[2],t=this._actions[this._currentAction][this._currentFrame]}if(e!=t[0]){this._oldImageFrame=t[0];let e=null;this._currentMesh&&(e=this._currentMesh.worldMatrix,this._currentMesh.removeFromParent()),this._currentMesh=this._meshes[t[0]],this._currentMesh.scaleX=this.flipX?-1:1,this._currentMesh.x=this.flipX?this._currentMesh.flipX:0,this._currentMesh.scaleY=this.flipY?-1:1,this._currentMesh.y=this.flipY?this._currentMesh.flipY:0,e&&this._currentMesh.setCustomPrev(e,this._currentMesh.colorOverride,this._currentMesh.anchorX,this._currentMesh.anchorY),0==this.attrib.enableHideMesh&&this.addChildAt(this._currentMesh,0)}return new ne(t[1],t[2])}checkRange(t,e,i){if(this==t)return!1;let s=this._currentMesh.ranges[e],n=t._currentMesh.ranges[i],o=s.x1+(this.flipX?s.fx:0),r=s.y1+(this.flipY?s.fy:0),a=s.x2+(this.flipX?s.fx:0),l=s.y2+(this.flipY?s.fy:0),h=n.x1+(t.flipX?n.fx:0),c=n.y1+(t.flipY?n.fy:0),d=n.x2+(t.flipX?n.fx:0),u=n.y2+(t.flipY?n.fy:0),p=this.localToGlobal(o,r),f=this.localToGlobal(a,l),y=t.localToGlobal(h,c),m=t.localToGlobal(d,u);return!(f.x<y.x||p.x>m.x||f.y<y.y||p.y>m.y)}updateVelocityAndAcceleration(){this.velocity=this.velocity.add(this.acceleration),0==this.attrib.disableGravity&&xi.instance.world&&(this.velocity=this.velocity.add(xi.instance.world.gravity))}setMapCollisionPhaseCallback(t){this.mapCollisionCallback=t}setUpdatePhaseCallback(t){this.updateCallback=t}setCollisionPhaseCallback(t){this.collisionCallback=t}setRemoveCallback(t){this.removeCallback=t}remove(t){this.removeAllEventListeners(),this.removeFromParent()}process(t){if(this.autoRemoveTimer>0&&(this.autoRemoveTimer--,0==this.autoRemoveTimer))return void this.remove("autoRemoveTimer");this.updateVelocityAndAcceleration();let e=new ne(0,0);0==this.attrib.disableVelocity&&(e=e.add(this.velocity)),0==this.attrib.disableGlobalVelocity&&xi.instance.world&&(e=e.add(xi.instance.world.constantVelocity)),0==this.animationStopCounter&&(this._currentFrame++,e=e.add(this.updateVisual()));let i=this._currentMesh&&this._currentMesh.ranges[0];if(this.attrib.enableDebug&&i){this.debugShape&&this.debugShape.removeFromParent();let t=new Je;t.makeBox(i.x1,i.y1,i.x2-i.x1+1,i.y2-i.y1+1,16711680,.7),this.debugShape=t,this.addChild(t)}if(0==this.attrib.enablePush)for(let e of t)e.attrib.enableBlock;if((this.attrib.enableMapCollisionLeft||this.attrib.enableMapCollisionRight||this.attrib.enableMapCollisionTop||this.attrib.enableMapCollisionBottom)&&0==this.animationStopCounter){const t=xi.instance.world;let s=new ne(0,0),n=new ne(0,0),o=0,r=(this.position,new ne(this.x+e.x,this.y+e.y)),a=[];if(this.attrib.enableMapCollisionBottom&&e.y>0)for(let e=r.x+i.x1>>4;e<=r.x+i.x2>>4;e++){const l=r.y+i.y2+1>>4;if(t.getMapAttrib(e,l)&vi.TILEATTRIB_FLOOR&&(a.push([e,l,t.getMap(e,l)]),0==(o&vi.TILEATTRIB_FLOOR))){s.y=-(r.y+i.y2+1)%16,n.y=-this.velocity.y,o|=vi.TILEATTRIB_FLOOR;break}}else if(this.attrib.enableMapCollisionTop&&e.y<0)for(let e=r.x+i.x1>>4;e<=r.x+i.x2>>4;e++){const l=r.y+i.y1>>4;if(t.getMapAttrib(e,l)&vi.TILEATTRIB_CEIL&&(a.push([e,l,t.getMap(e,l)]),0==(o&vi.TILEATTRIB_CEIL))){s.y=-(16-(r.y+i.y1)%16),n.y=-this.velocity.y,o|=vi.TILEATTRIB_CEIL;break}}if(r.y+=s.y,this.attrib.enableMapCollisionRight&&e.x>0)for(let e=r.y+i.y1>>4;e<=r.y+i.y2>>4;e++){const l=r.x+i.x2+1>>4;if(t.getMapAttrib(l,e)&vi.TILEATTRIB_RWALL&&(a.push([l,e,t.getMap(l,e)]),0==(o&vi.TILEATTRIB_RWALL))){s.x=-(r.x+i.x2+1)%16,n.x=-this.velocity.x,o|=vi.TILEATTRIB_RWALL;break}}else if(this.attrib.enableMapCollisionLeft&&e.x<0)for(let e=r.y+i.y1>>4;e<=r.y+i.y2>>4;e++){const l=r.x+i.x1>>4;if(t.getMapAttrib(l,e)&vi.TILEATTRIB_LWALL&&(a.push([l,e,t.getMap(l,e)]),0==(o&vi.TILEATTRIB_LWALL))){s.x=-(16-(r.x+i.x1)%16),n.x=-this.velocity.x,o|=vi.TILEATTRIB_LWALL;break}}this.mapCollisionCallback&&this.mapCollisionCallback.call(this,o,{adjust:s,adjustVelocity:n,collideList:a}),e=e.add(s),0==this.attrib.disableVelocity&&(this.velocity=this.velocity.add(n))}else this.animationStopCounter>0&&this.animationStopCounter--;this.position=this.position.add(e)}prepareDraw(){if(this.attrib.enableFlicker?(this._flicker=1-this._flicker,this._flicker?this._currentMesh.setVisible(!1):this._currentMesh.setVisible(!0)):this._currentMesh&&this._currentMesh.setVisible(!0),this.attrib.enableAutoRemoveStageOut){const t=xi.instance.world,e=new se(-t.x,-t.y,xi.instance.width,xi.instance.height);if(this._meshes){const t=this._currentMesh.visibleRect;(this.x+t.right<e.left||this.x+t.left>e.right||this.y+t.top>e.bottom||this.y+t.bottom<e.top)&&this.remove("autoRemoveStageOut")}else(this.x<e.left||this.x>e.right||this.y>e.bottom||this.y<e.top)&&this.remove("autoRemoveStageOut")}}static processAllSprites(){let t=xi.instance.searchChildren(!0),e=[];for(let i of t)i.parent||(console.log(xi.instance.children),console.assert(i.parent)),i instanceof _i&&(i.updateCallback&&i.updateCallback.call(i),e.push(i));for(let t of e)t.process(e);for(let t of e)t.collisionCallback&&t.collisionCallback.call(t,e);for(let t of e)t.prepareDraw()}static removeAllSprites(){let t=stage.searchChildren(!0);for(let e of t)e.isVsSprite&&e.remove("removeAll")}}_i.DIR_LEFT=16,_i.DIR_RIGHT=32,_i.DIR_TOP=64,_i.DIR_BOTOOM=128,_i.defaultAttrib={disableGravity:!1,disableGlobalVelocity:!1,disableVelocity:!1,disableChainAnimation:!1,enableAutoRemoveStageOut:!1,enablePush:!1,enableBlock:!1,enableMapCollisionTop:!1,enableMapCollisionBottom:!1,enableMapCollisionLeft:!1,enableMapCollisionRight:!1,enableHideMesh:!1,enableFlicker:!1,isScreenCoordinate:!1,dskip:!1,enableDebug:!1};class xi extends pe{static get instance(){return this.instances.PALO2=this.instances.PALO2||new pe,Object.setPrototypeOf(this.instances.PALO2,this.prototype)}static init(t,e){return new xi(t,e)}constructor(t,e){super();const i=xi.instance;return this._width=t|me.logicalViewport.width,this._height=e||me.logicalViewport.height,this._backgroundColor=255,this._background=null,this.palette=null,this.world=null,this.setClip(0,0,this._width,this._height),ge.on(s.RESIZE,(function(t){i.setClip(0,0,i._width,i._height)})),i.onStage(s.ENTER_FRAME,(function(){xi.instance.palette&&xi.instance.palette.process(),_i.processAllSprites()})),Object.assign(this.eventEmitter._events,i.eventEmitter._events),Object.assign(i,this),ge.addChild(i),i}get width(){return this._width}get height(){return this._height}get size(){return new ne(this.width,this.height)}get rect(){return new se(0,0,this.width,this.height)}setPalette(t){this.palette=t,this._background&&this._background.setShader(t.createShader())}get backgroundColor(){return this._backgroundColor}set backgroundColor(t){this._backgroundColor=t,this._background&&(this._background.removeFromParent(),this._background=null),t<255&&(this._background=new We(Ai.indexToColor(t),1,this.width,this.height),this._background.setShader(this.palette.createShader()),this.addChildAt(this._background,0))}setWorld(t,e){let i,s=this.world;if(s&&(i=s.getParent()==this?this.getChildIndex(s):0,s.removeFromParent()),this.world=t,this.world){if(s&&e){let t=this.world.tileMap;this.world.clearChildren(),s.layer0.removeFromParent(),this.world.addChild(s.layer0),this.world.addChild(t),this.world.addChild(s.layer1),this.world.addChild(s.layer2),this.world.addChild(s.layer3),this.world.addChild(s.layer4),this.world.addChild(s.layer5),this.world.layer0=s.layer0,this.world.layer1=s.layer1,this.world.layer2=s.layer2,this.world.layer3=s.layer3,this.world.layer4=s.layer4,this.world.layer5=s.layer5,this.world.scrollTarget=s.scrollTarget,this.world.eventTarget=s.eventTarget}this.addChildAt(this.world,i)}}}xi.instances={};const wi="\nprecision mediump float;\n\n#define PI 3.1415926535897932384626433832795\n#define MOTION_BLUR_THRESHOLD 2.0\n\nconst bool useDiscard = true;\n\n#ifndef NO_TEXTURE\n    attribute vec2 a_texCoord;\n    varying vec2 v_texCoord;\n#endif\n\n\n    uniform mat4 u_viewMatrix;\n    uniform mat4 u_worldMatrixPrev;\n    uniform mat4 u_worldMatrix;\n    uniform vec2 u_anchorPrev;\n    uniform vec2 u_anchor;\n    uniform vec4 u_colorOverridePrev;\n    uniform vec4 u_colorOverride;\n    uniform float u_alphaMod;\n    uniform float u_alphaMod2;\n    uniform float u_logicPerRenderFrame;\n    uniform float u_subRenderFrame;\n\n    attribute vec2 a_position;\n    attribute vec4 a_color;\n    attribute float a_blendFactor;\n\n    varying float v_discardAll;\n    varying vec4 v_colorOverride;\n\n    varying float v_alphaCorrection;\n\n\n\n//decomposing code from\n//https://github.com/deoxxa/transformation-matrix-js/blob/master/src/matrix.js\n\nstruct Transform {\n    vec2 position;\n    vec2 scale;\n    vec2 skew;\n    float rotation;\n};\n\nTransform decompose(mat4 mat) {\n    Transform result;\n\tfloat a = mat[0].x;\n    float b = mat[0].y;\n    float c = mat[1].x;\n    float d = mat[1].y;\n\n    float rotation = 0.0;\n    vec2 scale = vec2(1.0, 1.0);\n    vec2 skew = vec2(0.0, 0.0);\n\n    float determ = a * d - b * c;\t// determinant(), skip DRY here...\n\n    if(a != 0.0 || b != 0.0) {\n        float r = sqrt(a * a + b * b);\n        rotation = b > 0.0 ? acos(a / r) : -acos(a / r);\n        scale = vec2(r, determ / r);\n        skew.x = atan((a * c + b * d), (r * r));\n    } else if(c != 0.0 || d != 0.0) {\n        float s = sqrt(c * c + d * d);\n        rotation = PI * 0.5 - (d > 0.0 ? acos(-c / s) : -acos(c / s));\n        scale = vec2(determ / s, s);\n        skew.y = atan((a * c + b * d), (s * s));\n    } else { // a = b = c = d = 0\n        scale = vec2(0.0, 0.0);\t\t// = invalid matrix\n    } \n    result.scale = scale;\n    result.rotation = rotation;\n    result.skew = skew;\n    result.position = mat[3].xy;\n    return result;\n}\n\n\nvoid main() {\n\n    vec4 pos = vec4(a_position.xy,1,1);\n    float abf = a_blendFactor;\n    float bf = (a_blendFactor+u_subRenderFrame) / max(1.0,u_logicPerRenderFrame);\n    mat4 matrix1 = u_worldMatrixPrev;\n    mat4 matrix2 = u_worldMatrix;\n\n#ifndef NO_TEXTURE\n    v_texCoord = a_texCoord;\n#endif\n\n    Transform t1 = decompose(matrix1);\n    Transform t2 = decompose(matrix2);\n    Transform t;\n\n    float dist = length(matrix1[3].xy - matrix2[3].xy);\n    bool isNotMoved = bf>=1.0 || (dist<=MOTION_BLUR_THRESHOLD && t1.scale == t2.scale && t1.rotation == t2.rotation);\n\n\n    if(isNotMoved) {\n        if (useDiscard && abf!=0.5) {\n            v_discardAll = 1.0;\n            gl_Position = vec4(0);\n            return;\n        } else {\n            v_colorOverride = u_colorOverride;\n            t.position = t2.position;\n            t.rotation = t2.rotation;\n            t.scale = t2.scale;\n            t.skew = t2.skew;\n            v_colorOverride *= a_color;\n            v_alphaCorrection = 0.0;\n        }\n    } else {\n        v_alphaCorrection = 1.0;\n        float alpha = 1.0 - abs(abf - 0.5) * 2.0;\n        v_colorOverride = mix(u_colorOverridePrev, u_colorOverride, bf);\n        v_colorOverride *= a_color;\n        v_colorOverride.a *= a_color.a;// * alpha;\n        t.position = mix(t1.position, t2.position, bf);\n        t.rotation = mix(t1.rotation, t2.rotation, bf);\n        t.scale = mix(t1.scale, t2.scale, bf);\n        t.skew = mix(t1.skew, t2.skew, bf);\n    }\n    v_discardAll = 0.0;\n\n    mat4 posMat = mat4(1);\n    mat4 scaleMat = mat4(1);\n    mat4 rotMat = mat4(1);\n    mat4 shearMat = mat4(1);\n    mat4 anchorMat = mat4(1);\n\n    anchorMat[3].xy = -mix(u_anchorPrev,u_anchor,bf);\n\n    posMat[3].xy = t.position;\n    shearMat[0].y = -t.skew.x;\n    shearMat[1].x = t.skew.y;\n    scaleMat[0].x = t.scale.x;\n    scaleMat[1].y = t.scale.y;    \n    rotMat[0].x = cos(t.rotation);\n    rotMat[0].y = sin(t.rotation);\n    rotMat[1].x = -sin(t.rotation);\n    rotMat[1].y = cos(t.rotation);\n\n    gl_Position = u_viewMatrix * posMat * shearMat * scaleMat * rotMat * anchorMat * pos;\n\n}\n            ",bi="\nprecision mediump float;\n\n#define PI 3.1415926535897932384626433832795\n\n#ifndef NO_TEXTURE\n\n    uniform sampler2D u_texture;\n    uniform vec2 u_textureSize;\n    varying vec2 v_texCoord;\n\n#endif\n\n    uniform vec4 u_colorAdd;\n\n    varying float v_discardAll;\n    varying vec4 v_colorOverride;\n    varying float v_alphaCorrection;\n\n    uniform float u_alphaMod;\n    uniform float u_alphaMod2;\n\n    uniform sampler2D palette;\n    uniform float white;\n\nvoid main() {\n    if(v_discardAll != 0.0) discard;\n\n#ifndef NO_TEXTURE\n    vec4 c = texture2D(u_texture,v_texCoord / u_textureSize);\n#else\n    vec4 c = vec4(1.0,1.0,1.0,1.0);\n#endif\n    c += u_colorAdd;\n    c *= v_colorOverride;\n    vec4 ic = c;\n    float index = (ic.g * 16.0 + ic.r*16.0 * 16.0)/256.0;\n    c = vec4( \n           mix ( texture2D(palette,vec2(index,0)).xyz, vec3(1,1,1),white) \n        , ic.a );\n    \n    // 모션블러된 값을 보정하는 식\n    // 정확한 값을 구하는 것은 어렵고 근사치를 사용한다.\n    // 모션블러 9개 그리는 것을 기준으로 구한 값\n    // c.a *= 1.0 + (0.23/(1.18 - c.a) - 1.0)*v_alphaCorrection;\n    // 모션블러 15개 기준\n    c.a *= 1.0 + (0.09 / (1.5 - c.a) - 1.0) * v_alphaCorrection;\n    c.rgb *= c.a;\n    gl_FragColor = c;\n}\n            ",Ci=new ue("#define NO_TEXTURE\n"+wi,"#define NO_TEXTURE\n"+bi,null),Ei=new $e;{let t=[],e=[];for(let i=0;i<=255;i++){let s=t.length/2;t.push(i,0,i+1,0,i,1,i+1,1),e.push(s,s+1,s+2,s+1,s+3,s+2)}Ei.setVertexArray(t),Ei.setIndexArray(e)}class Ai{constructor(t){let e=JSON.parse(o.getEmbeddedFile(`pal_${t}.json`));this._rt=new Ye(256,1,!1),this.colorArray=e,this._currentColorArray=e.slice(),this._setArray(),this.fadeInfo=null,this.rotateInfo=null,this.baseShader=new ue(wi,bi,null)}get texture(){return console.log(`aaaaaaaaaaaaaaaaa palette ${this._rt.asset.id}`),this._rt}createShader(t){let e;return t?(e=this.baseShader.clone(),e.setTexture("palette",this._rt),e.setTexture("base",t),e.setConstant("texSize",t.size),e.setConstant("white",0)):(e=Ci,e.setTexture("palette",this._rt),e.setConstant("white",0)),e}add(t,e=0,i=255){for(let s=e;s<=i;s++){let e=o.hex2rgba(this.colorArray[s]),i=[];i[0]=o.clamp(e[0]+t,0,1),i[1]=o.clamp(e[1]+t,0,1),i[2]=o.clamp(e[2]+t,0,1),this._currentColorArray[s]=255*i[0]<<16|255*i[1]<<8|255*i[2]}this._setArray()}fade(t){this.fadeInfo=t}rotate(t){this.rotateInfo=t}_setArray(){let t=this._currentColorArray,e=[];for(let i=0;i<=255;i++)e.push(t[i],1,t[i],1,t[i],1,t[i],1);Ei.setColorArray(e),this._rt.draw(Ei)}process(){if(this.fadeInfo){let t=this.fadeInfo.range?this.fadeInfo.range[0]:0,e=this.fadeInfo.range?this.fadeInfo.range[1]:255,i=this.fadeInfo.start||0,s=this.fadeInfo.end||0,n=this.fadeInfo.duration||0;this.fadeInfo.count=this.fadeInfo.count++||0;let r=Math.min(1,0!=n?this.fadeInfo.count/n:0),a=o.lerp(i,s,r);for(let i=t;i<=e;i++){let t=o.hex2rgba(this.colorArray[i]),e=[];e[0]=o.clamp(t[0]+a,0,1),e[1]=o.clamp(t[1]+a,0,1),e[2]=o.clamp(t[2]+a,0,1),this._currentColorArray[i]=255*e[0]<<16|255*e[1]<<8|255*e[2]}this._setArray(),this.fadeInfo.count++,this.fadeInfo.count>this.fadeInfo.duration&&(this.fadeInfo=null)}this.rotateInfo}static indexToColor(t){return 16*Math.floor(t/16)<<16|t%16*16<<8}}const Ti=[6,2,4,6,6,6,6,3,3,3,5,6,3,6,2,6,6,6,6,6,6,6,6,6,6,6,2,3,4,5,4,4,6,6,6,6,6,6,6,6,6,4,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,3,6,3,4,4,4,5,5,5,5,5,5,5,5,2,3,5,2,6,5,5,5,5,5,5,5,5,5,5,5,5,5,3,2,3,5,5,4,2,4,4,4,4,4,3,3,3,4,4,3,4,2,4,4,4,4,4,4,4,4,4,4,4,2,3,4,4,4,4,6,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,4,3,4,4,3,4,4,4,4,4,4,4,4,2,3,4,2,4,4,4,4,4,4,4,4,4,4,4,4,4,4,3,2,3,4,4,6,2,4,6,6,6,6,3,3,3,5,6,3,6,2,6,6,6,6,6,6,6,6,6,6,6,2,3,4,5,4,4,6,6,6,6,6,5,5,5,4,4,6,6,6,6,6,6,6,6,6,4,4,3,6,6,6,6,6,3,6,3,4,4,4,5,5,5,5,5,5,5,5,2,3,5,2,6,5,5,5,5,5,5,5,5,5,5,5,5,5,3,2,3,5,5],Pi=new Uint8Array([99,54,6,8,0,0,0,46,11,1,5,0,0,0,21,1,3,2,0,0,0,61,12,5,5,0,0,0,68,12,5,5,0,0,0,75,12,5,5,0,0,0,82,12,5,5,0,0,0,26,1,2,2,0,0,0,89,12,2,5,0,0,0,93,12,2,5,0,0,0,97,12,4,5,0,0,0,103,12,5,5,0,0,0,30,1,2,2,0,3,0,1,1,5,1,0,2,0,8,1,1,1,0,4,0,110,12,5,5,0,0,0,117,12,5,5,0,0,0,124,12,3,5,1,0,0,6,16,5,5,0,0,0,13,16,5,5,0,0,0,20,17,5,5,0,0,0,27,17,5,5,0,0,0,34,17,5,5,0,0,0,46,18,5,5,0,0,0,53,18,5,5,0,0,0,60,19,5,5,0,0,0,50,1,1,3,0,1,0,6,4,2,4,0,1,0,1,15,3,5,0,0,0,53,1,4,3,0,1,0,41,17,3,5,0,0,0,67,19,3,5,0,0,0,72,19,5,5,0,0,0,79,19,5,5,0,0,0,86,19,5,5,0,0,0,93,19,5,5,0,0,0,100,19,5,5,0,0,0,107,19,5,5,0,0,0,114,19,5,5,0,0,0,121,19,5,5,0,0,0,6,23,5,5,0,0,0,1,22,3,5,0,0,0,13,23,4,5,0,0,0,19,24,5,5,0,0,0,26,24,5,5,0,0,0,33,24,5,5,0,0,0,44,25,5,5,0,0,0,117,12,5,5,0,0,0,51,25,5,5,0,0,0,58,26,5,5,0,0,0,65,26,5,5,0,0,0,72,26,5,5,0,0,0,79,26,5,5,0,0,0,86,26,5,5,0,0,0,93,26,5,5,0,0,0,100,26,5,5,0,0,0,107,26,5,5,0,0,0,114,26,5,5,0,0,0,121,26,5,5,0,0,0,40,24,2,5,0,0,0,5,30,5,5,0,0,0,1,29,2,5,0,0,0,34,1,3,2,0,0,0,11,1,3,1,0,4,0,10,4,3,4,0,1,0,15,4,4,4,0,1,0,12,30,4,5,0,0,0,21,5,4,4,0,1,0,18,31,4,5,0,0,0,27,5,4,4,0,1,0,24,31,4,5,0,0,0,30,31,4,5,0,1,0,36,31,4,5,0,0,0,42,32,1,5,0,0,0,1,36,2,6,0,0,0,45,32,4,5,0,0,0,51,32,1,5,0,0,0,33,5,5,4,0,1,0,40,5,4,4,0,1,0,50,6,4,4,0,1,0,58,33,4,5,0,1,0,64,33,4,5,0,1,0,56,6,4,4,0,1,0,62,6,4,4,0,1,0,70,33,4,5,0,0,0,68,6,4,4,0,1,0,74,6,4,4,0,1,0,80,6,4,4,0,1,0,86,6,4,4,0,1,0,76,33,4,5,0,1,0,92,6,4,4,0,1,0,54,32,2,5,0,0,0,82,33,1,5,0,0,0,85,33,2,5,0,0,0,39,1,4,2,0,0,0,98,6,4,4,0,1,0,123,47,4,8,0,0,0,46,11,1,5,0,0,0,21,1,3,2,0,0,0,89,33,3,5,0,0,0,94,33,3,5,0,0,0,99,33,3,5,0,0,0,104,6,3,4,0,1,0,26,1,2,2,0,0,0,89,12,2,5,0,0,0,93,12,2,5,0,0,0,59,1,3,3,0,1,0,64,1,3,3,0,1,0,30,1,2,2,0,3,0,16,1,3,1,0,2,0,8,1,1,1,0,4,0,69,1,3,3,0,1,0,104,33,3,5,0,0,0,109,33,1,5,1,0,0,112,33,3,5,0,0,0,117,33,3,5,0,0,0,122,33,3,5,0,0,0,5,37,3,5,0,0,0,10,37,3,5,0,0,0,15,38,3,5,0,0,0,20,38,3,5,0,0,0,25,38,3,5,0,0,0,50,1,1,3,0,1,0,6,4,2,4,0,1,0,1,15,3,5,0,0,0,74,1,3,3,0,1,0,41,17,3,5,0,0,0,67,19,3,5,0,0,0,72,19,5,5,0,0,0,30,38,3,5,0,0,0,35,38,3,5,0,0,0,40,39,3,5,0,0,0,45,39,3,5,0,0,0,50,39,3,5,0,0,0,55,40,3,5,0,0,0,60,40,3,5,0,0,0,65,40,3,5,0,0,0,1,22,3,5,0,0,0,70,40,3,5,0,0,0,75,40,3,5,0,0,0,80,40,3,5,0,0,0,85,40,3,5,0,0,0,90,40,3,5,0,0,0,95,40,3,5,0,0,0,100,40,3,5,0,0,0,105,40,3,5,0,0,0,110,40,3,5,0,0,0,115,40,3,5,0,0,0,120,40,3,5,0,0,0,1,44,3,5,0,0,0,6,44,3,5,0,0,0,11,45,3,5,0,0,0,16,45,3,5,0,0,0,21,45,3,5,0,0,0,26,45,3,5,0,0,0,40,24,2,5,0,0,0,79,1,3,3,0,1,0,1,29,2,5,0,0,0,34,1,3,2,0,0,0,11,1,3,1,0,4,0,46,5,2,4,0,1,0,109,6,3,4,0,1,0,31,45,3,5,0,0,0,114,6,3,4,0,1,0,36,46,3,5,0,0,0,119,6,3,4,0,1,0,41,46,3,5,0,0,0,46,46,3,5,0,1,0,51,47,3,5,0,0,0,42,32,1,5,0,0,0,1,36,2,6,0,0,0,56,47,3,5,0,0,0,51,32,1,5,0,0,0,124,6,3,4,0,1,0,1,9,3,4,0,1,0,6,10,3,4,0,1,0,61,47,3,5,0,1,0,66,47,3,5,0,1,0,11,10,3,4,0,1,0,16,10,3,4,0,1,0,71,47,3,5,0,0,0,21,11,3,4,0,1,0,26,11,3,4,0,1,0,31,11,3,4,0,1,0,36,11,3,4,0,1,0,76,47,3,5,0,1,0,41,11,3,4,0,1,0,54,32,2,5,0,0,0,82,33,1,5,0,0,0,85,33,2,5,0,0,0,45,1,3,2,0,0,0,84,1,3,3,0,2,0,99,54,6,8,0,0,0,46,11,1,5,0,0,0,21,1,3,2,0,0,0,61,12,5,5,0,0,0,68,12,5,5,0,0,0,75,12,5,5,0,0,0,82,12,5,5,0,0,0,26,1,2,2,0,0,0,89,12,2,5,0,0,0,93,12,2,5,0,0,0,97,12,4,5,0,0,0,103,12,5,5,0,0,0,30,1,2,2,0,3,0,1,1,5,1,0,2,0,8,1,1,1,0,4,0,110,12,5,5,0,0,0,81,47,5,5,0,0,0,88,47,5,5,0,0,0,95,47,5,5,0,0,0,102,47,5,5,0,0,0,109,47,5,5,0,0,0,89,1,5,3,0,2,0,116,47,5,5,0,0,0,1,51,5,5,0,0,0,8,52,5,5,0,0,0,15,52,5,5,0,0,0,50,1,1,3,0,1,0,6,4,2,4,0,1,0,1,15,3,5,0,0,0,53,1,4,3,0,1,0,41,17,3,5,0,0,0,67,19,3,5,0,0,0,72,19,5,5,0,0,0,22,52,5,5,0,0,0,29,52,5,5,0,0,0,117,12,5,5,0,0,0,36,53,5,5,0,0,0,96,1,3,3,1,1,0,49,12,4,4,0,0,0,55,12,4,4,0,1,0,101,1,3,3,0,0,0,106,1,3,3,0,2,0,43,53,5,5,0,0,0,50,54,5,5,0,0,0,57,54,5,5,0,0,0,64,54,5,5,0,0,0,71,54,5,5,0,0,0,78,54,5,5,0,0,0,85,54,5,5,0,0,0,111,1,5,3,0,1,0,118,1,5,3,0,1,0,1,4,3,3,0,1,0,64,1,3,3,0,1,0,125,1,2,3,0,1,0,92,54,5,5,0,0,0,100,26,5,5,0,0,0,107,26,5,5,0,0,0,114,26,5,5,0,0,0,121,26,5,5,0,0,0,40,24,2,5,0,0,0,5,30,5,5,0,0,0,1,29,2,5,0,0,0,34,1,3,2,0,0,0,11,1,3,1,0,4,0,10,4,3,4,0,1,0,15,4,4,4,0,1,0,12,30,4,5,0,0,0,21,5,4,4,0,1,0,18,31,4,5,0,0,0,27,5,4,4,0,1,0,24,31,4,5,0,0,0,30,31,4,5,0,1,0,36,31,4,5,0,0,0,42,32,1,5,0,0,0,1,36,2,6,0,0,0,45,32,4,5,0,0,0,51,32,1,5,0,0,0,33,5,5,4,0,1,0,40,5,4,4,0,1,0,50,6,4,4,0,1,0,58,33,4,5,0,1,0,64,33,4,5,0,1,0,56,6,4,4,0,1,0,62,6,4,4,0,1,0,70,33,4,5,0,0,0,68,6,4,4,0,1,0,74,6,4,4,0,1,0,80,6,4,4,0,1,0,86,6,4,4,0,1,0,76,33,4,5,0,1,0,92,6,4,4,0,1,0,54,32,2,5,0,0,0,82,33,1,5,0,0,0,85,33,2,5,0,0,0,39,1,4,2,0,0,0,98,6,4,4,0,1,0]),Mi=new _e("systemfont.png");class Si extends $e{constructor(t,e=Si.FONT_5X5){super(),this._color1=61440,this._color2=61440,this.setPalette(xi.instance.palette),this.fontSet=e,this.setTexture(Mi),t&&this.setText(t)}setPalette(t){let e=t.createShader(Mi);this.setShader(e)}setColor(t,e){this._color1=Ai.indexToColor(t),this._color2=e?Ai.indexToColor(e):this._color1}setText(t){let e=[],i=[],s=[],n=[],o=0,r=0;for(let a=0;a<t.length;a++){let l=t.charCodeAt(a);if(32==l)o+=Ti[96*this.fontSet];else if(10==l)o=0,r+=8;else if(1==l)this.fontSet=Si.FONT_5X5;else if(2==l)this.fontSet=Si.FONT_3X5;else if(3==l)this.fontSet=Si.FONT_SYMBOL;else if(4==l);else if(l>32&&l<=127){let t=672*this.fontSet+7*(l-32),a=Pi.slice(t,t+7),h=i.length/2,[c,d,u,p,f,y,m]=a;e.push(h,h+1,h+2,h+1,h+3,h+2),i.push(o+f,r+y,o+f+u,r+y,o+f,r+y+p,o+f+u,r+y+p),0==m?s.push(c,d,c+u,d,c,d+p,c+u,d+p):s.push(c+p,d,c+p,d+u,c,d,c,d+u),n.push(this._color1,1,this._color1,1,this._color2,1,this._color2,1),o+=Ti[96*this.fontSet+l-32]}}this.setVertexArray(i),this.setIndexArray(e),this.setColorArray(n),this.setTextureCoordinateArray(s)}}Si.FONT_5X5=0,Si.FONT_3X5=1,Si.FONT_SYMBOL=2;const Oi={I:5,J:6,i:5,j:6,l:5,"|":4,"{":6,"}":5},Ri=new Uint8Array([40,43,2,12,2,1,208,65,4,4,2,0,20,15,8,12,0,0,0,30,8,14,0,0,240,0,8,10,0,2,31,0,8,12,0,0,196,72,2,4,3,0,18,30,4,14,2,0,23,58,4,14,2,0,22,73,8,8,0,2,41,13,8,10,0,1,199,72,2,4,3,10,116,51,8,2,0,5,72,70,2,2,2,12,249,0,6,10,1,2,18,45,6,12,1,0,29,15,6,12,1,0,95,13,6,12,1,0,102,13,6,12,1,0,0,60,8,12,0,0,109,13,6,12,1,0,116,13,6,12,1,0,123,13,6,12,1,0,130,13,6,12,1,0,137,13,6,12,1,0,228,13,2,10,2,1,228,24,2,10,2,2,144,13,6,12,1,0,125,51,8,4,0,4,151,13,6,12,1,0,158,13,6,12,1,1,40,0,8,12,0,0,165,13,6,12,1,0,9,45,8,12,0,0,172,13,6,12,1,0,49,0,8,12,0,0,58,0,8,12,0,0,67,0,8,12,0,0,179,13,6,12,1,0,76,0,8,12,0,0,43,37,4,12,0,0,9,58,6,14,0,0,85,0,8,12,0,0,94,0,8,12,0,0,103,0,8,12,0,0,112,0,8,12,0,0,121,0,8,12,0,0,130,0,8,12,0,0,139,0,8,12,0,1,148,0,8,12,0,0,186,13,6,12,1,0,157,0,8,12,0,0,166,0,8,12,0,0,193,13,6,12,1,0,175,0,8,12,0,0,184,0,8,12,0,0,193,0,8,12,0,0,202,0,8,12,0,0,50,24,4,12,2,0,200,13,6,12,1,0,48,37,4,12,2,0,54,50,6,4,1,0,151,58,8,2,0,12,196,77,2,4,3,0,221,26,6,8,1,4,207,13,6,12,0,0,161,35,6,8,1,4,214,13,6,12,1,0,168,35,6,8,1,4,221,13,6,12,1,0,43,24,6,12,1,2,211,0,8,12,0,0,55,24,4,12,0,0,23,28,4,14,0,0,220,0,8,12,0,0,53,37,4,12,0,0,31,73,8,8,0,4,40,73,8,8,0,4,175,35,6,8,1,4,60,24,6,10,0,4,67,24,6,10,1,4,182,35,6,8,0,4,189,35,6,8,1,4,74,24,6,10,0,2,81,24,8,8,0,4,196,35,6,8,1,4,95,26,8,8,0,4,104,26,8,8,0,4,50,13,8,10,0,4,203,35,6,8,1,4,25,43,4,14,0,0,58,37,2,12,0,0,28,58,4,14,0,0,134,51,8,4,0,5,59,13,8,10,0,1,61,35,6,10,0,0,68,35,6,10,0,0,75,35,6,10,0,0,82,33,6,10,0,0,210,35,6,10,0,0,217,35,6,10,0,0,224,35,6,10,0,0,231,11,6,10,0,0,231,22,6,10,0,0,238,11,6,10,0,0,231,33,6,10,0,0,238,22,6,10,0,0,245,11,6,10,0,0,238,33,6,10,0,0,245,22,6,10,0,0,245,33,6,10,0,0,249,44,6,10,0,0,242,51,6,10,0,0,41,62,6,10,0,0,23,43,1,1,0,0,113,26,8,8,0,0,122,26,8,8,0,0,131,26,8,8,0,0,140,26,8,8,0,0,149,26,8,8,0,0,158,26,8,8,0,0,167,26,8,8,0,0,176,26,8,8,0,0,185,26,8,8,0,0,194,26,8,8,0,0,203,26,8,8,0,0,212,26,8,8,0,0,89,35,8,8,0,0,98,35,8,8,0,0,107,35,8,8,0,0,116,35,8,8,0,0,125,35,8,8,0,0,134,35,8,8,0,0,143,35,8,8,0,0,23,43,1,1,0,0,113,26,8,8,0,0,122,26,8,8,0,0,131,26,8,8,0,0,140,26,8,8,0,0,149,26,8,8,0,0,158,26,8,8,0,0,167,26,8,8,0,0,176,26,8,8,0,0,185,26,8,8,0,0,194,26,8,8,0,0,203,26,8,8,0,0,212,26,8,8,0,0,89,35,8,8,0,0,98,35,8,8,0,0,107,35,8,8,0,0,116,35,8,8,0,0,125,35,8,8,0,0,134,35,8,8,0,0,143,35,8,8,0,0,23,43,1,1,0,0,49,73,6,8,0,0,56,73,6,8,0,0,63,73,6,8,0,0,72,61,6,8,0,0,79,61,6,8,0,0,86,61,6,8,0,0,93,61,6,8,0,0,100,61,6,8,0,0,107,61,6,8,0,0,114,61,6,8,0,0,249,55,6,8,0,0,124,63,6,8,0,0,131,63,6,8,0,0,138,63,6,8,0,0,145,63,6,8,0,0,152,61,6,8,0,0,214,58,6,8,0,0,221,58,6,8,0,0,228,58,6,8,0,0,23,43,1,1,0,0,49,73,6,8,0,0,56,73,6,8,0,0,63,73,6,8,0,0,72,61,6,8,0,0,79,61,6,8,0,0,86,61,6,8,0,0,93,61,6,8,0,0,100,61,6,8,0,0,107,61,6,8,0,0,114,61,6,8,0,0,249,55,6,8,0,0,124,63,6,8,0,0,131,63,6,8,0,0,138,63,6,8,0,0,145,63,6,8,0,0,152,61,6,8,0,0,214,58,6,8,0,0,221,58,6,8,0,0,228,58,6,8,0,0,23,43,1,1,0,0,235,58,6,8,0,0,242,62,6,8,0,0,249,64,6,8,0,0,70,73,6,8,0,0,77,73,6,8,0,0,86,61,6,8,0,0,84,73,6,8,0,0,91,73,6,8,0,0,98,73,6,8,0,0,105,73,6,8,0,0,249,55,6,8,0,0,112,73,6,8,0,0,119,73,6,8,0,0,126,73,6,8,0,0,133,73,6,8,0,0,140,73,6,8,0,0,214,58,6,8,0,0,147,73,6,8,0,0,228,58,6,8,0,0,23,43,1,1,0,0,83,44,8,6,0,0,92,44,8,6,0,0,101,44,8,6,0,0,110,44,8,6,0,0,119,44,8,6,0,0,128,44,8,6,0,0,137,44,8,6,0,0,146,44,8,6,0,0,155,44,8,6,0,0,164,44,8,6,0,0,173,44,8,6,0,0,182,44,8,6,0,0,191,44,8,6,0,0,200,44,8,6,0,0,231,44,8,6,0,0,240,44,8,6,0,0,143,51,8,6,0,0,152,51,8,6,0,0,161,51,8,6,0,0,23,43,1,1,0,0,159,65,6,6,0,0,166,65,6,6,0,0,173,65,6,6,0,0,180,65,6,6,0,0,187,65,6,6,0,0,194,65,6,6,0,0,201,65,6,6,0,0,213,67,6,6,0,0,220,67,6,6,0,0,227,67,6,6,0,0,234,67,6,6,0,0,241,71,6,6,0,0,248,73,6,6,0,0,154,72,6,6,0,0,161,72,6,6,0,0,168,72,6,6,0,0,175,72,6,6,0,0,182,72,6,6,0,0,189,72,6,6,0,0,23,43,1,1,0,0,28,28,4,14,6,0,30,43,4,14,5,0,33,58,4,14,6,0,33,28,4,14,5,0,35,43,4,14,4,0,36,13,4,14,5,0,38,28,4,14,4,0,16,58,6,14,3,0,43,50,10,4,0,10,0,0,10,14,0,0,0,15,10,14,0,0,11,15,8,14,0,0,61,46,10,4,0,10,72,46,10,4,0,10,22,0,8,14,0,0,11,0,10,14,0,0,0,45,8,14,0,0,209,46,10,4,0,10,61,51,10,2,0,12,9,30,8,14,0,0,38,58,2,14,6,0,23,43,1,1,0,0,28,28,4,14,6,0,30,43,4,14,5,0,33,58,4,14,6,0,33,28,4,14,5,0,35,43,4,14,4,0,36,13,4,14,5,0,38,28,4,14,4,0,16,58,6,14,3,0,43,50,10,4,0,10,0,0,10,14,0,0,0,15,10,14,0,0,11,15,8,14,0,0,61,46,10,4,0,10,72,46,10,4,0,10,22,0,8,14,0,0,11,0,10,14,0,0,0,45,8,14,0,0,209,46,10,4,0,10,61,51,10,2,0,12,9,30,8,14,0,0,38,58,2,14,6,0,23,43,1,1,0,0,90,24,4,10,6,0,252,11,4,10,5,0,252,22,4,10,6,0,252,33,4,10,5,0,48,62,4,10,4,0,53,62,6,10,3,0,60,62,4,10,4,0,65,61,6,10,3,0,72,51,10,2,0,6,0,73,10,8,0,0,11,73,10,8,0,0,152,35,8,8,0,0,83,51,10,2,0,6,94,51,10,2,0,7,68,13,8,10,0,0,229,0,10,10,0,0,77,13,8,10,0,0,105,51,10,2,0,7,61,51,10,2,0,6,86,13,8,10,0,0,121,61,2,10,6,0,23,43,1,1,0,0,90,24,4,10,6,0,252,11,4,10,5,0,252,22,4,10,6,0,252,33,4,10,5,0,48,62,4,10,4,0,53,62,6,10,3,0,60,62,4,10,4,0,65,61,6,10,3,0,72,51,10,2,0,6,0,73,10,8,0,0,11,73,10,8,0,0,152,35,8,8,0,0,83,51,10,2,0,6,94,51,10,2,0,7,68,13,8,10,0,0,229,0,10,10,0,0,77,13,8,10,0,0,105,51,10,2,0,7,61,51,10,2,0,6,86,13,8,10,0,0,121,61,2,10,6,0,23,43,1,1,0,0,170,51,8,6,0,8,179,51,8,6,0,8,188,51,8,6,0,8,197,51,8,6,0,8,206,51,8,6,0,8,215,51,8,6,0,8,224,51,8,6,0,8,233,51,8,6,0,8,43,55,8,6,0,8,52,55,8,6,0,8,61,54,8,6,0,8,70,54,8,6,0,8,79,54,8,6,0,8,88,54,8,6,0,8,97,54,8,6,0,8,106,54,8,6,0,8,115,54,8,6,0,8,124,56,8,6,0,8,142,58,8,4,0,10,220,46,10,4,0,10,133,56,8,6,0,8,160,58,8,6,0,8,169,58,8,6,0,8,178,58,8,6,0,8,187,58,8,6,0,8,196,58,8,6,0,8,205,58,8,6,0,8,23,43,1,1,0,0,170,51,8,6,0,8,179,51,8,6,0,8,188,51,8,6,0,8,197,51,8,6,0,8,206,51,8,6,0,8,215,51,8,6,0,8,224,51,8,6,0,8,233,51,8,6,0,8,43,55,8,6,0,8,52,55,8,6,0,8,61,54,8,6,0,8,70,54,8,6,0,8,79,54,8,6,0,8,88,54,8,6,0,8,97,54,8,6,0,8,106,54,8,6,0,8,115,54,8,6,0,8,124,56,8,6,0,8,142,58,8,4,0,10,220,46,10,4,0,10,133,56,8,6,0,8,160,58,8,6,0,8,169,58,8,6,0,8,178,58,8,6,0,8,187,58,8,6,0,8,196,58,8,6,0,8,205,58,8,6,0,8,23,43,1,1,0,0,170,51,8,6,1,8,179,51,8,6,1,8,188,51,8,6,1,8,197,51,8,6,1,8,206,51,8,6,1,8,215,51,8,6,1,8,224,51,8,6,1,8,233,51,8,6,1,8,43,55,8,6,1,8,52,55,8,6,1,8,61,54,8,6,1,8,70,54,8,6,1,8,79,54,8,6,1,8,88,54,8,6,1,8,97,54,8,6,1,8,106,54,8,6,1,8,115,54,8,6,1,8,124,56,8,6,1,8,142,58,8,4,1,10,220,46,10,4,0,10,133,56,8,6,1,8,160,58,8,6,1,8,169,58,8,6,1,8,178,58,8,6,1,8,187,58,8,6,1,8,196,58,8,6,1,8,205,58,8,6,1,8,23,43,1,1,0,0,170,51,8,6,0,8,179,51,8,6,0,8,188,51,8,6,0,8,197,51,8,6,0,8,206,51,8,6,0,8,215,51,8,6,0,8,224,51,8,6,0,8,233,51,8,6,0,8,43,55,8,6,0,8,52,55,8,6,0,8,61,54,8,6,0,8,70,54,8,6,0,8,79,54,8,6,0,8,88,54,8,6,0,8,97,54,8,6,0,8,106,54,8,6,0,8,115,54,8,6,0,8,124,56,8,6,0,8,142,58,8,4,0,10,220,46,10,4,0,10,133,56,8,6,0,8,160,58,8,6,0,8,169,58,8,6,0,8,178,58,8,6,0,8,187,58,8,6,0,8,196,58,8,6,0,8,205,58,8,6,0,8]),Ii=new _e("hangulfont.png"),ki=new Uint8Array([0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,1,1,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,2,3,3,3]),Bi=new Uint8Array([0,2,0,2,1,2,1,2,3,0,2,1,3,3,1,2,1,3,3,1,1,0,0,0,0,0,0,0,0,1,3,3,3,1,2,4,4,4,2,1,3,0,5,5,5,5,5,5,5,5,6,7,7,7,6,6,7,7,7,6,6,7,5]),Di=new Uint8Array([0,1,0,2,2,2,3,4,5,5,5,5,5,5,5,5,6,7,8,7,9,10,11,12,13,14,15,16,17,18]);class Li extends $e{constructor(t){super(),this._color1=61440,this._color2=61440,this.setTexture(Ii),t&&this.setText(t),this.once(s.ADDED_TO_STAGE,(()=>{this.setPalette(xi.instance.palette)}))}setPalette(t){let e=t.createShader(Ii);this.setShader(e)}setColor(t,e){if(this._color1=Ai.indexToColor(t),this._color2=e?Ai.indexToColor(e):this._color1,null!=this.text){let t=this.getColorArraySize(),e=[];for(let i=0;i<t/4;i++)e.push(this._color1,1,this._color1,1,this._color2,1,this._color2,1);this.setColorArray(e)}}setText(t){let e=[],i=[],s=[],n=[],o=0,r=0;this.text=t;let a=t=>{let a=6*t,l=Ri.slice(a,a+6),h=i.length/2,[c,d,u,p,f,y]=l;e.push(h,h+1,h+2,h+1,h+3,h+2),i.push(o+f,r+y,o+f+u,r+y,o+f,r+y+p,o+f+u,r+y+p),s.push(c,d,c+u,d,c,d+p,c+u,d+p),n.push(this._color1,1,this._color1,1,this._color2,1,this._color2,1)};for(let e=0;e<t.length;e++){let i=t.charCodeAt(e);if(32==i)o+=7;else if(10==i)o=0,r+=16;else if(i>32&&i<=127)a(i-33),Oi[t[e]]?o+=Oi[t[e]]:o+=8;else{let t,e,s,n,r,l;i>=12593&&i<=12622?a(95+Di[i-12593]):(i-=44032,t=Math.floor(i/588),e=Math.floor(i%588/28),s=i%28,l=Bi[e],0==s?(r=ki[t],n=Bi[21+e]):(r=ki[19+t],n=Bi[42+e]),a(95+t+20*n),a(255+e+22*r),0!=s&&a(342+s+28*l)),o+=11}}this.setVertexArray(i),this.setIndexArray(e),this.setColorArray(n),this.setTextureCoordinateArray(s)}}const Fi={1:{up:[Pe,Ie],down:[Me,Be],left:[Ae,ke],right:[Te,De],shoot:[Ee,Fe],powerUp:[Se,Le]},2:{up:[Ve],down:[Ue],left:[Oe],right:[Re],shoot:[ze],powerUp:[Xe]}};class Ni extends _i{constructor(t){super(1==t.player?"p_hal":"p_crys");let e=1==t.player?50:110;this.position=Vi.world.getWorldCoordinate(60,e),this.attrib.disableGravity=!0,this.attrib.enableMapCollisionBottom=!0,this.attrib.enableMapCollisionTop=!0,this.attrib.enableMapCollisionLeft=!0,this.attrib.enableMapCollisionRight=!0,this.player=t.player,this.name=1==t.player?"HAL":"O2 ",this.rest=3,this.gameOver=!1,this.score=0,this.maxOption=3,this.readyTimer=0,this.setUpdatePhaseCallback(this.update),this.setMapCollisionPhaseCallback((t=>{0!=t&&this.onHit()})),this.on(s.KEY_DOWN,this.keyHandler.bind(this,!0)),this.on(s.KEY_UP,this.keyHandler.bind(this,!1)),this.inputs={},this.newInputs={},this.optionIndex=0,this.optionBuffer=[],this.resetPowerUp(),this.on("hit",this.onHit)}revive(){this.x=Vi.world.getWorldX(-10),this.setAction(12),this.readyTimer=200,this.attrib.enableFlicker=!0,this.attrib.enableMapCollisionLeft=!1,this.attrib.enableMapCollisionRight=!1,this.attrib.enableMapCollisionTop=!1,this.attrib.enableMapCollisionBottom=!1,this.setMapCollisionPhaseCallback(null),this.gameOver=!1,me.dispatchEvent("continue")}onHit(t){this.gameOver||null!=t&&1!=t.forceHit&&this.readyTimer>0||(this.maxOption=3,Ze.playSound("bang.wav"),me.dispatchEvent("explosion",{x:this.x,y:this.y,count:10,power:1}),this.resetPowerUp(),0==this.rest?(this.inputs.shoot=!1,this.rest=3,this.gameOver=!0,this.setAction(0),this.x=Vi.world.getWorldX(-50),this.velocity.x=0,this.velocity.y=0,this.attrib.enableMapCollisionLeft=!1,this.attrib.enableMapCollisionRight=!1,this.attrib.enableMapCollisionTop=!1,this.attrib.enableMapCollisionBottom=!1,me.dispatchEvent("refreshUI",{player:this.player})):(this.rest--,this.revive()))}resetPowerUp(){this.power=-1,this.isBarEmpty=[!1,!1,!1,!1,!1,!1,!1],this.missile=!1,this.moveSpeed=.55,this.weapon="normal",Array.isArray(this.options)&&this.options.forEach((t=>{t.remove("reset")})),this.options=[],this.shield=null,this.autoShootCoolDown=10,this.autoShootReset=11,this.autoShootCount=this.autoShootReset,this.missileDelay=60,this.missileCount=0}keyHandler(t,e){0==t&&e.keyCode==Ne&&me.dispatchEvent("stage",{stageNumber:2});let i=Fi[this.player];for(let s in i)i[s].indexOf(e.keyCode)>=0&&(t&&!this.inputs[s]&&(this.newInputs[s]=!0),this.inputs[s]=t)}update(){if(this.gameOver)return void(Ui.restCoin>0&&this.inputs.shoot&&(Ui.restCoin--,this.revive(),this.inputs.shoot=!1,Ze.playSound("power.wav")));this.readyTimer&&(this.readyTimer--,0==this.readyTimer&&(this.setMapCollisionPhaseCallback((t=>{0!=t&&this.onHit()})),this.attrib.enableFlicker=!1,this.attrib.enableMapCollisionLeft=!0,this.attrib.enableMapCollisionRight=!0,this.attrib.enableMapCollisionTop=!0,this.attrib.enableMapCollisionBottom=!0));let t=Vi.world.scrollTarget.velocity.x,e=!1;this.readyTimer<140?(this.inputs.up?(this.setAction(1),this.velocity.y=-this.moveSpeed,e=!0):this.inputs.down?(this.setAction(3),this.velocity.y=this.moveSpeed,e=!0):(1==this.action&&this.setAction(2),3==this.action&&this.setAction(4),this.velocity.y=0),this.inputs.left?(this.velocity.x=-this.moveSpeed,e=!0):this.inputs.right?(this.velocity.x=this.moveSpeed,e=!0):this.velocity.x=0):(this.velocity.x=0,this.velocity.y=0),(this.x<Vi.world.getWorldX(5)||this.x>Vi.world.getWorldX(250))&&(this.velocity.x=0,this.x=o.clamp(this.x,Vi.world.getWorldX(5),Vi.world.getWorldX(250))),(this.y<Vi.world.getWorldY(5)||this.y>Vi.world.getWorldY(195))&&(this.velocity.y=0,this.y=o.clamp(this.y,Vi.world.getWorldY(5),Vi.world.getWorldY(195))),this.velocity.x+=t,this.inputs.shoot?this.shoot():this.autoShootCount=this.autoShootReset,this.newInputs.powerUp&&(this.newInputs.powerUp=!1,this.powerUp()),this.missileCount>0&&this.missileCount--,e&&this.options.length>0&&(this.optionBuffer.push([Vi.world.getStageX(this.x),Vi.world.getStageY(this.y)]),this.optionBuffer.length>16*this.optionBuffer.length&&(this.optionBuffer=this.optionBuffer.splice(0,this.optionBuffer.length-16*this.optionBuffer.length)))}optionUpdate(){let t=this.owner;if(t.optionBuffer.length>0){let e=Math.max(0,t.optionBuffer.length-16*this.optionIndex),i=t.optionBuffer[e][0],s=t.optionBuffer[e][1];this.position=Vi.world.getWorldCoordinate(i,s)}else this.position=t.position}shoot(){const t=t=>{let e=this.createVsSprite({x:this.x,y:this.y,action:5});return e.attrib.disableGravity=!0,e.attrib.enableAutoRemoveStageOut=!0,e.attrib.enableMapCollisionRight=!0,e.velocity.x=10,e.setMapCollisionPhaseCallback(((i,s)=>{i&&(Ui.canBreakBlock&&s.collideList.forEach((e=>{t>=10&&(1==e[2]||2==e[2])&&(me.dispatchEvent("explosion",{x:8+(e[0]<<4),y:8+(e[1]<<4),count:1,power:0}),Ze.playSound("zako.wav"),Vi.world.setMap(e[0],e[1],e[2]-1))})),e.remove("block"))})),e.setCollisionPhaseCallback((i=>{for(let s of i)s.isEnemy&&e.checkRange(s,0,0)&&(s.dispatchEvent("hit",{type:"bullet",damage:t,owner:this}),e.remove("enemyHit"))})),e};if(0==this.optionIndex&&this.options.forEach((t=>{t.missile=this.missile,t.missileCount=this.missileCount,t.weapon=this.weapon,t.autoShootCount=this.autoShootCount,t.autoShootCoolDown=this.autoShootCoolDown,t.shoot()})),this.missile&&0==this.missileCount){let e=t(40);e.action=7,e.velocity.x=1.75,e.attrib.enableMapCollisionTop=!0,e.attrib.enableMapCollisionBottom=!0,e.attrib.enableMapCollisionLeft=!0,e.attrib.disableGravity=!1,e.setMapCollisionPhaseCallback((t=>{t&vi.TILEATTRIB_RWALL&&e.remove("block")})),Vi.world.layer2.addChild(e),this.missileCount=this.missileDelay}if(this.autoShootCount--,this.autoShootCount<this.autoShootCoolDown)0==this.autoShootCount&&(this.autoShootCount=this.autoShootReset);else{if("normal"!=this.weapon&&"double"!=this.weapon||(0==this.optionIndex&&Ze.playSound("shoot.wav"),Vi.world.layer2.addChild(t(10))),"double"==this.weapon){let e=t(10);e.velocity.y=-6,e.attrib.enableMapCollisionTop=!0,Vi.world.layer2.addChild(e)}if("laser"==this.weapon){0==this.optionIndex&&this.autoShootCount==this.autoShootReset-1&&Ze.playSound("laser.wav");let e=t(5);e.action=6,e.velocity.x=30,e.attrib.enableMapCollisionTop=!0,e.attrib.enableMapCollisionBottom=!0,e.setUpdatePhaseCallback((()=>{e.y=this.y})),Vi.world.layer2.addChild(e)}}}powerUp(){if(!(this.power<0||this.isBarEmpty[this.power])){switch(Ze.playSound("power.wav"),this.power){case 0:this.moveSpeed+=.5,this.moveSpeed>=3&&(this.isBarEmpty[this.power]=!0);break;case 1:this.missile=!0,this.isBarEmpty[this.power]=!0;break;case 2:this.weapon="double",this.isBarEmpty[this.power]=!0,this.isBarEmpty[3]=!1,this.autoShootCoolDown=10,this.autoShootReset=11;break;case 3:this.weapon="laser",this.isBarEmpty[this.power]=!0,this.isBarEmpty[2]=!1,this.autoShootCoolDown=20,this.autoShootReset=50;break;case 4:{let t=this.createVsSprite({x:this.x,y:this.y,action:8});Object.setPrototypeOf(t,Ni.prototype),t.attrib.disableGravity=!0,t.owner=this,t.player=this.player,t.setUpdatePhaseCallback(this.optionUpdate),this.options.push(t),t.optionIndex=this.options.length,this.options.length==this.maxOption&&(this.isBarEmpty[this.power]=!0),Vi.world.layer2.addChild(t)}break;case 5:{let t=this.createVsSprite({action:13});t.life=100,t.playerNumber=this.player,t.attrib.disableGravity=!0,t.on("hit",(e=>{t.life-=e.damage,t.life<=0&&(t.remove(),this.isBarEmpty[5]=!1,me.dispatchEvent("refreshUI",{player:this.player}))})),t.setUpdatePhaseCallback((()=>{t.white=0})),this.isBarEmpty[this.power]=!0,this.addChild(t),this.shield=t}break;case 6:this.resetPowerUp()}this.power=-1,me.dispatchEvent("refreshUI",{player:this.player})}}}me.on("gameOver",(function(){Ui.restCoin=0;for(let t=1;t<=2;t++)Ui.players[t]&&(Ui.players[t].rest=0,Ui.players[t].dispatchEvent(new s("hit",{forceHit:!0}))),me.dispatchEvent("refreshUI",{player:t})})),me.on("spawn:player",(function(t){let e=new Ni(t);Vi.world.layer3.addChild(e),Ui.players[t.player]=e}));const Ui=new class{constructor(){this.currentStage=0,this.scrollSpeed=0,this.players=[],this.restCoin=0,this.canBreakBlock=!1}};const Vi=xi.instance;me.on("mode:intro",(async function(t){const e=new Ai("demo");Vi.setPalette(e),Vi.backgroundColor=0,Vi.clearChildren();const i=new _i("demo");let n;const o=new pe;function r(t,e,i){let s=new Li;s.setColor(111,96),s.setText(t),s.xy=[e,i],Vi.addChild(s)}function a(t){return new Promise((s=>{if(e.fade({start:-1,end:1,duration:400,range:[96,111]}),t>0){let e=i.getMesh(t+7);e.xy=[15,10],Vi.addChild(e)}n=He.delayedCall(11750,(()=>{Vi.clearChildren(),Vi.addChild(o),s()}))}))}if(Vi.addChild(o),me.dispatchEvent("bgm",{filename:"intro"}),o.on(s.REMOVED_FROM_STAGE,(()=>{n.stop()})),o.on(s.KEY_DOWN,(t=>{t.stopPropagation(),t.keyCode!=Ee&&t.keyCode!=be&&t.keyCode!=Ce||(Vi.clearChildren(),n.stop(),me.dispatchEvent("mode:title"))})),1==t.endingFlag)r("할박사 일행은 우주 대악마 살모사 박사를\n무찌르고 지구로 귀환하였다.\n다시 우주에는 평화가 찾아왔다...",10,120),await a(4),r("지금까지 본 게임을 플레이해주신\n여러분께 깊은 감사를 드립니다.\n오브젝트 스퀘어의 다음 게임인\n학원 호러 어드벤쳐 (8.15해저드)를\n기대해 주십시오! 언제 나올진 몰라요.",10,40),await a(0);else{r("우리는 역사와 민족 앞에 진심으로\n참회하며 이 기록을 남긴다",10,70),r("         1997년 2월\n    표류 850일째, DR.할",80,130),await a(0),r("단기 1997+2333년",10,10),r("오브젝트 스퀘어 앞으로 의문의\n초대장이 도착하였다.",30,30),r("(100K 게임 공모전을 개최한다.\n    - 길어서 삭제 -\n 부디 왕림하여 자리를 빛내주기 바란다)\n        from 하이텔 게임제작동호회",30,70);let t=new _i("demo",{x:128,y:170});Vi.addChild(t),await a(0),r("오브젝트 스퀘어 팀은 3년전 우주 대악마\n살모사 박사에게 대항하기 위해 할박사와\n산소를 보냈다.",10,120),await a(1),r("그러나 공짜로 얻은 캡춰보드를 끼우다\n하드를 날려먹는 오브젝트 스퀘어 팀...\n덕분에 할박사와 산소는 1 스테이지를\n클리어 후 우주미아가 되고만다.",10,120),await a(2),r("지구로 돌아가고 싶은 산소와 할박사,\n그러나 그들은 오브젝트 스퀘어를 원망하지\n않았다!",10,120),await a(3),r("고생 끝에 낙이 오는 법. 공짜를 밝히는\n오브젝트 스퀘어 팀의 야욕과 함께 할박사\n일행은 지구로 돌아온다. 그들에게 내려진\n임무는 공모전에서 상을 타오는 것.",10,120),await a(4),r("100K에 끼워 맞추기 위해 내용을 마구\n삭제한 85되었수다 스페셜과 함께 두명은\n다시 출격하지만, 역시 이번 대회에도\n뭔가 악의 기운이...",10,120),await a(5)}me.dispatchEvent("mode:title")}));me.on("mode:title",(async function(){const t=new Ai("stage1");Vi.setPalette(t),Vi.setWorld(null),Vi.clearChildren(),Vi.backgroundColor=0;{const t=[7,8,15];for(let e=0;e<40;e++){let e=o.random(0,259),i=o.random(0,199),n=o.random(1,3),r=t[o.random(0,2)],a=new We(Ai.indexToColor(r),1);a.setShader(Vi.palette.createShader()),a.xy=[e,i],a.onStage(s.ENTER_FRAME,(function(){a.x-=n,a.x<0&&(a.x=260+o.random(0,259))})),Vi.addChild(a)}}const e=new _i("effect",{x:128,y:40,action:2});Vi.addChild(e);const i=new _i("effect",{x:128,y:40,action:5});Vi.addChild(i);let n=Ui.restCoin=4,r=new Si;r.setText(`1P START\n\n2P START\n\n1P and 2P START\n\nREPLAY INTRO\n\nEXIT TO DOS\n\n\nCONTINUE ${n}`),r.xy=[90,105],Vi.addChild(r),t.fade({start:1,end:0,duration:60,range:[0,254]}),me.dispatchEvent("bgm",{filename:"title"});const a=new _i(["p_hal","p_crys"][o.random(0,1)],{x:75,y:108,action:0});Vi.addChild(a);let l=0,h=He.delayedCall(15e3,(()=>{me.dispatchEvent("mode:intro")}));a.on(s.REMOVED_FROM_STAGE,(()=>{h.stop()})),a.on(s.KEY_DOWN,(async t=>{if(t.keyCode==Pe&&l>0&&(l--,Ze.playSound("zako.wav"),a.y=108+16*l,h.stop(),h.start()),t.keyCode==Me&&l<4&&(l++,Ze.playSound("zako.wav"),a.y=108+16*l,h.stop(),h.start()),t.keyCode==Ce||t.keyCode==Ee||t.keyCode==Fe)if(Ze.playSound("item.wav"),h.stop(),r.removeFromParent(),a.removeFromParent(),3==l)t.stopPropagation(),me.dispatchEvent(new s("mode:intro",{endingFlag:!1}));else if(4==l)t.stopPropagation(),me.dispatchEvent(new s("dialog",{msg:"exit"}));else{let t={coin:n};0==l?(me.dispatchEvent(new s("dialog",{msg:"1p"})),t.player1=!0):1==l?(me.dispatchEvent(new s("dialog",{msg:"2p"})),t.player2=!0):2==l&&(me.dispatchEvent(new s("dialog",{msg:"1p2p"})),t.player1=!0,t.player2=!0),await He.waitFrame(200),me.dispatchEvent("mode:gameLoop",t)}}))}));const Xi={"1p":[{face:"A",time:0,dialog:"에구에구..\n또다시 출격이라니.."}],"2p":[{face:"B",time:0,dialog:"산소, 출격합니다~!"}],"1p2p":[{face:"B",time:3,dialog:"아이템은 공평하게\n나눠먹기에요!"},{face:"A",time:0,dialog:"그거야 능력껏 먹는거지\n헐헐~"}],exit:[{face:"C",time:2,dialog:"갈려고? 그럼 지구는 내 차지닷!\n크푸하타타타타!"},{face:"C",time:2,dialog:"그래 맨날 공부만 해라!\n치사한 녀석 같으니~"},{face:"D",time:4,dialog:"어! 진짜 갈려고? 가지마잉~\n좀 더 해봐잉~"},{face:"E",time:3,dialog:"EXIT TO DOS?"},{face:"E",time:4,dialog:"DOS는 이제 없어\n못나가"},{event:"mode:title"}],9:[{face:"E",time:4,dialog:"나는 제작자A다.\n부디 1등상을 타오기 바란다."},{face:"E",time:4,dialog:"인삼을 먹으면 아래 게이지에\n하나씩 불이 켜진다."},{face:"E",time:4,dialog:"원하는 파워업에 불이 켜질때\n파워업 버튼을 누르면 된다."},{face:"E",time:4,dialog:"할박사는 커서키와\nN, M으로 조종하고"},{face:"E",time:4,dialog:"산소는 WASD키와\nZ, X로 조종하면 된다."},{face:"A",time:0,dialog:"다 아는 거니까 그만해\n시끄럽다.. 쯧."}],16:[{face:"B",time:3,dialog:"앗, 눈이 부셔!"},{face:"A",time:4,dialog:"100k게임에 이 정도의 특수\n효과라니.. 대단하군."},{face:"E",time:0,dialog:"후후후 이 정도를 가지고\n쑥스럽게."}],20:[{face:"B",time:4,dialog:"계속 똑같은 배경만 나오잖아."},{face:"F",time:4,dialog:"뭣이! 자세히 보면\n조금씩 다르단 말이다!"},{face:"A",time:3,dialog:"앗, 자넨 누군가?"},{face:"F",time:4,dialog:"음.. 소개가 늦었군.\n나는 제작자B요."},{face:"F",time:4,dialog:"용량을 아끼느라 그런거니\n배경이 썰렁해도 이해하슈."},{face:"B",time:0,dialog:"지루해.. -_-;"}],27:[{face:"C",time:4,dialog:"훗훗훗.. 드디어 보스군.\n내 이름은 살모사!"},{face:"C",time:4,dialog:"전편에서는 데모에만 나온\n비운의 악역이지!"},{face:"A",time:3,dialog:"살모사 박사라구!\n산소야, 조심해라!"},{face:"B",time:0,dialog:"네, 할아버지!"}],31:[{face:"D",time:4,dialog:"우씨.. 두고보자!"},{face:"B",time:0,dialog:"메에롱~"}],34:[{face:"B",time:4,dialog:"여긴 우리학교잖아!\n근데 왜 이리 이상해?"},{face:"E",time:4,dialog:"용량때문에\n다 삭제해서 그래."},{face:"A",time:3,dialog:"전편에선 좀 나았는데.."},{face:"F",time:0,dialog:"지금 배경은 전편의\n1/10분량의 타일이야!"}],39:[{face:"A",time:3,dialog:"앗.. 도서관이..\n살모사의 짓인가.."},{face:"B",time:3,dialog:"나쁜 녀석..\n아름다운 학교를.."},{face:"F",time:0,dialog:"미안하다.\n용량때문에 내가 그런거야~"}],43:[{face:"B",time:0,dialog:"이게 뭐야 -_-;"}],45:[{face:"E",time:4,dialog:"이봐이봐, 정신차려!\n보스 등장이다!"},{face:"E",time:6,dialog:"이번 보스는..\n전편에 이어 초대형 오리!"},{face:"E",time:4,dialog:"..로 할려고 했는데\n삭제됐다. 험험."},{face:"C",time:4,dialog:"좀 근사한 걸로\n주지 그랬어!"},{face:"A",time:0,dialog:"자, 어쨌든 대결이다!"}],51:[{face:"D",time:4,dialog:"부..분하다!\n보스만 컸어도..!"},{face:"A",time:4,dialog:"자고로 정의는 승리하는 법!"},{face:"B",time:0,dialog:"멋있어요 할아버지~"}],55:[{face:"E",time:4,dialog:"어때,\n1등상은 탈 수 있을것 같나?"},{face:"A",time:4,dialog:"쯧쯔.. 자고로 물욕에\n눈이 어두워선 망하는법."},{face:"E",time:3,dialog:"당신도 라면만 먹으며\n게임 만들어 봐!"},{face:"E",time:3,dialog:"게임제작자가 얼마나\n배고픈지 알아?"},{face:"F",time:3,dialog:"흑흑.. 이 게임 만드느라\n나흘동안 초코파이밖에 못먹었다."},{face:"E",time:3,dialog:"그래 이걸로 한 몫\n잡는거야 제작자B!"},{face:"F",time:0,dialog:"따뜻한 밥이 먹고싶다\n제작자A!"}],63:[{face:"A",time:4,dialog:"왜 계속 우주만 나오는거지."},{face:"F",time:4,dialog:"용량땜에 삭제했어.."},{face:"B",time:4,dialog:"에이 썰렁해!"},{face:"E",time:4,dialog:"너 계속 떠들면\n머리카락 흔들리는 거"},{face:"E",time:4,dialog:"정지시켜버린다!\n6프레임이나 된단말야."},{face:"F",time:3,dialog:"그래 그러자~\n용량이 아깝다."},{face:"B",time:0,dialog:"칫.. 치사해.."}],71:[{face:"E",time:2,dialog:"보스등장!"},{face:"C",time:2,dialog:"제작자 양반,\n이번엔 좀 큰 걸루.."},{face:"E",time:6,dialog:"이번엔 믿어봐!"},{face:"A",time:2,dialog:"아.. 아니 이건..!"},{face:"B",time:4,dialog:"용량 아낀대더니..\n이게 뭐야!"},{face:"A",time:4,dialog:"음.. 자고로.."},{face:"A",time:4,dialog:"좋은게 좋은거지\n^_^;"},{face:"C",time:4,dialog:"맞아 맞아~"},{face:"B",time:0,dialog:"으이구 남자들이란;"}],81:[{face:"D",time:4,dialog:"미인계도 실패야.."},{face:"A",time:4,dialog:"쩝.. 아쉽군."},{face:"B",time:4,dialog:"할아버지!"},{face:"C",time:0,dialog:"두고보자 흑흑.."}],86:[{face:"E",time:4,dialog:"거의 다 왔다.\n이번 판은 좀 어려워."},{face:"A",time:4,dialog:"여기까지 와서\n물러날 순 없지!"},{face:"B",time:4,dialog:"힘내자, 화이팅!"},{face:"F",time:4,dialog:"레이저로는 이 스테이지를\n통과하지 못해."},{face:"F",time:0,dialog:"스테이지 초반에\n'꽝'을 먹어두도록."}],92:[{face:"B",time:4,dialog:"헉헉..\n정말 힘든 스테이지군."},{face:"A",time:4,dialog:"산소야\n여기서 포기하면 안돼."},{face:"F",time:0,dialog:"길을 잘 선택하도록."}],96:[{face:"F",time:3,dialog:"드디어 보스까지 왔군."},{face:"E",time:4,dialog:"이번 보스도 대형이다."},{face:"A",time:3,dialog:"거짓말 마\n이젠 남은 용량이 없을걸."},{face:"B",time:3,dialog:"맞아\n100k 다 썼겠다."},{face:"E",time:6,dialog:"그럼 이건 어때?"},{face:"A",time:3,dialog:"으헉 이게 뭐야 -_-;"},{face:"B",time:3,dialog:"발악을 하는군."},{face:"C",time:0,dialog:"훗훗훗, 이제 너흰 끝장이다!"}],105:[{face:"D",time:2,dialog:"..."},{face:"D",time:2,dialog:"..."},{face:"D",time:2,dialog:"..."},{face:"B",time:4,dialog:"뭐야, 뭐 말할라구."},{face:"D",time:0,dialog:"... T_T"}],111:[{face:"F",time:4,dialog:"드디어 끝판이다.\n훌륭해."},{face:"A",time:4,dialog:"컨티뉴가 몇 개나 남았지."},{face:"B",time:0,dialog:"과연 엔딩을 볼 수 있을까."}],115:[{face:"E",time:4,dialog:"최종보스다, 조심해!"},{face:"C",time:3,dialog:"후후.. 이번에는\n최강의 우주병기,"},{face:"C",time:4,dialog:"최신예 아스카\n불기둥이다!"},{face:"F",time:0,dialog:"저 녀석 언제\n저걸 훔쳤지.."}],monitor:[{face:"C",time:6,dialog:"에잇 그렇다면\n비장의 수단이닷!"},{face:"E",time:3,dialog:"앗 안 돼!!!\n1등상인 모니터다!!"},{face:"F",time:3,dialog:"모니터는 건드리지마!\n게임오버시킬거야!"},{face:"E",time:3,dialog:"비싼건데 T_T"},{face:"C",time:3,dialog:"후후.. 싸우기가\n한결 편해졌는걸."},{face:"A",time:3,dialog:"어떻게 싸우란 말이냐!"},{face:"B",time:3,dialog:"할아버지 조심해요!"},{face:"E",time:0,dialog:"살모사 이 나쁜 놈!\n힘내라 할박사,산소!"}],monitorBroken:[{face:"F",time:3,dialog:"1등상을 터트렸어!"},{face:"E",time:0,dialog:"끝났어! 다 끝났다고!"}],ending:[{face:"C",time:4,dialog:"이, 이런..!\n으으으아악!!"},{face:"D",time:4,dialog:"잘 있어라 동무들아..\n나는 황천에 간다.."},{face:"B",time:4,dialog:"와! 이겼어요\n할아버지!"},{face:"A",time:4,dialog:"휴.. 간신히 이겼군."},{face:"E",time:4,dialog:"잘 했다.\n칭찬해주고 싶군."},{face:"F",time:4,dialog:"핫핫.\n수고 많이했다."},{face:"B",time:4,dialog:"흠..이제 엔딩인가?"},{face:"F",time:4,dialog:"으..엔딩?\n좀 썰렁할텐데."},{face:"B",time:4,dialog:"괜찮으니까 보여줘."},{face:"E",time:4,dialog:"좋아. 이제 게임 끝이다."},{event:"mode:intro",data:{endingFlag:!0}}]},zi=new _i("effect"),$i=new Li;zi.attrib.enableHideMesh=!0,zi.attrib.disableGravity=!0;const Wi=new Ye(200,40),Yi=new ve(Wi);let Hi;function ji(t,e=0){Hi&&Hi.stop(),console.assert(t,"잘못된 메시지 요청");let i=Xi[t][e];null!=i&&(i.event?me.dispatchEvent(new s(i.event,i.data)):(zi.setAction(3,0),zi.xy=[15,180],zi.autoRemoveTimer=120,Vi.addChildAt(zi,Vi.getNumChildren()),Wi.clear(),$i.setPalette(Vi.palette),$i.setColor(0),$i.setText(i.dialog),$i.xy=[1,0],Wi.draw($i),$i.xy=[1,2],Wi.draw($i),$i.xy=[0,1],Wi.draw($i),$i.xy=[2,1],Wi.draw($i),$i.setColor(15),$i.xy=[1,1],Wi.draw($i),zi.addChild(zi.getMesh(i.face.charCodeAt(0)-48)),Hi=He.delayedCall(1e3/60*i.time*30,(()=>{ji(t,e+1)}))))}Yi.xy=[45,5],zi.addChild(Yi),me.on("dialog",(t=>{ji(t.msg,t.index)}));const Gi=[null,function(t){me.dispatchEvent("dialog",{msg:t.var2})},function(t){t.var2},function(){},function(){},function(){},function(){Vi.world.scrollTarget.velocity.x=0,Vi.world.eventTarget.velocity.x=0,me.dispatchEvent("bgm",{filename:"boss"})},function(t){Vi.world.eventTarget.x=t.x,Vi.world.eventTarget.y=t.y,Vi.world.scrollTarget.velocity.x=Ui.scrollSpeed},function(t){return me.dispatchEvent("stage",{stageNumber:t.var2}),!0},function(t){switch(t.var2){case 0:me.dispatchEvent("bgm",{filename:`stage${Ui.currentStage}`}),Vi.palette.fade({start:-1,end:0,duration:300,range:[128,255]});break;case 1:Vi.palette.fade({start:0,end:-1,duration:50,range:[128,255]})}},function(t){t.var2<0?Vi.world.eventData.eventVars[-t.var2].flag=1:Vi.world.eventData.eventVars[t.var2].flag=0,t.var3<0?Vi.world.eventData.eventVars[-t.var3].flag=1:Vi.world.eventData.eventVars[t.var3].flag=0,t.var4<0?Vi.world.eventData.eventVars[-t.var4].flag=1:Vi.world.eventData.eventVars[t.var4].flag=0},function(){},function(t){let e=Vi.world.eventData.eventVars[t.var4];Vi.palette.fade({range:[e.var5,t.var2],start:e.var1/64,end:e.var2/64,duration:e.var4})},function(t){let e=[.1,-.35,-.9,-1.1,-1.18],i=new _i(null,{x:t.x,y:t.y});i.attrib.disableGravity=!0,i.setUpdatePhaseCallback((()=>{if(Vi.world.getStageX(i.x)<Vi.width+10){Vi.palette.fade({start:.7,end:0,duration:300,range:[0,255]});for(let i=0;i<5;i++){let s=new _i("effect",{x:0,y:0,action:o.random(7,8)});s.attrib.disableGravity=!0,s._currentMesh.setBlendMode(pe.BlendModes.ADD),s._currentMesh.alpha=.5,s.setUpdatePhaseCallback((()=>{let n=Vi.world.getStageCoordinate(t.x,t.y),o=n.x-128,r=n.y-100;o*=e[i],r*=e[i];let a=Vi.world.getWorldCoordinate(128+o,100+r);s.x=a.x,s.y=a.y,n.x<-10&&s.remove()})),Vi.world.addChild(s)}i.remove()}})),Vi.world.layer4.addChildAt(i)},function(){me.dispatchEvent(new s("mode:intro",{endingFlag:!0}))},null,null,null,null,null,function(t){let e;for(e=0;e<6;e++)me.dispatchEvent("spawn:zako",{type:"zako1",x:Vi.world.getWorldX(Vi.width+20*e),y:t.y,hp:t.var2,subType:0,level:t.var3,options:{spriteEvent:t,status4:10*e,status3:t.var3}});me.dispatchEvent("spawn:zako",{type:"zako1",x:Vi.world.getWorldX(Vi.width+20*e),y:t.y,hp:t.var2,subType:1,level:t.var3,options:{spriteEvent:t,status4:10*e}})},function(t){me.dispatchEvent("spawn:zako",{type:"zako2",x:t.x,y:t.y,hp:t.var2,timer:t.var3,options:{spriteEvent:t}})},function(t){me.dispatchEvent("spawn:zako",{type:"zako3",x:t.x,y:t.y,hp:t.var2,subType:t.var3,options:{spriteEvent:t}})},function(t){me.dispatchEvent("spawn:zako",{type:"zako4",x:t.x,y:t.y,hp:t.var2,level:t.var3,options:{spriteEvent:t}})},function(t){me.dispatchEvent("spawn:zako",{type:"zako5",x:t.x,y:t.y,hp:t.var2,options:{spriteEvent:t}})},function(t){for(let e=0;e<5;e++)me.dispatchEvent("spawn:zako",{type:"zako6",x:Vi.world.getWorldX(Vi.width+15*e),y:Vi.world.getWorldY(o.random(0,189)+5),hp:t.var2,options:{spriteEvent:t}})},function(t){me.dispatchEvent("spawn:zako",{type:"zako7",x:t.x,y:t.y,hp:t.var2,level:t.var3,options:{spriteEvent:t}})},function(t){me.dispatchEvent("spawn:zako",{type:"zako8",x:t.x,y:t.y,hp:t.var2,level:t.var3,options:{spriteEvent:t}})},function(t){me.dispatchEvent("spawn:zako",{type:"zako9",x:t.x,y:t.y,hp:t.var2,options:{spriteEvent:t}})},function(t){function e(e){me.dispatchEvent("spawn:zako",{type:"zako10",x:Vi.world.getWorldX(o.random(0,119)+100),y:Vi.world.getWorldY(210),subType:e,options:{spriteEvent:t}})}for(let i=0;i<t.var2;i++)e(1);for(let i=0;i<t.var3;i++)e(0);for(let i=0;i<t.var4;i++)e(2);for(let i=0;i<t.var5;i++)e(3);return!0},function(t){me.dispatchEvent(new s("spawn:zako",{type:"zako11",x:t.x,y:t.y,hp:t.var2,options:{spriteEvent:t}}))},function(t){me.dispatchEvent("spawn:zako",{type:"zako12",x:t.x,y:t.y,hp:t.var2,options:{spriteEvent:t}})},function(t){me.dispatchEvent("spawn:zako",{type:"zako13",x:t.x,y:t.y,hp:t.var2,options:{spriteEvent:t}})},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null];function Ki(t,e){let i=t*Math.PI/180;return[Math.cos(i)*e,-Math.sin(i)*e]}me.on("gameEvent",(function(t){if(0==t.eventNumber)return;const e=Vi.world;let i=t.eventNumber;if(null!=i)do{let t=e.eventData.eventVars[i].var1;console.assert(0!=t&&Gi[t],`존재하지 않는 이벤트를 호출 ${t}`);let s=e.eventData.eventVars[i];if(0==s.flag){let e=Gi[t](s);s.flag<255&&s.flag++,i=1!=e&&s.var5>0?s.var5:-1}else i=-1}while(i>0);else Gi[t.eventTypeNum](t.eventVars)}));class qi extends _i{constructor(t){const{type:e,x:i,y:n,hp:r,level:a,subType:l,timer:h}=t;switch(e){case"zako1":super("zako",{x:i,y:n,action:l,life:10*r,level:a,exprosionPower:0,exprosionParticleCount:1,isDropPowerUp:l,scoreBonus:200+300*l}),this.velocity.x=-1,this.attrib.disableGravity=!0,this.attrib.enableMapCollisionLeft=!0,this.attrib.enableMapCollisionRight=!0,this.AI=this.AI_zako1;break;case"zako2":super("zako",{x:i,y:n,action:2,life:5*r,targetPlayerNumber:o.random(0,1),timer:10*h,exprosionPower:1,exprosionParticleCount:5,isDropPowerUp:0==o.random(0,6)?20:0,scoreBonus:1e3}),this.velocity.x=.25,this.attrib.disableGravity=!0,(null==Ui.players[this.targetPlayerNumber+1]||Ui.players[this.targetPlayerNumber+1].gameOver)&&(this.targetPlayerNumber=1-this.targetPlayerNumber),this.AI=this.AI_zako2;break;case"zako3":super("zako",{x:i,y:n,action:3+l,life:5*r,targetPlayerNumber:o.random(0,1),speed:l+1,exprosionPower:1,exprosionParticleCount:5,isDropPowerUp:20,scoreBonus:1500}),(null==Ui.players[this.targetPlayerNumber+1]||Ui.players[this.targetPlayerNumber+1].gameOver)&&(this.targetPlayerNumber=1-this.targetPlayerNumber),this.attrib.disableGravity=!0,this.AI=this.AI_zako3;break;case"zako4":super("zako",{x:i,y:n,action:5,life:10*r,level:a,targetPlayerNumber:o.random(0,1),timer:10*h,exprosionPower:0,exprosionParticleCount:1,isDropPowerUp:0==o.random(0,9)?20:0,scoreBonus:600}),this.status1=1,this.attrib.disableGravity=!1,this.attrib.enableMapCollisionLeft=!0,this.attrib.enableMapCollisionRight=!0,this.attrib.enableMapCollisionBottom=!0,this.AI=this.AI_zako4;break;case"zako5":super("zako",{x:i,y:n,action:6,life:10*r,isShootWhenDie:1,exprosionPower:0,exprosionParticleCount:1,isDropPowerUp:5,scoreBonus:500}),this.velocity.x=.4,this.attrib.disableGravity=!0,this.attrib.enableMapCollisionTop=!0,this.attrib.enableMapCollisionBottom=!0,this.attrib.enableMapCollisionLeft=!0,this.attrib.enableMapCollisionRight=!0;break;case"zako6":super("zako",{x:i,y:n,action:7,life:10*r,exprosionPower:2,exprosionParticleCount:2,isDropPowerUp:0==o.random(0,9)?20:0,scoreBonus:500}),this.velocity.x=-3,this.attrib.disableGravity=!0;break;case"zako7":super("zako",{x:i,y:n,action:8,life:10*r,level:a,timer:0,targetPlayerNumber:0,exprosionPower:1,exprosionParticleCount:5,isDropPowerUp:10*o.random(0,1),scoreBonus:5e3}),a<4&&(t.status1=1),this.flipX=!0,this.attrib.enableMapCollisionBottom=!0,this.status2=0,this.setMapCollisionPhaseCallback((t=>{t&&0==this.status2&&(this.action,this.status2=1)})),this.AI=this.AI_zako7,this.breakFlag=!0;break;case"zako8":super("zako",{x:i,y:n,action:9,life:5*r,level:a,targetPlayerNumber:o.random(0,1),exprosionPower:0,exprosionParticleCount:1,isDropPowerUp:10*o.random(0,1),scoreBonus:700}),(null==Ui.players[this.targetPlayerNumber+1]||Ui.players[this.targetPlayerNumber+1].gameOver)&&(this.targetPlayerNumber=1-this.targetPlayerNumber),this.attrib.disableGravity=!0,this.attrib.enableFlicker=!0,this.AI=this.AI_zako8;break;case"miniDuck":super("zako",{x:i,y:n,action:21,life:50,level:1,targetPlayerNumber:o.random(0,1),exprosionPower:0,exprosionParticleCount:1,isDropPowerUp:5*o.random(0,1),scoreBonus:200}),(null==Ui.players[this.targetPlayerNumber+1]||Ui.players[this.targetPlayerNumber+1].gameOver)&&(this.targetPlayerNumber=1-this.targetPlayerNumber),this.attrib.disableGravity=!0,this.attrib.enableFlicker=!0,this.AI=this.AI_zako8;break;case"zako9":super("zako",{x:i,y:n,action:10,life:10*r,exprosionPower:4,exprosionParticleCount:15,scoreBonus:5e3}),this.velocity.y=1,this.attrib.disableGravity=!0,this.AI=this.AI_zako9;break;case"zako10":super("zako",{x:i,y:n,action:11+l,life:0,isShootWhenDie:2==l?1:0,exprosionPower:4,exprosionParticleCount:1,isDropPowerUp:0==l?10:0,scoreBonus:100+100*l}),this.velocity.x=.05*o.random(-2,5),this.velocity.y=.05*-o.random(1,12),this.setCollisionPhaseCallback(this.collision.bind(this,0)),this.attrib.disableGravity=!0;break;case"zako11":super("zako",{x:Vi.world.getWorldX(370),y:Vi.world.getWorldY(30),action:15,life:10*r,targetPlayerNumber:o.random(0,1),scoreBonus:5e3}),this.animationStopCounter=300,(null==Ui.players[this.targetPlayerNumber+1]||Ui.players[this.targetPlayerNumber+1].gameOver)&&(this.targetPlayerNumber=1-this.targetPlayerNumber),this.attrib.disableGravity=!0,this.AI=this.AI_zako11;break;case"monitor":super("zako",{x:Vi.world.getWorldX(270),y:Vi.world.getWorldY(-30),action:17,life:120,scoreBonus:5e3}),this.attrib.disableGravity=!0,this.velocity.x=-1,this.velocity.y=1,this.AI=this.AI_monitor,me.dispatchEvent(new s("dialog",{msg:"monitor"}));break;case"zako12":super("effect",{x:i,y:n,action:2,life:10*r,exprosionPower:4,exprosionParticleCount:15,scoreBonus:1e4}),this.attrib.disableGravity=!0,this.AI=this.AI_zako12;break;case"zako12-1":super("effect",{x:i,y:n,action:5,life:10*r}),this.attrib.disableGravity=!0;break;case"zako13":super("zako",{x:i+21,y:n-57,action:18,life:10*r,exprosionPower:4,exprosionParticleCount:15,scoreBonus:1e4}),this.status3=1,this.attrib.disableGravity=!0,Vi.world.layer1.addChild(new qi({type:"face",x:i,y:n})),this.AI=this.AI_zako13;break;case"face":super("zako",{x:i+21,y:n-59,action:19,life:1e4,exprosionPower:4,exprosionParticleCount:15,scoreBonus:1e4}),this.status3=1,this.attrib.disableGravity=!0;break;case"swordtrail":super("zako",{x:i,y:n,action:16,life:1e4,scoreBonus:2e4}),this.attrib.disableGravity=!0;break;default:super("zako")}this.life=this.life,this.level=this.level,this.targetPlayerNumber=this.targetPlayerNumber,this.scoreBonus=this.scoreBonus,this.explosionParticleCount=this.explosionParticleCount,this.explosionPower=this.explosionPower,this.isDropPowerUp=this.isDropPowerUp,this.isShootWhenDie=this.isShootWhenDie,this.speed=this.speed,this.isEnemy=!0,this.setUpdatePhaseCallback(this.update),null==this.collisionCallback&&this.setCollisionPhaseCallback(this.collision.bind(this,100)),this.on("hit",this.onHit),this.status4=0,this.on("cleanUp",this.onHit)}update(){this.white=0,(Vi.world.getStageX(this.x)<.5*-this.getWidth()||Vi.world.getStageX(this.x)>1.5*me.logicalViewport.width||Vi.world.getStageY(this.y)<-this.getHeight())&&this.remove("autoRemoveComponent"),this.AI&&this.AI()}collision(t){const e=e=>{const i=Ui.players[e];i&&0==i.readyTimer&&(i.shield&&this.checkRange(i.shield,0,0)&&(t>0&&i.shield.dispatchEvent("hit",{type:"collision",damage:t}),this.dispatchEvent("hit",{type:"collision",damage:100,owner:i})),this.life>=0&&this.checkRange(i,0,0)&&(t>0&&i.dispatchEvent("hit",{type:"collision",damage:t}),this.dispatchEvent("hit",{type:"collision",damage:100,owner:i})))};e(1),e(2)}onHit(t){let{damage:e,owner:i}=t;if(19==this.action&&(e+=100),this.life-=e,this.white=1,i.score+=this.scoreBonus,this.life<=0){if(me.dispatchEvent("explosion",{x:this.x,y:this.y,count:this.explosionParticleCount||0,power:this.explosionPower||0}),this.isDropPowerUp>0&&this.dropPowerUp(this.x+o.random(0,0),this.y,o.random(0,7)),this.remove("die"),this.scoreBonus>=5e3?(15==this.action?me.dispatchEvent(new s("dialog",{msg:"ending"})):17==this.action?(me.dispatchEvent(new s("dialog",{msg:"monitorBroken"})),me.dispatchEvent("gameOver")):15!=this.action&&(me.dispatchEvent("cleanUp",{type:"cleanUp",damage:2e3}),0==Vi.world.scrollTarget.velocity.x&&(me.dispatchEvent("bgm",{filename:"space"}),Vi.world.scrollTarget.velocity.x=.5,Vi.world.eventTarget.velocity.x=.5)),Vi.palette.fade({start:1,end:0,duration:40,range:[0,254]}),Ze.playSound("bang.wav")):Ze.playSound("zako.wav"),17==this.action&&(Ze.playSound("bang.wav"),me.dispatchEvent("explosion",{x:this.x,y:this.y,count:20,power:4}),Ui.restCoin=0),15==this.action&&(i.score+=3e4,Ze.playSound("bang.wav"),me.dispatchEvent("explosion",{x:this.x,y:this.y,count:20,power:4})),this.isShootWhenDie>0){for(let t=0;t<360;t+=22.5)this.shoot(this.x,this.y,...Ki(t,1.5));Ze.playSound("bang.wav")}me.dispatchEvent("refreshUI",{player:i.player})}else Ze.playSound("zako.wav")}shoot(t,e,i,s){let n=new _i("effect",{x:t,y:e,action:6});n.velocity.x=i,n.velocity.y=s,n.autoRemoveTimer=6e3,n.attrib.enableAutoRemoveStageOut=!0,n.attrib.disableGravity=!0,n.attrib.enableMapCollisionTop=!0,n.attrib.enableMapCollisionBottom=!0,n.attrib.enableMapCollisionLeft=!0,n.attrib.enableMapCollisionRight=!0,n.life=1,n.setCollisionPhaseCallback(this.collision.bind(n,10)),n.setMapCollisionPhaseCallback((t=>{t&&n.remove("block")})),n.on("hit",(()=>{n.remove("damage")})),n.on("cleanUp",(()=>{n.remove("cleanUp")})),n.status1=44,Vi.world.layer4.addChild(n)}dropPowerUp(t,e,i){let s=new _i("p_hal",{x:t,y:e,action:i>0?9:10});s.attrib.disableGravity=!0;let n=Ui.players;s.setCollisionPhaseCallback((()=>{function t(t){n[t]&&s.checkRange(n[t],0,0)&&(10==s.action?(Ze.playSound("clear.wav"),s.remove("cleanUp"),Vi.world.dispatchEventWithChildren("cleanUp",{type:"cleanUp",damage:100,owner:n[t]})):(n[t].power=(n[t].power+1)%7,Ze.playSound("item.wav"),me.dispatchEvent("refreshUI",{player:t}),s.remove("powerUp")))}t(1),t(2)})),s.setUpdatePhaseCallback((()=>{Vi.world.getStageX(s.x)<-this.getWidth()&&s.remove("autoRemoveComponent")})),Vi.world.layer4.addChild(s)}AI_zako1(){if(this.status4+=2,this.status4>180&&(this.status4-=360),this.level>1&&(this.velocity.y=.5*Math.sin(this.status4*Math.PI/180)),0==o.random(0,100*(5-this.level)+50)){let t=o.random(0,359);this.shoot(this.x,this.y,...Ki(t,.4))}this.x<Vi.world.getWorldX(25)&&(this.velocity.x=Ui.scrollSpeed+1)}AI_zako2(){if(null==Ui.players[this.targetPlayerNumber+1])return;let t=Ui.players[this.targetPlayerNumber+1].y;if(this.timer--,0==this.timer||this.timer<-255)return this.velocity.x=-5,this.velocity.y=0,void(this.AI=null);this.y<t-5?this.velocity.y=1:this.y>t+5&&(this.velocity.y=-1),this.x<Vi.world.getWorldX(235)&&(this.velocity.x=0)}AI_zako3(){if(null==Ui.players[this.targetPlayerNumber+1])return;let t=Ui.players[this.targetPlayerNumber+1].x,e=Ui.players[this.targetPlayerNumber+1].y;this.y<e-5?this.velocity.y=this.speed:this.y>e+5&&(this.velocity.y=-this.speed),this.x<t+45?this.velocity.x=2:this.x>t+50&&(this.velocity.x=-2)}AI_zako4(){if(null==Ui.players[this.targetPlayerNumber+1])return;let t=Ui.players[this.targetPlayerNumber+1].x,e=Ui.players[this.targetPlayerNumber+1].y;if(0==o.random(0,50)&&(this.targetPlayerNumber=o.random(0,1),(null==Ui.players[this.targetPlayerNumber+1]||Ui.players[this.targetPlayerNumber+1].gameOver)&&(this.targetPlayerNumber=1-this.targetPlayerNumber)),e<this.y&&0==o.random(0,150-10*this.level)){let e=o.random(0,90)*Math.PI/180;t<this.x?this.shoot(this.x,this.y-4,.5*Math.cos(e+90*Math.PI/180),.5*-Math.sin(e+90*Math.PI/180)):this.shoot(this.x,this.y-4,.5*Math.cos(e),.5*-Math.sin(e))}}AI_zako7(){this.timer++,this.timer>240+20*this.level?(this.timer=0,this.flipX=!0):this.timer>200&&0==(7&this.timer)?this.shoot(this.x,this.y,-4,0):this.timer>150&&(this.flipX=!1),0!=this.level&&1==this.status2&&0==o.random(0,100-10*this.level)&&(this.velocity.y=-this.level,this.status2=0)}AI_zako8(){if(null==Ui.players[this.targetPlayerNumber+1])return;let t=Ui.players[this.targetPlayerNumber+1].x,e=Ui.players[this.targetPlayerNumber+1].y;this.status4++,this.status4>120?(this.attrib.enableFlicker=!1,this.setCollisionPhaseCallback(this.collision.bind(this,100)),this.y<e-5?this.velocity.y=.25*(this.level+1)*.5:this.y>e+5?this.velocity.y=.25*-(this.level+1)*.5:this.velocity.y=0,this.x<t-5?this.velocity.x=.25*(this.level+1)*.5+Vi.world.scrollTarget.velocity.x:this.x>t+5?this.velocity.x=.25*-(this.level+1)*.5+Vi.world.scrollTarget.velocity.x:this.velocity.x=Vi.world.scrollTarget.velocity.x):(this.velocity.y=0,this.velocity.x=0,this.setCollisionPhaseCallback(null))}AI_zako9(){if(this.status4++>120?(this.attrib.enableFlicker=!1,this.setCollisionPhaseCallback(this.collision.bind(this,100))):this.setCollisionPhaseCallback(null),this.y<Vi.world.getWorldY(10)&&(this.velocity.y=1),this.y>Vi.world.getWorldY(195)&&(this.velocity.y=-1),0==o.random(0,99)&&(this.shoot(this.x,this.y,...Ki(170,2)),this.shoot(this.x,this.y,...Ki(180,2)),this.shoot(this.x,this.y,...Ki(190,2))),0==o.random(0,99)){let t=new qi({type:"miniDuck",x:this.x,y:this.y});Vi.world.layer3.addChild(t)}}AI_monitor(){this.x<Vi.world.getWorldX(10)&&(this.velocity.x=1),this.x>Vi.world.getWorldX(245)&&(this.velocity.x=-1),this.y<Vi.world.getWorldY(10)&&(this.velocity.y=1),this.y>Vi.world.getWorldY(195)&&(this.velocity.y=-1)}AI_zako11(){let t,e;if(0!=o.random(0,49)||(this.targetPlayerNumber=o.random(0,1),null!=Ui.players[this.targetPlayerNumber+1])){if(this.life<300&&null==this.refSpr){let t=new qi({type:"monitor",x:Vi.world.getWorldX(270),y:Vi.world.getWorldY(-30)});Vi.world.layer3.addChildAt(t),this.refSpr=t,me.dispatchEvent(new s("dialog",{msg:"monitor"}))}if(0!=this.status4||null==this.refSpr?(null!=Ui.players[this.targetPlayerNumber+1]&&(e=Ui.players[this.targetPlayerNumber+1].x,t=Ui.players[this.targetPlayerNumber+1].y),0==o.random(0,99)&&(this.status4=1)):(t=this.refSpr.y,e=this.refSpr.x-40,0==o.random(0,199)&&(this.status4=0)),0==o.random(0,50)&&(this.status4=1-this.status4),this.y<t-5?this.velocity.y=1+this.status4:this.y>t+5?this.velocity.y=-(1+this.status4):this.velocity.y=0,this.x<e+100&&this.x<Vi.world.getWorldX(235)?this.velocity.x=1+this.status4:this.x>e+210?this.velocity.x=-(1+this.status4):this.velocity.x=0,0==o.random(0,100)){let t=new qi({type:"swordtrail",x:this.x,y:this.y,hp:1e5});t.velocity.x=-1,t.acceleration.x=-.05,Vi.world.layer3.addChild(t)}if(0==o.random(0,119)){let t=o.random(0,359);this.shoot(this.x,this.y-4,...Ki(t,.5))}}}AI_zako12(){if(this.status4++>120&&(this.attrib.enableFlicker=!1),this.y<Vi.world.getWorldY(10)&&(this.velocity.y=1),this.y>Vi.world.getWorldY(195)&&(this.velocity.y=-1),0==o.random(0,70)){let t=new qi({type:"zako2",x:this.x,y:this.y,hp:2,timer:10});Vi.world.layer3.addChild(t)}if(0==o.random(0,120)){let t=new qi({type:"zako12-1",x:this.x,y:this.y,hp:20});t.velocity=new ne(...Ki(170,2)),Vi.world.layer3.addChild(t),t=new qi({type:"zako12-1",x:this.x,y:this.y,hp:20}),t.velocity=new ne(...Ki(190,2)),Vi.world.layer3.addChild(t)}}AI_zako13(){if(0==o.random(0,200)){let t=new qi({type:"zako4",x:this.x,y:this.y,hp:5,subType:1});Vi.world.layer3.addChild(t),t.level=13,t.velocity.y=-1,t.velocity.x=.1*o.random(-4,1)}if(0==o.random(0,300)){let t=new qi({type:"zako3",x:Vi.world.getStageX(260),y:this.y,hp:20,subType:1});Vi.world.layer3.addChild(t)}if(0==o.random(0,90)){let t=o.random(140,220);this.shoot(this.x,this.y,...Ki(t-30,1)),this.shoot(this.x,this.y,...Ki(t-20,1)),this.shoot(this.x,this.y,...Ki(t-10,1)),this.shoot(this.x,this.y,...Ki(t,1)),this.shoot(this.x,this.y,...Ki(t+10,1)),this.shoot(this.x,this.y,...Ki(t+20,1)),this.shoot(this.x,this.y,...Ki(t+30,1))}}}me.on("spawn:zako",(function(t){let e=new qi(t);Vi.world.layer3.addChild(e)})),me.on("explosion",(function(t){for(let e=0;e<(t.count||1);e++){let e=new _i("effect",{x:t.x,y:t.y});e.animationStopCounter=o.random(0,t.count),e.attrib.disableGravity=!0,e.attrib.enableAutoRemoveStageOut=!0;let i=o.random(0,359)*Math.PI/180;e.velocity.x=Math.cos(i)*o.random(0,100*t.power)/100,e.velocity.y=Math.sin(i)*o.random(0,100*t.power)/100,Vi.world.layer4.addChild(e)}}));let Ji,Zi,Qi,ts,es,is=new _i,ss=new _i;ss.onStage(s.ENTER_FRAME,(function(){me.dispatchEvent(new s("gameEvent",{eventNumber:Vi.world.getMapEventNumber(this.x,this.y)}))}));let ns=[];function os(t){let e,i=Ui.players[t],n=new pe;if(null==i||i.gameOver)(null==Ui.players[3-t]||Ui.players[3-t].gameOver)&&function(){if(es)return;let t=new Si,e=600;es=t,t.xy=[100,93],Qi=Vi.world.scrollTarget.velocity.x,ts=Vi.world.eventTarget.velocity.x,Vi.world.scrollTarget.velocity.x=0,Vi.world.eventTarget.velocity.x=0,t.on(s.ENTER_FRAME,(()=>{null!=es?(e%60==0&&(Ui.restCoin>0?t.setText("CONTINUE? "+e/60):t.setText("GAME OVER")),e--,e<=-60&&(t.removeFromParent(),es=null,me.dispatchEvent("mode:title"))):t.removeFromParent()})),Vi.addChild(t)}(),e=Ui.restCoin>0?new Si(`CONTINUE ${Ui.restCoin}`):new Si("GAME OVER"),e.xy=[128*(t-1)+40,192],n.addChild(e);else{e=new Si(`${i.name} ${i.rest} ${i.score.toString().padStart(8,"0")}`),e.xy=[128*(t-1)+20,192],n.addChild(e);let s=new _i("effect");for(let e=0;e<7;e++)if(i.power==e){let o=s.getMesh(e);o.xy=[128*(t-1)+20+12*e,185];let r=s.getMesh(i.isBarEmpty[e]?10:9);r.xy=[128*(t-1)+20+12*e,185],n.addChild(r),n.addChild(o)}else{let o=s.getMesh(i.isBarEmpty[e]?8:7);o.xy=[128*(t-1)+20+12*e,185],n.addChild(o)}}ns[t]&&ns[t].removeFromParent(),ns[t]=n,Vi.addChild(n)}async function rs(t){let e,i,s=0,n=!1;switch(Vi.setPalette(new Ai(`stage${t.stageNumber}`)),t.stageNumber){case 1:Vi.palette.rotate(),e=.5,Zi=Ji=.5;break;case 2:Vi.palette.rotate({range:[248,254],speed:4}),e=.5,Zi=Ji=.5;break;case 3:Vi.palette.rotate({range:[236,252],speed:4}),e=.25,Zi=Ji=1,s=1;break;case 4:n=!0,Vi.palette.rotate(),e=.625,Zi=Ji=.625;break;case 5:Vi.palette.rotate(),e=.25,Zi=Ji=.25,s=2,Vi.palette.colorArray[128]=0}if(Vi.palette.add(-1,128,255),me.dispatchEvent("bgm",{filename:"space"}),Vi.world&&(i=Vi.world.position),Vi.setWorld(new vi(`stage${t.stageNumber}`),!0),Vi.world.scrollTarget&&Vi.world.scrollTarget.removeFromParent(),Vi.world.gravity.y=.1388,is.xy=1==s?[-390,180]:2==s?[-308,180]:[-84,180],is.attrib.enableDebug=!0,is.attrib.disableGravity=!0,is.velocity.x=.5,Vi.world.setScrollTarget(is),Vi.world.eventTarget=ss,ss.velocity.x=e,ss.xy=[Vi.world.eventData.eventVars[0].x,Vi.world.eventData.eventVars[0].y],ss.attrib.enableDebug=!0,ss.attrib.disableGravity=!0,Vi.world.layer0.addChild(is),Vi.world.layer0.addChild(ss),Ui.scrollSpeed=e,Ui.canBreakBlock=n,Ui.currentStage=t.stageNumber,Vi.world.processScroll(),i){let t=Vi.world.searchChildren(),e=i.x-Vi.world.x,s=i.y-Vi.world.y;for(let i of t)i instanceof _i&&i!=is&&i!=ss&&(i.x+=e,i.y+=s)}}me.on("bgm",(function(t){Ze.playSingleSound(`${t.filename}.m4a`,.5,!0,"bgm")})),me.on("stage",rs),me.on("mode:gameLoop",(async function(t){Vi.clearChildren(),Vi.backgroundColor=128,Ui.players=[],function(){const t=[7,8,15];for(let e=0;e<40;e++){let e=o.random(0,259),i=o.random(0,199),n=o.random(1,3),r=t[o.random(0,2)],a=new We(Ai.indexToColor(r),1);a.setShader(Vi.palette.createShader()),a.xy=[e,i],a.onStage(s.ENTER_FRAME,(function(){a.x-=Ji/n,a.x<0&&(a.x=260+o.random(0,260))})),Vi.addChild(a)}}(),rs({stageNumber:1}),t.player1&&me.dispatchEvent("spawn:player",{player:1}),t.player2&&me.dispatchEvent("spawn:player",{player:2}),os(1),os(2)})),me.on("refreshUI",(t=>{os(t.player)})),me.on("continue",(function(){es&&(es.removeFromParent(),es=null,Vi.world.scrollTarget.velocity.x=Qi,Vi.world.eventTarget.velocity.x=ts),os(1),os(2)})),me.init(256,200,60,ye.ScaleModes.LETTERBOX),xi.init(),me.setBackgroundColor(0),ge.addChild(new class extends pe{constructor(t){super(),(t||me.touchEnabled)&&this.init(),me.on(s.RESIZE,this.init,this)}init(){this.clearChildren(),this.setDPad(me.logicalRenderBounds.left+50,me.logicalRenderBounds.bottom-50,Pe,Me,Ae,Te),this.setButton(me.logicalRenderBounds.right-70,me.logicalRenderBounds.bottom-40,Ee,16728128),this.setButton(me.logicalRenderBounds.right-40,me.logicalRenderBounds.bottom-60,Le,4194559)}setDPad(t,e,i,n,r,a){let l=t,h=e,c=t,d=e,u=new ve(new _e("vpad50.png"));u.xy=[t,e],u.setAnchorPoint(.5,.5),u.alpha=.2,this.addChild(u);let p=new ve(new _e("vpad5.png"));p.alpha=.5,p.setAnchorPoint(.5,.5),p.setVisible(!1),p.onStage(s.ENTER_FRAME,(()=>{if(xi.instance.world&&Ui.players&&Ui.players[1]){let i=Ui.players[1].x,s=Ui.players[1].y;p.position=xi.instance.world.getStageCoordinate(i,s),p.x+=.6*(c-t),p.y+=.6*(d-e)}})),this.addChild(p);let f=new ve(new _e("vpad30.png"));f.xy=[t,e],f.setAnchorPoint(.5,.5),f.alpha=.3,this.addChild(f);const y={},m=[[i],[i,a],[a],[n,a],[n],[n,r],[r],[i,r],[]],g=(i,s)=>{if(o.distance(t,e,i,s)<10)return 8;let n=180*Math.atan2(i-t,-(s-e))/Math.PI+22.5;return Math.floor((n<0?n+360:n)/45)};f.on(s.POINTER_DOWN,(i=>{if(o.distance(l,h,i.x,i.y)<=100){if(t=i.x,e=i.y,u.xy=[t,e],i.stopPropagation(),f.downId=i.id,f.alpha=.5,f.xy=[i.x,i.y],f.lastDir=g(i.x,i.y),c=i.x,d=i.y,p.setVisible(!0),m[f.lastDir].length>0){let t=new s(s.KEY_DOWN);t.keyCode=m[f.lastDir][0],y[t.keyCode]=!0,xi.instance.dispatchEventWithChildren(t)}if(m[f.lastDir].length>1){let t=new s(s.KEY_DOWN);t.keyCode=m[f.lastDir][1],y[t.keyCode]=!0,xi.instance.dispatchEventWithChildren(t)}}})),f.on(s.POINTER_MOVE,(t=>{if(null!=f.downId&&t.id==f.downId){t.stopPropagation(),f.xy=[t.x,t.y],c=t.x,d=t.y;let e=g(t.x,t.y);if(f.lastDir!=e){f.lastDir=e;for(let t in y){let e=new s(s.KEY_UP);m[f.lastDir].indexOf(t)<0&&(e.keyCode=t,xi.instance.dispatchEventWithChildren(e),delete y[t])}if(m[f.lastDir].length>0&&!y[m[f.lastDir][0]]){let t=new s(s.KEY_DOWN);t.keyCode=m[f.lastDir][0],y[t.keyCode]=!0,xi.instance.dispatchEventWithChildren(t)}if(m[f.lastDir].length>1&&!y[m[f.lastDir][1]]){let t=new s(s.KEY_DOWN);t.keyCode=m[f.lastDir][1],y[t.keyCode]=!0,xi.instance.dispatchEventWithChildren(t)}}}})),f.on(s.POINTER_UP,(i=>{if(i.id==f.downId){i.stopPropagation(),t=l,e=h,u.xy=[t,e],f.alpha=.3,f.xy=[t,e],p.setVisible(!1);for(let t in y){let e=new s(s.KEY_UP);e.keyCode=t,xi.instance.dispatchEventWithChildren(e),delete y[t]}f.downId=null}}))}setButton(t,e,i,n){this.addChild(function(t,e,i,n){let r=new _e("vpad30.png"),a=new ve(r);return a.setColorMultiplier(...o.hex2rgba(n)),a.alpha=.3,a.setAnchorPoint(.5,.5),a.xy=[t,e],a.on(s.POINTER_DOWN,(t=>{if(a.hitTestPoint(t.x,t.y)){t.stopPropagation();let e=new s(s.KEY_DOWN);a.alpha=.5,e.keyCode=i,a.downId=t.id,xi.instance.dispatchEventWithChildren(e)}})),a.on(s.POINTER_UP,(t=>{if(t.id==a.downId){t.stopPropagation();let e=new s(s.KEY_UP);a.alpha=.3,e.keyCode=i,a.downId=null,xi.instance.dispatchEventWithChildren(e)}})),a}(t,e,i,n))}}),ge.on(s.STAGE_VISIBLE,(t=>{t.visible||Ze.stopAllSingleSound(),me.setPaused(!t.visible)})),me.dispatchEvent("mode:title")})()})();